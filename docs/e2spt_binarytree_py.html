


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for e2spt_binarytree.py: 0%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>e2spt_binarytree.py</b> :
            <span class="pc_cov">0%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            244 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">0 run</span>
            <span class="mis shortkey_m button_toggle_mis">244 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">0 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
<p class="legend">Hot-keys on this page</p>
    <div>
<p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
<p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
<p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
<p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="pln"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="pln"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="pln"><a href="#n20">20</a></p>
<p id="n21" class="pln"><a href="#n21">21</a></p>
<p id="n22" class="pln"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="pln"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="pln"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="pln"><a href="#n31">31</a></p>
<p id="n32" class="stm mis"><a href="#n32">32</a></p>
<p id="n33" class="stm mis"><a href="#n33">33</a></p>
<p id="n34" class="stm mis"><a href="#n34">34</a></p>
<p id="n35" class="stm mis"><a href="#n35">35</a></p>
<p id="n36" class="stm mis"><a href="#n36">36</a></p>
<p id="n37" class="stm mis"><a href="#n37">37</a></p>
<p id="n38" class="stm mis"><a href="#n38">38</a></p>
<p id="n39" class="pln"><a href="#n39">39</a></p>
<p id="n40" class="pln"><a href="#n40">40</a></p>
<p id="n41" class="stm mis"><a href="#n41">41</a></p>
<p id="n42" class="stm mis"><a href="#n42">42</a></p>
<p id="n43" class="stm mis"><a href="#n43">43</a></p>
<p id="n44" class="pln"><a href="#n44">44</a></p>
<p id="n45" class="pln"><a href="#n45">45</a></p>
<p id="n46" class="pln"><a href="#n46">46</a></p>
<p id="n47" class="pln"><a href="#n47">47</a></p>
<p id="n48" class="pln"><a href="#n48">48</a></p>
<p id="n49" class="pln"><a href="#n49">49</a></p>
<p id="n50" class="pln"><a href="#n50">50</a></p>
<p id="n51" class="pln"><a href="#n51">51</a></p>
<p id="n52" class="pln"><a href="#n52">52</a></p>
<p id="n53" class="pln"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="pln"><a href="#n55">55</a></p>
<p id="n56" class="pln"><a href="#n56">56</a></p>
<p id="n57" class="pln"><a href="#n57">57</a></p>
<p id="n58" class="stm mis"><a href="#n58">58</a></p>
<p id="n59" class="pln"><a href="#n59">59</a></p>
<p id="n60" class="stm mis"><a href="#n60">60</a></p>
<p id="n61" class="pln"><a href="#n61">61</a></p>
<p id="n62" class="pln"><a href="#n62">62</a></p>
<p id="n63" class="stm mis"><a href="#n63">63</a></p>
<p id="n64" class="pln"><a href="#n64">64</a></p>
<p id="n65" class="stm mis"><a href="#n65">65</a></p>
<p id="n66" class="pln"><a href="#n66">66</a></p>
<p id="n67" class="stm mis"><a href="#n67">67</a></p>
<p id="n68" class="pln"><a href="#n68">68</a></p>
<p id="n69" class="stm mis"><a href="#n69">69</a></p>
<p id="n70" class="pln"><a href="#n70">70</a></p>
<p id="n71" class="stm mis"><a href="#n71">71</a></p>
<p id="n72" class="pln"><a href="#n72">72</a></p>
<p id="n73" class="stm mis"><a href="#n73">73</a></p>
<p id="n74" class="pln"><a href="#n74">74</a></p>
<p id="n75" class="stm mis"><a href="#n75">75</a></p>
<p id="n76" class="pln"><a href="#n76">76</a></p>
<p id="n77" class="pln"><a href="#n77">77</a></p>
<p id="n78" class="pln"><a href="#n78">78</a></p>
<p id="n79" class="stm mis"><a href="#n79">79</a></p>
<p id="n80" class="pln"><a href="#n80">80</a></p>
<p id="n81" class="stm mis"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="stm mis"><a href="#n83">83</a></p>
<p id="n84" class="pln"><a href="#n84">84</a></p>
<p id="n85" class="stm mis"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="stm mis"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="stm mis"><a href="#n89">89</a></p>
<p id="n90" class="pln"><a href="#n90">90</a></p>
<p id="n91" class="pln"><a href="#n91">91</a></p>
<p id="n92" class="stm mis"><a href="#n92">92</a></p>
<p id="n93" class="pln"><a href="#n93">93</a></p>
<p id="n94" class="stm mis"><a href="#n94">94</a></p>
<p id="n95" class="pln"><a href="#n95">95</a></p>
<p id="n96" class="pln"><a href="#n96">96</a></p>
<p id="n97" class="pln"><a href="#n97">97</a></p>
<p id="n98" class="pln"><a href="#n98">98</a></p>
<p id="n99" class="pln"><a href="#n99">99</a></p>
<p id="n100" class="pln"><a href="#n100">100</a></p>
<p id="n101" class="pln"><a href="#n101">101</a></p>
<p id="n102" class="pln"><a href="#n102">102</a></p>
<p id="n103" class="pln"><a href="#n103">103</a></p>
<p id="n104" class="pln"><a href="#n104">104</a></p>
<p id="n105" class="pln"><a href="#n105">105</a></p>
<p id="n106" class="pln"><a href="#n106">106</a></p>
<p id="n107" class="pln"><a href="#n107">107</a></p>
<p id="n108" class="pln"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="pln"><a href="#n110">110</a></p>
<p id="n111" class="pln"><a href="#n111">111</a></p>
<p id="n112" class="stm mis"><a href="#n112">112</a></p>
<p id="n113" class="pln"><a href="#n113">113</a></p>
<p id="n114" class="pln"><a href="#n114">114</a></p>
<p id="n115" class="pln"><a href="#n115">115</a></p>
<p id="n116" class="pln"><a href="#n116">116</a></p>
<p id="n117" class="pln"><a href="#n117">117</a></p>
<p id="n118" class="pln"><a href="#n118">118</a></p>
<p id="n119" class="pln"><a href="#n119">119</a></p>
<p id="n120" class="stm mis"><a href="#n120">120</a></p>
<p id="n121" class="pln"><a href="#n121">121</a></p>
<p id="n122" class="stm mis"><a href="#n122">122</a></p>
<p id="n123" class="pln"><a href="#n123">123</a></p>
<p id="n124" class="stm mis"><a href="#n124">124</a></p>
<p id="n125" class="pln"><a href="#n125">125</a></p>
<p id="n126" class="stm mis"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="stm mis"><a href="#n128">128</a></p>
<p id="n129" class="pln"><a href="#n129">129</a></p>
<p id="n130" class="stm mis"><a href="#n130">130</a></p>
<p id="n131" class="pln"><a href="#n131">131</a></p>
<p id="n132" class="stm mis"><a href="#n132">132</a></p>
<p id="n133" class="pln"><a href="#n133">133</a></p>
<p id="n134" class="pln"><a href="#n134">134</a></p>
<p id="n135" class="pln"><a href="#n135">135</a></p>
<p id="n136" class="pln"><a href="#n136">136</a></p>
<p id="n137" class="pln"><a href="#n137">137</a></p>
<p id="n138" class="stm mis"><a href="#n138">138</a></p>
<p id="n139" class="pln"><a href="#n139">139</a></p>
<p id="n140" class="stm mis"><a href="#n140">140</a></p>
<p id="n141" class="pln"><a href="#n141">141</a></p>
<p id="n142" class="stm mis"><a href="#n142">142</a></p>
<p id="n143" class="pln"><a href="#n143">143</a></p>
<p id="n144" class="stm mis"><a href="#n144">144</a></p>
<p id="n145" class="pln"><a href="#n145">145</a></p>
<p id="n146" class="stm mis"><a href="#n146">146</a></p>
<p id="n147" class="pln"><a href="#n147">147</a></p>
<p id="n148" class="stm mis"><a href="#n148">148</a></p>
<p id="n149" class="pln"><a href="#n149">149</a></p>
<p id="n150" class="stm mis"><a href="#n150">150</a></p>
<p id="n151" class="pln"><a href="#n151">151</a></p>
<p id="n152" class="stm mis"><a href="#n152">152</a></p>
<p id="n153" class="pln"><a href="#n153">153</a></p>
<p id="n154" class="pln"><a href="#n154">154</a></p>
<p id="n155" class="pln"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="pln"><a href="#n157">157</a></p>
<p id="n158" class="stm mis"><a href="#n158">158</a></p>
<p id="n159" class="pln"><a href="#n159">159</a></p>
<p id="n160" class="stm mis"><a href="#n160">160</a></p>
<p id="n161" class="pln"><a href="#n161">161</a></p>
<p id="n162" class="stm mis"><a href="#n162">162</a></p>
<p id="n163" class="pln"><a href="#n163">163</a></p>
<p id="n164" class="stm mis"><a href="#n164">164</a></p>
<p id="n165" class="pln"><a href="#n165">165</a></p>
<p id="n166" class="pln"><a href="#n166">166</a></p>
<p id="n167" class="pln"><a href="#n167">167</a></p>
<p id="n168" class="stm mis"><a href="#n168">168</a></p>
<p id="n169" class="pln"><a href="#n169">169</a></p>
<p id="n170" class="stm mis"><a href="#n170">170</a></p>
<p id="n171" class="pln"><a href="#n171">171</a></p>
<p id="n172" class="stm mis"><a href="#n172">172</a></p>
<p id="n173" class="pln"><a href="#n173">173</a></p>
<p id="n174" class="stm mis"><a href="#n174">174</a></p>
<p id="n175" class="pln"><a href="#n175">175</a></p>
<p id="n176" class="stm mis"><a href="#n176">176</a></p>
<p id="n177" class="pln"><a href="#n177">177</a></p>
<p id="n178" class="stm mis"><a href="#n178">178</a></p>
<p id="n179" class="pln"><a href="#n179">179</a></p>
<p id="n180" class="stm mis"><a href="#n180">180</a></p>
<p id="n181" class="pln"><a href="#n181">181</a></p>
<p id="n182" class="pln"><a href="#n182">182</a></p>
<p id="n183" class="pln"><a href="#n183">183</a></p>
<p id="n184" class="stm mis"><a href="#n184">184</a></p>
<p id="n185" class="pln"><a href="#n185">185</a></p>
<p id="n186" class="stm mis"><a href="#n186">186</a></p>
<p id="n187" class="pln"><a href="#n187">187</a></p>
<p id="n188" class="pln"><a href="#n188">188</a></p>
<p id="n189" class="pln"><a href="#n189">189</a></p>
<p id="n190" class="pln"><a href="#n190">190</a></p>
<p id="n191" class="pln"><a href="#n191">191</a></p>
<p id="n192" class="pln"><a href="#n192">192</a></p>
<p id="n193" class="pln"><a href="#n193">193</a></p>
<p id="n194" class="pln"><a href="#n194">194</a></p>
<p id="n195" class="pln"><a href="#n195">195</a></p>
<p id="n196" class="pln"><a href="#n196">196</a></p>
<p id="n197" class="stm mis"><a href="#n197">197</a></p>
<p id="n198" class="pln"><a href="#n198">198</a></p>
<p id="n199" class="pln"><a href="#n199">199</a></p>
<p id="n200" class="pln"><a href="#n200">200</a></p>
<p id="n201" class="stm mis"><a href="#n201">201</a></p>
<p id="n202" class="pln"><a href="#n202">202</a></p>
<p id="n203" class="pln"><a href="#n203">203</a></p>
<p id="n204" class="pln"><a href="#n204">204</a></p>
<p id="n205" class="stm mis"><a href="#n205">205</a></p>
<p id="n206" class="pln"><a href="#n206">206</a></p>
<p id="n207" class="stm mis"><a href="#n207">207</a></p>
<p id="n208" class="pln"><a href="#n208">208</a></p>
<p id="n209" class="stm mis"><a href="#n209">209</a></p>
<p id="n210" class="pln"><a href="#n210">210</a></p>
<p id="n211" class="stm mis"><a href="#n211">211</a></p>
<p id="n212" class="pln"><a href="#n212">212</a></p>
<p id="n213" class="pln"><a href="#n213">213</a></p>
<p id="n214" class="pln"><a href="#n214">214</a></p>
<p id="n215" class="pln"><a href="#n215">215</a></p>
<p id="n216" class="pln"><a href="#n216">216</a></p>
<p id="n217" class="stm mis"><a href="#n217">217</a></p>
<p id="n218" class="pln"><a href="#n218">218</a></p>
<p id="n219" class="pln"><a href="#n219">219</a></p>
<p id="n220" class="pln"><a href="#n220">220</a></p>
<p id="n221" class="pln"><a href="#n221">221</a></p>
<p id="n222" class="pln"><a href="#n222">222</a></p>
<p id="n223" class="stm mis"><a href="#n223">223</a></p>
<p id="n224" class="stm mis"><a href="#n224">224</a></p>
<p id="n225" class="pln"><a href="#n225">225</a></p>
<p id="n226" class="stm mis"><a href="#n226">226</a></p>
<p id="n227" class="pln"><a href="#n227">227</a></p>
<p id="n228" class="stm mis"><a href="#n228">228</a></p>
<p id="n229" class="stm mis"><a href="#n229">229</a></p>
<p id="n230" class="stm mis"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="stm mis"><a href="#n232">232</a></p>
<p id="n233" class="pln"><a href="#n233">233</a></p>
<p id="n234" class="stm mis"><a href="#n234">234</a></p>
<p id="n235" class="stm mis"><a href="#n235">235</a></p>
<p id="n236" class="pln"><a href="#n236">236</a></p>
<p id="n237" class="pln"><a href="#n237">237</a></p>
<p id="n238" class="pln"><a href="#n238">238</a></p>
<p id="n239" class="pln"><a href="#n239">239</a></p>
<p id="n240" class="pln"><a href="#n240">240</a></p>
<p id="n241" class="pln"><a href="#n241">241</a></p>
<p id="n242" class="stm mis"><a href="#n242">242</a></p>
<p id="n243" class="stm mis"><a href="#n243">243</a></p>
<p id="n244" class="stm mis"><a href="#n244">244</a></p>
<p id="n245" class="pln"><a href="#n245">245</a></p>
<p id="n246" class="stm mis"><a href="#n246">246</a></p>
<p id="n247" class="stm mis"><a href="#n247">247</a></p>
<p id="n248" class="stm mis"><a href="#n248">248</a></p>
<p id="n249" class="pln"><a href="#n249">249</a></p>
<p id="n250" class="pln"><a href="#n250">250</a></p>
<p id="n251" class="stm mis"><a href="#n251">251</a></p>
<p id="n252" class="stm mis"><a href="#n252">252</a></p>
<p id="n253" class="stm mis"><a href="#n253">253</a></p>
<p id="n254" class="stm mis"><a href="#n254">254</a></p>
<p id="n255" class="stm mis"><a href="#n255">255</a></p>
<p id="n256" class="stm mis"><a href="#n256">256</a></p>
<p id="n257" class="pln"><a href="#n257">257</a></p>
<p id="n258" class="stm mis"><a href="#n258">258</a></p>
<p id="n259" class="stm mis"><a href="#n259">259</a></p>
<p id="n260" class="pln"><a href="#n260">260</a></p>
<p id="n261" class="stm mis"><a href="#n261">261</a></p>
<p id="n262" class="stm mis"><a href="#n262">262</a></p>
<p id="n263" class="stm mis"><a href="#n263">263</a></p>
<p id="n264" class="pln"><a href="#n264">264</a></p>
<p id="n265" class="stm mis"><a href="#n265">265</a></p>
<p id="n266" class="pln"><a href="#n266">266</a></p>
<p id="n267" class="stm mis"><a href="#n267">267</a></p>
<p id="n268" class="stm mis"><a href="#n268">268</a></p>
<p id="n269" class="pln"><a href="#n269">269</a></p>
<p id="n270" class="pln"><a href="#n270">270</a></p>
<p id="n271" class="pln"><a href="#n271">271</a></p>
<p id="n272" class="pln"><a href="#n272">272</a></p>
<p id="n273" class="pln"><a href="#n273">273</a></p>
<p id="n274" class="pln"><a href="#n274">274</a></p>
<p id="n275" class="stm mis"><a href="#n275">275</a></p>
<p id="n276" class="stm mis"><a href="#n276">276</a></p>
<p id="n277" class="stm mis"><a href="#n277">277</a></p>
<p id="n278" class="pln"><a href="#n278">278</a></p>
<p id="n279" class="pln"><a href="#n279">279</a></p>
<p id="n280" class="pln"><a href="#n280">280</a></p>
<p id="n281" class="pln"><a href="#n281">281</a></p>
<p id="n282" class="stm mis"><a href="#n282">282</a></p>
<p id="n283" class="stm mis"><a href="#n283">283</a></p>
<p id="n284" class="stm mis"><a href="#n284">284</a></p>
<p id="n285" class="pln"><a href="#n285">285</a></p>
<p id="n286" class="stm mis"><a href="#n286">286</a></p>
<p id="n287" class="pln"><a href="#n287">287</a></p>
<p id="n288" class="stm mis"><a href="#n288">288</a></p>
<p id="n289" class="stm mis"><a href="#n289">289</a></p>
<p id="n290" class="stm mis"><a href="#n290">290</a></p>
<p id="n291" class="stm mis"><a href="#n291">291</a></p>
<p id="n292" class="stm mis"><a href="#n292">292</a></p>
<p id="n293" class="stm mis"><a href="#n293">293</a></p>
<p id="n294" class="stm mis"><a href="#n294">294</a></p>
<p id="n295" class="pln"><a href="#n295">295</a></p>
<p id="n296" class="stm mis"><a href="#n296">296</a></p>
<p id="n297" class="pln"><a href="#n297">297</a></p>
<p id="n298" class="pln"><a href="#n298">298</a></p>
<p id="n299" class="pln"><a href="#n299">299</a></p>
<p id="n300" class="pln"><a href="#n300">300</a></p>
<p id="n301" class="stm mis"><a href="#n301">301</a></p>
<p id="n302" class="stm mis"><a href="#n302">302</a></p>
<p id="n303" class="stm mis"><a href="#n303">303</a></p>
<p id="n304" class="stm mis"><a href="#n304">304</a></p>
<p id="n305" class="pln"><a href="#n305">305</a></p>
<p id="n306" class="stm mis"><a href="#n306">306</a></p>
<p id="n307" class="stm mis"><a href="#n307">307</a></p>
<p id="n308" class="pln"><a href="#n308">308</a></p>
<p id="n309" class="stm mis"><a href="#n309">309</a></p>
<p id="n310" class="pln"><a href="#n310">310</a></p>
<p id="n311" class="stm mis"><a href="#n311">311</a></p>
<p id="n312" class="pln"><a href="#n312">312</a></p>
<p id="n313" class="pln"><a href="#n313">313</a></p>
<p id="n314" class="stm mis"><a href="#n314">314</a></p>
<p id="n315" class="pln"><a href="#n315">315</a></p>
<p id="n316" class="pln"><a href="#n316">316</a></p>
<p id="n317" class="stm mis"><a href="#n317">317</a></p>
<p id="n318" class="pln"><a href="#n318">318</a></p>
<p id="n319" class="pln"><a href="#n319">319</a></p>
<p id="n320" class="pln"><a href="#n320">320</a></p>
<p id="n321" class="pln"><a href="#n321">321</a></p>
<p id="n322" class="pln"><a href="#n322">322</a></p>
<p id="n323" class="pln"><a href="#n323">323</a></p>
<p id="n324" class="pln"><a href="#n324">324</a></p>
<p id="n325" class="pln"><a href="#n325">325</a></p>
<p id="n326" class="pln"><a href="#n326">326</a></p>
<p id="n327" class="pln"><a href="#n327">327</a></p>
<p id="n328" class="pln"><a href="#n328">328</a></p>
<p id="n329" class="pln"><a href="#n329">329</a></p>
<p id="n330" class="pln"><a href="#n330">330</a></p>
<p id="n331" class="pln"><a href="#n331">331</a></p>
<p id="n332" class="pln"><a href="#n332">332</a></p>
<p id="n333" class="pln"><a href="#n333">333</a></p>
<p id="n334" class="pln"><a href="#n334">334</a></p>
<p id="n335" class="pln"><a href="#n335">335</a></p>
<p id="n336" class="stm mis"><a href="#n336">336</a></p>
<p id="n337" class="stm mis"><a href="#n337">337</a></p>
<p id="n338" class="stm mis"><a href="#n338">338</a></p>
<p id="n339" class="stm mis"><a href="#n339">339</a></p>
<p id="n340" class="pln"><a href="#n340">340</a></p>
<p id="n341" class="stm mis"><a href="#n341">341</a></p>
<p id="n342" class="stm mis"><a href="#n342">342</a></p>
<p id="n343" class="pln"><a href="#n343">343</a></p>
<p id="n344" class="stm mis"><a href="#n344">344</a></p>
<p id="n345" class="pln"><a href="#n345">345</a></p>
<p id="n346" class="stm mis"><a href="#n346">346</a></p>
<p id="n347" class="stm mis"><a href="#n347">347</a></p>
<p id="n348" class="pln"><a href="#n348">348</a></p>
<p id="n349" class="pln"><a href="#n349">349</a></p>
<p id="n350" class="pln"><a href="#n350">350</a></p>
<p id="n351" class="stm mis"><a href="#n351">351</a></p>
<p id="n352" class="pln"><a href="#n352">352</a></p>
<p id="n353" class="stm mis"><a href="#n353">353</a></p>
<p id="n354" class="stm mis"><a href="#n354">354</a></p>
<p id="n355" class="pln"><a href="#n355">355</a></p>
<p id="n356" class="stm mis"><a href="#n356">356</a></p>
<p id="n357" class="stm mis"><a href="#n357">357</a></p>
<p id="n358" class="pln"><a href="#n358">358</a></p>
<p id="n359" class="stm mis"><a href="#n359">359</a></p>
<p id="n360" class="pln"><a href="#n360">360</a></p>
<p id="n361" class="pln"><a href="#n361">361</a></p>
<p id="n362" class="stm mis"><a href="#n362">362</a></p>
<p id="n363" class="pln"><a href="#n363">363</a></p>
<p id="n364" class="stm mis"><a href="#n364">364</a></p>
<p id="n365" class="pln"><a href="#n365">365</a></p>
<p id="n366" class="stm mis"><a href="#n366">366</a></p>
<p id="n367" class="stm mis"><a href="#n367">367</a></p>
<p id="n368" class="stm mis"><a href="#n368">368</a></p>
<p id="n369" class="pln"><a href="#n369">369</a></p>
<p id="n370" class="pln"><a href="#n370">370</a></p>
<p id="n371" class="pln"><a href="#n371">371</a></p>
<p id="n372" class="pln"><a href="#n372">372</a></p>
<p id="n373" class="pln"><a href="#n373">373</a></p>
<p id="n374" class="pln"><a href="#n374">374</a></p>
<p id="n375" class="pln"><a href="#n375">375</a></p>
<p id="n376" class="pln"><a href="#n376">376</a></p>
<p id="n377" class="pln"><a href="#n377">377</a></p>
<p id="n378" class="pln"><a href="#n378">378</a></p>
<p id="n379" class="pln"><a href="#n379">379</a></p>
<p id="n380" class="stm mis"><a href="#n380">380</a></p>
<p id="n381" class="pln"><a href="#n381">381</a></p>
<p id="n382" class="stm mis"><a href="#n382">382</a></p>
<p id="n383" class="stm mis"><a href="#n383">383</a></p>
<p id="n384" class="stm mis"><a href="#n384">384</a></p>
<p id="n385" class="pln"><a href="#n385">385</a></p>
<p id="n386" class="stm mis"><a href="#n386">386</a></p>
<p id="n387" class="stm mis"><a href="#n387">387</a></p>
<p id="n388" class="pln"><a href="#n388">388</a></p>
<p id="n389" class="pln"><a href="#n389">389</a></p>
<p id="n390" class="pln"><a href="#n390">390</a></p>
<p id="n391" class="pln"><a href="#n391">391</a></p>
<p id="n392" class="pln"><a href="#n392">392</a></p>
<p id="n393" class="pln"><a href="#n393">393</a></p>
<p id="n394" class="pln"><a href="#n394">394</a></p>
<p id="n395" class="pln"><a href="#n395">395</a></p>
<p id="n396" class="pln"><a href="#n396">396</a></p>
<p id="n397" class="pln"><a href="#n397">397</a></p>
<p id="n398" class="pln"><a href="#n398">398</a></p>
<p id="n399" class="pln"><a href="#n399">399</a></p>
<p id="n400" class="pln"><a href="#n400">400</a></p>
<p id="n401" class="pln"><a href="#n401">401</a></p>
<p id="n402" class="pln"><a href="#n402">402</a></p>
<p id="n403" class="pln"><a href="#n403">403</a></p>
<p id="n404" class="pln"><a href="#n404">404</a></p>
<p id="n405" class="pln"><a href="#n405">405</a></p>
<p id="n406" class="stm mis"><a href="#n406">406</a></p>
<p id="n407" class="pln"><a href="#n407">407</a></p>
<p id="n408" class="pln"><a href="#n408">408</a></p>
<p id="n409" class="pln"><a href="#n409">409</a></p>
<p id="n410" class="pln"><a href="#n410">410</a></p>
<p id="n411" class="pln"><a href="#n411">411</a></p>
<p id="n412" class="stm mis"><a href="#n412">412</a></p>
<p id="n413" class="pln"><a href="#n413">413</a></p>
<p id="n414" class="pln"><a href="#n414">414</a></p>
<p id="n415" class="stm mis"><a href="#n415">415</a></p>
<p id="n416" class="stm mis"><a href="#n416">416</a></p>
<p id="n417" class="stm mis"><a href="#n417">417</a></p>
<p id="n418" class="stm mis"><a href="#n418">418</a></p>
<p id="n419" class="stm mis"><a href="#n419">419</a></p>
<p id="n420" class="pln"><a href="#n420">420</a></p>
<p id="n421" class="pln"><a href="#n421">421</a></p>
<p id="n422" class="pln"><a href="#n422">422</a></p>
<p id="n423" class="stm mis"><a href="#n423">423</a></p>
<p id="n424" class="pln"><a href="#n424">424</a></p>
<p id="n425" class="pln"><a href="#n425">425</a></p>
<p id="n426" class="stm mis"><a href="#n426">426</a></p>
<p id="n427" class="pln"><a href="#n427">427</a></p>
<p id="n428" class="pln"><a href="#n428">428</a></p>
<p id="n429" class="stm mis"><a href="#n429">429</a></p>
<p id="n430" class="stm mis"><a href="#n430">430</a></p>
<p id="n431" class="pln"><a href="#n431">431</a></p>
<p id="n432" class="pln"><a href="#n432">432</a></p>
<p id="n433" class="pln"><a href="#n433">433</a></p>
<p id="n434" class="pln"><a href="#n434">434</a></p>
<p id="n435" class="pln"><a href="#n435">435</a></p>
<p id="n436" class="pln"><a href="#n436">436</a></p>
<p id="n437" class="pln"><a href="#n437">437</a></p>
<p id="n438" class="pln"><a href="#n438">438</a></p>
<p id="n439" class="pln"><a href="#n439">439</a></p>
<p id="n440" class="pln"><a href="#n440">440</a></p>
<p id="n441" class="pln"><a href="#n441">441</a></p>
<p id="n442" class="pln"><a href="#n442">442</a></p>
<p id="n443" class="pln"><a href="#n443">443</a></p>
<p id="n444" class="pln"><a href="#n444">444</a></p>
<p id="n445" class="pln"><a href="#n445">445</a></p>
<p id="n446" class="stm mis"><a href="#n446">446</a></p>
<p id="n447" class="pln"><a href="#n447">447</a></p>
<p id="n448" class="stm mis"><a href="#n448">448</a></p>
<p id="n449" class="pln"><a href="#n449">449</a></p>
<p id="n450" class="pln"><a href="#n450">450</a></p>
<p id="n451" class="pln"><a href="#n451">451</a></p>
<p id="n452" class="pln"><a href="#n452">452</a></p>
<p id="n453" class="pln"><a href="#n453">453</a></p>
<p id="n454" class="pln"><a href="#n454">454</a></p>
<p id="n455" class="pln"><a href="#n455">455</a></p>
<p id="n456" class="pln"><a href="#n456">456</a></p>
<p id="n457" class="pln"><a href="#n457">457</a></p>
<p id="n458" class="pln"><a href="#n458">458</a></p>
<p id="n459" class="pln"><a href="#n459">459</a></p>
<p id="n460" class="pln"><a href="#n460">460</a></p>
<p id="n461" class="pln"><a href="#n461">461</a></p>
<p id="n462" class="stm mis"><a href="#n462">462</a></p>
<p id="n463" class="pln"><a href="#n463">463</a></p>
<p id="n464" class="stm mis"><a href="#n464">464</a></p>
<p id="n465" class="pln"><a href="#n465">465</a></p>
<p id="n466" class="pln"><a href="#n466">466</a></p>
<p id="n467" class="pln"><a href="#n467">467</a></p>
<p id="n468" class="stm mis"><a href="#n468">468</a></p>
<p id="n469" class="stm mis"><a href="#n469">469</a></p>
<p id="n470" class="pln"><a href="#n470">470</a></p>
<p id="n471" class="stm mis"><a href="#n471">471</a></p>
<p id="n472" class="stm mis"><a href="#n472">472</a></p>
<p id="n473" class="pln"><a href="#n473">473</a></p>
<p id="n474" class="stm mis"><a href="#n474">474</a></p>
<p id="n475" class="pln"><a href="#n475">475</a></p>
<p id="n476" class="pln"><a href="#n476">476</a></p>
<p id="n477" class="pln"><a href="#n477">477</a></p>
<p id="n478" class="stm mis"><a href="#n478">478</a></p>
<p id="n479" class="pln"><a href="#n479">479</a></p>
<p id="n480" class="stm mis"><a href="#n480">480</a></p>
<p id="n481" class="stm mis"><a href="#n481">481</a></p>
<p id="n482" class="pln"><a href="#n482">482</a></p>
<p id="n483" class="stm mis"><a href="#n483">483</a></p>
<p id="n484" class="pln"><a href="#n484">484</a></p>
<p id="n485" class="stm mis"><a href="#n485">485</a></p>
<p id="n486" class="stm mis"><a href="#n486">486</a></p>
<p id="n487" class="stm mis"><a href="#n487">487</a></p>
<p id="n488" class="pln"><a href="#n488">488</a></p>
<p id="n489" class="pln"><a href="#n489">489</a></p>
<p id="n490" class="stm mis"><a href="#n490">490</a></p>
<p id="n491" class="pln"><a href="#n491">491</a></p>
<p id="n492" class="stm mis"><a href="#n492">492</a></p>
<p id="n493" class="pln"><a href="#n493">493</a></p>
<p id="n494" class="stm mis"><a href="#n494">494</a></p>
<p id="n495" class="pln"><a href="#n495">495</a></p>
<p id="n496" class="pln"><a href="#n496">496</a></p>
<p id="n497" class="stm mis"><a href="#n497">497</a></p>
<p id="n498" class="pln"><a href="#n498">498</a></p>
<p id="n499" class="pln"><a href="#n499">499</a></p>
<p id="n500" class="pln"><a href="#n500">500</a></p>
<p id="n501" class="stm mis"><a href="#n501">501</a></p>
<p id="n502" class="stm mis"><a href="#n502">502</a></p>
<p id="n503" class="pln"><a href="#n503">503</a></p>
<p id="n504" class="pln"><a href="#n504">504</a></p>
<p id="n505" class="stm mis"><a href="#n505">505</a></p>
<p id="n506" class="stm mis"><a href="#n506">506</a></p>
<p id="n507" class="pln"><a href="#n507">507</a></p>
<p id="n508" class="pln"><a href="#n508">508</a></p>
<p id="n509" class="pln"><a href="#n509">509</a></p>
<p id="n510" class="stm mis"><a href="#n510">510</a></p>
<p id="n511" class="stm mis"><a href="#n511">511</a></p>
<p id="n512" class="stm mis"><a href="#n512">512</a></p>
<p id="n513" class="stm mis"><a href="#n513">513</a></p>
<p id="n514" class="pln"><a href="#n514">514</a></p>
<p id="n515" class="pln"><a href="#n515">515</a></p>
<p id="n516" class="stm mis"><a href="#n516">516</a></p>
<p id="n517" class="pln"><a href="#n517">517</a></p>
<p id="n518" class="pln"><a href="#n518">518</a></p>
<p id="n519" class="pln"><a href="#n519">519</a></p>
<p id="n520" class="pln"><a href="#n520">520</a></p>
<p id="n521" class="pln"><a href="#n521">521</a></p>
<p id="n522" class="pln"><a href="#n522">522</a></p>
<p id="n523" class="pln"><a href="#n523">523</a></p>
<p id="n524" class="stm mis"><a href="#n524">524</a></p>
<p id="n525" class="stm mis"><a href="#n525">525</a></p>
<p id="n526" class="stm mis"><a href="#n526">526</a></p>
<p id="n527" class="pln"><a href="#n527">527</a></p>
<p id="n528" class="pln"><a href="#n528">528</a></p>
<p id="n529" class="pln"><a href="#n529">529</a></p>
<p id="n530" class="stm mis"><a href="#n530">530</a></p>
<p id="n531" class="stm mis"><a href="#n531">531</a></p>
<p id="n532" class="stm mis"><a href="#n532">532</a></p>
<p id="n533" class="pln"><a href="#n533">533</a></p>
<p id="n534" class="stm mis"><a href="#n534">534</a></p>
<p id="n535" class="pln"><a href="#n535">535</a></p>
<p id="n536" class="stm mis"><a href="#n536">536</a></p>
<p id="n537" class="stm mis"><a href="#n537">537</a></p>
<p id="n538" class="stm mis"><a href="#n538">538</a></p>
<p id="n539" class="pln"><a href="#n539">539</a></p>
<p id="n540" class="pln"><a href="#n540">540</a></p>
<p id="n541" class="stm mis"><a href="#n541">541</a></p>
<p id="n542" class="stm mis"><a href="#n542">542</a></p>
<p id="n543" class="pln"><a href="#n543">543</a></p>
<p id="n544" class="pln"><a href="#n544">544</a></p>
<p id="n545" class="pln"><a href="#n545">545</a></p>
<p id="n546" class="pln"><a href="#n546">546</a></p>
<p id="n547" class="pln"><a href="#n547">547</a></p>
<p id="n548" class="stm mis"><a href="#n548">548</a></p>
<p id="n549" class="pln"><a href="#n549">549</a></p>
<p id="n550" class="pln"><a href="#n550">550</a></p>
<p id="n551" class="stm mis"><a href="#n551">551</a></p>
<p id="n552" class="pln"><a href="#n552">552</a></p>
<p id="n553" class="pln"><a href="#n553">553</a></p>
<p id="n554" class="stm mis"><a href="#n554">554</a></p>
<p id="n555" class="stm mis"><a href="#n555">555</a></p>
<p id="n556" class="stm mis"><a href="#n556">556</a></p>
<p id="n557" class="stm mis"><a href="#n557">557</a></p>
<p id="n558" class="stm mis"><a href="#n558">558</a></p>
<p id="n559" class="stm mis"><a href="#n559">559</a></p>
<p id="n560" class="stm mis"><a href="#n560">560</a></p>
<p id="n561" class="pln"><a href="#n561">561</a></p>
<p id="n562" class="stm mis"><a href="#n562">562</a></p>
<p id="n563" class="stm mis"><a href="#n563">563</a></p>
<p id="n564" class="pln"><a href="#n564">564</a></p>
<p id="n565" class="pln"><a href="#n565">565</a></p>
<p id="n566" class="stm mis"><a href="#n566">566</a></p>
<p id="n567" class="stm mis"><a href="#n567">567</a></p>
<p id="n568" class="stm mis"><a href="#n568">568</a></p>
<p id="n569" class="stm mis"><a href="#n569">569</a></p>
<p id="n570" class="stm mis"><a href="#n570">570</a></p>
<p id="n571" class="stm mis"><a href="#n571">571</a></p>
<p id="n572" class="stm mis"><a href="#n572">572</a></p>
<p id="n573" class="pln"><a href="#n573">573</a></p>
<p id="n574" class="pln"><a href="#n574">574</a></p>
<p id="n575" class="pln"><a href="#n575">575</a></p>
<p id="n576" class="stm mis"><a href="#n576">576</a></p>
<p id="n577" class="pln"><a href="#n577">577</a></p>
<p id="n578" class="stm mis"><a href="#n578">578</a></p>
<p id="n579" class="stm mis"><a href="#n579">579</a></p>
<p id="n580" class="pln"><a href="#n580">580</a></p>
<p id="n581" class="pln"><a href="#n581">581</a></p>
<p id="n582" class="pln"><a href="#n582">582</a></p>
<p id="n583" class="pln"><a href="#n583">583</a></p>
<p id="n584" class="stm mis"><a href="#n584">584</a></p>
<p id="n585" class="stm mis"><a href="#n585">585</a></p>
<p id="n586" class="stm mis"><a href="#n586">586</a></p>
<p id="n587" class="stm mis"><a href="#n587">587</a></p>
<p id="n588" class="pln"><a href="#n588">588</a></p>
<p id="n589" class="stm mis"><a href="#n589">589</a></p>
<p id="n590" class="pln"><a href="#n590">590</a></p>
<p id="n591" class="pln"><a href="#n591">591</a></p>
<p id="n592" class="stm mis"><a href="#n592">592</a></p>
<p id="n593" class="stm mis"><a href="#n593">593</a></p>
<p id="n594" class="pln"><a href="#n594">594</a></p>
<p id="n595" class="stm mis"><a href="#n595">595</a></p>
<p id="n596" class="stm mis"><a href="#n596">596</a></p>
<p id="n597" class="stm mis"><a href="#n597">597</a></p>
<p id="n598" class="pln"><a href="#n598">598</a></p>
<p id="n599" class="stm mis"><a href="#n599">599</a></p>
<p id="n600" class="stm mis"><a href="#n600">600</a></p>
<p id="n601" class="stm mis"><a href="#n601">601</a></p>
<p id="n602" class="stm mis"><a href="#n602">602</a></p>
<p id="n603" class="pln"><a href="#n603">603</a></p>
<p id="n604" class="stm mis"><a href="#n604">604</a></p>
<p id="n605" class="stm mis"><a href="#n605">605</a></p>
<p id="n606" class="stm mis"><a href="#n606">606</a></p>
<p id="n607" class="pln"><a href="#n607">607</a></p>
<p id="n608" class="stm mis"><a href="#n608">608</a></p>
<p id="n609" class="pln"><a href="#n609">609</a></p>
<p id="n610" class="stm mis"><a href="#n610">610</a></p>
<p id="n611" class="stm mis"><a href="#n611">611</a></p>
<p id="n612" class="pln"><a href="#n612">612</a></p>
<p id="n613" class="stm mis"><a href="#n613">613</a></p>
<p id="n614" class="stm mis"><a href="#n614">614</a></p>
<p id="n615" class="stm mis"><a href="#n615">615</a></p>
<p id="n616" class="pln"><a href="#n616">616</a></p>
<p id="n617" class="stm mis"><a href="#n617">617</a></p>
<p id="n618" class="pln"><a href="#n618">618</a></p>
<p id="n619" class="stm mis"><a href="#n619">619</a></p>
<p id="n620" class="pln"><a href="#n620">620</a></p>
<p id="n621" class="stm mis"><a href="#n621">621</a></p>
<p id="n622" class="pln"><a href="#n622">622</a></p>
<p id="n623" class="pln"><a href="#n623">623</a></p>
<p id="n624" class="stm mis"><a href="#n624">624</a></p>
<p id="n625" class="stm mis"><a href="#n625">625</a></p>
<p id="n626" class="pln"><a href="#n626">626</a></p>
                
            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com">#!/usr/bin/env python</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="com"># Author: Jesus Galaz-Montoya July/08/2015</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="com"># Last modification: 07/dic/2017</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="com"># Copyright (c) 2011 Baylor College of Medicine</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="com"># This software is issued under a joint BSD/GNU license. You may use the</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="com"># source code in this file under either license. However, note that the</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="pln"><span class="com"># complete EMAN2 and SPARX software packages have some GPL dependencies,</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="com"># so you are responsible for compliance with the licenses of these packages</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="com"># if you opt to use BSD licensing. The warranty disclaimer below holds</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="com"># in either instance.</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="com"># This complete copyright notice must be included in any revised version of the</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="com"># source code. Additional authorship citations may be added, but existing</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="com"># author citations must be preserved.</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="com"># This program is free software; you can redistribute it and/or modify</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln"><span class="com"># it under the terms of the GNU General Public License as published by</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="pln"><span class="com"># the Free Software Foundation; either version 2 of the License, or</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="pln"><span class="com"># (at your option) any later version.</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="com"># This program is distributed in the hope that it will be useful,</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="pln"><span class="com"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="com"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="com"># GNU General Public License for more details.</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="pln"><span class="com"># You should have received a copy of the GNU General Public License</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="com"># along with this program; if not, write to the Free Software</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="com"># Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA&nbsp; 2111-1307 USA</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t32" class="stm mis"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">print_function</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="stm mis"><span class="key">from</span> <span class="nam">EMAN2</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="stm mis"><span class="key">from</span> <span class="nam">EMAN2_utils</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t35" class="stm mis"><span class="key">import</span> <span class="nam">os</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="stm mis"><span class="key">import</span> <span class="nam">sys</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="stm mis"><span class="key">from</span> <span class="nam">EMAN2jsondb</span> <span class="key">import</span> <span class="nam">JSTask</span><span class="op">,</span><span class="nam">jsonclasses</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm mis"><span class="key">from</span> <span class="nam">pprint</span> <span class="key">import</span> <span class="nam">pprint</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t40" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t41" class="stm mis"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progname</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t43" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">usage</span> <span class="op">=</span> <span class="str">&quot;&quot;&quot;prog &lt;output&gt; [options]</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Program to build an initial subtomogram average by averaging pairs from the largest subset</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; in --input that is a power of 2. For example, if you supply an input stack with 100 subtomograms,</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; this program will build an initial reference using 64, since 64 is the largest power of 2 contained in 100.</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; In the first iteration, particle 1 will be averaged with 2, 3 with 4, 5 with 6... etc.</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; 32 new averages (each an average of 2 subtomograms) will be used for the second iteration.</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Again, 1 will be averaged with 2, 3 with 4, etc... yielding 16 new averages.</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; The algorithm continues until the entire subset (64) has been merged into 1 average.</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t52" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; This program imports &#39;preprocfunc&#39; from e2spt_preproc.py and &#39;alignment&#39; from e2spt_classaverage.py</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --mask=mask.sharp:outer_radius=&lt;safe radius&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t55" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --preprocess=filter.lowpass.gauss:cutoff_freq=&lt;1/resolution in A&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t56" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t58" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span> <span class="op">=</span> <span class="nam">EMArgumentParser</span><span class="op">(</span><span class="nam">usage</span><span class="op">=</span><span class="nam">usage</span><span class="op">,</span><span class="nam">version</span><span class="op">=</span><span class="nam">EMANVERSION</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t60" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;sptbtheader&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Options below this label are specific to </span><span class="strut">&nbsp;</span></p>
<p id="t61" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sptbinarytree&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;### sptbinarytree options ###&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">6</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span><span class="nam">mode</span><span class="op">=</span><span class="str">&quot;align&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t62" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t63" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;caheader&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Options below this label are specific to sptclassaverage&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;### sptclassaverage options ###&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t65" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--path&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;spt_bt&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=spt. Directory to store results in. The default is a numbered series of directories containing the prefix &#39;spt&#39;; for example, spt_02 will be the directory by default if &#39;spt_01&#39; already exists.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t67" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--input&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. The name of the input volume stack. MUST be HDF since volume stack support is required.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMSubTomosTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t69" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--npeakstorefine&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=1. The number of best coarse alignments to refine in search of the best final alignment. Default=1.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">9</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">nosharedb</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym[1]&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t71" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--parallel&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;thread:1&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;default=thread:1. Parallelism. See http://blake.bcm.edu/emanwiki/EMAN2/Parallel&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;strbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">19</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t73" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--ppid&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=-1. Set the PID of the parent process, used for cross platform PPID&quot;&quot;&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t75" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--verbose&quot;</span><span class="op">,</span> <span class="str">&quot;-v&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;verbose&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=0. Verbose level [0-9], higner number means higher level of verboseness; 10-11 will trigger many messages that might make little sense since this level of verboseness corresponds to &#39;debugging mode&#39;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t77" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--resume&quot;,type=str,default=&#39;&#39;,help=&quot;&quot;&quot;(Not working currently). tomo_fxorms.json file that contains alignment information for the particles in the set. If the information is incomplete (i.e., there are less elements in the file than particles in the stack), on the first iteration the program will complete the file by working ONLY on particle indexes that are missing. For subsequent iterations, all the particles will be used.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t79" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--plots&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. Turn this option on to generatea plot of the ccc scores during each iteration. Running on a cluster or via ssh remotely might not support plotting.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t81" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--subset&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=0 (not used). Refine only this substet of particles from the stack provided through --input&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t83" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--preavgproc1&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to the raw particle after alignment but before averaging (for example, a threshold to exclude extreme values, or a highphass filter if you have phaseplate data.)&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t85" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--preavgproc2&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to the raw particle after alignment but before averaging (for example, a threshold to exclude extreme values, or a highphass filter if you have phaseplate data.)&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t87" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--weighbytiltaxis&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A,B, where A is an integer number and B a decimal. A represents the location of the tilt axis in the tomogram in pixels (eg.g, for a 4096x4096xZ tomogram, this value should be 2048), and B is the weight of the particles furthest from the tomogram. For example, --weighbytiltaxis=2048,0.5 means that praticles at the tilt axis (with an x coordinate of 2048) will have a weight of 1.0 during averaging, while the distance in the x coordinates of particles not-on the tilt axis will be used to weigh their contribution to the average, with particles at the edge(0+radius or 4096-radius) weighing 0.5, as specified by the value provided for B.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t89" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--weighbyscore&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. This option will weigh the contribution of each subtomogram to the average by score/bestscore.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t91" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--align&quot;,type=str,default=&quot;rotate_translate_3d:search=8:delta=12:dphi=12&quot;,help=&quot;&quot;&quot;This is the aligner used to align particles to the previous class average. Default is rotate_translate_3d:search=8:delta=12:dphi=12, specify &#39;None&#39; (with capital N) to disable.&quot;&quot;&quot;, returnNone=True,guitype=&#39;comboparambox&#39;, choicelist=&#39;re_filter_list(dump_aligners_list(),\&#39;3d\&#39;)&#39;, row=12, col=0, rowspan=1, colspan=3, nosharedb=True, mode=&quot;alignment,breaksym[&#39;rotate_symmetry_3d&#39;]&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--align&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;rotate_translate_3d_tree&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default is rotate_translate_3d_tree. See e2help.py aligners to see the list of parameters the aligner takes (for example, if there&#39;s symmetry, supply --align rotate_translate_3d_tree:sym=icos). This is the aligner used to align particles to the previous class average. Specify &#39;None&#39; (with capital N) to disable.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t94" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--aligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;ccc.tomo.thresh&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=ccc.tomo.thresh. The comparator used for the --align aligner. Do not specify unless you need to use anotherspecific aligner.&quot;&quot;&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span><span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_cmps_list(),\&#39;tomo\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">13</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span><span class="nam">mode</span><span class="op">=</span><span class="str">&quot;alignment,breaksym&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t96" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--output&quot;, type=str, default=&#39;avg.hdf&#39;, help=&quot;&quot;&quot;Default=avg.hdf. The name of the output class-average stack. MUST be HDF since volume stack support is required.&quot;&quot;&quot;, guitype=&#39;strbox&#39;, row=2, col=0, rowspan=1, colspan=3, mode=&#39;alignment,breaksym&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t98" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--classmx&quot;, type=str, default=&#39;&#39;, help=&quot;&quot;&quot;Default=None. The name of the classification matrix specifying how particles in &#39;input&#39; should be grouped. If omitted, all particles will be averaged.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t100" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--ref&quot;, type=str, default=&#39;&#39;, help=&quot;&quot;&quot;Default=None. Reference image(s). Used as an initial alignment reference and for final orientation adjustment if present. This is typically the projections that were used for classification.&quot;&quot;&quot;, guitype=&#39;filebox&#39;, browser=&#39;EMBrowserWidget(withmodal=True,multiselect=True)&#39;, filecheck=False, row=1, col=0, rowspan=1, colspan=3, mode=&#39;alignment&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t102" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--refpreprocess&quot;,action=&quot;store_true&quot;,default=False,help=&quot;&quot;&quot;Default=False. This will preprocess the reference identically to the particles. It is off by default, but it is internally turned on when no reference is supplied.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t104" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--resultmx&quot;,type=str,default=None,help=&quot;&quot;&quot;Default=Npone. Specify an output image to store the result matrix. This is in the same format as the classification matrix. http://blake.bcm.edu/emanwiki/EMAN2/ClassmxFiles&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t106" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--refinemultireftag&quot;, type=str, default=&#39;&#39;, help=&quot;&quot;&quot;Default=&#39;&#39;. DO NOT USE THIS PARAMETER. It is passed on from e2spt_refinemulti.py if needed.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t108" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; ADVANCED parameters</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t111" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--averager&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;mean.tomo&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=mean.tomo. The type of averager used to produce the class average. Default=mean.tomo.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t114" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; PRE-FFT processing parameters</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t118" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--nopreprocprefft&quot;,action=&quot;store_true&quot;,default=False,help=&quot;&quot;&quot;Turns off all preprocessing that happens only once before alignment (--normproc, --mask, --maskfile, --clip, --threshold; i.e., all preprocessing excepting filters --highpass, --lowpass, --preprocess, and --shrink.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t120" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--shrink&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">1</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=1 (no shrinking). Optionally shrink the input volumes by an integer amount for coarse alignment.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;shrinkbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t121" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t122" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--shrinkfine&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">1</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=1 (no shrinking). Optionally shrink the input volumes by an integer amount for refine alignment.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t124" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--threshold&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A threshold applied to the subvolumes after normalization. For example, --threshold=threshold.belowtozero:minval=0 makes all negative pixels equal 0, so that they do not contribute to the correlation score.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;filter\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t126" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--mask&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. Masking processor applied to particles before alignment. IF using --clip, make sure to express outer mask radii as negative pixels from the edge.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">returnNone</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;mask\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">11</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t128" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--maskfile&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. Mask file (3D IMAGE) applied to particles before alignment. Must be in HDF format. Default is None.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--normproc&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None (see &#39;e2help.py processors -v 10&#39; at the command line). Normalization processor applied to particles before alignment. If normalize.mask is used, results of the mask option will be passed in automatically. If you want to turn this option off specify \&#39;None\&#39;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t132" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--clip&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=0 (which means it&#39;s not used). Boxsize to clip particles as part of preprocessing to speed up alignment. For example, the boxsize of the particles might be 100 pixels, but the particles are only 50 pixels in diameter. Aliasing effects are not always as deleterious for all specimens, and sometimes 2x padding isn&#39;t necessary; still, there are some benefits from &#39;oversampling&#39; the data during averaging; so you might still want an average of size 2x, but perhaps particles in a box of 1.5x are sufficiently good for alignment. In this case, you would supply --clip=75&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t134" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t135" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; POST-FFT filtering parameters</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--preprocess&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Any processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to each volume prior to COARSE alignment. Not applied to aligned particles before averaging.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;filter\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t140" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--preprocessfine&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Any processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to each volume prior to FINE alignment. Not applied to aligned particles before averaging.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t142" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--lowpass&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A lowpass filtering processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to each volume prior to COARSE alignment. Not applied to aligned particles before averaging.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;filter\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">17</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t144" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--lowpassfine&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A lowpass filtering processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to each volume prior to FINE alignment. Not applied to aligned particles before averaging.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--highpass&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A highpass filtering processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to each volume prior to COARSE alignment. Not applied to aligned particles before averaging.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;filter\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t148" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--highpassfine&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. A highpass filtering processor (see &#39;e2help.py processors -v 10&#39; at the command line) to be applied to each volume prior to FINE alignment. Not applied to aligned particles before averaging.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t150" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--matchimgs&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. Applies filter.matchto to one image so that it matches the other&#39;s spectral profile during preprocessing for pair-wise alignment purposes.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t151" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t152" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--filterbyfsc&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. If on, this parameter will use dynamic FSC filtering. --lowpass will be used to build initial references if no --ref supplied, then, the FSC between the even and odd initial references will be used to filter the data during preprocessing. If --ref is supplied, --lowpass will be used during the first iteration to align the particles against the reference. Thereafter, the FSC between the most current particle average and the original reference (--ref) will be used in the next iteration.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t154" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t155" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; OTHER ADVANCED parameters</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--radius&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=0 (which means it&#39;s not used by default). Hydrodynamic radius of the particle in Angstroms. This will be used to automatically calculate the angular steps to use in search of the best alignment. Make sure the apix is correct on the particles&#39; headers, sine the radius will be converted from Angstroms to pixels. Then, the fine angular step is equal to 360/(2*pi*radius), and the coarse angular step 4 times that.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--precision&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">1.0</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=1.0. Precision in pixels to use when figuring out alignment parameters automatically using --radius. Precision would be the number of pixels that the the edge of the specimen is moved (rotationally) during the finest sampling, --falign. If precision is 1, then the precision of alignment will be that of the sampling (apix of your images) times the --shrinkfine factor specified.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--search&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">8</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;&quot;Default=8. During COARSE alignment translational search in X, Y and Z, in pixels. Default=8. This WILL overwrite any search: provided through --align, EXCEPT if you provide --search=8, which is the default. In general, just avoid providing search twice (through here and through the aligner, --align). If you do, just be careful to make them consistent to minimize misinterpretation and error.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t164" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--searchfine&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">2</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;&quot;Default=2. During FINE alignment translational search in X, Y and Z, in pixels. Default=2. This WILL overwrite any search: provided through --falign, EXCEPT if you provide --searchfine=2, which is the default. In general, just avoid providing search twice (through here and through the fine aligner --falign). If you do, just be careful to make them consistent to minimize misinterpretation and error.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t166" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--donotaverage&quot;,action=&quot;store_true&quot;, help=&quot;&quot;&quot;If e2spt_refinemulti.py is calling e2spt_classaverage.py, the latter need not average any particles, but rather only yield the alignment results.&quot;&quot;&quot;, default=False)</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t168" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--iterstop&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=0. (Not used). The program is called to convergence by default (all particles merge into one final average). To stop at an intermediate iteration, provide this parameter. For example, --iterstop=1, will only allow the algorithm to complete 1 iteration; --iterstop=2 will allow it to go through 2, etc.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--savesteps&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. If set, will save the average after each iteration to class_#.hdf. Each class in a separate file. Appends to existing files.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t172" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--saveali&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. If set, will save the aligned particle volumes in class_ptcl.hdf. Overwrites existing file.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--saveallalign&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. If set, will save the alignment parameters after each iteration&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--sym&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;sym&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span> <span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;&quot;&quot;Default=None (equivalent to c1). Symmetry to impose -choices are: c&lt;n&gt;, d&lt;n&gt;, h&lt;n&gt;, tet, oct, icos&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;symbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">9</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t178" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--postprocess&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;A processor to be applied to the FINAL volume after averaging the raw volumes in their FINAL orientations, after all iterations are done.&quot;&quot;&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;filter\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">16</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t179" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--procfinelikecoarse&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;If you supply this parameters, particles for fine alignment will be preprocessed identically to particles for coarse alignment by default. If you supply this, but want specific parameters for preprocessing particles for also supply: fine alignment, nd supply fine alignment parameters, such as --lowpassfine, --highpassfine, etc; to preprocess the particles for FINE alignment differently than for COARSE alignment.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t182" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t183" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t184" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--falign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. This is the second stage aligner used to fine-tune the first alignment.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">returnNone</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_aligners_list(),\&#39;refine.*3d\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">14</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">nosharedb</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;alignment,breaksym[None]&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t186" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--faligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;ccc.tomo.thresh&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=ccc.tomo.thresh. The comparator used by the second stage aligner.&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_cmps_list(),\&#39;tomo\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">15</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span><span class="nam">mode</span><span class="op">=</span><span class="str">&quot;alignment,breaksym&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t188" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t189" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--nopreprocprefft&quot;,action=&quot;store_true&quot;,default=False,help=&quot;&quot;&quot;Turns off all preprocessing that happens only once before alignment (--normproc, --mask, --maskfile, --clip, --threshold; i.e., all preprocessing excepting filters --highpass, --lowpass, --preprocess, and --shrink.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t190" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t191" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--keep&quot;,type=float,default=1.0,help=&quot;&quot;&quot;Default=1.0 (all particles kept). The fraction of particles to keep in each class.&quot;&quot;&quot;, guitype=&#39;floatbox&#39;, row=6, col=0, rowspan=1, colspan=1, mode=&#39;alignment,breaksym&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t193" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--keepsig&quot;, action=&quot;store_true&quot;, default=False,help=&quot;&quot;&quot;Default=False. Causes the keep argument to be interpreted in standard deviations.&quot;&quot;&quot;, guitype=&#39;boolbox&#39;, row=6, col=1, rowspan=1, colspan=1, mode=&#39;alignment,breaksym&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t195" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--inixforms&quot;,type=str,default=&quot;&quot;,help=&quot;&quot;&quot;Default=None. .json file containing a dict of transforms to apply to &#39;pre-align&#39; the particles.&quot;&quot;&quot;, guitype=&#39;dirbox&#39;, dirbasename=&#39;spt_|sptsym_&#39;, row=7, col=0,rowspan=1, colspan=2, nosharedb=True, mode=&#39;breaksym&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--breaksym&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. Break symmetry. Do not apply symmetrization after averaging, even if searching the asymmetric unit provided through --sym only for alignment. Default=False&quot;&quot;&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">7</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">nosharedb</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&#39;,breaksym[True]&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t199" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--groups&quot;,type=int,default=0,help=&quot;&quot;&quot;Default=0 (not used; data not split). This parameter will split the data into a user defined number of groups. For purposes of gold-standard FSC computation later, select --group=2.&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t201" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--randomizewedge&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span>&nbsp; <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. This parameter is EXPERIMENTAL. It randomizes the position of the particles BEFORE alignment, to minimize missing wedge bias and artifacts during symmetric alignment where only a fraction of space is scanned&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t202" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t203" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--savepreproc&quot;,action=&quot;store_true&quot;,&nbsp; default=False,help=&quot;&quot;&quot;Default=False. Will save stacks of preprocessed particles (one for coarse alignment and one for fine alignment if preprocessing options are different).&quot;&quot;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t204" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t205" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--autocenter&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. Autocenters each averaged pair during initial average generation with --btref and --hacref. Will also autocenter the average of all particles after each iteration of iterative refinement. Options are --autocenter=xform.centerofmass (self descriptive), or --autocenter=xform.centeracf, which applies auto-convolution on the average.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t207" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--autocentermask&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=None. Masking processor to apply before autocentering. See &#39;e2help.py processors -v 10&#39; at the command line.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t209" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--autocenterpreprocess&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Default=False. This will apply a highpass filter at a frequency of half the box size times the apix, shrink by 2, and apply a low pass filter at half nyquist frequency to any computed average for autocentering purposes if --autocenter is provided. Default=False.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t211" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--tweak&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&#39;store_true&#39;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;WARNING: BUGGY. This will perform a final alignment with no downsampling [without using --shrink or --shrinkfine] if --shrinkfine &gt; 1.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t213" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; BT SPECIFIC PARAMETERS</span><span class="strut">&nbsp;</span></p>
<p id="t215" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t217" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--nseedlimit&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;&quot;&quot;Maximum number of particles</span><span class="strut">&nbsp;</span></p>
<p id="t218" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; to use. For example, if you supply a stack with 150 subtomograms, the program will</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; automatically select 128 as the limit to use because it&#39;s the largest power of 2 that is</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; smaller than 150. But if you provide, say --nseedlimit=100, then the number of particles</span><span class="strut">&nbsp;</span></p>
<p id="t221" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; used will be 64, because it&#39;s the largest power of 2 that is still smaller than 100.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t223" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="nam">args</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">parse_args</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t224" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">optionsUnparsed</span><span class="op">,</span> <span class="nam">args</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">parse_args</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t225" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t226" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">nopreprocprefft</span> <span class="op">=</span> <span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t228" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrink</span> <span class="op">&lt;</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrinkfine</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">shrink</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrinkfine</span><span class="strut">&nbsp;</span></p>
<p id="t230" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n(e2spt_binarytree)(main) it makes no sense for shrinkfine to be larger than shrink; therefore, shrink will be made to match shrinkfine&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t232" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span> <span class="op">=</span> <span class="nam">checkinput</span><span class="op">(</span> <span class="nam">options</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t234" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">e2spt_classaverage</span> <span class="key">import</span> <span class="nam">checksaneimagesize</span><span class="strut">&nbsp;</span></p>
<p id="t235" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">checksaneimagesize</span><span class="op">(</span> <span class="nam">options</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t237" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Make the directory where to create the database where the results will be stored</span><span class="strut">&nbsp;</span></p>
<p id="t239" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t240" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#from e2spt_classaverage import sptmakepath</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#options = sptmakepath(options,&#39;spt_bt&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">EMAN2_utils</span> <span class="key">import</span> <span class="nam">makepath</span><span class="strut">&nbsp;</span></p>
<p id="t243" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span> <span class="op">=</span> <span class="nam">makepath</span><span class="op">(</span><span class="nam">options</span><span class="op">,</span><span class="str">&#39;spt_bt&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t244" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">path</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="strut">&nbsp;</span></p>
<p id="t245" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t246" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">rootpath</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">getcwd</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">rootpath</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t248" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">=</span> <span class="nam">rootpath</span> <span class="op">+</span> <span class="str">&#39;/&#39;</span> <span class="op">+</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="strut">&nbsp;</span></p>
<p id="t249" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t250" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t251" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t252" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">print_help</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t253" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">exit</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t254" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">subset</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t255" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">subsetStack</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">+</span> <span class="str">&#39;/subset&#39;</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span> <span class="nam">options</span><span class="op">.</span><span class="nam">subset</span> <span class="op">)</span><span class="op">.</span><span class="nam">zfill</span><span class="op">(</span> <span class="nam">len</span><span class="op">(</span> <span class="nam">str</span><span class="op">(</span> <span class="nam">options</span><span class="op">.</span><span class="nam">subset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="str">&#39;.hdf&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t256" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nSubset to be written to&quot;</span><span class="op">,</span> <span class="nam">subsetStack</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t257" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t258" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">subsetcmd</span> <span class="op">=</span> <span class="str">&#39;e2proc3d.py &#39;</span> <span class="op">+</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span> <span class="op">+</span> <span class="str">&#39; &#39;</span> <span class="op">+</span> <span class="nam">subsetStack</span> <span class="op">+</span> <span class="str">&#39; --first=0 --last=&#39;</span> <span class="op">+</span> <span class="nam">str</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">subset</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Subset cmd is&quot;</span><span class="op">,</span> <span class="nam">subsetcmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t260" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t261" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">p</span><span class="op">=</span><span class="nam">subprocess</span><span class="op">.</span><span class="nam">Popen</span><span class="op">(</span> <span class="nam">subsetcmd</span><span class="op">,</span> <span class="nam">shell</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span><span class="nam">stdout</span><span class="op">=</span><span class="nam">subprocess</span><span class="op">.</span><span class="nam">PIPE</span><span class="op">,</span> <span class="nam">stderr</span><span class="op">=</span><span class="nam">subprocess</span><span class="op">.</span><span class="nam">PIPE</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">text</span><span class="op">=</span><span class="nam">p</span><span class="op">.</span><span class="nam">communicate</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">p</span><span class="op">.</span><span class="nam">stdout</span><span class="op">.</span><span class="nam">close</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t264" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t265" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">input</span> <span class="op">=</span> <span class="nam">subsetStack</span><span class="strut">&nbsp;</span></p>
<p id="t266" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t267" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">e2spt_classaverage</span> <span class="key">import</span> <span class="nam">sptParseAligner</span><span class="strut">&nbsp;</span></p>
<p id="t268" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span> <span class="op">=</span> <span class="nam">sptParseAligner</span><span class="op">(</span> <span class="nam">options</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t269" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t270" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t271" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; If --radius of the particle is provided, we calculate the optimal alignment steps for </span><span class="strut">&nbsp;</span></p>
<p id="t272" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; coarse and fine alignment rounds using --shrink and --shrinkfine options and apix info</span><span class="strut">&nbsp;</span></p>
<p id="t273" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t274" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t275" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">radius</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t276" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">e2spt_classaverage</span> <span class="key">import</span> <span class="nam">calcAliStep</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span> <span class="op">=</span> <span class="nam">calcAliStep</span><span class="op">(</span><span class="nam">options</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t278" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t279" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;c:</span><span class="strut">&nbsp;</span></p>
<p id="t280" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; c:Parse parameters such that &quot;None&quot; or &quot;none&quot; are adequately interpreted to turn off an option</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; c:&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span> <span class="op">=</span> <span class="nam">sptOptionsParser</span><span class="op">(</span> <span class="nam">options</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nAFTER PARSING options type={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">type</span><span class="op">(</span><span class="nam">options</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t284" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nAFTER PARSING optionsUnparsed type={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">type</span><span class="op">(</span><span class="nam">optionsUnparsed</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t286" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">writeParameters</span><span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="str">&#39;e2spt_binarytree.py&#39;</span><span class="op">,</span> <span class="str">&#39;spt_bt&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t287" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t288" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">hdr</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span> <span class="op">=</span> <span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span> <span class="op">=</span> <span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t291" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nz</span> <span class="op">=</span> <span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nz&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t292" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">nx</span><span class="op">!=</span><span class="nam">ny</span> <span class="key">or</span> <span class="nam">ny</span><span class="op">!=</span><span class="nam">nz</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t293" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR, input volumes are not cubes&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t294" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t295" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t296" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">logger</span> <span class="op">=</span> <span class="nam">E2init</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">ppid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t297" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t298" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t299" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Initialize parallelism if being used; it will be turned on automatically by detectThreads unless --parallel-=None</span><span class="strut">&nbsp;</span></p>
<p id="t300" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t301" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span> <span class="op">=</span> <span class="nam">detectThreads</span><span class="op">(</span> <span class="nam">options</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t302" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t303" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n\n(e2spt_classaverage.py) INITIALIZING PARALLELISM!&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t304" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t305" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t306" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">EMAN2PAR</span> <span class="key">import</span> <span class="nam">EMTaskCustomer</span><span class="strut">&nbsp;</span></p>
<p id="t307" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">etc</span><span class="op">=</span><span class="nam">EMTaskCustomer</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t308" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t309" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pclist</span><span class="op">=</span><span class="op">[</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t310" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t311" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">etc</span><span class="op">.</span><span class="nam">precache</span><span class="op">(</span><span class="nam">pclist</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t312" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t313" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t314" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">etc</span><span class="op">=</span><span class="str">&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t315" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t316" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t317" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">raw</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="strut">&nbsp;</span></p>
<p id="t318" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t319" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t320" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; if &#39;tree&#39; in options.align:</span><span class="strut">&nbsp;</span></p>
<p id="t321" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.falign = None</span><span class="strut">&nbsp;</span></p>
<p id="t322" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.mask = None</span><span class="strut">&nbsp;</span></p>
<p id="t323" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.lowpass = None</span><span class="strut">&nbsp;</span></p>
<p id="t324" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.highpass = None</span><span class="strut">&nbsp;</span></p>
<p id="t325" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.normproc = None</span><span class="strut">&nbsp;</span></p>
<p id="t326" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.lowpassfine = None</span><span class="strut">&nbsp;</span></p>
<p id="t327" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.highpassfine = None</span><span class="strut">&nbsp;</span></p>
<p id="t328" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.preprocess = None</span><span class="strut">&nbsp;</span></p>
<p id="t329" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; options.preprocessfine = None</span><span class="strut">&nbsp;</span></p>
<p id="t330" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t331" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; else:</span><span class="strut">&nbsp;</span></p>
<p id="t332" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from e2spt_classaverage import cmdpreproc</span><span class="strut">&nbsp;</span></p>
<p id="t333" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cmdpreproc( options.input, options, False )</span><span class="strut">&nbsp;</span></p>
<p id="t334" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t335" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t336" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nptcl</span><span class="op">=</span><span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t337" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">nptcl</span> <span class="op">&lt;</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t338" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR : at least 2 particles required in input stack&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t339" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t340" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t341" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ptclnums</span><span class="op">=</span><span class="nam">range</span><span class="op">(</span><span class="nam">nptcl</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t342" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nptclForRef</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">ptclnums</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t343" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t344" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nseed</span><span class="op">=</span><span class="num">2</span><span class="op">**</span><span class="nam">int</span><span class="op">(</span><span class="nam">floor</span><span class="op">(</span><span class="nam">log</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">ptclnums</span><span class="op">)</span><span class="op">,</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># we stick with powers of 2 for this to make the tree easier to collapse</span><span class="strut">&nbsp;</span></p>
<p id="t345" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t346" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">nseedlimit</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t347" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nseed</span><span class="op">=</span><span class="num">2</span><span class="op">**</span><span class="nam">int</span><span class="op">(</span><span class="nam">floor</span><span class="op">(</span><span class="nam">log</span><span class="op">(</span> <span class="nam">options</span><span class="op">.</span><span class="nam">nseedlimit</span> <span class="op">,</span> <span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t348" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t349" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#binaryTreeRef(options,nptclForRef,nseed,-1,etc)</span><span class="strut">&nbsp;</span></p>
<p id="t350" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t351" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">binaryTreeRef</span><span class="op">(</span><span class="nam">options</span><span class="op">,</span><span class="nam">optionsUnparsed</span><span class="op">,</span><span class="nam">nptclForRef</span><span class="op">,</span><span class="nam">nseed</span><span class="op">,</span><span class="nam">etc</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t352" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t353" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Will end logger&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t354" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2end</span><span class="op">(</span><span class="nam">logger</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t355" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t356" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;logger ended&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t357" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">stdout</span><span class="op">.</span><span class="nam">flush</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t358" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t359" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t360" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t361" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t362" class="stm mis"><span class="key">def</span> <span class="nam">binaryTreeRef</span><span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="nam">optionsUnparsed</span><span class="op">,</span> <span class="nam">nptclForRef</span><span class="op">,</span> <span class="nam">nseed</span><span class="op">,</span> <span class="nam">etc</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t363" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t364" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">e2spt_classaverage</span> <span class="key">import</span> <span class="nam">Align3DTask</span><span class="op">,</span><span class="nam">align3Dfunc</span><span class="op">,</span><span class="nam">get_results</span><span class="strut">&nbsp;</span></p>
<p id="t365" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t366" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">nptclForRef</span> <span class="op">==</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t367" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error: More than 1 particle required to build a reference.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t368" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t369" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t370" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># we need to make an initial reference. Due to the parallelism scheme we&#39;re using in 3-D and the slow speed of the</span><span class="strut">&nbsp;</span></p>
<p id="t371" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># individual alignments we use a slightly different strategy than in 2-D. We make a binary tree from the first 2^n particles and</span><span class="strut">&nbsp;</span></p>
<p id="t372" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># compute pairwise alignments until we get an average out. </span><span class="strut">&nbsp;</span></p>
<p id="t373" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t374" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t375" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t376" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if nseed&gt;64 : </span><span class="strut">&nbsp;</span></p>
<p id="t377" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; nseed=64</span><span class="strut">&nbsp;</span></p>
<p id="t378" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; print &quot;Limiting seeding to the first 64 images&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t379" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t380" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nseediter</span> <span class="op">=</span> <span class="nam">int</span><span class="op">(</span><span class="nam">log</span><span class="op">(</span><span class="nam">nseed</span><span class="op">,</span><span class="num">2</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># number of iterations we&#39;ll need</span><span class="strut">&nbsp;</span></p>
<p id="t381" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t382" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">iterstop</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t383" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">iterstop</span> <span class="op">&lt;</span> <span class="nam">nseediter</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t384" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nseediter</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">iterstop</span><span class="strut">&nbsp;</span></p>
<p id="t385" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t386" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t387" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Seedtree to produce initial reference. Using %d particles in a %d level tree&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">nseed</span><span class="op">,</span><span class="nam">nseediter</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t388" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t389" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># We copy the particles for this class into bdb:seedtree_0</span><span class="strut">&nbsp;</span></p>
<p id="t390" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t391" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; for i,j in enumerate(ptclnums[:nseed]):</span><span class="strut">&nbsp;</span></p>
<p id="t392" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; emdata = EMData(options.input,j)</span><span class="strut">&nbsp;</span></p>
<p id="t393" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t394" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #if options.inixforms:</span><span class="strut">&nbsp;</span></p>
<p id="t395" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;&nbsp; emdata.process_inplace(&quot;xform&quot;,{&quot;transform&quot;:js[&quot;tomo_%04d&quot;%i]})</span><span class="strut">&nbsp;</span></p>
<p id="t396" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #&nbsp; &nbsp; &nbsp;&nbsp; emdata.set_attr(&quot;test_xfm&quot;,js[&quot;tomo_%04d&quot;%i])</span><span class="strut">&nbsp;</span></p>
<p id="t397" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t398" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; seedfile = &quot;%s/seedtree_0_cl_%d.hdf&quot; % (options.path,ic)</span><span class="strut">&nbsp;</span></p>
<p id="t399" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; emdata.write_image(seedfile, i)</span><span class="strut">&nbsp;</span></p>
<p id="t400" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t401" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print &quot;Creating this seed file for this class&quot;, seedfile, ic</span><span class="strut">&nbsp;</span></p>
<p id="t402" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t403" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t404" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#for i in range( ptclnums[:nseed] ):</span><span class="strut">&nbsp;</span></p>
<p id="t405" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t406" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ii</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t407" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t408" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#seedfile = options.path + &#39;/seedtree_0_cl_&#39; + str(ic) + &#39;.hdf&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t409" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t410" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if ic &lt; 0:</span><span class="strut">&nbsp;</span></p>
<p id="t411" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t412" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">seedfile</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">+</span> <span class="str">&#39;/seedtree_0.hdf&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t413" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t414" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#for j in ptclnums[:nseed]:</span><span class="strut">&nbsp;</span></p>
<p id="t415" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">j</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">nseed</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t416" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">emdata</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="nam">j</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t417" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">emdata</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">seedfile</span><span class="op">,</span><span class="nam">ii</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t418" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;have taken particle %d and written it into index %d of the seedfile&quot;</span> <span class="op">%</span><span class="op">(</span><span class="nam">j</span><span class="op">,</span><span class="nam">ii</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t419" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ii</span><span class="op">+=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t420" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if ic &gt;= 0:</span><span class="strut">&nbsp;</span></p>
<p id="t421" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; print &quot;Creating this seed file for this class&quot;, seedfile, ic</span><span class="strut">&nbsp;</span></p>
<p id="t422" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t423" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Creating this seed file for this class&quot;</span><span class="op">,</span> <span class="nam">seedfile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t424" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t425" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t426" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">from</span> <span class="nam">e2spt_classaverage</span> <span class="key">import</span> <span class="nam">cmdpreproc</span><span class="strut">&nbsp;</span></p>
<p id="t427" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t428" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t429" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">preproc</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t430" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">mask</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">maskfile</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">normproc</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">threshold</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">clip</span> <span class="key">or</span> <span class="op">(</span><span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">shrink</span> <span class="op">&gt;</span> <span class="num">1</span><span class="op">)</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">lowpass</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">highpass</span> <span class="key">or</span> <span class="nam">optionsUnparsed</span><span class="op">.</span><span class="nam">preprocess</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t431" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t432" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.mask&quot;, options.mask)</span><span class="strut">&nbsp;</span></p>
<p id="t433" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.maskfile&quot;, options.maskfile)</span><span class="strut">&nbsp;</span></p>
<p id="t434" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.normproc&quot;, options.normproc)</span><span class="strut">&nbsp;</span></p>
<p id="t435" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.threshold&quot;, options.threshold)</span><span class="strut">&nbsp;</span></p>
<p id="t436" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.clip&quot;, options.clip)</span><span class="strut">&nbsp;</span></p>
<p id="t437" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.shrink&quot;, options.shrink)</span><span class="strut">&nbsp;</span></p>
<p id="t438" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.shrinkfine&quot;, options.shrinkfine)</span><span class="strut">&nbsp;</span></p>
<p id="t439" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.lowpass&quot;, options.lowpass)</span><span class="strut">&nbsp;</span></p>
<p id="t440" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.highpass&quot;, options.highpass)</span><span class="strut">&nbsp;</span></p>
<p id="t441" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\noptions.preprocess&quot;, options.preprocess)</span><span class="strut">&nbsp;</span></p>
<p id="t442" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t443" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t444" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print(&quot;\ntruth statement&quot;, options.mask or options.maskfile or options.normproc or options.threshold or options.clip or (options.shrink &gt; 1) or options.lowpass or options.highpass or options.preprocess)</span><span class="strut">&nbsp;</span></p>
<p id="t445" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t446" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmdpreproc</span><span class="op">(</span> <span class="nam">seedfile</span><span class="op">,</span> <span class="nam">optionsUnparsed</span><span class="op">,</span> <span class="nam">False</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t447" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t448" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">preproc</span> <span class="op">=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t449" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t450" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t451" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t452" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; #Parse parameters such that &quot;None&quot; or &quot;none&quot; are adequately interpreted to turn off an option</span><span class="strut">&nbsp;</span></p>
<p id="t453" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; #&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t454" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t455" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#from e2spt_classaverage import sptOptionsParser</span><span class="strut">&nbsp;</span></p>
<p id="t456" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#options = sptOptionsParser( options )</span><span class="strut">&nbsp;</span></p>
<p id="t457" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t458" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t459" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; #Outer loop covering levels in the converging binary tree</span><span class="strut">&nbsp;</span></p>
<p id="t460" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t461" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t462" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nnseediter is&quot;</span><span class="op">,</span> <span class="nam">nseediter</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t463" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t464" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span> <span class="nam">nseediter</span> <span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t465" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#infile=&quot;%s/seedtree_%d_cl_%d.hdf&quot;%(options.path,i,ic)</span><span class="strut">&nbsp;</span></p>
<p id="t466" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if ic &lt; 0:</span><span class="strut">&nbsp;</span></p>
<p id="t467" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t468" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">rawinfile</span> <span class="op">=</span> <span class="str">&quot;{}/seedtree_{}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t469" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">infile</span> <span class="op">=</span> <span class="nam">rawinfile</span><span class="strut">&nbsp;</span></p>
<p id="t470" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t471" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">preproc</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t472" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">infile</span><span class="op">=</span><span class="str">&quot;{}/seedtree_{}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">&#39;.hdf&#39;</span><span class="op">,</span><span class="str">&#39;_preproc.hdf&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t473" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t474" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n(e2spt_binarytree)(binaryTreeRef) infile will be&quot;</span><span class="op">,</span> <span class="nam">infile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t475" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t476" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#outfile=&quot;%s/seedtree_%d_cl_%d.hdf&quot;%(options.path,i+1,ic)</span><span class="strut">&nbsp;</span></p>
<p id="t477" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if ic &lt; 0:</span><span class="strut">&nbsp;</span></p>
<p id="t478" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">outfile</span><span class="op">=</span><span class="str">&quot;{}/seedtree_{}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t479" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t480" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">i</span> <span class="op">==</span> <span class="nam">nseediter</span><span class="op">-</span><span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t481" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">outfile</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">+</span> <span class="str">&#39;/final_avg.hdf&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t482" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t483" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n(e2spt_binarytree)(binaryTreeRef) outfile will be&quot;</span><span class="op">,</span> <span class="nam">outfile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t484" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t485" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tasks</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t486" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">results</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t487" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">transform</span> <span class="op">=</span> <span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t488" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># loop over volumes in the current level</span><span class="strut">&nbsp;</span></p>
<p id="t489" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t490" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nptclsinInfile</span> <span class="op">=</span> <span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span> <span class="nam">infile</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t491" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t492" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">nptclsinInfile</span> <span class="op">&gt;</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t493" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t494" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">j</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">nseed</span><span class="op">/</span><span class="op">(</span><span class="num">2</span><span class="op">**</span><span class="nam">i</span><span class="op">)</span><span class="op">,</span><span class="num">2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t495" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t496" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#Unfortunately this tree structure limits the parallelism to the number of pairs at the current level :^(</span><span class="strut">&nbsp;</span></p>
<p id="t497" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t498" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#task=Align3DTask([&quot;cache&quot;,infile,j],[&quot;cache&quot;,infile,j+1],j/2,&quot;Seed Tree pair %d at level %d&quot;%(j/2,i),options.mask,options.normproc,options.preprocess,options.lowpass,options.highpass,</span><span class="strut">&nbsp;</span></p>
<p id="t499" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; options.npeakstorefine,options.align,options.aligncmp,options.falign,options.faligncmp,options.shrink,options.shrinkfine,transform,options.verbose-1,options.randomizewedge,options.wedgeangle,options.wedgei,options.wedgef)</span><span class="strut">&nbsp;</span></p>
<p id="t500" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t501" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">task</span><span class="op">=</span><span class="nam">Align3DTask</span><span class="op">(</span><span class="op">[</span><span class="str">&quot;cache&quot;</span><span class="op">,</span><span class="nam">infile</span><span class="op">,</span><span class="nam">j</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="str">&quot;cache&quot;</span><span class="op">,</span><span class="nam">infile</span><span class="op">,</span><span class="nam">j</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">j</span><span class="op">/</span><span class="num">2</span><span class="op">,</span><span class="str">&quot;Seed Tree pair #%d at level %d&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">j</span><span class="op">/</span><span class="num">2</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="op">,</span><span class="nam">options</span><span class="op">,</span><span class="nam">transform</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t502" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tasks</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">task</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t503" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t504" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print &quot;No parallelism specified&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t505" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">result</span><span class="op">=</span><span class="nam">align3Dfunc</span><span class="op">(</span><span class="op">[</span><span class="str">&quot;cache&quot;</span><span class="op">,</span><span class="nam">infile</span><span class="op">,</span><span class="nam">j</span><span class="op">]</span><span class="op">,</span><span class="op">[</span><span class="str">&quot;cache&quot;</span><span class="op">,</span><span class="nam">infile</span><span class="op">,</span><span class="nam">j</span><span class="op">+</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">j</span><span class="op">/</span><span class="num">2</span><span class="op">,</span><span class="str">&quot;Seed Tree pair #%d at level %d&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">j</span><span class="op">/</span><span class="num">2</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="op">,</span><span class="nam">options</span><span class="op">,</span><span class="nam">transform</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t506" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">results</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">result</span><span class="op">[</span><span class="str">&#39;final&#39;</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t507" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="strut">&nbsp;</span></p>
<p id="t508" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #Start the alignments for this level</span><span class="strut">&nbsp;</span></p>
<p id="t509" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t510" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t511" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tids</span><span class="op">=</span><span class="nam">etc</span><span class="op">.</span><span class="nam">send_tasks</span><span class="op">(</span><span class="nam">tasks</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t512" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t513" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;%d tasks queued in seedtree level %d&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">tids</span><span class="op">)</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t514" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t515" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&quot;&quot;&quot;Wait for alignments to finish and get results&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t516" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">results</span><span class="op">=</span><span class="nam">get_results</span><span class="op">(</span><span class="nam">etc</span><span class="op">,</span><span class="nam">tids</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">,</span><span class="nam">nseed</span><span class="op">,</span><span class="str">&#39;binarytree&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t517" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t518" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#results=get_results(etc,tids,options.verbose,{},len(ptclnums),0,&#39;binarytree&#39;)</span><span class="strut">&nbsp;</span></p>
<p id="t519" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#results=get_results(etc,tids,options.verbose,{},nptclForRef,0)</span><span class="strut">&nbsp;</span></p>
<p id="t520" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#def get_results(etc,tids,verbose,nptcls,refmethod=&#39;&#39;):</span><span class="strut">&nbsp;</span></p>
<p id="t521" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t522" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t523" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t524" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">2</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t525" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Results:&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t526" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pprint</span><span class="op">(</span><span class="nam">results</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t527" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t528" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print &quot;No parallelism specified&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t529" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#results=tasks</span><span class="strut">&nbsp;</span></p>
<p id="t530" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">2</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t531" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Results:&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t532" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pprint</span><span class="op">(</span><span class="nam">results</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t533" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t534" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ret</span> <span class="op">=</span> <span class="nam">makeAveragePairs</span><span class="op">(</span><span class="nam">options</span><span class="op">,</span><span class="nam">infile</span><span class="op">,</span><span class="nam">outfile</span><span class="op">,</span><span class="nam">results</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t535" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t536" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">ret</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t537" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">preproc</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t538" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmdpreproc</span><span class="op">(</span> <span class="nam">outfile</span><span class="op">,</span> <span class="nam">optionsUnparsed</span><span class="op">,</span> <span class="nam">False</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t539" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t540" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t541" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nalgorithm converged since infile %s has only one particle, nimgs=%d&quot;</span> <span class="op">%</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">nptclsinInfile</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t542" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">os</span><span class="op">.</span><span class="nam">rename</span><span class="op">(</span> <span class="nam">rawinfile</span><span class="op">,</span> <span class="nam">outfile</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t543" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t544" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t545" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#ref = EMData( outfile, 0 )&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # result of the last iteration</span><span class="strut">&nbsp;</span></p>
<p id="t546" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t547" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#return ref</span><span class="strut">&nbsp;</span></p>
<p id="t548" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t549" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t550" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t551" class="stm mis"><span class="key">def</span> <span class="nam">makeAveragePairs</span><span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="nam">ptcl_file</span><span class="op">,</span> <span class="nam">outfile</span><span class="op">,</span> <span class="nam">results</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t552" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&quot;&quot;&quot;Will take a set of alignments and an input particle stack filename and produce a new set of class-averages over pairs&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t553" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t554" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">current</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">getcwd</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t555" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n(e2spt_classaverage.py) (make_average_pairs) current directory is&quot;</span><span class="op">,</span> <span class="nam">current</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t556" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">findir</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="nam">current</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t557" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\noptions.path is&quot;</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t558" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">findirpath</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t559" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nThe particle file where the particles ought to be read from is&quot;</span><span class="op">,</span> <span class="nam">ptcl_file</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t560" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nLets see if ptcl_file is in path. Files in path are&quot;</span><span class="op">,</span> <span class="nam">findirpath</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t561" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t562" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nresults are&quot;</span><span class="op">,</span> <span class="nam">results</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t563" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nTheir len&quot;</span><span class="op">,</span> <span class="nam">len</span><span class="op">(</span><span class="nam">results</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t564" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t565" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#for i,ptcl_parms in enumerate(align_parms):</span><span class="strut">&nbsp;</span></p>
<p id="t566" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ii</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t567" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">r</span> <span class="key">in</span> <span class="nam">results</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t568" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;r is&quot;</span><span class="op">,</span> <span class="nam">r</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t569" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nr[0] is&quot;</span><span class="op">,</span> <span class="nam">r</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t570" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nr[0][0] is&quot;</span><span class="op">,</span> <span class="nam">r</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t571" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nr[0][0][&#39;xform.align3d&#39;] is&quot;</span><span class="op">,</span> <span class="nam">r</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t572" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nr[0][-1]&quot;</span><span class="op">,</span> <span class="nam">r</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t573" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t574" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t575" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if ptcl_parms:</span><span class="strut">&nbsp;</span></p>
<p id="t576" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ptcl0</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">ptcl_file</span><span class="op">,</span><span class="nam">ii</span><span class="op">*</span><span class="num">2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t577" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t578" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ptcl1</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">ptcl_file</span><span class="op">,</span><span class="nam">ii</span><span class="op">*</span><span class="num">2</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t579" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ptcl1</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">r</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t580" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t581" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#ptcl1.process_inplace(&quot;xform&quot;,{&quot;transform&quot;:align_parms[0][&quot;xform.align3d&quot;]})</span><span class="strut">&nbsp;</span></p>
<p id="t582" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t583" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># While this is only 2 images, we still use the averager in case something clever is going on</span><span class="strut">&nbsp;</span></p>
<p id="t584" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;averager is&quot;</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">averager</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t585" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgr</span> <span class="op">=</span> <span class="nam">Averagers</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">averager</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">averager</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t586" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgr</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span><span class="nam">ptcl0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t587" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgr</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span><span class="nam">ptcl1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t588" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t589" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">=</span><span class="nam">avgr</span><span class="op">.</span><span class="nam">finish</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t590" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#postprocess(avg,optmask,optnormproc,optpostprocess)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #There should be NO postprocessing of the intermediate averages</span><span class="strut">&nbsp;</span></p>
<p id="t591" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t592" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">autocenter</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t593" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\n\n\n\nYou have selected to autocenter!\n&quot;</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">autocenter</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t594" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t595" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgac</span> <span class="op">=</span> <span class="nam">avg</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t596" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">autocentermask</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t597" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgac</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span> <span class="nam">options</span><span class="op">.</span><span class="nam">autocentermask</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">autocentermask</span><span class="op">[</span><span class="num">1</span><span class="op">]</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t598" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t599" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">autocenterpreprocess</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t600" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span> <span class="op">=</span> <span class="nam">avg</span><span class="op">[</span><span class="str">&#39;apix_x&#39;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t601" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">halfnyquist</span> <span class="op">=</span> <span class="nam">apix</span><span class="op">*</span><span class="num">4</span><span class="strut">&nbsp;</span></p>
<p id="t602" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">highpassf</span> <span class="op">=</span> <span class="nam">apix</span><span class="op">*</span><span class="nam">a</span><span class="op">[</span><span class="str">&#39;nx&#39;</span><span class="op">]</span><span class="op">/</span><span class="num">2.0</span><span class="strut">&nbsp;</span></p>
<p id="t603" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t604" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgac</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span> <span class="str">&#39;filter.highpass.gauss&#39;</span><span class="op">,</span><span class="op">{</span><span class="str">&#39;cutoff_freq&#39;</span><span class="op">:</span><span class="nam">highpassf</span><span class="op">,</span><span class="str">&#39;apix&#39;</span><span class="op">:</span><span class="nam">apix</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t605" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgac</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span> <span class="str">&#39;filter.lowpass.gauss&#39;</span><span class="op">,</span><span class="op">{</span><span class="str">&#39;cutoff_freq&#39;</span><span class="op">:</span><span class="nam">halfnyquist</span><span class="op">,</span><span class="str">&#39;apix&#39;</span><span class="op">:</span><span class="nam">apix</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t606" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgac</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span> <span class="str">&#39;math.meanshrink&#39;</span><span class="op">,</span><span class="op">{</span><span class="str">&#39;n&#39;</span><span class="op">:</span><span class="num">2</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t607" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t608" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgac</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">autocenter</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">autocenter</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t609" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t610" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tcenter</span> <span class="op">=</span> <span class="nam">avgac</span><span class="op">[</span><span class="str">&#39;xform.align3d&#39;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t611" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Thus the average HAS BEEN be translated like this&quot;</span><span class="op">,</span> <span class="nam">tcenter</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t612" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t613" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">[</span><span class="str">&#39;origin_x&#39;</span><span class="op">]</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t614" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">[</span><span class="str">&#39;origin_y&#39;</span><span class="op">]</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t615" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">[</span><span class="str">&#39;origin_z&#39;</span><span class="op">]</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t616" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t617" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="nam">ii</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t618" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t619" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ii</span><span class="op">+=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t620" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t621" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t622" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t623" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t624" class="stm mis"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">&#39;__main__&#39;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t625" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t626" class="pln"><span class="strut">&nbsp;</span></p>
                
            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.org">coverage.py v4.0.3</a>,
            created at 2018-07-02 18:17
        </p>
    </div>
</div>

</body>
</html>
