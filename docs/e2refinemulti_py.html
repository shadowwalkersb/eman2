


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for e2refinemulti.py: 0%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>e2refinemulti.py</b> :
            <span class="pc_cov">0%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            427 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">0 run</span>
            <span class="mis shortkey_m button_toggle_mis">427 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">0 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
<p class="legend">Hot-keys on this page</p>
    <div>
<p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
<p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
<p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
<p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="stm mis"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="pln"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="pln"><a href="#n20">20</a></p>
<p id="n21" class="pln"><a href="#n21">21</a></p>
<p id="n22" class="pln"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="pln"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="pln"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="pln"><a href="#n31">31</a></p>
<p id="n32" class="pln"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="pln"><a href="#n34">34</a></p>
<p id="n35" class="pln"><a href="#n35">35</a></p>
<p id="n36" class="stm mis"><a href="#n36">36</a></p>
<p id="n37" class="stm mis"><a href="#n37">37</a></p>
<p id="n38" class="stm mis"><a href="#n38">38</a></p>
<p id="n39" class="stm mis"><a href="#n39">39</a></p>
<p id="n40" class="stm mis"><a href="#n40">40</a></p>
<p id="n41" class="stm mis"><a href="#n41">41</a></p>
<p id="n42" class="stm mis"><a href="#n42">42</a></p>
<p id="n43" class="pln"><a href="#n43">43</a></p>
<p id="n44" class="pln"><a href="#n44">44</a></p>
<p id="n45" class="stm mis"><a href="#n45">45</a></p>
<p id="n46" class="stm mis"><a href="#n46">46</a></p>
<p id="n47" class="stm mis"><a href="#n47">47</a></p>
<p id="n48" class="pln"><a href="#n48">48</a></p>
<p id="n49" class="stm mis"><a href="#n49">49</a></p>
<p id="n50" class="pln"><a href="#n50">50</a></p>
<p id="n51" class="stm mis"><a href="#n51">51</a></p>
<p id="n52" class="stm mis"><a href="#n52">52</a></p>
<p id="n53" class="stm mis"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="pln"><a href="#n55">55</a></p>
<p id="n56" class="stm mis"><a href="#n56">56</a></p>
<p id="n57" class="pln"><a href="#n57">57</a></p>
<p id="n58" class="stm mis"><a href="#n58">58</a></p>
<p id="n59" class="stm mis"><a href="#n59">59</a></p>
<p id="n60" class="stm mis"><a href="#n60">60</a></p>
<p id="n61" class="stm mis"><a href="#n61">61</a></p>
<p id="n62" class="stm mis"><a href="#n62">62</a></p>
<p id="n63" class="stm mis"><a href="#n63">63</a></p>
<p id="n64" class="pln"><a href="#n64">64</a></p>
<p id="n65" class="stm mis"><a href="#n65">65</a></p>
<p id="n66" class="stm mis"><a href="#n66">66</a></p>
<p id="n67" class="stm mis"><a href="#n67">67</a></p>
<p id="n68" class="pln"><a href="#n68">68</a></p>
<p id="n69" class="pln"><a href="#n69">69</a></p>
<p id="n70" class="pln"><a href="#n70">70</a></p>
<p id="n71" class="pln"><a href="#n71">71</a></p>
<p id="n72" class="pln"><a href="#n72">72</a></p>
<p id="n73" class="pln"><a href="#n73">73</a></p>
<p id="n74" class="pln"><a href="#n74">74</a></p>
<p id="n75" class="pln"><a href="#n75">75</a></p>
<p id="n76" class="pln"><a href="#n76">76</a></p>
<p id="n77" class="pln"><a href="#n77">77</a></p>
<p id="n78" class="pln"><a href="#n78">78</a></p>
<p id="n79" class="pln"><a href="#n79">79</a></p>
<p id="n80" class="pln"><a href="#n80">80</a></p>
<p id="n81" class="pln"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="pln"><a href="#n83">83</a></p>
<p id="n84" class="pln"><a href="#n84">84</a></p>
<p id="n85" class="pln"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="pln"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="pln"><a href="#n89">89</a></p>
<p id="n90" class="pln"><a href="#n90">90</a></p>
<p id="n91" class="pln"><a href="#n91">91</a></p>
<p id="n92" class="pln"><a href="#n92">92</a></p>
<p id="n93" class="pln"><a href="#n93">93</a></p>
<p id="n94" class="pln"><a href="#n94">94</a></p>
<p id="n95" class="pln"><a href="#n95">95</a></p>
<p id="n96" class="pln"><a href="#n96">96</a></p>
<p id="n97" class="pln"><a href="#n97">97</a></p>
<p id="n98" class="pln"><a href="#n98">98</a></p>
<p id="n99" class="pln"><a href="#n99">99</a></p>
<p id="n100" class="pln"><a href="#n100">100</a></p>
<p id="n101" class="pln"><a href="#n101">101</a></p>
<p id="n102" class="pln"><a href="#n102">102</a></p>
<p id="n103" class="pln"><a href="#n103">103</a></p>
<p id="n104" class="pln"><a href="#n104">104</a></p>
<p id="n105" class="pln"><a href="#n105">105</a></p>
<p id="n106" class="pln"><a href="#n106">106</a></p>
<p id="n107" class="pln"><a href="#n107">107</a></p>
<p id="n108" class="pln"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="pln"><a href="#n110">110</a></p>
<p id="n111" class="pln"><a href="#n111">111</a></p>
<p id="n112" class="pln"><a href="#n112">112</a></p>
<p id="n113" class="pln"><a href="#n113">113</a></p>
<p id="n114" class="pln"><a href="#n114">114</a></p>
<p id="n115" class="pln"><a href="#n115">115</a></p>
<p id="n116" class="pln"><a href="#n116">116</a></p>
<p id="n117" class="pln"><a href="#n117">117</a></p>
<p id="n118" class="pln"><a href="#n118">118</a></p>
<p id="n119" class="pln"><a href="#n119">119</a></p>
<p id="n120" class="pln"><a href="#n120">120</a></p>
<p id="n121" class="pln"><a href="#n121">121</a></p>
<p id="n122" class="pln"><a href="#n122">122</a></p>
<p id="n123" class="pln"><a href="#n123">123</a></p>
<p id="n124" class="pln"><a href="#n124">124</a></p>
<p id="n125" class="pln"><a href="#n125">125</a></p>
<p id="n126" class="pln"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="pln"><a href="#n128">128</a></p>
<p id="n129" class="pln"><a href="#n129">129</a></p>
<p id="n130" class="stm mis"><a href="#n130">130</a></p>
<p id="n131" class="pln"><a href="#n131">131</a></p>
<p id="n132" class="pln"><a href="#n132">132</a></p>
<p id="n133" class="pln"><a href="#n133">133</a></p>
<p id="n134" class="pln"><a href="#n134">134</a></p>
<p id="n135" class="stm mis"><a href="#n135">135</a></p>
<p id="n136" class="stm mis"><a href="#n136">136</a></p>
<p id="n137" class="stm mis"><a href="#n137">137</a></p>
<p id="n138" class="stm mis"><a href="#n138">138</a></p>
<p id="n139" class="stm mis"><a href="#n139">139</a></p>
<p id="n140" class="stm mis"><a href="#n140">140</a></p>
<p id="n141" class="stm mis"><a href="#n141">141</a></p>
<p id="n142" class="stm mis"><a href="#n142">142</a></p>
<p id="n143" class="stm mis"><a href="#n143">143</a></p>
<p id="n144" class="stm mis"><a href="#n144">144</a></p>
<p id="n145" class="stm mis"><a href="#n145">145</a></p>
<p id="n146" class="stm mis"><a href="#n146">146</a></p>
<p id="n147" class="stm mis"><a href="#n147">147</a></p>
<p id="n148" class="stm mis"><a href="#n148">148</a></p>
<p id="n149" class="stm mis"><a href="#n149">149</a></p>
<p id="n150" class="stm mis"><a href="#n150">150</a></p>
<p id="n151" class="stm mis"><a href="#n151">151</a></p>
<p id="n152" class="pln"><a href="#n152">152</a></p>
<p id="n153" class="stm mis"><a href="#n153">153</a></p>
<p id="n154" class="stm mis"><a href="#n154">154</a></p>
<p id="n155" class="stm mis"><a href="#n155">155</a></p>
<p id="n156" class="stm mis"><a href="#n156">156</a></p>
<p id="n157" class="stm mis"><a href="#n157">157</a></p>
<p id="n158" class="stm mis"><a href="#n158">158</a></p>
<p id="n159" class="stm mis"><a href="#n159">159</a></p>
<p id="n160" class="stm mis"><a href="#n160">160</a></p>
<p id="n161" class="stm mis"><a href="#n161">161</a></p>
<p id="n162" class="stm mis"><a href="#n162">162</a></p>
<p id="n163" class="stm mis"><a href="#n163">163</a></p>
<p id="n164" class="pln"><a href="#n164">164</a></p>
<p id="n165" class="pln"><a href="#n165">165</a></p>
<p id="n166" class="pln"><a href="#n166">166</a></p>
<p id="n167" class="pln"><a href="#n167">167</a></p>
<p id="n168" class="stm mis"><a href="#n168">168</a></p>
<p id="n169" class="stm mis"><a href="#n169">169</a></p>
<p id="n170" class="stm mis"><a href="#n170">170</a></p>
<p id="n171" class="pln"><a href="#n171">171</a></p>
<p id="n172" class="pln"><a href="#n172">172</a></p>
<p id="n173" class="pln"><a href="#n173">173</a></p>
<p id="n174" class="stm mis"><a href="#n174">174</a></p>
<p id="n175" class="stm mis"><a href="#n175">175</a></p>
<p id="n176" class="stm mis"><a href="#n176">176</a></p>
<p id="n177" class="stm mis"><a href="#n177">177</a></p>
<p id="n178" class="stm mis"><a href="#n178">178</a></p>
<p id="n179" class="stm mis"><a href="#n179">179</a></p>
<p id="n180" class="stm mis"><a href="#n180">180</a></p>
<p id="n181" class="stm mis"><a href="#n181">181</a></p>
<p id="n182" class="stm mis"><a href="#n182">182</a></p>
<p id="n183" class="stm mis"><a href="#n183">183</a></p>
<p id="n184" class="stm mis"><a href="#n184">184</a></p>
<p id="n185" class="pln"><a href="#n185">185</a></p>
<p id="n186" class="pln"><a href="#n186">186</a></p>
<p id="n187" class="pln"><a href="#n187">187</a></p>
<p id="n188" class="pln"><a href="#n188">188</a></p>
<p id="n189" class="pln"><a href="#n189">189</a></p>
<p id="n190" class="pln"><a href="#n190">190</a></p>
<p id="n191" class="stm mis"><a href="#n191">191</a></p>
<p id="n192" class="stm mis"><a href="#n192">192</a></p>
<p id="n193" class="stm mis"><a href="#n193">193</a></p>
<p id="n194" class="stm mis"><a href="#n194">194</a></p>
<p id="n195" class="stm mis"><a href="#n195">195</a></p>
<p id="n196" class="stm mis"><a href="#n196">196</a></p>
<p id="n197" class="stm mis"><a href="#n197">197</a></p>
<p id="n198" class="stm mis"><a href="#n198">198</a></p>
<p id="n199" class="stm mis"><a href="#n199">199</a></p>
<p id="n200" class="stm mis"><a href="#n200">200</a></p>
<p id="n201" class="pln"><a href="#n201">201</a></p>
<p id="n202" class="pln"><a href="#n202">202</a></p>
<p id="n203" class="pln"><a href="#n203">203</a></p>
<p id="n204" class="pln"><a href="#n204">204</a></p>
<p id="n205" class="stm mis"><a href="#n205">205</a></p>
<p id="n206" class="stm mis"><a href="#n206">206</a></p>
<p id="n207" class="stm mis"><a href="#n207">207</a></p>
<p id="n208" class="stm mis"><a href="#n208">208</a></p>
<p id="n209" class="stm mis"><a href="#n209">209</a></p>
<p id="n210" class="pln"><a href="#n210">210</a></p>
<p id="n211" class="pln"><a href="#n211">211</a></p>
<p id="n212" class="stm mis"><a href="#n212">212</a></p>
<p id="n213" class="stm mis"><a href="#n213">213</a></p>
<p id="n214" class="pln"><a href="#n214">214</a></p>
<p id="n215" class="stm mis"><a href="#n215">215</a></p>
<p id="n216" class="pln"><a href="#n216">216</a></p>
<p id="n217" class="stm mis"><a href="#n217">217</a></p>
<p id="n218" class="stm mis"><a href="#n218">218</a></p>
<p id="n219" class="stm mis"><a href="#n219">219</a></p>
<p id="n220" class="pln"><a href="#n220">220</a></p>
<p id="n221" class="stm mis"><a href="#n221">221</a></p>
<p id="n222" class="stm mis"><a href="#n222">222</a></p>
<p id="n223" class="stm mis"><a href="#n223">223</a></p>
<p id="n224" class="pln"><a href="#n224">224</a></p>
<p id="n225" class="stm mis"><a href="#n225">225</a></p>
<p id="n226" class="stm mis"><a href="#n226">226</a></p>
<p id="n227" class="pln"><a href="#n227">227</a></p>
<p id="n228" class="pln"><a href="#n228">228</a></p>
<p id="n229" class="pln"><a href="#n229">229</a></p>
<p id="n230" class="stm mis"><a href="#n230">230</a></p>
<p id="n231" class="stm mis"><a href="#n231">231</a></p>
<p id="n232" class="stm mis"><a href="#n232">232</a></p>
<p id="n233" class="stm mis"><a href="#n233">233</a></p>
<p id="n234" class="pln"><a href="#n234">234</a></p>
<p id="n235" class="stm mis"><a href="#n235">235</a></p>
<p id="n236" class="stm mis"><a href="#n236">236</a></p>
<p id="n237" class="stm mis"><a href="#n237">237</a></p>
<p id="n238" class="pln"><a href="#n238">238</a></p>
<p id="n239" class="stm mis"><a href="#n239">239</a></p>
<p id="n240" class="stm mis"><a href="#n240">240</a></p>
<p id="n241" class="stm mis"><a href="#n241">241</a></p>
<p id="n242" class="pln"><a href="#n242">242</a></p>
<p id="n243" class="pln"><a href="#n243">243</a></p>
<p id="n244" class="stm mis"><a href="#n244">244</a></p>
<p id="n245" class="stm mis"><a href="#n245">245</a></p>
<p id="n246" class="stm mis"><a href="#n246">246</a></p>
<p id="n247" class="pln"><a href="#n247">247</a></p>
<p id="n248" class="pln"><a href="#n248">248</a></p>
<p id="n249" class="stm mis"><a href="#n249">249</a></p>
<p id="n250" class="stm mis"><a href="#n250">250</a></p>
<p id="n251" class="pln"><a href="#n251">251</a></p>
<p id="n252" class="pln"><a href="#n252">252</a></p>
<p id="n253" class="pln"><a href="#n253">253</a></p>
<p id="n254" class="stm mis"><a href="#n254">254</a></p>
<p id="n255" class="stm mis"><a href="#n255">255</a></p>
<p id="n256" class="stm mis"><a href="#n256">256</a></p>
<p id="n257" class="stm mis"><a href="#n257">257</a></p>
<p id="n258" class="stm mis"><a href="#n258">258</a></p>
<p id="n259" class="stm mis"><a href="#n259">259</a></p>
<p id="n260" class="stm mis"><a href="#n260">260</a></p>
<p id="n261" class="stm mis"><a href="#n261">261</a></p>
<p id="n262" class="stm mis"><a href="#n262">262</a></p>
<p id="n263" class="stm mis"><a href="#n263">263</a></p>
<p id="n264" class="stm mis"><a href="#n264">264</a></p>
<p id="n265" class="stm mis"><a href="#n265">265</a></p>
<p id="n266" class="stm mis"><a href="#n266">266</a></p>
<p id="n267" class="pln"><a href="#n267">267</a></p>
<p id="n268" class="stm mis"><a href="#n268">268</a></p>
<p id="n269" class="stm mis"><a href="#n269">269</a></p>
<p id="n270" class="stm mis"><a href="#n270">270</a></p>
<p id="n271" class="stm mis"><a href="#n271">271</a></p>
<p id="n272" class="pln"><a href="#n272">272</a></p>
<p id="n273" class="stm mis"><a href="#n273">273</a></p>
<p id="n274" class="stm mis"><a href="#n274">274</a></p>
<p id="n275" class="pln"><a href="#n275">275</a></p>
<p id="n276" class="pln"><a href="#n276">276</a></p>
<p id="n277" class="stm mis"><a href="#n277">277</a></p>
<p id="n278" class="stm mis"><a href="#n278">278</a></p>
<p id="n279" class="pln"><a href="#n279">279</a></p>
<p id="n280" class="pln"><a href="#n280">280</a></p>
<p id="n281" class="stm mis"><a href="#n281">281</a></p>
<p id="n282" class="stm mis"><a href="#n282">282</a></p>
<p id="n283" class="stm mis"><a href="#n283">283</a></p>
<p id="n284" class="stm mis"><a href="#n284">284</a></p>
<p id="n285" class="stm mis"><a href="#n285">285</a></p>
<p id="n286" class="stm mis"><a href="#n286">286</a></p>
<p id="n287" class="pln"><a href="#n287">287</a></p>
<p id="n288" class="stm mis"><a href="#n288">288</a></p>
<p id="n289" class="stm mis"><a href="#n289">289</a></p>
<p id="n290" class="stm mis"><a href="#n290">290</a></p>
<p id="n291" class="stm mis"><a href="#n291">291</a></p>
<p id="n292" class="stm mis"><a href="#n292">292</a></p>
<p id="n293" class="pln"><a href="#n293">293</a></p>
<p id="n294" class="pln"><a href="#n294">294</a></p>
<p id="n295" class="pln"><a href="#n295">295</a></p>
<p id="n296" class="stm mis"><a href="#n296">296</a></p>
<p id="n297" class="stm mis"><a href="#n297">297</a></p>
<p id="n298" class="stm mis"><a href="#n298">298</a></p>
<p id="n299" class="stm mis"><a href="#n299">299</a></p>
<p id="n300" class="pln"><a href="#n300">300</a></p>
<p id="n301" class="stm mis"><a href="#n301">301</a></p>
<p id="n302" class="stm mis"><a href="#n302">302</a></p>
<p id="n303" class="pln"><a href="#n303">303</a></p>
<p id="n304" class="stm mis"><a href="#n304">304</a></p>
<p id="n305" class="pln"><a href="#n305">305</a></p>
<p id="n306" class="stm mis"><a href="#n306">306</a></p>
<p id="n307" class="pln"><a href="#n307">307</a></p>
<p id="n308" class="stm mis"><a href="#n308">308</a></p>
<p id="n309" class="stm mis"><a href="#n309">309</a></p>
<p id="n310" class="stm mis"><a href="#n310">310</a></p>
<p id="n311" class="pln"><a href="#n311">311</a></p>
<p id="n312" class="stm mis"><a href="#n312">312</a></p>
<p id="n313" class="pln"><a href="#n313">313</a></p>
<p id="n314" class="pln"><a href="#n314">314</a></p>
<p id="n315" class="pln"><a href="#n315">315</a></p>
<p id="n316" class="pln"><a href="#n316">316</a></p>
<p id="n317" class="stm mis"><a href="#n317">317</a></p>
<p id="n318" class="pln"><a href="#n318">318</a></p>
<p id="n319" class="stm mis"><a href="#n319">319</a></p>
<p id="n320" class="pln"><a href="#n320">320</a></p>
<p id="n321" class="pln"><a href="#n321">321</a></p>
<p id="n322" class="pln"><a href="#n322">322</a></p>
<p id="n323" class="pln"><a href="#n323">323</a></p>
<p id="n324" class="pln"><a href="#n324">324</a></p>
<p id="n325" class="pln"><a href="#n325">325</a></p>
<p id="n326" class="pln"><a href="#n326">326</a></p>
<p id="n327" class="pln"><a href="#n327">327</a></p>
<p id="n328" class="stm mis"><a href="#n328">328</a></p>
<p id="n329" class="stm mis"><a href="#n329">329</a></p>
<p id="n330" class="pln"><a href="#n330">330</a></p>
<p id="n331" class="stm mis"><a href="#n331">331</a></p>
<p id="n332" class="stm mis"><a href="#n332">332</a></p>
<p id="n333" class="stm mis"><a href="#n333">333</a></p>
<p id="n334" class="stm mis"><a href="#n334">334</a></p>
<p id="n335" class="stm mis"><a href="#n335">335</a></p>
<p id="n336" class="stm mis"><a href="#n336">336</a></p>
<p id="n337" class="stm mis"><a href="#n337">337</a></p>
<p id="n338" class="stm mis"><a href="#n338">338</a></p>
<p id="n339" class="stm mis"><a href="#n339">339</a></p>
<p id="n340" class="stm mis"><a href="#n340">340</a></p>
<p id="n341" class="stm mis"><a href="#n341">341</a></p>
<p id="n342" class="stm mis"><a href="#n342">342</a></p>
<p id="n343" class="stm mis"><a href="#n343">343</a></p>
<p id="n344" class="stm mis"><a href="#n344">344</a></p>
<p id="n345" class="stm mis"><a href="#n345">345</a></p>
<p id="n346" class="pln"><a href="#n346">346</a></p>
<p id="n347" class="stm mis"><a href="#n347">347</a></p>
<p id="n348" class="stm mis"><a href="#n348">348</a></p>
<p id="n349" class="stm mis"><a href="#n349">349</a></p>
<p id="n350" class="stm mis"><a href="#n350">350</a></p>
<p id="n351" class="pln"><a href="#n351">351</a></p>
<p id="n352" class="pln"><a href="#n352">352</a></p>
<p id="n353" class="pln"><a href="#n353">353</a></p>
<p id="n354" class="stm mis"><a href="#n354">354</a></p>
<p id="n355" class="stm mis"><a href="#n355">355</a></p>
<p id="n356" class="stm mis"><a href="#n356">356</a></p>
<p id="n357" class="pln"><a href="#n357">357</a></p>
<p id="n358" class="stm mis"><a href="#n358">358</a></p>
<p id="n359" class="stm mis"><a href="#n359">359</a></p>
<p id="n360" class="pln"><a href="#n360">360</a></p>
<p id="n361" class="stm mis"><a href="#n361">361</a></p>
<p id="n362" class="pln"><a href="#n362">362</a></p>
<p id="n363" class="pln"><a href="#n363">363</a></p>
<p id="n364" class="pln"><a href="#n364">364</a></p>
<p id="n365" class="pln"><a href="#n365">365</a></p>
<p id="n366" class="stm mis"><a href="#n366">366</a></p>
<p id="n367" class="stm mis"><a href="#n367">367</a></p>
<p id="n368" class="pln"><a href="#n368">368</a></p>
<p id="n369" class="stm mis"><a href="#n369">369</a></p>
<p id="n370" class="pln"><a href="#n370">370</a></p>
<p id="n371" class="pln"><a href="#n371">371</a></p>
<p id="n372" class="pln"><a href="#n372">372</a></p>
<p id="n373" class="pln"><a href="#n373">373</a></p>
<p id="n374" class="stm mis"><a href="#n374">374</a></p>
<p id="n375" class="stm mis"><a href="#n375">375</a></p>
<p id="n376" class="pln"><a href="#n376">376</a></p>
<p id="n377" class="stm mis"><a href="#n377">377</a></p>
<p id="n378" class="stm mis"><a href="#n378">378</a></p>
<p id="n379" class="stm mis"><a href="#n379">379</a></p>
<p id="n380" class="pln"><a href="#n380">380</a></p>
<p id="n381" class="pln"><a href="#n381">381</a></p>
<p id="n382" class="pln"><a href="#n382">382</a></p>
<p id="n383" class="pln"><a href="#n383">383</a></p>
<p id="n384" class="pln"><a href="#n384">384</a></p>
<p id="n385" class="stm mis"><a href="#n385">385</a></p>
<p id="n386" class="pln"><a href="#n386">386</a></p>
<p id="n387" class="stm mis"><a href="#n387">387</a></p>
<p id="n388" class="stm mis"><a href="#n388">388</a></p>
<p id="n389" class="pln"><a href="#n389">389</a></p>
<p id="n390" class="stm mis"><a href="#n390">390</a></p>
<p id="n391" class="stm mis"><a href="#n391">391</a></p>
<p id="n392" class="stm mis"><a href="#n392">392</a></p>
<p id="n393" class="stm mis"><a href="#n393">393</a></p>
<p id="n394" class="stm mis"><a href="#n394">394</a></p>
<p id="n395" class="stm mis"><a href="#n395">395</a></p>
<p id="n396" class="pln"><a href="#n396">396</a></p>
<p id="n397" class="stm mis"><a href="#n397">397</a></p>
<p id="n398" class="stm mis"><a href="#n398">398</a></p>
<p id="n399" class="stm mis"><a href="#n399">399</a></p>
<p id="n400" class="pln"><a href="#n400">400</a></p>
<p id="n401" class="pln"><a href="#n401">401</a></p>
<p id="n402" class="stm mis"><a href="#n402">402</a></p>
<p id="n403" class="stm mis"><a href="#n403">403</a></p>
<p id="n404" class="pln"><a href="#n404">404</a></p>
<p id="n405" class="pln"><a href="#n405">405</a></p>
<p id="n406" class="stm mis"><a href="#n406">406</a></p>
<p id="n407" class="pln"><a href="#n407">407</a></p>
<p id="n408" class="pln"><a href="#n408">408</a></p>
<p id="n409" class="pln"><a href="#n409">409</a></p>
<p id="n410" class="pln"><a href="#n410">410</a></p>
<p id="n411" class="pln"><a href="#n411">411</a></p>
<p id="n412" class="pln"><a href="#n412">412</a></p>
<p id="n413" class="stm mis"><a href="#n413">413</a></p>
<p id="n414" class="stm mis"><a href="#n414">414</a></p>
<p id="n415" class="stm mis"><a href="#n415">415</a></p>
<p id="n416" class="stm mis"><a href="#n416">416</a></p>
<p id="n417" class="pln"><a href="#n417">417</a></p>
<p id="n418" class="stm mis"><a href="#n418">418</a></p>
<p id="n419" class="stm mis"><a href="#n419">419</a></p>
<p id="n420" class="stm mis"><a href="#n420">420</a></p>
<p id="n421" class="pln"><a href="#n421">421</a></p>
<p id="n422" class="pln"><a href="#n422">422</a></p>
<p id="n423" class="pln"><a href="#n423">423</a></p>
<p id="n424" class="pln"><a href="#n424">424</a></p>
<p id="n425" class="stm mis"><a href="#n425">425</a></p>
<p id="n426" class="stm mis"><a href="#n426">426</a></p>
<p id="n427" class="stm mis"><a href="#n427">427</a></p>
<p id="n428" class="pln"><a href="#n428">428</a></p>
<p id="n429" class="stm mis"><a href="#n429">429</a></p>
<p id="n430" class="stm mis"><a href="#n430">430</a></p>
<p id="n431" class="stm mis"><a href="#n431">431</a></p>
<p id="n432" class="pln"><a href="#n432">432</a></p>
<p id="n433" class="pln"><a href="#n433">433</a></p>
<p id="n434" class="pln"><a href="#n434">434</a></p>
<p id="n435" class="pln"><a href="#n435">435</a></p>
<p id="n436" class="stm mis"><a href="#n436">436</a></p>
<p id="n437" class="stm mis"><a href="#n437">437</a></p>
<p id="n438" class="pln"><a href="#n438">438</a></p>
<p id="n439" class="stm mis"><a href="#n439">439</a></p>
<p id="n440" class="pln"><a href="#n440">440</a></p>
<p id="n441" class="stm mis"><a href="#n441">441</a></p>
<p id="n442" class="stm mis"><a href="#n442">442</a></p>
<p id="n443" class="stm mis"><a href="#n443">443</a></p>
<p id="n444" class="stm mis"><a href="#n444">444</a></p>
<p id="n445" class="stm mis"><a href="#n445">445</a></p>
<p id="n446" class="pln"><a href="#n446">446</a></p>
<p id="n447" class="stm mis"><a href="#n447">447</a></p>
<p id="n448" class="stm mis"><a href="#n448">448</a></p>
<p id="n449" class="stm mis"><a href="#n449">449</a></p>
<p id="n450" class="pln"><a href="#n450">450</a></p>
<p id="n451" class="stm mis"><a href="#n451">451</a></p>
<p id="n452" class="stm mis"><a href="#n452">452</a></p>
<p id="n453" class="stm mis"><a href="#n453">453</a></p>
<p id="n454" class="stm mis"><a href="#n454">454</a></p>
<p id="n455" class="pln"><a href="#n455">455</a></p>
<p id="n456" class="stm mis"><a href="#n456">456</a></p>
<p id="n457" class="stm mis"><a href="#n457">457</a></p>
<p id="n458" class="stm mis"><a href="#n458">458</a></p>
<p id="n459" class="stm mis"><a href="#n459">459</a></p>
<p id="n460" class="stm mis"><a href="#n460">460</a></p>
<p id="n461" class="stm mis"><a href="#n461">461</a></p>
<p id="n462" class="stm mis"><a href="#n462">462</a></p>
<p id="n463" class="stm mis"><a href="#n463">463</a></p>
<p id="n464" class="stm mis"><a href="#n464">464</a></p>
<p id="n465" class="pln"><a href="#n465">465</a></p>
<p id="n466" class="stm mis"><a href="#n466">466</a></p>
<p id="n467" class="stm mis"><a href="#n467">467</a></p>
<p id="n468" class="stm mis"><a href="#n468">468</a></p>
<p id="n469" class="stm mis"><a href="#n469">469</a></p>
<p id="n470" class="pln"><a href="#n470">470</a></p>
<p id="n471" class="stm mis"><a href="#n471">471</a></p>
<p id="n472" class="stm mis"><a href="#n472">472</a></p>
<p id="n473" class="stm mis"><a href="#n473">473</a></p>
<p id="n474" class="pln"><a href="#n474">474</a></p>
<p id="n475" class="stm mis"><a href="#n475">475</a></p>
<p id="n476" class="stm mis"><a href="#n476">476</a></p>
<p id="n477" class="stm mis"><a href="#n477">477</a></p>
<p id="n478" class="pln"><a href="#n478">478</a></p>
<p id="n479" class="stm mis"><a href="#n479">479</a></p>
<p id="n480" class="stm mis"><a href="#n480">480</a></p>
<p id="n481" class="stm mis"><a href="#n481">481</a></p>
<p id="n482" class="pln"><a href="#n482">482</a></p>
<p id="n483" class="stm mis"><a href="#n483">483</a></p>
<p id="n484" class="stm mis"><a href="#n484">484</a></p>
<p id="n485" class="pln"><a href="#n485">485</a></p>
<p id="n486" class="pln"><a href="#n486">486</a></p>
<p id="n487" class="stm mis"><a href="#n487">487</a></p>
<p id="n488" class="stm mis"><a href="#n488">488</a></p>
<p id="n489" class="stm mis"><a href="#n489">489</a></p>
<p id="n490" class="stm mis"><a href="#n490">490</a></p>
<p id="n491" class="stm mis"><a href="#n491">491</a></p>
<p id="n492" class="stm mis"><a href="#n492">492</a></p>
<p id="n493" class="stm mis"><a href="#n493">493</a></p>
<p id="n494" class="pln"><a href="#n494">494</a></p>
<p id="n495" class="pln"><a href="#n495">495</a></p>
<p id="n496" class="pln"><a href="#n496">496</a></p>
<p id="n497" class="pln"><a href="#n497">497</a></p>
<p id="n498" class="pln"><a href="#n498">498</a></p>
<p id="n499" class="stm mis"><a href="#n499">499</a></p>
<p id="n500" class="stm mis"><a href="#n500">500</a></p>
<p id="n501" class="pln"><a href="#n501">501</a></p>
<p id="n502" class="stm mis"><a href="#n502">502</a></p>
<p id="n503" class="stm mis"><a href="#n503">503</a></p>
<p id="n504" class="pln"><a href="#n504">504</a></p>
<p id="n505" class="stm mis"><a href="#n505">505</a></p>
<p id="n506" class="stm mis"><a href="#n506">506</a></p>
<p id="n507" class="pln"><a href="#n507">507</a></p>
<p id="n508" class="stm mis"><a href="#n508">508</a></p>
<p id="n509" class="stm mis"><a href="#n509">509</a></p>
<p id="n510" class="stm mis"><a href="#n510">510</a></p>
<p id="n511" class="stm mis"><a href="#n511">511</a></p>
<p id="n512" class="pln"><a href="#n512">512</a></p>
<p id="n513" class="stm mis"><a href="#n513">513</a></p>
<p id="n514" class="stm mis"><a href="#n514">514</a></p>
<p id="n515" class="stm mis"><a href="#n515">515</a></p>
<p id="n516" class="pln"><a href="#n516">516</a></p>
<p id="n517" class="pln"><a href="#n517">517</a></p>
<p id="n518" class="pln"><a href="#n518">518</a></p>
<p id="n519" class="pln"><a href="#n519">519</a></p>
<p id="n520" class="pln"><a href="#n520">520</a></p>
<p id="n521" class="pln"><a href="#n521">521</a></p>
<p id="n522" class="pln"><a href="#n522">522</a></p>
<p id="n523" class="stm mis"><a href="#n523">523</a></p>
<p id="n524" class="stm mis"><a href="#n524">524</a></p>
<p id="n525" class="pln"><a href="#n525">525</a></p>
<p id="n526" class="stm mis"><a href="#n526">526</a></p>
<p id="n527" class="stm mis"><a href="#n527">527</a></p>
<p id="n528" class="pln"><a href="#n528">528</a></p>
<p id="n529" class="stm mis"><a href="#n529">529</a></p>
<p id="n530" class="stm mis"><a href="#n530">530</a></p>
<p id="n531" class="pln"><a href="#n531">531</a></p>
<p id="n532" class="stm mis"><a href="#n532">532</a></p>
<p id="n533" class="stm mis"><a href="#n533">533</a></p>
<p id="n534" class="pln"><a href="#n534">534</a></p>
<p id="n535" class="stm mis"><a href="#n535">535</a></p>
<p id="n536" class="stm mis"><a href="#n536">536</a></p>
<p id="n537" class="pln"><a href="#n537">537</a></p>
<p id="n538" class="stm mis"><a href="#n538">538</a></p>
<p id="n539" class="stm mis"><a href="#n539">539</a></p>
<p id="n540" class="pln"><a href="#n540">540</a></p>
<p id="n541" class="stm mis"><a href="#n541">541</a></p>
<p id="n542" class="stm mis"><a href="#n542">542</a></p>
<p id="n543" class="pln"><a href="#n543">543</a></p>
<p id="n544" class="stm mis"><a href="#n544">544</a></p>
<p id="n545" class="stm mis"><a href="#n545">545</a></p>
<p id="n546" class="pln"><a href="#n546">546</a></p>
<p id="n547" class="stm mis"><a href="#n547">547</a></p>
<p id="n548" class="stm mis"><a href="#n548">548</a></p>
<p id="n549" class="pln"><a href="#n549">549</a></p>
<p id="n550" class="stm mis"><a href="#n550">550</a></p>
<p id="n551" class="pln"><a href="#n551">551</a></p>
<p id="n552" class="pln"><a href="#n552">552</a></p>
<p id="n553" class="stm mis"><a href="#n553">553</a></p>
<p id="n554" class="stm mis"><a href="#n554">554</a></p>
<p id="n555" class="pln"><a href="#n555">555</a></p>
<p id="n556" class="pln"><a href="#n556">556</a></p>
<p id="n557" class="stm mis"><a href="#n557">557</a></p>
<p id="n558" class="pln"><a href="#n558">558</a></p>
<p id="n559" class="stm mis"><a href="#n559">559</a></p>
<p id="n560" class="stm mis"><a href="#n560">560</a></p>
<p id="n561" class="pln"><a href="#n561">561</a></p>
<p id="n562" class="pln"><a href="#n562">562</a></p>
<p id="n563" class="stm mis"><a href="#n563">563</a></p>
<p id="n564" class="pln"><a href="#n564">564</a></p>
<p id="n565" class="pln"><a href="#n565">565</a></p>
<p id="n566" class="stm mis"><a href="#n566">566</a></p>
<p id="n567" class="stm mis"><a href="#n567">567</a></p>
<p id="n568" class="pln"><a href="#n568">568</a></p>
<p id="n569" class="pln"><a href="#n569">569</a></p>
<p id="n570" class="stm mis"><a href="#n570">570</a></p>
<p id="n571" class="stm mis"><a href="#n571">571</a></p>
<p id="n572" class="stm mis"><a href="#n572">572</a></p>
<p id="n573" class="stm mis"><a href="#n573">573</a></p>
<p id="n574" class="stm mis"><a href="#n574">574</a></p>
<p id="n575" class="stm mis"><a href="#n575">575</a></p>
<p id="n576" class="stm mis"><a href="#n576">576</a></p>
<p id="n577" class="stm mis"><a href="#n577">577</a></p>
<p id="n578" class="pln"><a href="#n578">578</a></p>
<p id="n579" class="stm mis"><a href="#n579">579</a></p>
<p id="n580" class="stm mis"><a href="#n580">580</a></p>
<p id="n581" class="pln"><a href="#n581">581</a></p>
<p id="n582" class="stm mis"><a href="#n582">582</a></p>
<p id="n583" class="pln"><a href="#n583">583</a></p>
<p id="n584" class="stm mis"><a href="#n584">584</a></p>
<p id="n585" class="stm mis"><a href="#n585">585</a></p>
<p id="n586" class="stm mis"><a href="#n586">586</a></p>
<p id="n587" class="stm mis"><a href="#n587">587</a></p>
<p id="n588" class="pln"><a href="#n588">588</a></p>
<p id="n589" class="pln"><a href="#n589">589</a></p>
<p id="n590" class="pln"><a href="#n590">590</a></p>
<p id="n591" class="pln"><a href="#n591">591</a></p>
<p id="n592" class="pln"><a href="#n592">592</a></p>
<p id="n593" class="stm mis"><a href="#n593">593</a></p>
<p id="n594" class="pln"><a href="#n594">594</a></p>
<p id="n595" class="pln"><a href="#n595">595</a></p>
<p id="n596" class="pln"><a href="#n596">596</a></p>
<p id="n597" class="stm mis"><a href="#n597">597</a></p>
<p id="n598" class="stm mis"><a href="#n598">598</a></p>
<p id="n599" class="stm mis"><a href="#n599">599</a></p>
<p id="n600" class="pln"><a href="#n600">600</a></p>
<p id="n601" class="pln"><a href="#n601">601</a></p>
<p id="n602" class="stm mis"><a href="#n602">602</a></p>
<p id="n603" class="pln"><a href="#n603">603</a></p>
<p id="n604" class="stm mis"><a href="#n604">604</a></p>
<p id="n605" class="stm mis"><a href="#n605">605</a></p>
<p id="n606" class="stm mis"><a href="#n606">606</a></p>
<p id="n607" class="pln"><a href="#n607">607</a></p>
<p id="n608" class="pln"><a href="#n608">608</a></p>
<p id="n609" class="pln"><a href="#n609">609</a></p>
<p id="n610" class="stm mis"><a href="#n610">610</a></p>
<p id="n611" class="stm mis"><a href="#n611">611</a></p>
<p id="n612" class="pln"><a href="#n612">612</a></p>
<p id="n613" class="stm mis"><a href="#n613">613</a></p>
<p id="n614" class="stm mis"><a href="#n614">614</a></p>
<p id="n615" class="stm mis"><a href="#n615">615</a></p>
<p id="n616" class="pln"><a href="#n616">616</a></p>
<p id="n617" class="stm mis"><a href="#n617">617</a></p>
<p id="n618" class="stm mis"><a href="#n618">618</a></p>
<p id="n619" class="pln"><a href="#n619">619</a></p>
<p id="n620" class="stm mis"><a href="#n620">620</a></p>
<p id="n621" class="stm mis"><a href="#n621">621</a></p>
<p id="n622" class="pln"><a href="#n622">622</a></p>
<p id="n623" class="stm mis"><a href="#n623">623</a></p>
<p id="n624" class="stm mis"><a href="#n624">624</a></p>
<p id="n625" class="stm mis"><a href="#n625">625</a></p>
<p id="n626" class="stm mis"><a href="#n626">626</a></p>
<p id="n627" class="stm mis"><a href="#n627">627</a></p>
<p id="n628" class="pln"><a href="#n628">628</a></p>
<p id="n629" class="pln"><a href="#n629">629</a></p>
<p id="n630" class="pln"><a href="#n630">630</a></p>
<p id="n631" class="stm mis"><a href="#n631">631</a></p>
<p id="n632" class="pln"><a href="#n632">632</a></p>
<p id="n633" class="pln"><a href="#n633">633</a></p>
<p id="n634" class="pln"><a href="#n634">634</a></p>
<p id="n635" class="pln"><a href="#n635">635</a></p>
<p id="n636" class="pln"><a href="#n636">636</a></p>
<p id="n637" class="stm mis"><a href="#n637">637</a></p>
<p id="n638" class="stm mis"><a href="#n638">638</a></p>
<p id="n639" class="stm mis"><a href="#n639">639</a></p>
<p id="n640" class="pln"><a href="#n640">640</a></p>
<p id="n641" class="pln"><a href="#n641">641</a></p>
<p id="n642" class="pln"><a href="#n642">642</a></p>
<p id="n643" class="pln"><a href="#n643">643</a></p>
<p id="n644" class="pln"><a href="#n644">644</a></p>
<p id="n645" class="stm mis"><a href="#n645">645</a></p>
<p id="n646" class="stm mis"><a href="#n646">646</a></p>
<p id="n647" class="stm mis"><a href="#n647">647</a></p>
<p id="n648" class="pln"><a href="#n648">648</a></p>
<p id="n649" class="stm mis"><a href="#n649">649</a></p>
<p id="n650" class="pln"><a href="#n650">650</a></p>
<p id="n651" class="pln"><a href="#n651">651</a></p>
<p id="n652" class="pln"><a href="#n652">652</a></p>
<p id="n653" class="stm mis"><a href="#n653">653</a></p>
<p id="n654" class="pln"><a href="#n654">654</a></p>
<p id="n655" class="stm mis"><a href="#n655">655</a></p>
<p id="n656" class="pln"><a href="#n656">656</a></p>
<p id="n657" class="pln"><a href="#n657">657</a></p>
<p id="n658" class="pln"><a href="#n658">658</a></p>
<p id="n659" class="pln"><a href="#n659">659</a></p>
<p id="n660" class="pln"><a href="#n660">660</a></p>
<p id="n661" class="pln"><a href="#n661">661</a></p>
<p id="n662" class="stm mis"><a href="#n662">662</a></p>
<p id="n663" class="stm mis"><a href="#n663">663</a></p>
<p id="n664" class="stm mis"><a href="#n664">664</a></p>
<p id="n665" class="stm mis"><a href="#n665">665</a></p>
<p id="n666" class="stm mis"><a href="#n666">666</a></p>
<p id="n667" class="stm mis"><a href="#n667">667</a></p>
<p id="n668" class="stm mis"><a href="#n668">668</a></p>
<p id="n669" class="pln"><a href="#n669">669</a></p>
<p id="n670" class="pln"><a href="#n670">670</a></p>
<p id="n671" class="pln"><a href="#n671">671</a></p>
<p id="n672" class="stm mis"><a href="#n672">672</a></p>
<p id="n673" class="stm mis"><a href="#n673">673</a></p>
<p id="n674" class="stm mis"><a href="#n674">674</a></p>
<p id="n675" class="stm mis"><a href="#n675">675</a></p>
<p id="n676" class="stm mis"><a href="#n676">676</a></p>
<p id="n677" class="stm mis"><a href="#n677">677</a></p>
<p id="n678" class="stm mis"><a href="#n678">678</a></p>
<p id="n679" class="stm mis"><a href="#n679">679</a></p>
<p id="n680" class="stm mis"><a href="#n680">680</a></p>
<p id="n681" class="stm mis"><a href="#n681">681</a></p>
<p id="n682" class="pln"><a href="#n682">682</a></p>
<p id="n683" class="stm mis"><a href="#n683">683</a></p>
<p id="n684" class="stm mis"><a href="#n684">684</a></p>
<p id="n685" class="stm mis"><a href="#n685">685</a></p>
<p id="n686" class="stm mis"><a href="#n686">686</a></p>
<p id="n687" class="stm mis"><a href="#n687">687</a></p>
<p id="n688" class="pln"><a href="#n688">688</a></p>
<p id="n689" class="stm mis"><a href="#n689">689</a></p>
<p id="n690" class="stm mis"><a href="#n690">690</a></p>
<p id="n691" class="stm mis"><a href="#n691">691</a></p>
<p id="n692" class="stm mis"><a href="#n692">692</a></p>
<p id="n693" class="stm mis"><a href="#n693">693</a></p>
<p id="n694" class="stm mis"><a href="#n694">694</a></p>
<p id="n695" class="pln"><a href="#n695">695</a></p>
<p id="n696" class="pln"><a href="#n696">696</a></p>
<p id="n697" class="stm mis"><a href="#n697">697</a></p>
<p id="n698" class="stm mis"><a href="#n698">698</a></p>
<p id="n699" class="stm mis"><a href="#n699">699</a></p>
<p id="n700" class="pln"><a href="#n700">700</a></p>
<p id="n701" class="pln"><a href="#n701">701</a></p>
<p id="n702" class="stm mis"><a href="#n702">702</a></p>
<p id="n703" class="stm mis"><a href="#n703">703</a></p>
<p id="n704" class="stm mis"><a href="#n704">704</a></p>
<p id="n705" class="stm mis"><a href="#n705">705</a></p>
<p id="n706" class="stm mis"><a href="#n706">706</a></p>
<p id="n707" class="stm mis"><a href="#n707">707</a></p>
<p id="n708" class="pln"><a href="#n708">708</a></p>
<p id="n709" class="stm mis"><a href="#n709">709</a></p>
<p id="n710" class="pln"><a href="#n710">710</a></p>
<p id="n711" class="pln"><a href="#n711">711</a></p>
<p id="n712" class="stm mis"><a href="#n712">712</a></p>
<p id="n713" class="stm mis"><a href="#n713">713</a></p>
<p id="n714" class="pln"><a href="#n714">714</a></p>
<p id="n715" class="pln"><a href="#n715">715</a></p>
<p id="n716" class="stm mis"><a href="#n716">716</a></p>
<p id="n717" class="stm mis"><a href="#n717">717</a></p>
<p id="n718" class="pln"><a href="#n718">718</a></p>
<p id="n719" class="stm mis"><a href="#n719">719</a></p>
<p id="n720" class="pln"><a href="#n720">720</a></p>
<p id="n721" class="stm mis"><a href="#n721">721</a></p>
<p id="n722" class="pln"><a href="#n722">722</a></p>
<p id="n723" class="pln"><a href="#n723">723</a></p>
<p id="n724" class="stm mis"><a href="#n724">724</a></p>
<p id="n725" class="stm mis"><a href="#n725">725</a></p>
<p id="n726" class="pln"><a href="#n726">726</a></p>
<p id="n727" class="stm mis"><a href="#n727">727</a></p>
<p id="n728" class="pln"><a href="#n728">728</a></p>
<p id="n729" class="pln"><a href="#n729">729</a></p>
<p id="n730" class="stm mis"><a href="#n730">730</a></p>
<p id="n731" class="pln"><a href="#n731">731</a></p>
<p id="n732" class="stm mis"><a href="#n732">732</a></p>
<p id="n733" class="pln"><a href="#n733">733</a></p>
<p id="n734" class="pln"><a href="#n734">734</a></p>
<p id="n735" class="stm mis"><a href="#n735">735</a></p>
<p id="n736" class="pln"><a href="#n736">736</a></p>
<p id="n737" class="pln"><a href="#n737">737</a></p>
<p id="n738" class="pln"><a href="#n738">738</a></p>
<p id="n739" class="pln"><a href="#n739">739</a></p>
<p id="n740" class="pln"><a href="#n740">740</a></p>
<p id="n741" class="pln"><a href="#n741">741</a></p>
<p id="n742" class="pln"><a href="#n742">742</a></p>
<p id="n743" class="pln"><a href="#n743">743</a></p>
<p id="n744" class="stm mis"><a href="#n744">744</a></p>
<p id="n745" class="pln"><a href="#n745">745</a></p>
<p id="n746" class="stm mis"><a href="#n746">746</a></p>
<p id="n747" class="pln"><a href="#n747">747</a></p>
<p id="n748" class="pln"><a href="#n748">748</a></p>
<p id="n749" class="pln"><a href="#n749">749</a></p>
<p id="n750" class="pln"><a href="#n750">750</a></p>
<p id="n751" class="pln"><a href="#n751">751</a></p>
<p id="n752" class="pln"><a href="#n752">752</a></p>
<p id="n753" class="stm mis"><a href="#n753">753</a></p>
<p id="n754" class="stm mis"><a href="#n754">754</a></p>
<p id="n755" class="stm mis"><a href="#n755">755</a></p>
<p id="n756" class="stm mis"><a href="#n756">756</a></p>
<p id="n757" class="stm mis"><a href="#n757">757</a></p>
<p id="n758" class="stm mis"><a href="#n758">758</a></p>
<p id="n759" class="pln"><a href="#n759">759</a></p>
<p id="n760" class="stm mis"><a href="#n760">760</a></p>
<p id="n761" class="stm mis"><a href="#n761">761</a></p>
<p id="n762" class="stm mis"><a href="#n762">762</a></p>
<p id="n763" class="stm mis"><a href="#n763">763</a></p>
<p id="n764" class="stm mis"><a href="#n764">764</a></p>
<p id="n765" class="stm mis"><a href="#n765">765</a></p>
<p id="n766" class="pln"><a href="#n766">766</a></p>
<p id="n767" class="pln"><a href="#n767">767</a></p>
<p id="n768" class="pln"><a href="#n768">768</a></p>
<p id="n769" class="pln"><a href="#n769">769</a></p>
<p id="n770" class="pln"><a href="#n770">770</a></p>
<p id="n771" class="pln"><a href="#n771">771</a></p>
<p id="n772" class="pln"><a href="#n772">772</a></p>
<p id="n773" class="stm mis"><a href="#n773">773</a></p>
<p id="n774" class="pln"><a href="#n774">774</a></p>
<p id="n775" class="stm mis"><a href="#n775">775</a></p>
<p id="n776" class="pln"><a href="#n776">776</a></p>
<p id="n777" class="stm mis"><a href="#n777">777</a></p>
<p id="n778" class="pln"><a href="#n778">778</a></p>
<p id="n779" class="pln"><a href="#n779">779</a></p>
<p id="n780" class="stm mis"><a href="#n780">780</a></p>
<p id="n781" class="stm mis"><a href="#n781">781</a></p>
<p id="n782" class="pln"><a href="#n782">782</a></p>
<p id="n783" class="stm mis"><a href="#n783">783</a></p>
<p id="n784" class="pln"><a href="#n784">784</a></p>
<p id="n785" class="pln"><a href="#n785">785</a></p>
<p id="n786" class="stm mis"><a href="#n786">786</a></p>
<p id="n787" class="stm mis"><a href="#n787">787</a></p>
<p id="n788" class="stm mis"><a href="#n788">788</a></p>
<p id="n789" class="pln"><a href="#n789">789</a></p>
<p id="n790" class="stm mis"><a href="#n790">790</a></p>
<p id="n791" class="pln"><a href="#n791">791</a></p>
<p id="n792" class="stm mis"><a href="#n792">792</a></p>
<p id="n793" class="stm mis"><a href="#n793">793</a></p>
                
            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com">#!/usr/bin/env python</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="stm mis"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">print_function</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="com"># Author: Steve Ludtke 06/10/2013 (sludtke@bcm.edu)</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="com"># Copyright (c) 2013- Baylor College of Medicine</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="com"># This software is issued under a joint BSD/GNU license. You may use the</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="pln"><span class="com"># source code in this file under either license. However, note that the</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="com"># complete EMAN2 and SPARX software packages have some GPL dependencies,</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="com"># so you are responsible for compliance with the licenses of these packages</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="com"># if you opt to use BSD licensing. The warranty disclaimer below holds</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="com"># in either instance.</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="com"># This complete copyright notice must be included in any revised version of the</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="com"># source code. Additional authorship citations may be added, but existing</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln"><span class="com"># author citations must be preserved.</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln"><span class="com"># This program is free software; you can redistribute it and/or modify</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="pln"><span class="com"># it under the terms of the GNU General Public License as published by</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="pln"><span class="com"># the Free Software Foundation; either version 2 of the License, or</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="pln"><span class="com"># (at your option) any later version.</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="pln"><span class="com"># This program is distributed in the hope that it will be useful,</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="com"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="com"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="com"># GNU General Public License for more details.</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="com"># You should have received a copy of the GNU General Public License</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="com"># along with this program; if not, write to the Free Software</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="pln"><span class="com"># Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA&nbsp; 2111-1307 USA</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t35" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t36" class="stm mis"><span class="key">from</span> <span class="nam">EMAN2</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="stm mis"><span class="key">from</span> <span class="nam">optparse</span> <span class="key">import</span> <span class="nam">OptionParser</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm mis"><span class="key">from</span> <span class="nam">math</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="stm mis"><span class="key">import</span> <span class="nam">os</span><span class="strut">&nbsp;</span></p>
<p id="t40" class="stm mis"><span class="key">import</span> <span class="nam">sys</span><span class="strut">&nbsp;</span></p>
<p id="t41" class="stm mis"><span class="key">import</span> <span class="nam">time</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="stm mis"><span class="key">from</span> <span class="nam">numpy</span> <span class="key">import</span> <span class="nam">array</span><span class="strut">&nbsp;</span></p>
<p id="t43" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t44" class="pln"><span class="com"># This is used to build the HTML status file. It&#39;s a global for convenience</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="stm mis"><span class="nam">output_html</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="stm mis"><span class="nam">output_html_com</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="stm mis"><span class="nam">output_path</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t49" class="stm mis"><span class="key">def</span> <span class="nam">append_html</span><span class="op">(</span><span class="nam">msg</span><span class="op">,</span><span class="nam">com</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">global</span> <span class="nam">output_html</span><span class="op">,</span><span class="nam">output_html_com</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">com</span> <span class="op">:</span> <span class="nam">output_html_com</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">output_html</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">write_html</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t55" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t56" class="stm mis"><span class="key">def</span> <span class="nam">write_html</span><span class="op">(</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">global</span> <span class="nam">output_html</span><span class="op">,</span><span class="nam">output_html_com</span><span class="op">,</span><span class="nam">output_path</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">=</span><span class="nam">open</span><span class="op">(</span><span class="nam">output_path</span><span class="op">+</span><span class="str">&quot;/index.html&quot;</span><span class="op">,</span><span class="str">&quot;w&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;EMAN2 Multi-model Refinement Analysis&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;\n&quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">output_html</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;&lt;h4&gt;Detailed command log&lt;/h4&gt;\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t62" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;\n&quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">output_html_com</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t63" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;&lt;br&gt;&lt;/br&gt;&lt;hr&gt;&lt;/hr&gt;Generated by {ver} {date}\n&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ver</span><span class="op">=</span><span class="nam">EMANVERSION</span><span class="op">,</span><span class="nam">date</span><span class="op">=</span><span class="nam">DATESTAMP</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t65" class="stm mis"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progname</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">usage</span> <span class="op">=</span> <span class="str">&quot;&quot;&quot;prog [options]</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t69" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; This is the multiple model single particle refinement program in EMAN2.1+. It replaces the earlier e2refinemulti, offering features similar to e2refine_easy.</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="pln"><span class="str">Major features of this program:</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t72" class="pln"><span class="str"> * While a range of command-line options still exist. You should not normally specify more than the basic requirements. The rest will be auto-selected for you.</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="pln"><span class="str"> * Unlike e2refine_easy, this program doesn&#39;t compute gold_standard resolution curves, since it&#39;s already splitting the data into multiple groups. After it completes, the particles are split, easy_refine is run on the fractions.</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="pln"><span class="str"> * An HTML report file will be generated as this program runs, telling you exactly what it decided to do and why, as well as giving information about runtime, etc while the job is still running.</span><span class="strut">&nbsp;</span></p>
<p id="t75" class="pln"><span class="str"> * If you specify only one starting model it will be randomly perturbed N times, and results may be different with each run, depending on the nature of the heterogeneity in the data.</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="pln"><span class="str"> * Many of the &#39;advanced&#39; options are hidden in the e2projectmanager.py GUI, because most users should not need to specify them.</span><span class="strut">&nbsp;</span></p>
<p id="t77" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t78" class="pln"><span class="str">To run this program, you would normally specify only the following options:</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="pln"><span class="str">&nbsp; --model=&lt;starting map to seed refinement&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="pln"><span class="str">&nbsp; --nmodels=&lt;number of starting models to generate from model&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="pln"><span class="str">&nbsp; --mapfragment&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Optional. If specified will generate starting maps via segmentation and random exclusion</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; instead of phase randomization. This option may be appropriate for heterogenous assemblies.</span><span class="strut">&nbsp;</span></p>
<p id="t83" class="pln"><span class="str">&nbsp; OR</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="pln"><span class="str">&nbsp; --models=&lt;starting map 1&gt;,&lt;starting map 2&gt;,...</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln"><span class="str">&nbsp; Required:</span><span class="strut">&nbsp;</span></p>
<p id="t87" class="pln"><span class="str">&nbsp; --input=&lt;lst file referencing phase-flipped particles in HDF format&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t89" class="pln"><span class="str">&nbsp; --targetres=&lt;in A&gt;&nbsp; &nbsp;&nbsp; Resolution to target in Angstroms in this refinement run. Do not be overoptimistic !</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Generally begin with something conservative like 25, then use --startfrom and reduce</span><span class="strut">&nbsp;</span></p>
<p id="t91" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; to ~12, only after that try for high (3-8 A). Data permitting, of course. Low resolution</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; attempts will run MUCH faster due to more efficient parameters.</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="pln"><span class="str">&nbsp; --speed=&lt;1-7&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Default=5. Larger values will run faster, with a coarser angular step. Smaller values will</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; sample the angular step more finely than strictly required and increase sep=. Usually a</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; larger value here combined with a smaller value in the subsequent single-model refinements</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; will produce good results.</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="pln"><span class="str">&nbsp; --sym=&lt;symmetry&gt;&nbsp; &nbsp; &nbsp;&nbsp; Symmetry to enforce during refinement (Cn, Dn, icos, oct, cub).</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Default=c1 (no symmetry)</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="pln"><span class="str">&nbsp; --mass=&lt;in kDa&gt;&nbsp; &nbsp; &nbsp; &nbsp; Putative mass of object in kDa, but as desired volume varies with resolution</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; actual number may vary by as much a ~2x from the true value. The goal is to</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; have a good isosurface in the final map with a threshold of 1.0.</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="pln"><span class="str">&nbsp; --parallel=&lt;par spec&gt;&nbsp; While not strictly required, without this option the refinement will run on a single CPU</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; and you will likely wait a very long time. To use more than one core on a single computer,</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; just say thread:N (eg - thread:4). For other options, like MPI, see:</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; http://blake.bcm.edu/emanwiki/EMAN2/Parallel for details.</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="pln"><span class="str">&nbsp; --threads=&lt;ncpu&gt;&nbsp; &nbsp; &nbsp;&nbsp; For some algorithms, processing in parallel over the network (MPI) works poorly.</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Running on multiple processors on a single machine may still be worthwhile. If you specify this</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; option, in specific cases it will replace your specified --parallel option. Specify</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the number of cores that can be used on a single machine.</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t111" class="pln"><span class="str">&nbsp; Optional:</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="pln"><span class="str">&nbsp; --apix=&lt;A/pix&gt;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; The value will normally come from the particle data if present. You can override with this.</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="pln"><span class="str">&nbsp; --sep=&lt;classes/ptcl&gt;&nbsp;&nbsp; each particle will be put into N classes. Improves contrast at cost of rotational blur.</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="pln"><span class="str">&nbsp; --classkeep=&lt;frac&gt;&nbsp; &nbsp;&nbsp; fraction of particles to use in final average. Default 90%%. Should be &gt;50%%</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="pln"><span class="str">&nbsp; --m3dkeep=&lt;frac&gt;&nbsp; &nbsp; &nbsp;&nbsp; fraction of class-averages to use in 3-D map. Default=auto</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="pln"><span class="str">&nbsp; --classautomask&nbsp; &nbsp; &nbsp; &nbsp; applies an automask when aligning particles for improved alignment</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="pln"><span class="str">&nbsp; --m3dpostprocess&nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;:&lt;parm&gt;=&lt;value&gt;:...&nbsp; An arbitrary processor</span><span class="strut">&nbsp;</span></p>
<p id="t118" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (e2help.py processors -v2) to apply to the 3-D map after each</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; iteration. Default=none</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="pln"><span class="str">&nbsp; --path=&lt;path&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Normally the new directory will be named automatically. If you prefer your own convention</span><span class="strut">&nbsp;</span></p>
<p id="t121" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; you can override, but it may cause minor GUI problems if you break the standard naming</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; convention.</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t124" class="pln"><span class="str">========================================================================</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="pln"><span class="str">&nbsp; There are numerous additional options based on the original e2refine.py command. These options are not available from</span><span class="strut">&nbsp;</span></p>
<p id="t126" class="pln"><span class="str">the graphical interface, as it is generally best to let e2refine_easy pick these values for you. Normally you should</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln"><span class="str">not need to specify any of the following other than the ones already listed above:</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t129" class="pln"><span class="str">&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span> <span class="op">=</span> <span class="nam">EMArgumentParser</span><span class="op">(</span><span class="nam">usage</span><span class="op">=</span><span class="nam">usage</span><span class="op">,</span><span class="nam">version</span><span class="op">=</span><span class="nam">EMANVERSION</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t132" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#options associated with e2refine.py</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_header(name=&quot;multirefineheader&quot;, help=&#39;Options below this label are specific to e2refinemulti&#39;, title=&quot;### e2refinemulti options ###&quot;, row=1, col=0, rowspan=1, colspan=3, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_header(name=&quot;multimodelheader&quot;, help=&#39;Options below this label are specific to e2refinemulti Model&#39;, title=&quot;### e2refinemulti model options ###&quot;, row=4, col=0, rowspan=1, colspan=3, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t135" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--model&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;model&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The map to use as a starting point for refinement&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMModelsTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--nmodels&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;nmodels&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;The total number of different maps to generate. Specify with --model, but not with --models&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--mapfragment&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Generate initial maps by randomly removing portions of the input map rather than by phase randomizing.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--randclassify&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Generate initial maps by randomly assigning the particles in each class to each model after the first iteration.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[True]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--randphase&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Generate initial maps by randomizing the phase of the given model.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">4</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;orblock&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&#39;Just a visual separation&#39;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;- OR -&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--treeclassify&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Classify using a binary tree. This will call e2classifytree.py for particle classification, replacing e2simmx2stage.py and e2classify.py. This function is still experimental.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--models&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;models&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The map to use as a starting point for refinement&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMModelsTable(withmodal=True,multiselect=True)&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">7</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--input&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;input&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The name of the image file containing the particle data&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMSetsTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">8</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;required&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&#39;Just a visual separation&#39;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;Required:&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">9</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--targetres&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">12.0</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Target resolution in A of the final single-model refinements.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--speed&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">5</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;(1-7) Balances speed vs precision. Larger values sacrifice a bit of potential resolution for significant speed increases. Set to 1 when pushing resolution. default=5&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">16</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--sym&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;sym&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;c1&quot;</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Specify symmetry - choices are: c&lt;n&gt;, d&lt;n&gt;, tet, oct, icos. You can specify either a single value or one for each model.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;strbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t148" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--breaksym&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;If selected, reconstruction will be asymmetric with sym= specifying a known pseudosymmetry, not an imposed symmetry.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">11</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--iter&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;iter&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">6</span><span class="op">,</span> <span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;The total number of refinement iterations to perform. Default=auto&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--mass&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The ~mass of the particles in kilodaltons. May specify one number or one number for each map. Due to resolution effects, not always the true mass.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">12</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[&#39;self.pm().getMass()&#39;]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t151" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;optional&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&#39;Just a visual separation&#39;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;Optional:&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">14</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_argument(&quot;--apix&quot;, default=0, type=float,help=&quot;The angstrom per pixel of the input particles. This argument is required if you specify the --mass argument. If unspecified (set to 0), the convergence plot is generated using either the project apix, or if not an apix of 1.&quot;, guitype=&#39;floatbox&#39;, row=16, col=0, rowspan=1, colspan=1, mode=&quot;refinement[&#39;self.pm().getAPIX()&#39;]&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--sep&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The number of classes each particle can contribute towards (normally 1). Increasing will improve SNR, but produce rotational blurring.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classkeep&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The fraction of particles to keep in each class, based on the similarity score. (default=0.9 -&gt; 90%%)&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0.9</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">16</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classautomask&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;This will apply an automask to the class-average during iterative alignment for better accuracy. The final class averages are unmasked.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--prethreshold&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Applies a threshold to the volume just before generating projections. A sort of aggressive solvent flattening for the reference.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dkeep&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The fraction of slices to keep in e2make3d.py. Default=0.8 -&gt; 80%%&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0.8</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--nosingle&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Normally the multi-model refinement will be followed by N single model refinements automatically. If this is set the job will finish after making the split data sets.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t159" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dpostprocess&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=none. An arbitrary post-processor to run after all other automatic processing. Maps are autofiltered, so a low-pass filter is not required here.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),\&#39;filter.lowpass|filter.highpass\&#39;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">20</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--parallel&quot;</span><span class="op">,</span><span class="str">&quot;-P&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Run in parallel, specify type:&lt;option&gt;=&lt;value&gt;:&lt;option&gt;=&lt;value&gt;. See http://blake.bcm.edu/emanwiki/EMAN2/Parallel&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;strbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">24</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--threads&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">4</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Number of threads to run in parallel on a single computer when multi-computer parallelism isn&#39;t useful&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">24</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--path&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The name of a directory where results are placed. Default = create new multi_xx&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--verbose&quot;</span><span class="op">,</span> <span class="str">&quot;-v&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;verbose&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;verbose level [0-9], higner number means higher level of verboseness&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_argument(&quot;--usefilt&quot;, dest=&quot;usefilt&quot;, type=str,default=None, help=&quot;Specify a particle data file that has been low pass or Wiener filtered. Has a one to one correspondence with your particle data. If specified will be used in projection matching routines, and elsewhere.&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t166" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2project3d.py</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;projectheader&quot;, help=&#39;Options below this label are specific to e2project&#39;, title=&quot;### e2project options ###&quot;, row=12, col=0, rowspan=1, colspan=3)</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--automask3d&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Specify as a processor, eg - mask.auto3d:threshold=1.1:radius=30:nshells=5:nshellsgauss=5.&quot;</span><span class="op">,</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--projector&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;projector&quot;</span><span class="op">,</span> <span class="nam">default</span> <span class="op">=</span> <span class="str">&quot;standard&quot;</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Default=standard. Projector to use with parameters.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--orientgen&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Default=auto. Orientation generator for projections, eg - eman:delta=5.0:inc_mirror=0:perturb=1&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t172" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2simmx.py</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;simmxheader&quot;, help=&#39;Options below this label are specific to e2simmx&#39;, title=&quot;### e2simmx options ###&quot;, row=15, col=0, rowspan=1, colspan=3)</span><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simalign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name of an &#39;aligner&#39; to use prior to comparing the images&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;rotate_translate_flip&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simaligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Name of the aligner along with its construction arguments&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simralign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name and parameters of the second stage aligner which refines the results of the first alignment&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simraligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name and parameters of the comparitor used by the second stage aligner.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simcmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name of a &#39;cmp&#39; to be used in comparing the aligned images&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t179" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simmask&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. A file containing a single 0/1 image to apply as a mask before comparison but after alignment&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--shrink&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;shrink&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Optionally shrink the input particles by an integer amount prior to computing similarity scores. For speed purposes. 0 -&gt; no shrinking&quot;</span><span class="op">,</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--shrinks1&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;shrinks1&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The level of shrinking to apply in the first stage of the two-stage classification process. Default=0 (autoselect)&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--prefilt&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Filter each reference (c) to match the power spectrum of each particle (r) before alignment and comparison. Applies both to classification and class-averaging.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--cmpdiff&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Used only in binary tree classification. Use a mask that focus on the difference of two children.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--treeincomplete&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Used only in binary tree classification. Incompleteness of the tree on each level.Default=0&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t186" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t187" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2classify.py</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t189" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2classaverage.py</span><span class="strut">&nbsp;</span></p>
<p id="t190" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;caheader&quot;, help=&#39;Options below this label are specific to e2classaverage&#39;, title=&quot;### e2classaverage options ###&quot;, row=22, col=0, rowspan=1, colspan=3, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classkeepsig&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Change the keep (\&#39;--keep\&#39;) criterion from fraction-based to sigma-based.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classiter&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The number of iterations to perform.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t193" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classalign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;rotate_translate_flip&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. If doing more than one iteration, this is the name and parameters of the &#39;aligner&#39; used to align particles to the previous class average.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classaligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. This is the name and parameters of the comparitor used by the fist stage aligner.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classralign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The second stage aligner which refines the results of the first alignment in class averaging.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classraligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The comparitor used by the second stage aligner in class averageing.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classaverager&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The averager used to generate the class averages. Default is \&#39;mean\&#39;.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classcmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name and parameters of the comparitor used to generate similarity scores, when class averaging.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classnormproc&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;normalize.edgemean&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Normalization applied during class averaging&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classrefsf&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=True. Use the setsfref option in class averaging to produce better filtered averages.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t201" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t202" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t203" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#options associated with e2make3d.py</span><span class="strut">&nbsp;</span></p>
<p id="t204" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;make3dheader&quot;, help=&#39;Options below this label are specific to e2make3d&#39;, title=&quot;### e2make3d options ###&quot;, row=32, col=0, rowspan=1, colspan=3)</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--pad&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;pad&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. To reduce Fourier artifacts, the model is typically padded by ~25 percent - only applies to Fourier reconstruction&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--recon&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;recon&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;fourier&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Reconstructor to use see e2help.py reconstructors -v&quot;</span><span class="op">,</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dkeepsig&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The standard deviation alternative to the --m3dkeep argument&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dsetsf&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">dest</span><span class="op">=</span><span class="str">&quot;m3dsetsf&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Name of a file containing a structure factor to apply after refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t209" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dpreprocess&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;normalize.edgemean&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Normalization processor applied before 3D reconstruction&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t211" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#lowmem!</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--lowmem&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Make limited use of memory when possible - useful on lower end machines&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t213" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--ppid&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Set the PID of the parent process, used for cross platform PPID&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t215" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="nam">args</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">parse_args</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t217" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">!=</span><span class="nam">None</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">!=</span><span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t218" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR : You may specify --model with --nmodels OR --models, not both&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">==</span><span class="nam">None</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="op">-</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">!=</span><span class="str">&quot;.lst&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR : You must specify --input, which must be a .lst file\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t223" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t224" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t225" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&gt;</span><span class="num">7</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&lt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: --speed must be between 1 and 7. Lower numbers will make refinements take longer, but produce slightly better measured resolutions. The default value of 5 is a good balance for typical refinements. When\</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="pln"><span class="str">satisfied with the results with speed=5 you may consider reducing this number, though pushing for higher resolution would normally be done in the subsequent single-model refinements.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t228" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t229" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t230" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">==</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fls</span><span class="op">=</span><span class="op">[</span><span class="nam">int</span><span class="op">(</span><span class="nam">i</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="str">&quot;.&quot;</span><span class="op">)</span> <span class="key">if</span> <span class="nam">i</span><span class="op">[</span><span class="op">:</span><span class="num">6</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;multi_&quot;</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">i</span><span class="op">)</span><span class="op">==</span><span class="num">8</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t232" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">fls</span><span class="op">)</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span> <span class="nam">fls</span><span class="op">=</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">=</span> <span class="str">&quot;multi_{:02d}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">max</span><span class="op">(</span><span class="nam">fls</span><span class="op">)</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t235" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">&lt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;WARNING: threads set to an invalid value. Changing to 1, but you should really provide a reasonable number.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t239" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">randclassify</span><span class="op">+</span><span class="nam">options</span><span class="op">.</span><span class="nam">randphase</span><span class="op">+</span><span class="nam">options</span><span class="op">.</span><span class="nam">mapfragment</span><span class="op">&gt;</span><span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t240" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: Must select only one initial model generation method. Either --mapfragment, --randclassify or --randphase.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t243" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">global</span> <span class="nam">output_path</span><span class="strut">&nbsp;</span></p>
<p id="t244" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">output_path</span><span class="op">=</span><span class="str">&quot;{}/report&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t245" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">os</span><span class="op">.</span><span class="nam">makedirs</span><span class="op">(</span><span class="nam">output_path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t246" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t248" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This initial mass processing must be here, since used below</span><span class="strut">&nbsp;</span></p>
<p id="t249" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;,&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t250" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">=</span><span class="op">[</span><span class="nam">float</span><span class="op">(</span><span class="nam">i</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t251" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t252" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t253" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># make randomized starting models</span><span class="strut">&nbsp;</span></p>
<p id="t254" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">!=</span><span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t255" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t256" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">mapfragment</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t257" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;normalize.bymass&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;thr&quot;</span><span class="op">:</span><span class="num">1</span><span class="op">,</span><span class="str">&quot;mass&quot;</span><span class="op">:</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t258" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">seg</span><span class="op">=</span><span class="nam">model</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;segment.kmeans&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;ampweight&quot;</span><span class="op">:</span><span class="num">1</span><span class="op">,</span><span class="str">&quot;nseg&quot;</span><span class="op">:</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">+</span><span class="num">2</span><span class="op">,</span><span class="str">&quot;thr&quot;</span><span class="op">:</span><span class="num">0.7</span><span class="op">}</span><span class="op">)</span>&nbsp; <span class="com"># +2 is arbitrary, to decrease the amount of excluded mass</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t260" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">seg2</span><span class="op">=</span><span class="nam">seg</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;threshold.binaryrange&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;low&quot;</span><span class="op">:</span><span class="nam">i</span><span class="op">-</span><span class="num">1.1</span><span class="op">,</span><span class="str">&quot;high&quot;</span><span class="op">:</span><span class="nam">i</span><span class="op">-</span><span class="num">0.9</span><span class="op">}</span><span class="op">)</span>&nbsp; &nbsp; <span class="com"># by subtracting 1, we don&#39;t remove anything from the first map</span><span class="strut">&nbsp;</span></p>
<p id="t261" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">seg2</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;math.linear&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;scale&quot;</span><span class="op">:</span><span class="op">-</span><span class="num">1.0</span><span class="op">,</span><span class="str">&quot;shift&quot;</span><span class="op">:</span><span class="num">1.0</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model2</span><span class="op">=</span><span class="nam">model</span><span class="op">*</span><span class="nam">seg2</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model2</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{}/threed_00_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t264" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">seg</span><span class="op">=</span><span class="nam">None</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># free up memory</span><span class="strut">&nbsp;</span></p>
<p id="t265" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">seg2</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t266" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model2</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t267" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t268" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">randphase</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t269" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t270" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;filter.lowpass.randomphase&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;cutoff_freq&quot;</span><span class="op">:</span><span class="num">.02</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t271" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{}/threed_00_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t272" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t273" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">randclassify</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t274" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{}/threed_00_01.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t275" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t276" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: Must specify a initial model genenration method.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t278" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t279" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t280" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># or copy the specified starting models</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;,&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">=</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">&gt;</span><span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t284" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span><span class="op">,</span><span class="nam">m</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">m</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t286" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{}/threed_00_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t287" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t288" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">=</span><span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t291" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">models</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t292" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">model</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{}/threed_00_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t293" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t294" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t295" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># can&#39;t finish the mass processing before we know nmodels</span><span class="strut">&nbsp;</span></p>
<p id="t296" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">)</span><span class="op">==</span><span class="num">1</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">*</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="strut">&nbsp;</span></p>
<p id="t297" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">)</span><span class="op">!=</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t298" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: Must specify either a single --mass value or a list of &lt;nmodels&gt; comma separated masses.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t299" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t300" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t301" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">=</span> <span class="num">0.0</span><span class="strut">&nbsp;</span></p>
<p id="t302" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">total_procs</span> <span class="op">=</span> <span class="num">5</span><span class="op">*</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="strut">&nbsp;</span></p>
<p id="t303" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t304" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">automask3d</span><span class="op">:</span> <span class="nam">automask_parms</span> <span class="op">=</span> <span class="nam">parsemodopt</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">automask3d</span><span class="op">)</span> <span class="com"># this is just so we only ever have to do it</span><span class="strut">&nbsp;</span></p>
<p id="t305" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; apix = get_apix_used(options)</span><span class="strut">&nbsp;</span></p>
<p id="t306" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t307" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t308" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&lt;</span><span class="nam">apix</span><span class="op">*</span><span class="num">2</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t309" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: Target resolution is smaller than 2*A/pix value. This is impossible.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t310" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t311" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t312" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">logid</span><span class="op">=</span><span class="nam">E2init</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">ppid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t313" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t314" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">###################################</span><span class="strut">&nbsp;</span></p>
<p id="t315" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### This is where we fill in all of the undefined options, and analyse the data</span><span class="strut">&nbsp;</span></p>
<p id="t316" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">###################################</span><span class="strut">&nbsp;</span></p>
<p id="t317" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;h1&gt;e2refine_easy.py report&lt;/h1&gt;\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t318" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t319" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;h3&gt;Warning - This is an alpha release version of EMAN2.1&lt;/h3&gt; &lt;p&gt;This program is still experimental and planned functionality is not yet complete. \</span><span class="strut">&nbsp;</span></p>
<p id="t320" class="pln"><span class="str">While it will run refinements and do a decent job with parameters, this will improve substantially as we approach the actual 2.1 release, so please do not \</span><span class="strut">&nbsp;</span></p>
<p id="t321" class="pln"><span class="str">judge EMAN2.1 based on this preliminary version. As always, bug reports or reports of unexpected results are welcome.&lt;/p&gt;\</span><span class="strut">&nbsp;</span></p>
<p id="t322" class="pln"><span class="str">&lt;p&gt;This analysis document is quite verbose. If you are just curious to see a list of the exact refinement parameters used, browse to the 0_refine_parms.json file\</span><span class="strut">&nbsp;</span></p>
<p id="t323" class="pln"><span class="str">in the refinement directory. You can use Info with the browser or just read the file directly (.json files are plain text)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t324" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t325" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t326" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Prepare initial models</span><span class="strut">&nbsp;</span></p>
<p id="t327" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># make sure the box sizes match</span><span class="strut">&nbsp;</span></p>
<p id="t328" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">hdr</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t329" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xsize</span><span class="op">=</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t330" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#apix=hdr[&quot;apix_x&quot;]</span><span class="strut">&nbsp;</span></p>
<p id="t331" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t332" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xsize3d</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{}/threed_00_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t333" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span> <span class="nam">xsize3d</span> <span class="op">!=</span> <span class="nam">xsize</span> <span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t334" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;The dimensions of the particles ( {ptcl}x{ptcl} ) do not match the dimensions of initial model {n} ( {vol}x{vol}x{vol} ). I will assume A/pix is correct in the model and rescale/resize accordingly.&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ptcl</span><span class="op">=</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">vol</span><span class="op">=</span><span class="nam">xsize3d</span><span class="op">,</span><span class="nam">n</span><span class="op">=</span><span class="nam">i</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t335" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img3</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{}/threed_00_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t336" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t337" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">scale</span><span class="op">=</span><span class="nam">img3</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="op">/</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t338" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t339" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;A/pix unknown, assuming scale same as relative box size&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t340" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">scale</span><span class="op">=</span><span class="nam">float</span><span class="op">(</span><span class="nam">xsize</span><span class="op">)</span><span class="op">/</span><span class="nam">xsize3d</span><span class="strut">&nbsp;</span></p>
<p id="t341" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">scale</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2proc3d.py {path}/threed_00_{i:02d}.hdf {path}/threed_00_{i:02d}.hdf --clip={cl},{cl},{cl} --scale={sca:1.4f}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">=</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">,</span><span class="nam">cl</span><span class="op">=</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">sca</span><span class="op">=</span><span class="nam">scale</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t342" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2proc3d.py {path}/threed_00_{i:02d}.hdf {path}/threed_00_{i:02d}.hdf --scale={sca:1.4f} --clip={cl},{cl},{cl}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">i</span><span class="op">=</span><span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">,</span><span class="nam">cl</span><span class="op">=</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">sca</span><span class="op">=</span><span class="nam">scale</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t343" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t344" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span> <span class="nam">options</span><span class="op">.</span><span class="nam">randclassify</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">!=</span><span class="nam">None</span> <span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t345" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t346" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t347" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">repim</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># read a representative image to get some basic info</span><span class="strut">&nbsp;</span></p>
<p id="t348" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">repim</span><span class="op">.</span><span class="nam">has_attr</span><span class="op">(</span><span class="str">&quot;ctf&quot;</span><span class="op">)</span> <span class="op">:</span> <span class="nam">hasctf</span><span class="op">=</span><span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t349" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">hasctf</span><span class="op">=</span><span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t350" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span><span class="op">=</span><span class="nam">repim</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t351" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t352" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Fill in optional parameters</span><span class="strut">&nbsp;</span></p>
<p id="t353" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t354" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">hasctf</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t355" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="str">&quot;strucfac.txt&quot;</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t356" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Several different methods can be used for final amplitude correction in cryoEM. For refinemulti, we base the filter on the FSC \</span><span class="strut">&nbsp;</span></p>
<p id="t357" class="pln"><span class="str">between the different output models. Second stage single-model refinement will use a different method.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t358" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t359" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;--setsf strucfac.txt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t360" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t361" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;No data-based structure factor was found in the project. Computing one during CTF correction is highly recommended. Falling back to two-stage filtration: \</span><span class="strut">&nbsp;</span></p>
<p id="t362" class="pln"><span class="str">&#39;filter.lowpass.autob&#39; which flattens the overall falloff of the structure factor in the 4-15 A range, \</span><span class="strut">&nbsp;</span></p>
<p id="t363" class="pln"><span class="str">and filter.wiener.byfsc which performs a low-pass Wiener filter based on the computed FSC curve between even/odd maps. \</span><span class="strut">&nbsp;</span></p>
<p id="t364" class="pln"><span class="str">While this filtration can work reasonably well, you may find that it over-exagerates low-resolution terms over multiple iterations. \</span><span class="strut">&nbsp;</span></p>
<p id="t365" class="pln"><span class="str">To avoid this, compute a structure factor.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t366" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;--postprocess filter.lowpass.autob&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t367" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t368" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t369" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;No CTF information found in the input data. Note that EMAN2 cannot perform optimal reconstructions using phase-flipped particles from other \</span><span class="strut">&nbsp;</span></p>
<p id="t370" class="pln"><span class="str">software. Part of EMAN2&#39;s CTF correction process is measuring the SSNR of the particle data, an estimate of the low resolution structure factor and other parameters \</span><span class="strut">&nbsp;</span></p>
<p id="t371" class="pln"><span class="str">which are used to provide more accurate orientations, filters, etc. during processing. Since CTF information isn&#39;t present, we are limited to a basic refinement. \</span><span class="strut">&nbsp;</span></p>
<p id="t372" class="pln"><span class="str">output maps will be low-pass filtered based on resolution, but note that there will be no B-factor correction, so this will result in over-filtration of the final \</span><span class="strut">&nbsp;</span></p>
<p id="t373" class="pln"><span class="str">maps.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t374" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t375" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t376" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t377" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">&lt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t378" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">=</span><span class="nam">max</span><span class="op">(</span><span class="num">1</span><span class="op">,</span><span class="num">6</span><span class="op">-</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t379" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Based on your selected --speed, I am setting --sep {}. This puts each particle into its N best orientations. If the angular sampling is finer than required \</span><span class="strut">&nbsp;</span></p>
<p id="t380" class="pln"><span class="str">to achieve the specified resolution, then a certain amount of rotational &#39;smearing&#39; of each particle will help improve SNR in the resulting map without actually the &#39;smearing&#39; degrading \</span><span class="strut">&nbsp;</span></p>
<p id="t381" class="pln"><span class="str">the actual map quality. This can achieve maximum liklihood-like effects without the substantial compuations this can entail. If you are concerned by this, or have many more particles than \</span><span class="strut">&nbsp;</span></p>
<p id="t382" class="pln"><span class="str">are really required to achieve the targeted resolution, you may consider manually specifiying --sep 1, which will override this automatic behavior.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t383" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t384" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t385" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t386" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># target resolution worse than 1/2 Nyquist</span><span class="strut">&nbsp;</span></p>
<p id="t387" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="nam">apix</span><span class="op">*</span><span class="num">4</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t388" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">effbox</span><span class="op">=</span><span class="nam">nx</span><span class="op">*</span><span class="nam">apix</span><span class="op">*</span><span class="num">2</span><span class="op">/</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="strut">&nbsp;</span></p>
<p id="t389" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; astep=89.999/ceil(90.0/sqrt(4300/effbox))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # This rounds to the best angular step divisible by 90 degrees, original computation without speed</span><span class="strut">&nbsp;</span></p>
<p id="t390" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">89.99</span><span class="op">/</span><span class="nam">ceil</span><span class="op">(</span><span class="num">90.0</span><span class="op">*</span><span class="num">9.0</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">+</span><span class="num">3.0</span><span class="op">)</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">4300</span><span class="op">/</span><span class="nam">effbox</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This rounds to the best angular step divisible by 90 degrees</span><span class="strut">&nbsp;</span></p>
<p id="t391" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="str">&quot;eman:delta={:1.5f}:inc_mirror=0:perturb=0&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t392" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t393" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">12.0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t394" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">=</span><span class="num">3</span><span class="strut">&nbsp;</span></p>
<p id="t395" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is below 1/2 Nyquist, and you requested a resolution of &lt;12 A, so we will initially set --classiter to 3. This will help \</span><span class="strut">&nbsp;</span></p>
<p id="t396" class="pln"><span class="str">low resolution refinements converge more rapidly. If you run more than 2 iterations and the map seems to have converged fairly well, this will be decreased.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t397" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">8.0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t398" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">=</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t399" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is below 1/2 Nyquist, and you requested a resolution of &lt;8 A, so we will initially set --classiter to 2. This balances \</span><span class="strut">&nbsp;</span></p>
<p id="t400" class="pln"><span class="str">rapid convergence with the subnanometer resolution goal. If you run more than 2 iterations and the map seems to have converged fairly well, this will be decreased.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t401" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t402" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t403" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is below 1/2 Nyquist, and you requested a high resolution, so we will initially set --classiter to 1. This balances \</span><span class="strut">&nbsp;</span></p>
<p id="t404" class="pln"><span class="str">rapid convergence with the resolution goal. If you run more than 2 iterations and the map seems to have converged fairly well, this will be decreased.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t405" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t406" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Automatically selecting a good angular spacing for the refinement adjusted for your selected --speed. The resolution you are requesting ({}) is quite conservative given the \</span><span class="strut">&nbsp;</span></p>
<p id="t407" class="pln"><span class="str">sampling ({}) of your data. If this is simply an initial refinement designed to get the overall shape of the structure correct, this is fine. If this is your final resolution \</span><span class="strut">&nbsp;</span></p>
<p id="t408" class="pln"><span class="str">target, you may wish to consider downsampling the data and importing into a new project, as too much oversampling is both &lt;i&gt;extremely&lt;/i&gt; inefficient, and in some cases will \</span><span class="strut">&nbsp;</span></p>
<p id="t409" class="pln"><span class="str">even lead to worse structures. Based on your requested resolution and box-size, I will use an angular sampling of {} deg. For details, please see \</span><span class="strut">&nbsp;</span></p>
<p id="t410" class="pln"><span class="str">&lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">,</span><span class="nam">apix</span><span class="op">,</span><span class="nam">astep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t411" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t412" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># target resolution between 1/2 and 3/4 Nyquist</span><span class="strut">&nbsp;</span></p>
<p id="t413" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="nam">apix</span><span class="op">*</span><span class="num">3</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t414" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">89.99</span><span class="op">/</span><span class="nam">ceil</span><span class="op">(</span><span class="num">90.0</span><span class="op">*</span><span class="num">9.0</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">+</span><span class="num">3.0</span><span class="op">)</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">4300</span><span class="op">/</span><span class="nam">nx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This rounds to the best angular step divisible by 90 degrees</span><span class="strut">&nbsp;</span></p>
<p id="t415" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="str">&quot;eman:delta={:1.5f}:inc_mirror=0:perturb=0&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t416" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Based on your requested resolution and box-size, modified by --speed,&nbsp; I will use an angular sampling of {} deg. For details, please see \</span><span class="strut">&nbsp;</span></p>
<p id="t417" class="pln"><span class="str">&lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t418" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t419" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t420" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is between 1/2 and 3/4 Nyquist, so we will set --classiter to 1. Leaving this above 0 \</span><span class="strut">&nbsp;</span></p>
<p id="t421" class="pln"><span class="str">will help avoid noise bias in early rounds, but it may be reduced at zero if convergence seems to have been achieved.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t422" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t423" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># target resolution is beyond 3/4 Nyquist</span><span class="strut">&nbsp;</span></p>
<p id="t424" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t425" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t426" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t427" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is beyond 3/4 Nyquist. Regardless, we will set --classiter to 1 initially. Leaving this above 0 \</span><span class="strut">&nbsp;</span></p>
<p id="t428" class="pln"><span class="str">will help avoid noise bias, but it may be reduced at zero if convergence seems to have been achieved.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t429" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">89.99</span><span class="op">/</span><span class="nam">ceil</span><span class="op">(</span><span class="num">90.0</span><span class="op">*</span><span class="num">9.0</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">+</span><span class="num">3.0</span><span class="op">)</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">4300</span><span class="op">/</span><span class="nam">nx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This rounds to the best angular step divisible by 90 degrees</span><span class="strut">&nbsp;</span></p>
<p id="t430" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="str">&quot;eman:delta={:1.5f}:inc_mirror=0:perturb=0&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t431" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;The resolution you are requesting is beyond 2/3 Nyquist. This is normally not recommended, as it represents insufficient sampling to give a good representation of your \</span><span class="strut">&nbsp;</span></p>
<p id="t432" class="pln"><span class="str">reconstructed map, and resolution can be difficult to accurately assess. The reconstruction will proceed, but generally speaking your A/pix should be less than 1/3 the targeted resolution. \</span><span class="strut">&nbsp;</span></p>
<p id="t433" class="pln"><span class="str">Based on your requested resolution and box-size, modified by --speed, I will use an angular sampling of {} deg. For details, please see \</span><span class="strut">&nbsp;</span></p>
<p id="t434" class="pln"><span class="str">&lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t435" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t436" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Using your specified orientation generator with angular step. You may consider reading this page: &lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t437" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t438" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t439" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">breaksym</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">+</span><span class="str">&quot;:breaksym=1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t440" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t441" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t442" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t443" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;=</span><span class="num">7.0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t444" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t445" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t446" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t447" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t448" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">=</span><span class="str">&quot;frc:zeromask=1:snrweight=1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t449" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;--ralign {} --raligncmp {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t450" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t451" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t452" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">18.0</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">hasctf</span><span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">=</span><span class="str">&quot;frc:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t453" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">7.0</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># no zeromask to avoid top/side errors at lower resolutions</span><span class="strut">&nbsp;</span></p>
<p id="t454" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">max</span><span class="op">(</span><span class="num">7.0</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t455" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t456" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrink</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span> <span class="nam">shrink</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t457" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">shrink</span><span class="op">=</span><span class="str">&quot;--shrink {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">shrink</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t458" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrinks1</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t459" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">nx</span><span class="op">&gt;=</span><span class="num">256</span> <span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;--shrinks1 4&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t460" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">nx</span><span class="op">&gt;=</span><span class="num">96</span><span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;--shrinks1 2&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t461" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t462" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;--shrinks1 {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">shrinks1</span><span class="op">)</span> <span class="com">#must pass shrinks1 to e2simmx2stage</span><span class="strut">&nbsp;</span></p>
<p id="t463" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t464" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t465" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t466" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t467" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">15</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">hasctf</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t468" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t469" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t470" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t471" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t472" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1:zeromask=1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t473" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;--ralign {ralign} --raligncmp {raligncmp}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ralign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">,</span><span class="nam">raligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t474" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t475" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t476" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">hasctf</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&lt;</span><span class="num">15</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">=</span><span class="str">&quot;ctfw.auto&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t477" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">=</span><span class="str">&quot;mean&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t478" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t479" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t480" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">hasctf</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t481" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t482" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t483" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">&lt;</span><span class="nam">nx</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t484" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">=</span><span class="nam">good_size</span><span class="op">(</span><span class="nam">nx</span><span class="op">*</span><span class="num">1.25</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t485" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t486" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># deal with symmetry and alignment</span><span class="strut">&nbsp;</span></p>
<p id="t487" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sym</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sym</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;,&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t488" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">sym</span><span class="op">)</span><span class="op">==</span><span class="num">1</span> <span class="key">or</span> <span class="nam">len</span><span class="op">(</span><span class="nam">set</span><span class="op">(</span><span class="nam">sym</span><span class="op">)</span><span class="op">)</span><span class="op">==</span><span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t489" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">sym</span><span class="op">)</span><span class="op">==</span><span class="num">1</span> <span class="op">:</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">sym</span><span class="op">*</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="strut">&nbsp;</span></p>
<p id="t490" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">sym</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span> <span class="key">in</span> <span class="op">(</span><span class="str">&quot;icos&quot;</span><span class="op">,</span><span class="str">&quot;tet&quot;</span><span class="op">,</span><span class="str">&quot;oct&quot;</span><span class="op">)</span> <span class="key">or</span> <span class="nam">sym</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="str">&quot;d&quot;</span> <span class="op">:</span> <span class="nam">align</span><span class="op">=</span><span class="str">&quot;&quot;</span>&nbsp; <span class="com"># no alignment with higher symmetries</span><span class="strut">&nbsp;</span></p>
<p id="t491" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">sym</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="str">&quot;c&quot;</span> <span class="key">and</span> <span class="nam">sym</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">!=</span><span class="str">&quot;1&quot;</span> <span class="op">:</span> <span class="nam">align</span><span class="op">=</span><span class="nam">align</span><span class="op">=</span><span class="str">&quot; --ralignz={path}/tmp0.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># z alignment only</span><span class="strut">&nbsp;</span></p>
<p id="t492" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">align</span><span class="op">=</span><span class="str">&quot;--alignref={path}/tmp0.hdf --align=refine_3d&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span>&nbsp; &nbsp; <span class="com"># full 3-D alignment for C1</span><span class="strut">&nbsp;</span></p>
<p id="t493" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">align</span><span class="op">=</span><span class="nam">align</span><span class="op">=</span><span class="str">&quot; --ralignz={path}/tmp0.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t494" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t495" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">##################################</span><span class="strut">&nbsp;</span></p>
<p id="t496" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### prepare for the run</span><span class="strut">&nbsp;</span></p>
<p id="t497" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">##################################</span><span class="strut">&nbsp;</span></p>
<p id="t498" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Convert some of the command-line options to more conventient strings for command generation</span><span class="strut">&nbsp;</span></p>
<p id="t499" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="nam">verbose</span><span class="op">=</span><span class="str">&quot;--verbose {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t500" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">verbose</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t501" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t502" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">parallel</span><span class="op">=</span><span class="str">&quot;--parallel {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t503" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">parallel</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t504" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t505" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">prefilt</span> <span class="op">:</span> <span class="nam">prefilt</span><span class="op">=</span><span class="str">&quot;--prefilt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t506" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">prefilt</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t507" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t508" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simmask</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t509" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">makesimmask</span><span class="op">=</span><span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t510" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simmask</span><span class="op">=</span><span class="str">&quot;--mask {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">simmask</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t511" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;{simmask} was specified, so I will not automatically create a mask for each iteration.&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t512" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t513" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">makesimmask</span><span class="op">=</span><span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t514" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simmask</span><span class="op">=</span><span class="str">&quot;--mask {path}/simmask.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t515" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;As particles get translated during alignment, the total amount of noise present in the aligned particle can change\</span><span class="strut">&nbsp;</span></p>
<p id="t516" class="pln"><span class="str"> significantly. While this isn&#39;t a very large effect for similarity metrics like fsc, it can cause a bias in the reconstruction. Similarly\</span><span class="strut">&nbsp;</span></p>
<p id="t517" class="pln"><span class="str"> if we use a different mask derived for each projection to combat this problem (as with the zeromask=1 option in some comparators, then each\</span><span class="strut">&nbsp;</span></p>
<p id="t518" class="pln"><span class="str"> projection masks out a different fraction of the image causing some orientations to be preferred. To combat both effects, I will compute a\</span><span class="strut">&nbsp;</span></p>
<p id="t519" class="pln"><span class="str"> single aggregate mask from all of the projections in each iteration, and use it as {simmask}. The mask is autogenerated and overwritten\</span><span class="strut">&nbsp;</span></p>
<p id="t520" class="pln"><span class="str"> after each iteration. The only way to completely disable this behavior\</span><span class="strut">&nbsp;</span></p>
<p id="t521" class="pln"><span class="str"> is to specify --simmask yourself with a file containing all 1.0 pixels.&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t522" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t523" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classrefsf</span> <span class="op">:</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="str">&quot;--setsfref&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t524" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t525" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t526" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classautomask</span> <span class="op">:</span> <span class="nam">classautomask</span><span class="op">=</span><span class="str">&quot;--automask&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t527" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classautomask</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t528" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t529" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classkeepsig</span> <span class="op">:</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="str">&quot;--keepsig&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t530" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t531" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t532" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;--ralign {} --raligncmp {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t533" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t534" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t535" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeepsig</span> <span class="op">:</span> <span class="nam">m3dkeepsig</span><span class="op">=</span><span class="str">&quot;--keepsig&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t536" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">m3dkeepsig</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t537" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t538" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">automask3d</span> <span class="op">:</span> <span class="nam">amask3d</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">automask3d</span><span class="strut">&nbsp;</span></p>
<p id="t539" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">amask3d</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t540" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t541" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">prethreshold</span> <span class="op">:</span> <span class="nam">prethreshold</span><span class="op">=</span><span class="str">&quot;--prethreshold&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t542" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">prethreshold</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t543" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t544" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">cmpdiff</span> <span class="op">:</span> <span class="nam">cmpdiff</span><span class="op">=</span><span class="str">&quot;--cmpdiff&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t545" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">cmpdiff</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t546" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># store the input arguments forever in the refinement directory</span><span class="strut">&nbsp;</span></p>
<p id="t547" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span> <span class="op">=</span> <span class="nam">js_open_dict</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">+</span><span class="str">&quot;/0_refine_parms.json&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t548" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">vars</span><span class="op">(</span><span class="nam">options</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t549" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t550" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;NOTE: you can check the progress of the refinement at any time by opening this URL in your web-browser:&nbsp; file://{}/index.html&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">abspath</span><span class="op">(</span><span class="nam">output_path</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t551" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t552" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Actual refinement loop ###</span><span class="strut">&nbsp;</span></p>
<p id="t553" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">it</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">1</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">+</span><span class="num">1</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t554" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;h4&gt;Beginning iteration {} at {}&lt;/h4&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">,</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t555" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t556" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### 3-D Projections</span><span class="strut">&nbsp;</span></p>
<p id="t557" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">models</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;{path}/threed_{itrm1:02d}_{mdl:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="nam">mdl</span><span class="op">+</span><span class="num">1</span><span class="op">)</span> <span class="key">for</span> <span class="nam">mdl</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t558" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t559" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">randclassify</span> <span class="key">and</span> <span class="nam">it</span><span class="op">==</span><span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t560" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2project3d.py {mdls} --outfile {path}/projections_{itr:02d}.hdf -f --projector {projector} --orientgen {orient} --sym {sym} --postprocess normalize.circlemean {prethr} --parallel thread:{threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t561" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">mdls</span><span class="op">=</span><span class="nam">models</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="nam">i</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">projector</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">projector</span><span class="op">,</span><span class="nam">orient</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">,</span><span class="nam">sym</span><span class="op">=</span><span class="nam">sym</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">prethr</span><span class="op">=</span><span class="nam">prethreshold</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t562" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t563" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2project3d.py {mdls} --outfile {path}/projections_{itr:02d}.hdf -f --projector {projector} --orientgen {orient} --sym {sym} --postprocess normalize.circlemean {prethr} --parallel thread:{threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t564" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">mdls</span><span class="op">=</span><span class="str">&quot; &quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">models</span><span class="op">)</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="nam">i</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">projector</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">projector</span><span class="op">,</span><span class="nam">orient</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">,</span><span class="nam">sym</span><span class="op">=</span><span class="str">&quot;,&quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">sym</span><span class="op">)</span><span class="op">,</span><span class="nam">prethr</span><span class="op">=</span><span class="nam">prethreshold</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t565" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t566" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t567" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t568" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t569" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### We may need to make our own similarity mask file for more accurate particle classification</span><span class="strut">&nbsp;</span></p>
<p id="t570" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">makesimmask</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t571" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">av</span><span class="op">=</span><span class="nam">Averagers</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">&quot;minmax&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;max&quot;</span><span class="op">:</span><span class="num">1</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t572" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nprj</span><span class="op">=</span><span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="str">&quot;{path}/projections_{itr:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t573" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Mask from {} projections&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">nprj</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t574" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">nprj</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t575" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">a</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/projections_{itr:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t576" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">av</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span><span class="nam">a</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t577" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">msk</span><span class="op">=</span><span class="nam">av</span><span class="op">.</span><span class="nam">finish</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t578" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; msk.process_inplace(&quot;threshold.binary&quot;,{&quot;value&quot;:msk[&quot;sigma&quot;]/50.0})</span><span class="strut">&nbsp;</span></p>
<p id="t579" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">msk</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;threshold.notzero&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t580" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">msk</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{path}/simmask.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t581" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t582" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">treeclassify</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t583" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Classify using a binary tree</span><span class="strut">&nbsp;</span></p>
<p id="t584" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Classify each particle using a binary tree generated from the projections&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t585" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classifytree.py {path}/projections_{itr:02d}.hdf {inputfile} --output={path}/classmx_{itr:02d}.hdf&nbsp; --nodes {path}/nodes_{itr:02d}.hdf --cmp {simcmp} --align {simalign} --aligncmp {simaligncmp} {simralign} {cmpdiff} --incomplete {incomplete} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">cmpdiff</span><span class="op">=</span><span class="nam">cmpdiff</span><span class="op">,</span><span class="nam">incomplete</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">treeincomplete</span><span class="op">,</span><span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t586" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t587" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">2.0</span><span class="strut">&nbsp;</span></p>
<p id="t588" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t589" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t590" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Simmx</span><span class="strut">&nbsp;</span></p>
<p id="t591" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#FIXME - Need to combine simmx with classification !!!</span><span class="strut">&nbsp;</span></p>
<p id="t592" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t593" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2simmx2stage.py {path}/projections_{itr:02d}.hdf {inputfile} {path}/simmx_{itr:02d}.hdf {path}/proj_simmx_{itr:02d}.hdf {path}/proj_stg1_{itr:02d}.hdf {path}/simmx_stg1_{itr:02d}.hdf --saveali --cmp {simcmp} \</span><span class="strut">&nbsp;</span></p>
<p id="t594" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --align {simalign} --aligncmp {simaligncmp} {simralign} {shrinks1} {shrink} {prefilt} {simmask} {verbose} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t595" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t596" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrinks1</span><span class="op">=</span><span class="nam">shrinks1</span><span class="op">,</span><span class="nam">shrink</span><span class="op">=</span><span class="nam">shrink</span><span class="op">,</span><span class="nam">prefilt</span><span class="op">=</span><span class="nam">prefilt</span><span class="op">,</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span><span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t597" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t598" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t599" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t600" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t601" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Classify</span><span class="strut">&nbsp;</span></p>
<p id="t602" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classify.py {path}/simmx_{itr:02d}.hdf {path}/classmx_{itr:02d}.hdf -f --sep {sep} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t603" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">sep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t604" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t605" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t606" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t607" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t608" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t609" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#random assignment</span><span class="strut">&nbsp;</span></p>
<p id="t610" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">randclassify</span> <span class="key">and</span> <span class="nam">it</span><span class="op">==</span><span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t611" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">clsmx</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/classmx_{itr:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t612" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t613" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nproj</span><span class="op">=</span><span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="str">&quot;{}/projections_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t614" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nptl</span><span class="op">=</span><span class="nam">clsmx</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t615" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">iu</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">nptl</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t616" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">## randomly assign the particles in classes</span><span class="strut">&nbsp;</span></p>
<p id="t617" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">rndtmp</span><span class="op">=</span><span class="nam">Util</span><span class="op">.</span><span class="nam">get_irand</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t618" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nowcls</span><span class="op">=</span><span class="nam">clsmx</span><span class="op">.</span><span class="nam">get_value_at</span><span class="op">(</span><span class="nam">iu</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t619" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print iu,nowcls+nproj</span><span class="strut">&nbsp;</span></p>
<p id="t620" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">clsmx</span><span class="op">.</span><span class="nam">set_value_at</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">iu</span><span class="op">,</span><span class="nam">nowcls</span><span class="op">+</span><span class="nam">nproj</span><span class="op">*</span><span class="nam">rndtmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t621" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">clsmx</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{path}/classmx_{itr:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t622" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t623" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">im</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">1</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t624" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">iu</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">nproj</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t625" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pj</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{}/projections_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="nam">iu</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t626" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pj</span><span class="op">[</span><span class="str">&quot;model_id&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">im</span><span class="op">+</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t627" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pj</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{}/projections_{:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="nam">iu</span><span class="op">+</span><span class="nam">nproj</span><span class="op">*</span><span class="nam">im</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t628" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t629" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t630" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Class-averaging</span><span class="strut">&nbsp;</span></p>
<p id="t631" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2classaverage.py --input {inputfile} --classmx {path}/classmx_{itr:02d}.hdf --decayedge --storebad --output {path}/classes_{itr:02d}.hdf --ref {path}/projections_{itr:02d}.hdf --iter {classiter} \</span><span class="strut">&nbsp;</span></p>
<p id="t632" class="pln"><span class="str">-f --resultmx {path}/cls_result_{itr:02d}.hdf --normproc {normproc} --averager {averager} {classrefsf} {classautomask} --keep {classkeep} {classkeepsig} --cmp {classcmp} \</span><span class="strut">&nbsp;</span></p>
<p id="t633" class="pln"><span class="str">--align {classalign} --aligncmp {classaligncmp} {classralign} {prefilt} {verbose} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t634" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span> <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">classiter</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">,</span> <span class="nam">normproc</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classnormproc</span><span class="op">,</span> <span class="nam">averager</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">,</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="nam">classrefsf</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t635" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classautomask</span><span class="op">=</span><span class="nam">classautomask</span><span class="op">,</span><span class="nam">classkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classkeep</span><span class="op">,</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="nam">classkeepsig</span><span class="op">,</span> <span class="nam">classcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">,</span> <span class="nam">classalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classalign</span><span class="op">,</span> <span class="nam">classaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t636" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classralign</span><span class="op">=</span><span class="nam">classralign</span><span class="op">,</span> <span class="nam">prefilt</span><span class="op">=</span><span class="nam">prefilt</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span> <span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t637" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t638" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t639" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t640" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t641" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t642" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">## 3-D Reconstruction</span><span class="strut">&nbsp;</span></p>
<p id="t643" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#FIXME - --lowmem removed due to some tricky bug in e2make3d</span><span class="strut">&nbsp;</span></p>
<p id="t644" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t645" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">mdl</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t646" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">breaksym</span> <span class="op">:</span> <span class="nam">m3dsym</span><span class="op">=</span><span class="str">&quot;c1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t647" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">m3dsym</span><span class="op">=</span><span class="nam">sym</span><span class="op">[</span><span class="nam">mdl</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t648" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t649" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2make3d.py --input {path}/classes_{itr:02d}.hdf --iter 2 -f --sym {sym} --output {path}/threed_{itr:02d}_{mdl:02d}.hdf --recon {recon} --preprocess {preprocess} \</span><span class="strut">&nbsp;</span></p>
<p id="t650" class="pln"><span class="str">{postprocess} --keep={m3dkeep} {keepsig} --apix={apix} --pad={m3dpad} {setsf} {verbose} --input_model {mdl}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t651" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">m3dsym</span><span class="op">,</span> <span class="nam">recon</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">recon</span><span class="op">,</span> <span class="nam">preprocess</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dpreprocess</span><span class="op">,</span> <span class="nam">postprocess</span><span class="op">=</span><span class="nam">postprocess</span><span class="op">,</span> <span class="nam">m3dkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeep</span><span class="op">,</span> <span class="nam">keepsig</span><span class="op">=</span><span class="nam">m3dkeepsig</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t652" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dpad</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">,</span> <span class="nam">setsf</span><span class="op">=</span><span class="nam">m3dsetsf</span><span class="op">,</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span> <span class="nam">mdl</span><span class="op">=</span><span class="nam">mdl</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t653" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t654" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t655" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t656" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t657" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">######################</span><span class="strut">&nbsp;</span></p>
<p id="t658" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">## postprocessing, a bit different than e2refine_postprocess, and we need a lot of info, so we do it in-place</span><span class="strut">&nbsp;</span></p>
<p id="t659" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t660" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># alignment</span><span class="strut">&nbsp;</span></p>
<p id="t661" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t662" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {path}/threed_{itr:02d}_{mdl:02d}.hdf {path}/tmp0.hdf --process=filter.lowpass.gauss:cutoff_freq=.05&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t663" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">o0</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/threed_{itr:02d}_{mdl:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t664" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">mdl</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">1</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t665" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;Aligning map &quot;</span><span class="op">,</span><span class="nam">mdl</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t666" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">map2</span><span class="op">=</span><span class="str">&quot;{path}/threed_{itr:02d}_{mdl:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="nam">mdl</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t667" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {map2} {path}/tmp1.hdf --process=filter.lowpass.gauss:cutoff_freq=.05 {align}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">map2</span><span class="op">=</span><span class="nam">map2</span><span class="op">,</span><span class="nam">align</span><span class="op">=</span><span class="nam">align</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t668" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {map2} {path}/tmp1f.hdf --process=filter.lowpass.gauss:cutoff_freq=.05 --process=xform.flip:axis=z {align}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">map2</span><span class="op">=</span><span class="nam">map2</span><span class="op">,</span><span class="nam">align</span><span class="op">=</span><span class="nam">align</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t669" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t670" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># now we have to check which of the two handednesses produced the better alignment</span><span class="strut">&nbsp;</span></p>
<p id="t671" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Pick the best handedness</span><span class="strut">&nbsp;</span></p>
<p id="t672" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">a</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/tmp1.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t673" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">b</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/tmp1f.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t674" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">c</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/tmp0.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t675" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ca</span><span class="op">=</span><span class="nam">c</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">a</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t676" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cb</span><span class="op">=</span><span class="nam">c</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">b</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t677" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">o</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">map2</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t678" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">ca</span><span class="op">&lt;</span><span class="nam">cb</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t679" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">ali</span><span class="op">=</span><span class="nam">a</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t680" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="nam">ali</span><span class="op">=</span><span class="nam">Transform</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t681" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;correct hand detected &quot;</span><span class="op">,</span><span class="nam">ali</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t682" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t683" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">ali</span><span class="op">=</span><span class="nam">b</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t684" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="nam">ali</span><span class="op">=</span><span class="nam">Transform</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t685" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">o</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;xform.flip&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;axis&quot;</span><span class="op">:</span><span class="str">&quot;z&quot;</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t686" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;handedness flip required&quot;</span><span class="op">,</span><span class="nam">ali</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t687" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">o</span><span class="op">.</span><span class="nam">transform</span><span class="op">(</span><span class="nam">ali</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t688" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t689" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">os</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="nam">map2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t690" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">o</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">map2</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t691" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t692" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">os</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="str">&quot;{path}/tmp1.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t693" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">os</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="str">&quot;{path}/tmp1f.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t694" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span> <span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t695" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t696" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># now compute FSC</span><span class="strut">&nbsp;</span></p>
<p id="t697" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">f</span><span class="op">=</span><span class="nam">o0</span><span class="op">.</span><span class="nam">calc_fourier_shell_correlation</span><span class="op">(</span><span class="nam">o</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t698" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">mdl</span><span class="op">==</span><span class="num">1</span> <span class="op">:</span> <span class="nam">fm</span><span class="op">=</span><span class="nam">array</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t699" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">fm</span><span class="op">+=</span><span class="nam">array</span><span class="op">(</span><span class="nam">f</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t700" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t701" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># so we now have an average FSC curve between map 1 and each of the others (we should probably do all vs all, but don&#39;t)</span><span class="strut">&nbsp;</span></p>
<p id="t702" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fm</span><span class="op">/=</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">-</span><span class="num">1.0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t703" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">third</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">fm</span><span class="op">)</span><span class="op">/</span><span class="num">3</span><span class="strut">&nbsp;</span></p>
<p id="t704" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xaxis</span> <span class="op">=</span> <span class="nam">fm</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="nam">third</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t705" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fsc</span> <span class="op">=</span> <span class="nam">fm</span><span class="op">[</span><span class="nam">third</span><span class="op">:</span><span class="num">2</span><span class="op">*</span><span class="nam">third</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t706" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">saxis</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span><span class="op">/</span><span class="nam">apix</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">xaxis</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t707" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">Util</span><span class="op">.</span><span class="nam">save_data</span><span class="op">(</span><span class="nam">float</span><span class="op">(</span><span class="nam">saxis</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="nam">float</span><span class="op">(</span><span class="nam">saxis</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">saxis</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="nam">list</span><span class="op">(</span><span class="nam">fsc</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="str">&quot;{path}/fsc_mutual_avg_{it:02d}.txt&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">it</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t708" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t709" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">models</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;threed_{itr:02d}_{mdl:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">mdl</span><span class="op">=</span><span class="nam">mdl</span><span class="op">+</span><span class="num">1</span><span class="op">)</span> <span class="key">for</span> <span class="nam">mdl</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">nmodels</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t710" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t711" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># we filter the maps, to a resolution ~20% higher than the inter-map FSC, so we don&#39;t hide the relative differences</span><span class="strut">&nbsp;</span></p>
<p id="t712" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">ii</span><span class="op">,</span><span class="nam">m</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">models</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t713" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {path}/{mod} {path}/{mod} {m3dsetsf} --process filter.wiener.byfsc:fscfile={path}/fsc_mutual_avg_{it:02d}.txt:sscale=1.2 --process normalize.bymass:thr=1:mass={mass}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t714" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="nam">m3dsetsf</span><span class="op">,</span><span class="nam">mod</span><span class="op">=</span><span class="nam">m</span><span class="op">,</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">it</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">mass</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">[</span><span class="nam">ii</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t715" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t716" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span> <span class="op">:</span> <span class="nam">os</span><span class="op">.</span><span class="nam">unlink</span><span class="op">(</span><span class="str">&quot;{path}/tmp0.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t717" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t718" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t719" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">[</span><span class="str">&quot;last_map&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">models</span><span class="strut">&nbsp;</span></p>
<p id="t720" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t721" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t722" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t723" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># try and generate an intelligent name for the split output sets</span><span class="strut">&nbsp;</span></p>
<p id="t724" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="op">:</span><span class="num">4</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;sets/&quot;</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="op">-</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;.lst&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t725" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">setname</span><span class="op">=</span><span class="str">&quot;{}_mul{}_it{:02d}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="op">:</span><span class="op">-</span><span class="num">4</span><span class="op">]</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="op">,</span><span class="nam">it</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t726" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t727" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">setname</span><span class="op">=</span><span class="str">&quot;sets/{}_mul{}_it{:02d}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;/&quot;</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">.</span><span class="nam">replace</span><span class="op">(</span><span class="str">&quot;.&quot;</span><span class="op">,</span><span class="str">&quot;-&quot;</span><span class="op">)</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="op">,</span><span class="nam">it</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t728" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t729" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Now we split the data into sets for individual model refinements</span><span class="strut">&nbsp;</span></p>
<p id="t730" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2classextract.py {path}/classes_{itr:02d}.hdf --refinemulti --sort --verbose=1 --setname={set}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">set</span><span class="op">=</span><span class="nam">setname</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t731" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t732" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;e2refinemulti.py completed sucessfully, but you are not yet done. The particles going into each output map have been seperated into the sets listed above. \</span><span class="strut">&nbsp;</span></p>
<p id="t733" class="pln"><span class="str">You now need to run a single model e2refine_easy job for each of these output sets to produce the final maps. The maps in {} are not optimal, and no gold standard \</span><span class="strut">&nbsp;</span></p>
<p id="t734" class="pln"><span class="str">resolution has been determined for them.&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t735" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;e2refinemulti.py has now completed running, and experienced no detectable errors, but you aren&#39;t done yet. The multi-model refinement method is inherently somewhat instable, particularly if \</span><span class="strut">&nbsp;</span></p>
<p id="t736" class="pln"><span class="str">the variability in your map you are trying to classify is continuous rather than discrete. What this means is, the final maps in {}, are not entirely optimal, and do not have gold standard resolutions associated \</span><span class="strut">&nbsp;</span></p>
<p id="t737" class="pln"><span class="str">with them. Your next step should be to run a normal e2refine_easy run for the particles from each of the subgroups produced by this run of e2refinemulti. To facilitate that process, new particle sets have \</span><span class="strut">&nbsp;</span></p>
<p id="t738" class="pln"><span class="str">been produced for you, called {}_m*. Just run e2refine_easy.py for each of these sets. &lt;/p&gt;\</span><span class="strut">&nbsp;</span></p>
<p id="t739" class="pln"><span class="str">&lt;p&gt;Normally you would use the final map corresponding to each particle set as a starting model for these refinements, but \</span><span class="strut">&nbsp;</span></p>
<p id="t740" class="pln"><span class="str">you may also consider doing a cross-validation on your individual maps. To do that, you would, for example, use the particles from map 1 as --input and the --model would be map 2, and vice versa. If \</span><span class="strut">&nbsp;</span></p>
<p id="t741" class="pln"><span class="str">you recover a structure more like map 1 (using the particles from map 1), despite the incorrect starting model, that indicates that the particle classification was more than just noise bias, and should \</span><span class="strut">&nbsp;</span></p>
<p id="t742" class="pln"><span class="str">increase your confidence in your result.&gt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t743" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t744" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2end</span><span class="op">(</span><span class="nam">logid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t745" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t746" class="stm mis"><span class="key">def</span> <span class="nam">get_apix_used</span><span class="op">(</span><span class="nam">options</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t747" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t748" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Just an encapsulation apix retrieval</span><span class="strut">&nbsp;</span></p>
<p id="t749" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Basically, if the apix argument is in the options, that&#39;s what you get</span><span class="strut">&nbsp;</span></p>
<p id="t750" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Else the project db is checked for the global.apix parameter</span><span class="strut">&nbsp;</span></p>
<p id="t751" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Else you just get 1</span><span class="strut">&nbsp;</span></p>
<p id="t752" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&#39;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t753" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span> <span class="op">=</span> <span class="num">0.0</span><span class="strut">&nbsp;</span></p>
<p id="t754" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">!=</span><span class="nam">None</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">&gt;</span><span class="num">0</span><span class="op">:</span> <span class="key">return</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t755" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t756" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">prj</span><span class="op">=</span><span class="nam">js_open_dict</span><span class="op">(</span><span class="str">&quot;info/project.json&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t757" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span> <span class="nam">prj</span><span class="op">[</span><span class="str">&quot;global.apix&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t758" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t759" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t760" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t761" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t762" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">img</span><span class="op">[</span><span class="str">&quot;ctf&quot;</span><span class="op">]</span><span class="op">.</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t763" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">img</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t764" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span> <span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t765" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t766" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t767" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t768" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#else:</span><span class="strut">&nbsp;</span></p>
<p id="t769" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#img=EMData(options.input,0,True)</span><span class="strut">&nbsp;</span></p>
<p id="t770" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#try: apix=img[&quot;ctf&quot;].apix</span><span class="strut">&nbsp;</span></p>
<p id="t771" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#except: apix=img[&quot;apix_x&quot;]</span><span class="strut">&nbsp;</span></p>
<p id="t772" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t773" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: Could not find a valid A/pix value anywhere. Please specify.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t774" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t775" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t776" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t777" class="stm mis"><span class="key">def</span> <span class="nam">run</span><span class="op">(</span><span class="nam">command</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t778" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&quot;Mostly here for debugging, allows you to control how commands are executed (os.system is normal)&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t779" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t780" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;{}: {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="nam">command</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t781" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;{}: {}&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="nam">command</span><span class="op">)</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t782" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t783" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ret</span><span class="op">=</span><span class="nam">launch_childprocess</span><span class="op">(</span><span class="nam">command</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t784" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t785" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># We put the exit here since this is what we&#39;d do in every case anyway. Saves replication of error detection code above.</span><span class="strut">&nbsp;</span></p>
<p id="t786" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">ret</span> <span class="op">!=</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t787" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error running: &quot;</span><span class="op">,</span><span class="nam">command</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t788" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t789" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t790" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t791" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t792" class="stm mis"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">&quot;__main__&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t793" class="stm mis">&nbsp; &nbsp; <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
                
            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.org">coverage.py v4.0.3</a>,
            created at 2018-07-02 18:17
        </p>
    </div>
</div>

</body>
</html>
