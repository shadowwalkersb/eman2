


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for e2refine_easy.py: 0%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>e2refine_easy.py</b> :
            <span class="pc_cov">0%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            627 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">0 run</span>
            <span class="mis shortkey_m button_toggle_mis">627 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">0 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
<p class="legend">Hot-keys on this page</p>
    <div>
<p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
<p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
<p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
<p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="stm mis"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="pln"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="pln"><a href="#n20">20</a></p>
<p id="n21" class="pln"><a href="#n21">21</a></p>
<p id="n22" class="pln"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="pln"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="pln"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="pln"><a href="#n31">31</a></p>
<p id="n32" class="pln"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="pln"><a href="#n34">34</a></p>
<p id="n35" class="stm mis"><a href="#n35">35</a></p>
<p id="n36" class="stm mis"><a href="#n36">36</a></p>
<p id="n37" class="stm mis"><a href="#n37">37</a></p>
<p id="n38" class="stm mis"><a href="#n38">38</a></p>
<p id="n39" class="stm mis"><a href="#n39">39</a></p>
<p id="n40" class="stm mis"><a href="#n40">40</a></p>
<p id="n41" class="stm mis"><a href="#n41">41</a></p>
<p id="n42" class="pln"><a href="#n42">42</a></p>
<p id="n43" class="pln"><a href="#n43">43</a></p>
<p id="n44" class="stm mis"><a href="#n44">44</a></p>
<p id="n45" class="stm mis"><a href="#n45">45</a></p>
<p id="n46" class="stm mis"><a href="#n46">46</a></p>
<p id="n47" class="stm mis"><a href="#n47">47</a></p>
<p id="n48" class="stm mis"><a href="#n48">48</a></p>
<p id="n49" class="stm mis"><a href="#n49">49</a></p>
<p id="n50" class="stm mis"><a href="#n50">50</a></p>
<p id="n51" class="stm mis"><a href="#n51">51</a></p>
<p id="n52" class="pln"><a href="#n52">52</a></p>
<p id="n53" class="pln"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="stm mis"><a href="#n55">55</a></p>
<p id="n56" class="stm mis"><a href="#n56">56</a></p>
<p id="n57" class="stm mis"><a href="#n57">57</a></p>
<p id="n58" class="pln"><a href="#n58">58</a></p>
<p id="n59" class="stm mis"><a href="#n59">59</a></p>
<p id="n60" class="pln"><a href="#n60">60</a></p>
<p id="n61" class="stm mis"><a href="#n61">61</a></p>
<p id="n62" class="stm mis"><a href="#n62">62</a></p>
<p id="n63" class="stm mis"><a href="#n63">63</a></p>
<p id="n64" class="pln"><a href="#n64">64</a></p>
<p id="n65" class="pln"><a href="#n65">65</a></p>
<p id="n66" class="stm mis"><a href="#n66">66</a></p>
<p id="n67" class="pln"><a href="#n67">67</a></p>
<p id="n68" class="stm mis"><a href="#n68">68</a></p>
<p id="n69" class="stm mis"><a href="#n69">69</a></p>
<p id="n70" class="stm mis"><a href="#n70">70</a></p>
<p id="n71" class="stm mis"><a href="#n71">71</a></p>
<p id="n72" class="stm mis"><a href="#n72">72</a></p>
<p id="n73" class="stm mis"><a href="#n73">73</a></p>
<p id="n74" class="pln"><a href="#n74">74</a></p>
<p id="n75" class="stm mis"><a href="#n75">75</a></p>
<p id="n76" class="stm mis"><a href="#n76">76</a></p>
<p id="n77" class="stm mis"><a href="#n77">77</a></p>
<p id="n78" class="pln"><a href="#n78">78</a></p>
<p id="n79" class="pln"><a href="#n79">79</a></p>
<p id="n80" class="pln"><a href="#n80">80</a></p>
<p id="n81" class="pln"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="pln"><a href="#n83">83</a></p>
<p id="n84" class="pln"><a href="#n84">84</a></p>
<p id="n85" class="pln"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="pln"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="pln"><a href="#n89">89</a></p>
<p id="n90" class="pln"><a href="#n90">90</a></p>
<p id="n91" class="pln"><a href="#n91">91</a></p>
<p id="n92" class="pln"><a href="#n92">92</a></p>
<p id="n93" class="pln"><a href="#n93">93</a></p>
<p id="n94" class="pln"><a href="#n94">94</a></p>
<p id="n95" class="pln"><a href="#n95">95</a></p>
<p id="n96" class="pln"><a href="#n96">96</a></p>
<p id="n97" class="pln"><a href="#n97">97</a></p>
<p id="n98" class="pln"><a href="#n98">98</a></p>
<p id="n99" class="pln"><a href="#n99">99</a></p>
<p id="n100" class="pln"><a href="#n100">100</a></p>
<p id="n101" class="pln"><a href="#n101">101</a></p>
<p id="n102" class="pln"><a href="#n102">102</a></p>
<p id="n103" class="pln"><a href="#n103">103</a></p>
<p id="n104" class="pln"><a href="#n104">104</a></p>
<p id="n105" class="pln"><a href="#n105">105</a></p>
<p id="n106" class="pln"><a href="#n106">106</a></p>
<p id="n107" class="pln"><a href="#n107">107</a></p>
<p id="n108" class="pln"><a href="#n108">108</a></p>
<p id="n109" class="pln"><a href="#n109">109</a></p>
<p id="n110" class="pln"><a href="#n110">110</a></p>
<p id="n111" class="pln"><a href="#n111">111</a></p>
<p id="n112" class="pln"><a href="#n112">112</a></p>
<p id="n113" class="pln"><a href="#n113">113</a></p>
<p id="n114" class="pln"><a href="#n114">114</a></p>
<p id="n115" class="pln"><a href="#n115">115</a></p>
<p id="n116" class="pln"><a href="#n116">116</a></p>
<p id="n117" class="pln"><a href="#n117">117</a></p>
<p id="n118" class="pln"><a href="#n118">118</a></p>
<p id="n119" class="pln"><a href="#n119">119</a></p>
<p id="n120" class="pln"><a href="#n120">120</a></p>
<p id="n121" class="pln"><a href="#n121">121</a></p>
<p id="n122" class="pln"><a href="#n122">122</a></p>
<p id="n123" class="pln"><a href="#n123">123</a></p>
<p id="n124" class="pln"><a href="#n124">124</a></p>
<p id="n125" class="pln"><a href="#n125">125</a></p>
<p id="n126" class="pln"><a href="#n126">126</a></p>
<p id="n127" class="pln"><a href="#n127">127</a></p>
<p id="n128" class="pln"><a href="#n128">128</a></p>
<p id="n129" class="pln"><a href="#n129">129</a></p>
<p id="n130" class="pln"><a href="#n130">130</a></p>
<p id="n131" class="pln"><a href="#n131">131</a></p>
<p id="n132" class="pln"><a href="#n132">132</a></p>
<p id="n133" class="pln"><a href="#n133">133</a></p>
<p id="n134" class="pln"><a href="#n134">134</a></p>
<p id="n135" class="pln"><a href="#n135">135</a></p>
<p id="n136" class="pln"><a href="#n136">136</a></p>
<p id="n137" class="pln"><a href="#n137">137</a></p>
<p id="n138" class="pln"><a href="#n138">138</a></p>
<p id="n139" class="pln"><a href="#n139">139</a></p>
<p id="n140" class="pln"><a href="#n140">140</a></p>
<p id="n141" class="pln"><a href="#n141">141</a></p>
<p id="n142" class="pln"><a href="#n142">142</a></p>
<p id="n143" class="pln"><a href="#n143">143</a></p>
<p id="n144" class="pln"><a href="#n144">144</a></p>
<p id="n145" class="pln"><a href="#n145">145</a></p>
<p id="n146" class="pln"><a href="#n146">146</a></p>
<p id="n147" class="pln"><a href="#n147">147</a></p>
<p id="n148" class="pln"><a href="#n148">148</a></p>
<p id="n149" class="pln"><a href="#n149">149</a></p>
<p id="n150" class="pln"><a href="#n150">150</a></p>
<p id="n151" class="pln"><a href="#n151">151</a></p>
<p id="n152" class="pln"><a href="#n152">152</a></p>
<p id="n153" class="pln"><a href="#n153">153</a></p>
<p id="n154" class="pln"><a href="#n154">154</a></p>
<p id="n155" class="pln"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="stm mis"><a href="#n157">157</a></p>
<p id="n158" class="pln"><a href="#n158">158</a></p>
<p id="n159" class="pln"><a href="#n159">159</a></p>
<p id="n160" class="pln"><a href="#n160">160</a></p>
<p id="n161" class="pln"><a href="#n161">161</a></p>
<p id="n162" class="stm mis"><a href="#n162">162</a></p>
<p id="n163" class="stm mis"><a href="#n163">163</a></p>
<p id="n164" class="stm mis"><a href="#n164">164</a></p>
<p id="n165" class="stm mis"><a href="#n165">165</a></p>
<p id="n166" class="stm mis"><a href="#n166">166</a></p>
<p id="n167" class="stm mis"><a href="#n167">167</a></p>
<p id="n168" class="stm mis"><a href="#n168">168</a></p>
<p id="n169" class="stm mis"><a href="#n169">169</a></p>
<p id="n170" class="stm mis"><a href="#n170">170</a></p>
<p id="n171" class="stm mis"><a href="#n171">171</a></p>
<p id="n172" class="stm mis"><a href="#n172">172</a></p>
<p id="n173" class="stm mis"><a href="#n173">173</a></p>
<p id="n174" class="stm mis"><a href="#n174">174</a></p>
<p id="n175" class="stm mis"><a href="#n175">175</a></p>
<p id="n176" class="stm mis"><a href="#n176">176</a></p>
<p id="n177" class="stm mis"><a href="#n177">177</a></p>
<p id="n178" class="stm mis"><a href="#n178">178</a></p>
<p id="n179" class="stm mis"><a href="#n179">179</a></p>
<p id="n180" class="stm mis"><a href="#n180">180</a></p>
<p id="n181" class="stm mis"><a href="#n181">181</a></p>
<p id="n182" class="stm mis"><a href="#n182">182</a></p>
<p id="n183" class="stm mis"><a href="#n183">183</a></p>
<p id="n184" class="stm mis"><a href="#n184">184</a></p>
<p id="n185" class="stm mis"><a href="#n185">185</a></p>
<p id="n186" class="stm mis"><a href="#n186">186</a></p>
<p id="n187" class="stm mis"><a href="#n187">187</a></p>
<p id="n188" class="stm mis"><a href="#n188">188</a></p>
<p id="n189" class="stm mis"><a href="#n189">189</a></p>
<p id="n190" class="stm mis"><a href="#n190">190</a></p>
<p id="n191" class="stm mis"><a href="#n191">191</a></p>
<p id="n192" class="pln"><a href="#n192">192</a></p>
<p id="n193" class="pln"><a href="#n193">193</a></p>
<p id="n194" class="pln"><a href="#n194">194</a></p>
<p id="n195" class="pln"><a href="#n195">195</a></p>
<p id="n196" class="stm mis"><a href="#n196">196</a></p>
<p id="n197" class="stm mis"><a href="#n197">197</a></p>
<p id="n198" class="stm mis"><a href="#n198">198</a></p>
<p id="n199" class="stm mis"><a href="#n199">199</a></p>
<p id="n200" class="stm mis"><a href="#n200">200</a></p>
<p id="n201" class="pln"><a href="#n201">201</a></p>
<p id="n202" class="pln"><a href="#n202">202</a></p>
<p id="n203" class="pln"><a href="#n203">203</a></p>
<p id="n204" class="stm mis"><a href="#n204">204</a></p>
<p id="n205" class="stm mis"><a href="#n205">205</a></p>
<p id="n206" class="stm mis"><a href="#n206">206</a></p>
<p id="n207" class="stm mis"><a href="#n207">207</a></p>
<p id="n208" class="stm mis"><a href="#n208">208</a></p>
<p id="n209" class="stm mis"><a href="#n209">209</a></p>
<p id="n210" class="stm mis"><a href="#n210">210</a></p>
<p id="n211" class="stm mis"><a href="#n211">211</a></p>
<p id="n212" class="stm mis"><a href="#n212">212</a></p>
<p id="n213" class="stm mis"><a href="#n213">213</a></p>
<p id="n214" class="stm mis"><a href="#n214">214</a></p>
<p id="n215" class="pln"><a href="#n215">215</a></p>
<p id="n216" class="pln"><a href="#n216">216</a></p>
<p id="n217" class="pln"><a href="#n217">217</a></p>
<p id="n218" class="pln"><a href="#n218">218</a></p>
<p id="n219" class="pln"><a href="#n219">219</a></p>
<p id="n220" class="stm mis"><a href="#n220">220</a></p>
<p id="n221" class="stm mis"><a href="#n221">221</a></p>
<p id="n222" class="stm mis"><a href="#n222">222</a></p>
<p id="n223" class="stm mis"><a href="#n223">223</a></p>
<p id="n224" class="stm mis"><a href="#n224">224</a></p>
<p id="n225" class="stm mis"><a href="#n225">225</a></p>
<p id="n226" class="stm mis"><a href="#n226">226</a></p>
<p id="n227" class="stm mis"><a href="#n227">227</a></p>
<p id="n228" class="stm mis"><a href="#n228">228</a></p>
<p id="n229" class="stm mis"><a href="#n229">229</a></p>
<p id="n230" class="pln"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="pln"><a href="#n232">232</a></p>
<p id="n233" class="stm mis"><a href="#n233">233</a></p>
<p id="n234" class="stm mis"><a href="#n234">234</a></p>
<p id="n235" class="stm mis"><a href="#n235">235</a></p>
<p id="n236" class="pln"><a href="#n236">236</a></p>
<p id="n237" class="stm mis"><a href="#n237">237</a></p>
<p id="n238" class="pln"><a href="#n238">238</a></p>
<p id="n239" class="stm mis"><a href="#n239">239</a></p>
<p id="n240" class="pln"><a href="#n240">240</a></p>
<p id="n241" class="pln"><a href="#n241">241</a></p>
<p id="n242" class="pln"><a href="#n242">242</a></p>
<p id="n243" class="pln"><a href="#n243">243</a></p>
<p id="n244" class="pln"><a href="#n244">244</a></p>
<p id="n245" class="stm mis"><a href="#n245">245</a></p>
<p id="n246" class="stm mis"><a href="#n246">246</a></p>
<p id="n247" class="pln"><a href="#n247">247</a></p>
<p id="n248" class="stm mis"><a href="#n248">248</a></p>
<p id="n249" class="pln"><a href="#n249">249</a></p>
<p id="n250" class="stm mis"><a href="#n250">250</a></p>
<p id="n251" class="stm mis"><a href="#n251">251</a></p>
<p id="n252" class="stm mis"><a href="#n252">252</a></p>
<p id="n253" class="stm mis"><a href="#n253">253</a></p>
<p id="n254" class="stm mis"><a href="#n254">254</a></p>
<p id="n255" class="pln"><a href="#n255">255</a></p>
<p id="n256" class="stm mis"><a href="#n256">256</a></p>
<p id="n257" class="stm mis"><a href="#n257">257</a></p>
<p id="n258" class="stm mis"><a href="#n258">258</a></p>
<p id="n259" class="pln"><a href="#n259">259</a></p>
<p id="n260" class="stm mis"><a href="#n260">260</a></p>
<p id="n261" class="stm mis"><a href="#n261">261</a></p>
<p id="n262" class="stm mis"><a href="#n262">262</a></p>
<p id="n263" class="stm mis"><a href="#n263">263</a></p>
<p id="n264" class="pln"><a href="#n264">264</a></p>
<p id="n265" class="stm mis"><a href="#n265">265</a></p>
<p id="n266" class="stm mis"><a href="#n266">266</a></p>
<p id="n267" class="stm mis"><a href="#n267">267</a></p>
<p id="n268" class="pln"><a href="#n268">268</a></p>
<p id="n269" class="stm mis"><a href="#n269">269</a></p>
<p id="n270" class="pln"><a href="#n270">270</a></p>
<p id="n271" class="stm mis"><a href="#n271">271</a></p>
<p id="n272" class="stm mis"><a href="#n272">272</a></p>
<p id="n273" class="stm mis"><a href="#n273">273</a></p>
<p id="n274" class="stm mis"><a href="#n274">274</a></p>
<p id="n275" class="pln"><a href="#n275">275</a></p>
<p id="n276" class="stm mis"><a href="#n276">276</a></p>
<p id="n277" class="stm mis"><a href="#n277">277</a></p>
<p id="n278" class="stm mis"><a href="#n278">278</a></p>
<p id="n279" class="pln"><a href="#n279">279</a></p>
<p id="n280" class="pln"><a href="#n280">280</a></p>
<p id="n281" class="stm mis"><a href="#n281">281</a></p>
<p id="n282" class="stm mis"><a href="#n282">282</a></p>
<p id="n283" class="stm mis"><a href="#n283">283</a></p>
<p id="n284" class="stm mis"><a href="#n284">284</a></p>
<p id="n285" class="stm mis"><a href="#n285">285</a></p>
<p id="n286" class="stm mis"><a href="#n286">286</a></p>
<p id="n287" class="stm mis"><a href="#n287">287</a></p>
<p id="n288" class="stm mis"><a href="#n288">288</a></p>
<p id="n289" class="stm mis"><a href="#n289">289</a></p>
<p id="n290" class="stm mis"><a href="#n290">290</a></p>
<p id="n291" class="stm mis"><a href="#n291">291</a></p>
<p id="n292" class="pln"><a href="#n292">292</a></p>
<p id="n293" class="stm mis"><a href="#n293">293</a></p>
<p id="n294" class="stm mis"><a href="#n294">294</a></p>
<p id="n295" class="stm mis"><a href="#n295">295</a></p>
<p id="n296" class="stm mis"><a href="#n296">296</a></p>
<p id="n297" class="stm mis"><a href="#n297">297</a></p>
<p id="n298" class="stm mis"><a href="#n298">298</a></p>
<p id="n299" class="stm mis"><a href="#n299">299</a></p>
<p id="n300" class="stm mis"><a href="#n300">300</a></p>
<p id="n301" class="stm mis"><a href="#n301">301</a></p>
<p id="n302" class="stm mis"><a href="#n302">302</a></p>
<p id="n303" class="stm mis"><a href="#n303">303</a></p>
<p id="n304" class="pln"><a href="#n304">304</a></p>
<p id="n305" class="stm mis"><a href="#n305">305</a></p>
<p id="n306" class="pln"><a href="#n306">306</a></p>
<p id="n307" class="stm mis"><a href="#n307">307</a></p>
<p id="n308" class="stm mis"><a href="#n308">308</a></p>
<p id="n309" class="pln"><a href="#n309">309</a></p>
<p id="n310" class="pln"><a href="#n310">310</a></p>
<p id="n311" class="stm mis"><a href="#n311">311</a></p>
<p id="n312" class="stm mis"><a href="#n312">312</a></p>
<p id="n313" class="pln"><a href="#n313">313</a></p>
<p id="n314" class="pln"><a href="#n314">314</a></p>
<p id="n315" class="stm mis"><a href="#n315">315</a></p>
<p id="n316" class="pln"><a href="#n316">316</a></p>
<p id="n317" class="stm mis"><a href="#n317">317</a></p>
<p id="n318" class="stm mis"><a href="#n318">318</a></p>
<p id="n319" class="stm mis"><a href="#n319">319</a></p>
<p id="n320" class="stm mis"><a href="#n320">320</a></p>
<p id="n321" class="stm mis"><a href="#n321">321</a></p>
<p id="n322" class="stm mis"><a href="#n322">322</a></p>
<p id="n323" class="pln"><a href="#n323">323</a></p>
<p id="n324" class="stm mis"><a href="#n324">324</a></p>
<p id="n325" class="stm mis"><a href="#n325">325</a></p>
<p id="n326" class="stm mis"><a href="#n326">326</a></p>
<p id="n327" class="pln"><a href="#n327">327</a></p>
<p id="n328" class="stm mis"><a href="#n328">328</a></p>
<p id="n329" class="pln"><a href="#n329">329</a></p>
<p id="n330" class="pln"><a href="#n330">330</a></p>
<p id="n331" class="pln"><a href="#n331">331</a></p>
<p id="n332" class="pln"><a href="#n332">332</a></p>
<p id="n333" class="stm mis"><a href="#n333">333</a></p>
<p id="n334" class="pln"><a href="#n334">334</a></p>
<p id="n335" class="stm mis"><a href="#n335">335</a></p>
<p id="n336" class="pln"><a href="#n336">336</a></p>
<p id="n337" class="pln"><a href="#n337">337</a></p>
<p id="n338" class="stm mis"><a href="#n338">338</a></p>
<p id="n339" class="pln"><a href="#n339">339</a></p>
<p id="n340" class="pln"><a href="#n340">340</a></p>
<p id="n341" class="stm mis"><a href="#n341">341</a></p>
<p id="n342" class="stm mis"><a href="#n342">342</a></p>
<p id="n343" class="stm mis"><a href="#n343">343</a></p>
<p id="n344" class="stm mis"><a href="#n344">344</a></p>
<p id="n345" class="stm mis"><a href="#n345">345</a></p>
<p id="n346" class="stm mis"><a href="#n346">346</a></p>
<p id="n347" class="stm mis"><a href="#n347">347</a></p>
<p id="n348" class="pln"><a href="#n348">348</a></p>
<p id="n349" class="stm mis"><a href="#n349">349</a></p>
<p id="n350" class="stm mis"><a href="#n350">350</a></p>
<p id="n351" class="stm mis"><a href="#n351">351</a></p>
<p id="n352" class="pln"><a href="#n352">352</a></p>
<p id="n353" class="stm mis"><a href="#n353">353</a></p>
<p id="n354" class="stm mis"><a href="#n354">354</a></p>
<p id="n355" class="stm mis"><a href="#n355">355</a></p>
<p id="n356" class="stm mis"><a href="#n356">356</a></p>
<p id="n357" class="pln"><a href="#n357">357</a></p>
<p id="n358" class="stm mis"><a href="#n358">358</a></p>
<p id="n359" class="stm mis"><a href="#n359">359</a></p>
<p id="n360" class="stm mis"><a href="#n360">360</a></p>
<p id="n361" class="pln"><a href="#n361">361</a></p>
<p id="n362" class="pln"><a href="#n362">362</a></p>
<p id="n363" class="pln"><a href="#n363">363</a></p>
<p id="n364" class="stm mis"><a href="#n364">364</a></p>
<p id="n365" class="stm mis"><a href="#n365">365</a></p>
<p id="n366" class="pln"><a href="#n366">366</a></p>
<p id="n367" class="stm mis"><a href="#n367">367</a></p>
<p id="n368" class="stm mis"><a href="#n368">368</a></p>
<p id="n369" class="stm mis"><a href="#n369">369</a></p>
<p id="n370" class="stm mis"><a href="#n370">370</a></p>
<p id="n371" class="stm mis"><a href="#n371">371</a></p>
<p id="n372" class="stm mis"><a href="#n372">372</a></p>
<p id="n373" class="stm mis"><a href="#n373">373</a></p>
<p id="n374" class="stm mis"><a href="#n374">374</a></p>
<p id="n375" class="pln"><a href="#n375">375</a></p>
<p id="n376" class="stm mis"><a href="#n376">376</a></p>
<p id="n377" class="stm mis"><a href="#n377">377</a></p>
<p id="n378" class="stm mis"><a href="#n378">378</a></p>
<p id="n379" class="stm mis"><a href="#n379">379</a></p>
<p id="n380" class="stm mis"><a href="#n380">380</a></p>
<p id="n381" class="stm mis"><a href="#n381">381</a></p>
<p id="n382" class="pln"><a href="#n382">382</a></p>
<p id="n383" class="stm mis"><a href="#n383">383</a></p>
<p id="n384" class="stm mis"><a href="#n384">384</a></p>
<p id="n385" class="stm mis"><a href="#n385">385</a></p>
<p id="n386" class="stm mis"><a href="#n386">386</a></p>
<p id="n387" class="pln"><a href="#n387">387</a></p>
<p id="n388" class="pln"><a href="#n388">388</a></p>
<p id="n389" class="pln"><a href="#n389">389</a></p>
<p id="n390" class="stm mis"><a href="#n390">390</a></p>
<p id="n391" class="stm mis"><a href="#n391">391</a></p>
<p id="n392" class="pln"><a href="#n392">392</a></p>
<p id="n393" class="pln"><a href="#n393">393</a></p>
<p id="n394" class="pln"><a href="#n394">394</a></p>
<p id="n395" class="pln"><a href="#n395">395</a></p>
<p id="n396" class="pln"><a href="#n396">396</a></p>
<p id="n397" class="pln"><a href="#n397">397</a></p>
<p id="n398" class="stm mis"><a href="#n398">398</a></p>
<p id="n399" class="pln"><a href="#n399">399</a></p>
<p id="n400" class="pln"><a href="#n400">400</a></p>
<p id="n401" class="pln"><a href="#n401">401</a></p>
<p id="n402" class="pln"><a href="#n402">402</a></p>
<p id="n403" class="pln"><a href="#n403">403</a></p>
<p id="n404" class="pln"><a href="#n404">404</a></p>
<p id="n405" class="pln"><a href="#n405">405</a></p>
<p id="n406" class="pln"><a href="#n406">406</a></p>
<p id="n407" class="pln"><a href="#n407">407</a></p>
<p id="n408" class="pln"><a href="#n408">408</a></p>
<p id="n409" class="stm mis"><a href="#n409">409</a></p>
<p id="n410" class="stm mis"><a href="#n410">410</a></p>
<p id="n411" class="pln"><a href="#n411">411</a></p>
<p id="n412" class="stm mis"><a href="#n412">412</a></p>
<p id="n413" class="pln"><a href="#n413">413</a></p>
<p id="n414" class="pln"><a href="#n414">414</a></p>
<p id="n415" class="pln"><a href="#n415">415</a></p>
<p id="n416" class="pln"><a href="#n416">416</a></p>
<p id="n417" class="stm mis"><a href="#n417">417</a></p>
<p id="n418" class="stm mis"><a href="#n418">418</a></p>
<p id="n419" class="stm mis"><a href="#n419">419</a></p>
<p id="n420" class="stm mis"><a href="#n420">420</a></p>
<p id="n421" class="pln"><a href="#n421">421</a></p>
<p id="n422" class="stm mis"><a href="#n422">422</a></p>
<p id="n423" class="stm mis"><a href="#n423">423</a></p>
<p id="n424" class="pln"><a href="#n424">424</a></p>
<p id="n425" class="stm mis"><a href="#n425">425</a></p>
<p id="n426" class="pln"><a href="#n426">426</a></p>
<p id="n427" class="pln"><a href="#n427">427</a></p>
<p id="n428" class="pln"><a href="#n428">428</a></p>
<p id="n429" class="pln"><a href="#n429">429</a></p>
<p id="n430" class="stm mis"><a href="#n430">430</a></p>
<p id="n431" class="stm mis"><a href="#n431">431</a></p>
<p id="n432" class="pln"><a href="#n432">432</a></p>
<p id="n433" class="stm mis"><a href="#n433">433</a></p>
<p id="n434" class="stm mis"><a href="#n434">434</a></p>
<p id="n435" class="pln"><a href="#n435">435</a></p>
<p id="n436" class="pln"><a href="#n436">436</a></p>
<p id="n437" class="pln"><a href="#n437">437</a></p>
<p id="n438" class="pln"><a href="#n438">438</a></p>
<p id="n439" class="stm mis"><a href="#n439">439</a></p>
<p id="n440" class="stm mis"><a href="#n440">440</a></p>
<p id="n441" class="stm mis"><a href="#n441">441</a></p>
<p id="n442" class="pln"><a href="#n442">442</a></p>
<p id="n443" class="pln"><a href="#n443">443</a></p>
<p id="n444" class="pln"><a href="#n444">444</a></p>
<p id="n445" class="pln"><a href="#n445">445</a></p>
<p id="n446" class="pln"><a href="#n446">446</a></p>
<p id="n447" class="stm mis"><a href="#n447">447</a></p>
<p id="n448" class="pln"><a href="#n448">448</a></p>
<p id="n449" class="stm mis"><a href="#n449">449</a></p>
<p id="n450" class="pln"><a href="#n450">450</a></p>
<p id="n451" class="pln"><a href="#n451">451</a></p>
<p id="n452" class="pln"><a href="#n452">452</a></p>
<p id="n453" class="pln"><a href="#n453">453</a></p>
<p id="n454" class="pln"><a href="#n454">454</a></p>
<p id="n455" class="stm mis"><a href="#n455">455</a></p>
<p id="n456" class="pln"><a href="#n456">456</a></p>
<p id="n457" class="stm mis"><a href="#n457">457</a></p>
<p id="n458" class="stm mis"><a href="#n458">458</a></p>
<p id="n459" class="pln"><a href="#n459">459</a></p>
<p id="n460" class="pln"><a href="#n460">460</a></p>
<p id="n461" class="pln"><a href="#n461">461</a></p>
<p id="n462" class="pln"><a href="#n462">462</a></p>
<p id="n463" class="pln"><a href="#n463">463</a></p>
<p id="n464" class="stm mis"><a href="#n464">464</a></p>
<p id="n465" class="stm mis"><a href="#n465">465</a></p>
<p id="n466" class="stm mis"><a href="#n466">466</a></p>
<p id="n467" class="pln"><a href="#n467">467</a></p>
<p id="n468" class="pln"><a href="#n468">468</a></p>
<p id="n469" class="pln"><a href="#n469">469</a></p>
<p id="n470" class="pln"><a href="#n470">470</a></p>
<p id="n471" class="pln"><a href="#n471">471</a></p>
<p id="n472" class="stm mis"><a href="#n472">472</a></p>
<p id="n473" class="stm mis"><a href="#n473">473</a></p>
<p id="n474" class="pln"><a href="#n474">474</a></p>
<p id="n475" class="stm mis"><a href="#n475">475</a></p>
<p id="n476" class="pln"><a href="#n476">476</a></p>
<p id="n477" class="stm mis"><a href="#n477">477</a></p>
<p id="n478" class="stm mis"><a href="#n478">478</a></p>
<p id="n479" class="pln"><a href="#n479">479</a></p>
<p id="n480" class="stm mis"><a href="#n480">480</a></p>
<p id="n481" class="stm mis"><a href="#n481">481</a></p>
<p id="n482" class="stm mis"><a href="#n482">482</a></p>
<p id="n483" class="stm mis"><a href="#n483">483</a></p>
<p id="n484" class="stm mis"><a href="#n484">484</a></p>
<p id="n485" class="stm mis"><a href="#n485">485</a></p>
<p id="n486" class="pln"><a href="#n486">486</a></p>
<p id="n487" class="stm mis"><a href="#n487">487</a></p>
<p id="n488" class="stm mis"><a href="#n488">488</a></p>
<p id="n489" class="stm mis"><a href="#n489">489</a></p>
<p id="n490" class="pln"><a href="#n490">490</a></p>
<p id="n491" class="pln"><a href="#n491">491</a></p>
<p id="n492" class="stm mis"><a href="#n492">492</a></p>
<p id="n493" class="stm mis"><a href="#n493">493</a></p>
<p id="n494" class="pln"><a href="#n494">494</a></p>
<p id="n495" class="pln"><a href="#n495">495</a></p>
<p id="n496" class="stm mis"><a href="#n496">496</a></p>
<p id="n497" class="pln"><a href="#n497">497</a></p>
<p id="n498" class="pln"><a href="#n498">498</a></p>
<p id="n499" class="pln"><a href="#n499">499</a></p>
<p id="n500" class="pln"><a href="#n500">500</a></p>
<p id="n501" class="pln"><a href="#n501">501</a></p>
<p id="n502" class="pln"><a href="#n502">502</a></p>
<p id="n503" class="stm mis"><a href="#n503">503</a></p>
<p id="n504" class="stm mis"><a href="#n504">504</a></p>
<p id="n505" class="stm mis"><a href="#n505">505</a></p>
<p id="n506" class="stm mis"><a href="#n506">506</a></p>
<p id="n507" class="pln"><a href="#n507">507</a></p>
<p id="n508" class="stm mis"><a href="#n508">508</a></p>
<p id="n509" class="stm mis"><a href="#n509">509</a></p>
<p id="n510" class="stm mis"><a href="#n510">510</a></p>
<p id="n511" class="pln"><a href="#n511">511</a></p>
<p id="n512" class="pln"><a href="#n512">512</a></p>
<p id="n513" class="pln"><a href="#n513">513</a></p>
<p id="n514" class="pln"><a href="#n514">514</a></p>
<p id="n515" class="stm mis"><a href="#n515">515</a></p>
<p id="n516" class="stm mis"><a href="#n516">516</a></p>
<p id="n517" class="stm mis"><a href="#n517">517</a></p>
<p id="n518" class="pln"><a href="#n518">518</a></p>
<p id="n519" class="stm mis"><a href="#n519">519</a></p>
<p id="n520" class="stm mis"><a href="#n520">520</a></p>
<p id="n521" class="stm mis"><a href="#n521">521</a></p>
<p id="n522" class="pln"><a href="#n522">522</a></p>
<p id="n523" class="pln"><a href="#n523">523</a></p>
<p id="n524" class="pln"><a href="#n524">524</a></p>
<p id="n525" class="pln"><a href="#n525">525</a></p>
<p id="n526" class="stm mis"><a href="#n526">526</a></p>
<p id="n527" class="stm mis"><a href="#n527">527</a></p>
<p id="n528" class="stm mis"><a href="#n528">528</a></p>
<p id="n529" class="stm mis"><a href="#n529">529</a></p>
<p id="n530" class="stm mis"><a href="#n530">530</a></p>
<p id="n531" class="pln"><a href="#n531">531</a></p>
<p id="n532" class="stm mis"><a href="#n532">532</a></p>
<p id="n533" class="stm mis"><a href="#n533">533</a></p>
<p id="n534" class="stm mis"><a href="#n534">534</a></p>
<p id="n535" class="stm mis"><a href="#n535">535</a></p>
<p id="n536" class="stm mis"><a href="#n536">536</a></p>
<p id="n537" class="pln"><a href="#n537">537</a></p>
<p id="n538" class="stm mis"><a href="#n538">538</a></p>
<p id="n539" class="stm mis"><a href="#n539">539</a></p>
<p id="n540" class="stm mis"><a href="#n540">540</a></p>
<p id="n541" class="stm mis"><a href="#n541">541</a></p>
<p id="n542" class="stm mis"><a href="#n542">542</a></p>
<p id="n543" class="pln"><a href="#n543">543</a></p>
<p id="n544" class="stm mis"><a href="#n544">544</a></p>
<p id="n545" class="pln"><a href="#n545">545</a></p>
<p id="n546" class="pln"><a href="#n546">546</a></p>
<p id="n547" class="stm mis"><a href="#n547">547</a></p>
<p id="n548" class="stm mis"><a href="#n548">548</a></p>
<p id="n549" class="pln"><a href="#n549">549</a></p>
<p id="n550" class="stm mis"><a href="#n550">550</a></p>
<p id="n551" class="stm mis"><a href="#n551">551</a></p>
<p id="n552" class="stm mis"><a href="#n552">552</a></p>
<p id="n553" class="stm mis"><a href="#n553">553</a></p>
<p id="n554" class="pln"><a href="#n554">554</a></p>
<p id="n555" class="stm mis"><a href="#n555">555</a></p>
<p id="n556" class="stm mis"><a href="#n556">556</a></p>
<p id="n557" class="stm mis"><a href="#n557">557</a></p>
<p id="n558" class="stm mis"><a href="#n558">558</a></p>
<p id="n559" class="pln"><a href="#n559">559</a></p>
<p id="n560" class="stm mis"><a href="#n560">560</a></p>
<p id="n561" class="stm mis"><a href="#n561">561</a></p>
<p id="n562" class="stm mis"><a href="#n562">562</a></p>
<p id="n563" class="stm mis"><a href="#n563">563</a></p>
<p id="n564" class="stm mis"><a href="#n564">564</a></p>
<p id="n565" class="stm mis"><a href="#n565">565</a></p>
<p id="n566" class="stm mis"><a href="#n566">566</a></p>
<p id="n567" class="pln"><a href="#n567">567</a></p>
<p id="n568" class="stm mis"><a href="#n568">568</a></p>
<p id="n569" class="stm mis"><a href="#n569">569</a></p>
<p id="n570" class="pln"><a href="#n570">570</a></p>
<p id="n571" class="stm mis"><a href="#n571">571</a></p>
<p id="n572" class="stm mis"><a href="#n572">572</a></p>
<p id="n573" class="stm mis"><a href="#n573">573</a></p>
<p id="n574" class="stm mis"><a href="#n574">574</a></p>
<p id="n575" class="pln"><a href="#n575">575</a></p>
<p id="n576" class="stm mis"><a href="#n576">576</a></p>
<p id="n577" class="stm mis"><a href="#n577">577</a></p>
<p id="n578" class="stm mis"><a href="#n578">578</a></p>
<p id="n579" class="stm mis"><a href="#n579">579</a></p>
<p id="n580" class="stm mis"><a href="#n580">580</a></p>
<p id="n581" class="stm mis"><a href="#n581">581</a></p>
<p id="n582" class="pln"><a href="#n582">582</a></p>
<p id="n583" class="stm mis"><a href="#n583">583</a></p>
<p id="n584" class="pln"><a href="#n584">584</a></p>
<p id="n585" class="stm mis"><a href="#n585">585</a></p>
<p id="n586" class="stm mis"><a href="#n586">586</a></p>
<p id="n587" class="pln"><a href="#n587">587</a></p>
<p id="n588" class="stm mis"><a href="#n588">588</a></p>
<p id="n589" class="stm mis"><a href="#n589">589</a></p>
<p id="n590" class="stm mis"><a href="#n590">590</a></p>
<p id="n591" class="pln"><a href="#n591">591</a></p>
<p id="n592" class="stm mis"><a href="#n592">592</a></p>
<p id="n593" class="stm mis"><a href="#n593">593</a></p>
<p id="n594" class="stm mis"><a href="#n594">594</a></p>
<p id="n595" class="stm mis"><a href="#n595">595</a></p>
<p id="n596" class="pln"><a href="#n596">596</a></p>
<p id="n597" class="pln"><a href="#n597">597</a></p>
<p id="n598" class="pln"><a href="#n598">598</a></p>
<p id="n599" class="pln"><a href="#n599">599</a></p>
<p id="n600" class="stm mis"><a href="#n600">600</a></p>
<p id="n601" class="stm mis"><a href="#n601">601</a></p>
<p id="n602" class="pln"><a href="#n602">602</a></p>
<p id="n603" class="pln"><a href="#n603">603</a></p>
<p id="n604" class="pln"><a href="#n604">604</a></p>
<p id="n605" class="pln"><a href="#n605">605</a></p>
<p id="n606" class="pln"><a href="#n606">606</a></p>
<p id="n607" class="pln"><a href="#n607">607</a></p>
<p id="n608" class="pln"><a href="#n608">608</a></p>
<p id="n609" class="pln"><a href="#n609">609</a></p>
<p id="n610" class="stm mis"><a href="#n610">610</a></p>
<p id="n611" class="stm mis"><a href="#n611">611</a></p>
<p id="n612" class="pln"><a href="#n612">612</a></p>
<p id="n613" class="stm mis"><a href="#n613">613</a></p>
<p id="n614" class="stm mis"><a href="#n614">614</a></p>
<p id="n615" class="stm mis"><a href="#n615">615</a></p>
<p id="n616" class="pln"><a href="#n616">616</a></p>
<p id="n617" class="stm mis"><a href="#n617">617</a></p>
<p id="n618" class="stm mis"><a href="#n618">618</a></p>
<p id="n619" class="stm mis"><a href="#n619">619</a></p>
<p id="n620" class="pln"><a href="#n620">620</a></p>
<p id="n621" class="stm mis"><a href="#n621">621</a></p>
<p id="n622" class="stm mis"><a href="#n622">622</a></p>
<p id="n623" class="pln"><a href="#n623">623</a></p>
<p id="n624" class="stm mis"><a href="#n624">624</a></p>
<p id="n625" class="stm mis"><a href="#n625">625</a></p>
<p id="n626" class="pln"><a href="#n626">626</a></p>
<p id="n627" class="stm mis"><a href="#n627">627</a></p>
<p id="n628" class="stm mis"><a href="#n628">628</a></p>
<p id="n629" class="stm mis"><a href="#n629">629</a></p>
<p id="n630" class="stm mis"><a href="#n630">630</a></p>
<p id="n631" class="pln"><a href="#n631">631</a></p>
<p id="n632" class="stm mis"><a href="#n632">632</a></p>
<p id="n633" class="stm mis"><a href="#n633">633</a></p>
<p id="n634" class="stm mis"><a href="#n634">634</a></p>
<p id="n635" class="pln"><a href="#n635">635</a></p>
<p id="n636" class="pln"><a href="#n636">636</a></p>
<p id="n637" class="pln"><a href="#n637">637</a></p>
<p id="n638" class="pln"><a href="#n638">638</a></p>
<p id="n639" class="pln"><a href="#n639">639</a></p>
<p id="n640" class="pln"><a href="#n640">640</a></p>
<p id="n641" class="pln"><a href="#n641">641</a></p>
<p id="n642" class="stm mis"><a href="#n642">642</a></p>
<p id="n643" class="stm mis"><a href="#n643">643</a></p>
<p id="n644" class="pln"><a href="#n644">644</a></p>
<p id="n645" class="stm mis"><a href="#n645">645</a></p>
<p id="n646" class="stm mis"><a href="#n646">646</a></p>
<p id="n647" class="pln"><a href="#n647">647</a></p>
<p id="n648" class="stm mis"><a href="#n648">648</a></p>
<p id="n649" class="pln"><a href="#n649">649</a></p>
<p id="n650" class="pln"><a href="#n650">650</a></p>
<p id="n651" class="stm mis"><a href="#n651">651</a></p>
<p id="n652" class="stm mis"><a href="#n652">652</a></p>
<p id="n653" class="pln"><a href="#n653">653</a></p>
<p id="n654" class="stm mis"><a href="#n654">654</a></p>
<p id="n655" class="stm mis"><a href="#n655">655</a></p>
<p id="n656" class="pln"><a href="#n656">656</a></p>
<p id="n657" class="pln"><a href="#n657">657</a></p>
<p id="n658" class="pln"><a href="#n658">658</a></p>
<p id="n659" class="pln"><a href="#n659">659</a></p>
<p id="n660" class="stm mis"><a href="#n660">660</a></p>
<p id="n661" class="stm mis"><a href="#n661">661</a></p>
<p id="n662" class="pln"><a href="#n662">662</a></p>
<p id="n663" class="stm mis"><a href="#n663">663</a></p>
<p id="n664" class="stm mis"><a href="#n664">664</a></p>
<p id="n665" class="pln"><a href="#n665">665</a></p>
<p id="n666" class="stm mis"><a href="#n666">666</a></p>
<p id="n667" class="stm mis"><a href="#n667">667</a></p>
<p id="n668" class="pln"><a href="#n668">668</a></p>
<p id="n669" class="pln"><a href="#n669">669</a></p>
<p id="n670" class="stm mis"><a href="#n670">670</a></p>
<p id="n671" class="stm mis"><a href="#n671">671</a></p>
<p id="n672" class="pln"><a href="#n672">672</a></p>
<p id="n673" class="stm mis"><a href="#n673">673</a></p>
<p id="n674" class="stm mis"><a href="#n674">674</a></p>
<p id="n675" class="pln"><a href="#n675">675</a></p>
<p id="n676" class="pln"><a href="#n676">676</a></p>
<p id="n677" class="stm mis"><a href="#n677">677</a></p>
<p id="n678" class="stm mis"><a href="#n678">678</a></p>
<p id="n679" class="stm mis"><a href="#n679">679</a></p>
<p id="n680" class="stm mis"><a href="#n680">680</a></p>
<p id="n681" class="stm mis"><a href="#n681">681</a></p>
<p id="n682" class="stm mis"><a href="#n682">682</a></p>
<p id="n683" class="pln"><a href="#n683">683</a></p>
<p id="n684" class="stm mis"><a href="#n684">684</a></p>
<p id="n685" class="pln"><a href="#n685">685</a></p>
<p id="n686" class="stm mis"><a href="#n686">686</a></p>
<p id="n687" class="pln"><a href="#n687">687</a></p>
<p id="n688" class="stm mis"><a href="#n688">688</a></p>
<p id="n689" class="pln"><a href="#n689">689</a></p>
<p id="n690" class="pln"><a href="#n690">690</a></p>
<p id="n691" class="pln"><a href="#n691">691</a></p>
<p id="n692" class="pln"><a href="#n692">692</a></p>
<p id="n693" class="pln"><a href="#n693">693</a></p>
<p id="n694" class="stm mis"><a href="#n694">694</a></p>
<p id="n695" class="pln"><a href="#n695">695</a></p>
<p id="n696" class="pln"><a href="#n696">696</a></p>
<p id="n697" class="pln"><a href="#n697">697</a></p>
<p id="n698" class="pln"><a href="#n698">698</a></p>
<p id="n699" class="pln"><a href="#n699">699</a></p>
<p id="n700" class="pln"><a href="#n700">700</a></p>
<p id="n701" class="pln"><a href="#n701">701</a></p>
<p id="n702" class="pln"><a href="#n702">702</a></p>
<p id="n703" class="pln"><a href="#n703">703</a></p>
<p id="n704" class="pln"><a href="#n704">704</a></p>
<p id="n705" class="pln"><a href="#n705">705</a></p>
<p id="n706" class="pln"><a href="#n706">706</a></p>
<p id="n707" class="pln"><a href="#n707">707</a></p>
<p id="n708" class="stm mis"><a href="#n708">708</a></p>
<p id="n709" class="pln"><a href="#n709">709</a></p>
<p id="n710" class="pln"><a href="#n710">710</a></p>
<p id="n711" class="pln"><a href="#n711">711</a></p>
<p id="n712" class="pln"><a href="#n712">712</a></p>
<p id="n713" class="pln"><a href="#n713">713</a></p>
<p id="n714" class="pln"><a href="#n714">714</a></p>
<p id="n715" class="pln"><a href="#n715">715</a></p>
<p id="n716" class="pln"><a href="#n716">716</a></p>
<p id="n717" class="pln"><a href="#n717">717</a></p>
<p id="n718" class="pln"><a href="#n718">718</a></p>
<p id="n719" class="pln"><a href="#n719">719</a></p>
<p id="n720" class="pln"><a href="#n720">720</a></p>
<p id="n721" class="pln"><a href="#n721">721</a></p>
<p id="n722" class="pln"><a href="#n722">722</a></p>
<p id="n723" class="pln"><a href="#n723">723</a></p>
<p id="n724" class="pln"><a href="#n724">724</a></p>
<p id="n725" class="pln"><a href="#n725">725</a></p>
<p id="n726" class="stm mis"><a href="#n726">726</a></p>
<p id="n727" class="stm mis"><a href="#n727">727</a></p>
<p id="n728" class="stm mis"><a href="#n728">728</a></p>
<p id="n729" class="stm mis"><a href="#n729">729</a></p>
<p id="n730" class="stm mis"><a href="#n730">730</a></p>
<p id="n731" class="stm mis"><a href="#n731">731</a></p>
<p id="n732" class="pln"><a href="#n732">732</a></p>
<p id="n733" class="stm mis"><a href="#n733">733</a></p>
<p id="n734" class="stm mis"><a href="#n734">734</a></p>
<p id="n735" class="pln"><a href="#n735">735</a></p>
<p id="n736" class="stm mis"><a href="#n736">736</a></p>
<p id="n737" class="stm mis"><a href="#n737">737</a></p>
<p id="n738" class="pln"><a href="#n738">738</a></p>
<p id="n739" class="pln"><a href="#n739">739</a></p>
<p id="n740" class="stm mis"><a href="#n740">740</a></p>
<p id="n741" class="stm mis"><a href="#n741">741</a></p>
<p id="n742" class="stm mis"><a href="#n742">742</a></p>
<p id="n743" class="stm mis"><a href="#n743">743</a></p>
<p id="n744" class="stm mis"><a href="#n744">744</a></p>
<p id="n745" class="pln"><a href="#n745">745</a></p>
<p id="n746" class="pln"><a href="#n746">746</a></p>
<p id="n747" class="pln"><a href="#n747">747</a></p>
<p id="n748" class="stm mis"><a href="#n748">748</a></p>
<p id="n749" class="stm mis"><a href="#n749">749</a></p>
<p id="n750" class="stm mis"><a href="#n750">750</a></p>
<p id="n751" class="stm mis"><a href="#n751">751</a></p>
<p id="n752" class="stm mis"><a href="#n752">752</a></p>
<p id="n753" class="stm mis"><a href="#n753">753</a></p>
<p id="n754" class="stm mis"><a href="#n754">754</a></p>
<p id="n755" class="stm mis"><a href="#n755">755</a></p>
<p id="n756" class="pln"><a href="#n756">756</a></p>
<p id="n757" class="pln"><a href="#n757">757</a></p>
<p id="n758" class="pln"><a href="#n758">758</a></p>
<p id="n759" class="stm mis"><a href="#n759">759</a></p>
<p id="n760" class="stm mis"><a href="#n760">760</a></p>
<p id="n761" class="pln"><a href="#n761">761</a></p>
<p id="n762" class="stm mis"><a href="#n762">762</a></p>
<p id="n763" class="stm mis"><a href="#n763">763</a></p>
<p id="n764" class="pln"><a href="#n764">764</a></p>
<p id="n765" class="stm mis"><a href="#n765">765</a></p>
<p id="n766" class="stm mis"><a href="#n766">766</a></p>
<p id="n767" class="stm mis"><a href="#n767">767</a></p>
<p id="n768" class="pln"><a href="#n768">768</a></p>
<p id="n769" class="pln"><a href="#n769">769</a></p>
<p id="n770" class="stm mis"><a href="#n770">770</a></p>
<p id="n771" class="stm mis"><a href="#n771">771</a></p>
<p id="n772" class="stm mis"><a href="#n772">772</a></p>
<p id="n773" class="stm mis"><a href="#n773">773</a></p>
<p id="n774" class="stm mis"><a href="#n774">774</a></p>
<p id="n775" class="stm mis"><a href="#n775">775</a></p>
<p id="n776" class="stm mis"><a href="#n776">776</a></p>
<p id="n777" class="stm mis"><a href="#n777">777</a></p>
<p id="n778" class="stm mis"><a href="#n778">778</a></p>
<p id="n779" class="stm mis"><a href="#n779">779</a></p>
<p id="n780" class="pln"><a href="#n780">780</a></p>
<p id="n781" class="stm mis"><a href="#n781">781</a></p>
<p id="n782" class="stm mis"><a href="#n782">782</a></p>
<p id="n783" class="pln"><a href="#n783">783</a></p>
<p id="n784" class="stm mis"><a href="#n784">784</a></p>
<p id="n785" class="pln"><a href="#n785">785</a></p>
<p id="n786" class="stm mis"><a href="#n786">786</a></p>
<p id="n787" class="stm mis"><a href="#n787">787</a></p>
<p id="n788" class="stm mis"><a href="#n788">788</a></p>
<p id="n789" class="stm mis"><a href="#n789">789</a></p>
<p id="n790" class="pln"><a href="#n790">790</a></p>
<p id="n791" class="stm mis"><a href="#n791">791</a></p>
<p id="n792" class="stm mis"><a href="#n792">792</a></p>
<p id="n793" class="stm mis"><a href="#n793">793</a></p>
<p id="n794" class="stm mis"><a href="#n794">794</a></p>
<p id="n795" class="stm mis"><a href="#n795">795</a></p>
<p id="n796" class="pln"><a href="#n796">796</a></p>
<p id="n797" class="stm mis"><a href="#n797">797</a></p>
<p id="n798" class="stm mis"><a href="#n798">798</a></p>
<p id="n799" class="pln"><a href="#n799">799</a></p>
<p id="n800" class="pln"><a href="#n800">800</a></p>
<p id="n801" class="stm mis"><a href="#n801">801</a></p>
<p id="n802" class="stm mis"><a href="#n802">802</a></p>
<p id="n803" class="stm mis"><a href="#n803">803</a></p>
<p id="n804" class="pln"><a href="#n804">804</a></p>
<p id="n805" class="pln"><a href="#n805">805</a></p>
<p id="n806" class="stm mis"><a href="#n806">806</a></p>
<p id="n807" class="stm mis"><a href="#n807">807</a></p>
<p id="n808" class="pln"><a href="#n808">808</a></p>
<p id="n809" class="pln"><a href="#n809">809</a></p>
<p id="n810" class="pln"><a href="#n810">810</a></p>
<p id="n811" class="pln"><a href="#n811">811</a></p>
<p id="n812" class="pln"><a href="#n812">812</a></p>
<p id="n813" class="pln"><a href="#n813">813</a></p>
<p id="n814" class="stm mis"><a href="#n814">814</a></p>
<p id="n815" class="stm mis"><a href="#n815">815</a></p>
<p id="n816" class="pln"><a href="#n816">816</a></p>
<p id="n817" class="pln"><a href="#n817">817</a></p>
<p id="n818" class="pln"><a href="#n818">818</a></p>
<p id="n819" class="stm mis"><a href="#n819">819</a></p>
<p id="n820" class="stm mis"><a href="#n820">820</a></p>
<p id="n821" class="pln"><a href="#n821">821</a></p>
<p id="n822" class="pln"><a href="#n822">822</a></p>
<p id="n823" class="pln"><a href="#n823">823</a></p>
<p id="n824" class="stm mis"><a href="#n824">824</a></p>
<p id="n825" class="stm mis"><a href="#n825">825</a></p>
<p id="n826" class="stm mis"><a href="#n826">826</a></p>
<p id="n827" class="pln"><a href="#n827">827</a></p>
<p id="n828" class="pln"><a href="#n828">828</a></p>
<p id="n829" class="stm mis"><a href="#n829">829</a></p>
<p id="n830" class="stm mis"><a href="#n830">830</a></p>
<p id="n831" class="pln"><a href="#n831">831</a></p>
<p id="n832" class="stm mis"><a href="#n832">832</a></p>
<p id="n833" class="stm mis"><a href="#n833">833</a></p>
<p id="n834" class="pln"><a href="#n834">834</a></p>
<p id="n835" class="stm mis"><a href="#n835">835</a></p>
<p id="n836" class="stm mis"><a href="#n836">836</a></p>
<p id="n837" class="stm mis"><a href="#n837">837</a></p>
<p id="n838" class="pln"><a href="#n838">838</a></p>
<p id="n839" class="pln"><a href="#n839">839</a></p>
<p id="n840" class="pln"><a href="#n840">840</a></p>
<p id="n841" class="pln"><a href="#n841">841</a></p>
<p id="n842" class="stm mis"><a href="#n842">842</a></p>
<p id="n843" class="stm mis"><a href="#n843">843</a></p>
<p id="n844" class="pln"><a href="#n844">844</a></p>
<p id="n845" class="stm mis"><a href="#n845">845</a></p>
<p id="n846" class="stm mis"><a href="#n846">846</a></p>
<p id="n847" class="stm mis"><a href="#n847">847</a></p>
<p id="n848" class="stm mis"><a href="#n848">848</a></p>
<p id="n849" class="stm mis"><a href="#n849">849</a></p>
<p id="n850" class="stm mis"><a href="#n850">850</a></p>
<p id="n851" class="pln"><a href="#n851">851</a></p>
<p id="n852" class="stm mis"><a href="#n852">852</a></p>
<p id="n853" class="stm mis"><a href="#n853">853</a></p>
<p id="n854" class="stm mis"><a href="#n854">854</a></p>
<p id="n855" class="stm mis"><a href="#n855">855</a></p>
<p id="n856" class="pln"><a href="#n856">856</a></p>
<p id="n857" class="stm mis"><a href="#n857">857</a></p>
<p id="n858" class="stm mis"><a href="#n858">858</a></p>
<p id="n859" class="stm mis"><a href="#n859">859</a></p>
<p id="n860" class="pln"><a href="#n860">860</a></p>
<p id="n861" class="pln"><a href="#n861">861</a></p>
<p id="n862" class="pln"><a href="#n862">862</a></p>
<p id="n863" class="pln"><a href="#n863">863</a></p>
<p id="n864" class="pln"><a href="#n864">864</a></p>
<p id="n865" class="stm mis"><a href="#n865">865</a></p>
<p id="n866" class="stm mis"><a href="#n866">866</a></p>
<p id="n867" class="pln"><a href="#n867">867</a></p>
<p id="n868" class="pln"><a href="#n868">868</a></p>
<p id="n869" class="pln"><a href="#n869">869</a></p>
<p id="n870" class="pln"><a href="#n870">870</a></p>
<p id="n871" class="pln"><a href="#n871">871</a></p>
<p id="n872" class="stm mis"><a href="#n872">872</a></p>
<p id="n873" class="stm mis"><a href="#n873">873</a></p>
<p id="n874" class="stm mis"><a href="#n874">874</a></p>
<p id="n875" class="pln"><a href="#n875">875</a></p>
<p id="n876" class="pln"><a href="#n876">876</a></p>
<p id="n877" class="stm mis"><a href="#n877">877</a></p>
<p id="n878" class="stm mis"><a href="#n878">878</a></p>
<p id="n879" class="pln"><a href="#n879">879</a></p>
<p id="n880" class="stm mis"><a href="#n880">880</a></p>
<p id="n881" class="pln"><a href="#n881">881</a></p>
<p id="n882" class="stm mis"><a href="#n882">882</a></p>
<p id="n883" class="pln"><a href="#n883">883</a></p>
<p id="n884" class="stm mis"><a href="#n884">884</a></p>
<p id="n885" class="pln"><a href="#n885">885</a></p>
<p id="n886" class="pln"><a href="#n886">886</a></p>
<p id="n887" class="pln"><a href="#n887">887</a></p>
<p id="n888" class="stm mis"><a href="#n888">888</a></p>
<p id="n889" class="stm mis"><a href="#n889">889</a></p>
<p id="n890" class="stm mis"><a href="#n890">890</a></p>
<p id="n891" class="pln"><a href="#n891">891</a></p>
<p id="n892" class="stm mis"><a href="#n892">892</a></p>
<p id="n893" class="stm mis"><a href="#n893">893</a></p>
<p id="n894" class="pln"><a href="#n894">894</a></p>
<p id="n895" class="pln"><a href="#n895">895</a></p>
<p id="n896" class="pln"><a href="#n896">896</a></p>
<p id="n897" class="stm mis"><a href="#n897">897</a></p>
<p id="n898" class="pln"><a href="#n898">898</a></p>
<p id="n899" class="stm mis"><a href="#n899">899</a></p>
<p id="n900" class="pln"><a href="#n900">900</a></p>
<p id="n901" class="pln"><a href="#n901">901</a></p>
<p id="n902" class="pln"><a href="#n902">902</a></p>
<p id="n903" class="pln"><a href="#n903">903</a></p>
<p id="n904" class="pln"><a href="#n904">904</a></p>
<p id="n905" class="pln"><a href="#n905">905</a></p>
<p id="n906" class="pln"><a href="#n906">906</a></p>
<p id="n907" class="pln"><a href="#n907">907</a></p>
<p id="n908" class="pln"><a href="#n908">908</a></p>
<p id="n909" class="pln"><a href="#n909">909</a></p>
<p id="n910" class="pln"><a href="#n910">910</a></p>
<p id="n911" class="stm mis"><a href="#n911">911</a></p>
<p id="n912" class="pln"><a href="#n912">912</a></p>
<p id="n913" class="stm mis"><a href="#n913">913</a></p>
<p id="n914" class="stm mis"><a href="#n914">914</a></p>
<p id="n915" class="pln"><a href="#n915">915</a></p>
<p id="n916" class="pln"><a href="#n916">916</a></p>
<p id="n917" class="pln"><a href="#n917">917</a></p>
<p id="n918" class="stm mis"><a href="#n918">918</a></p>
<p id="n919" class="pln"><a href="#n919">919</a></p>
<p id="n920" class="stm mis"><a href="#n920">920</a></p>
<p id="n921" class="pln"><a href="#n921">921</a></p>
<p id="n922" class="pln"><a href="#n922">922</a></p>
<p id="n923" class="pln"><a href="#n923">923</a></p>
<p id="n924" class="pln"><a href="#n924">924</a></p>
<p id="n925" class="pln"><a href="#n925">925</a></p>
<p id="n926" class="pln"><a href="#n926">926</a></p>
<p id="n927" class="pln"><a href="#n927">927</a></p>
<p id="n928" class="pln"><a href="#n928">928</a></p>
<p id="n929" class="pln"><a href="#n929">929</a></p>
<p id="n930" class="pln"><a href="#n930">930</a></p>
<p id="n931" class="pln"><a href="#n931">931</a></p>
<p id="n932" class="stm mis"><a href="#n932">932</a></p>
<p id="n933" class="stm mis"><a href="#n933">933</a></p>
<p id="n934" class="pln"><a href="#n934">934</a></p>
<p id="n935" class="pln"><a href="#n935">935</a></p>
<p id="n936" class="stm mis"><a href="#n936">936</a></p>
<p id="n937" class="pln"><a href="#n937">937</a></p>
<p id="n938" class="stm mis"><a href="#n938">938</a></p>
<p id="n939" class="stm mis"><a href="#n939">939</a></p>
<p id="n940" class="stm mis"><a href="#n940">940</a></p>
<p id="n941" class="stm mis"><a href="#n941">941</a></p>
<p id="n942" class="pln"><a href="#n942">942</a></p>
<p id="n943" class="pln"><a href="#n943">943</a></p>
<p id="n944" class="pln"><a href="#n944">944</a></p>
<p id="n945" class="pln"><a href="#n945">945</a></p>
<p id="n946" class="stm mis"><a href="#n946">946</a></p>
<p id="n947" class="pln"><a href="#n947">947</a></p>
<p id="n948" class="pln"><a href="#n948">948</a></p>
<p id="n949" class="pln"><a href="#n949">949</a></p>
<p id="n950" class="pln"><a href="#n950">950</a></p>
<p id="n951" class="pln"><a href="#n951">951</a></p>
<p id="n952" class="stm mis"><a href="#n952">952</a></p>
<p id="n953" class="stm mis"><a href="#n953">953</a></p>
<p id="n954" class="stm mis"><a href="#n954">954</a></p>
<p id="n955" class="stm mis"><a href="#n955">955</a></p>
<p id="n956" class="stm mis"><a href="#n956">956</a></p>
<p id="n957" class="pln"><a href="#n957">957</a></p>
<p id="n958" class="stm mis"><a href="#n958">958</a></p>
<p id="n959" class="stm mis"><a href="#n959">959</a></p>
<p id="n960" class="stm mis"><a href="#n960">960</a></p>
<p id="n961" class="stm mis"><a href="#n961">961</a></p>
<p id="n962" class="stm mis"><a href="#n962">962</a></p>
<p id="n963" class="stm mis"><a href="#n963">963</a></p>
<p id="n964" class="stm mis"><a href="#n964">964</a></p>
<p id="n965" class="stm mis"><a href="#n965">965</a></p>
<p id="n966" class="stm mis"><a href="#n966">966</a></p>
<p id="n967" class="stm mis"><a href="#n967">967</a></p>
<p id="n968" class="stm mis"><a href="#n968">968</a></p>
<p id="n969" class="stm mis"><a href="#n969">969</a></p>
<p id="n970" class="stm mis"><a href="#n970">970</a></p>
<p id="n971" class="stm mis"><a href="#n971">971</a></p>
<p id="n972" class="stm mis"><a href="#n972">972</a></p>
<p id="n973" class="stm mis"><a href="#n973">973</a></p>
<p id="n974" class="stm mis"><a href="#n974">974</a></p>
<p id="n975" class="pln"><a href="#n975">975</a></p>
<p id="n976" class="stm mis"><a href="#n976">976</a></p>
<p id="n977" class="stm mis"><a href="#n977">977</a></p>
<p id="n978" class="stm mis"><a href="#n978">978</a></p>
<p id="n979" class="stm mis"><a href="#n979">979</a></p>
<p id="n980" class="stm mis"><a href="#n980">980</a></p>
<p id="n981" class="stm mis"><a href="#n981">981</a></p>
<p id="n982" class="pln"><a href="#n982">982</a></p>
<p id="n983" class="stm mis"><a href="#n983">983</a></p>
<p id="n984" class="stm mis"><a href="#n984">984</a></p>
<p id="n985" class="stm mis"><a href="#n985">985</a></p>
<p id="n986" class="pln"><a href="#n986">986</a></p>
<p id="n987" class="pln"><a href="#n987">987</a></p>
<p id="n988" class="pln"><a href="#n988">988</a></p>
<p id="n989" class="pln"><a href="#n989">989</a></p>
<p id="n990" class="stm mis"><a href="#n990">990</a></p>
<p id="n991" class="stm mis"><a href="#n991">991</a></p>
<p id="n992" class="stm mis"><a href="#n992">992</a></p>
<p id="n993" class="stm mis"><a href="#n993">993</a></p>
<p id="n994" class="stm mis"><a href="#n994">994</a></p>
<p id="n995" class="stm mis"><a href="#n995">995</a></p>
<p id="n996" class="pln"><a href="#n996">996</a></p>
<p id="n997" class="stm mis"><a href="#n997">997</a></p>
<p id="n998" class="stm mis"><a href="#n998">998</a></p>
<p id="n999" class="stm mis"><a href="#n999">999</a></p>
<p id="n1000" class="stm mis"><a href="#n1000">1000</a></p>
<p id="n1001" class="pln"><a href="#n1001">1001</a></p>
<p id="n1002" class="pln"><a href="#n1002">1002</a></p>
<p id="n1003" class="stm mis"><a href="#n1003">1003</a></p>
<p id="n1004" class="stm mis"><a href="#n1004">1004</a></p>
<p id="n1005" class="pln"><a href="#n1005">1005</a></p>
<p id="n1006" class="pln"><a href="#n1006">1006</a></p>
<p id="n1007" class="stm mis"><a href="#n1007">1007</a></p>
<p id="n1008" class="pln"><a href="#n1008">1008</a></p>
<p id="n1009" class="pln"><a href="#n1009">1009</a></p>
<p id="n1010" class="stm mis"><a href="#n1010">1010</a></p>
<p id="n1011" class="stm mis"><a href="#n1011">1011</a></p>
<p id="n1012" class="stm mis"><a href="#n1012">1012</a></p>
<p id="n1013" class="pln"><a href="#n1013">1013</a></p>
<p id="n1014" class="pln"><a href="#n1014">1014</a></p>
<p id="n1015" class="stm mis"><a href="#n1015">1015</a></p>
<p id="n1016" class="stm mis"><a href="#n1016">1016</a></p>
<p id="n1017" class="pln"><a href="#n1017">1017</a></p>
<p id="n1018" class="stm mis"><a href="#n1018">1018</a></p>
<p id="n1019" class="stm mis"><a href="#n1019">1019</a></p>
<p id="n1020" class="stm mis"><a href="#n1020">1020</a></p>
<p id="n1021" class="stm mis"><a href="#n1021">1021</a></p>
<p id="n1022" class="stm mis"><a href="#n1022">1022</a></p>
<p id="n1023" class="stm mis"><a href="#n1023">1023</a></p>
<p id="n1024" class="pln"><a href="#n1024">1024</a></p>
<p id="n1025" class="stm mis"><a href="#n1025">1025</a></p>
<p id="n1026" class="stm mis"><a href="#n1026">1026</a></p>
<p id="n1027" class="stm mis"><a href="#n1027">1027</a></p>
<p id="n1028" class="pln"><a href="#n1028">1028</a></p>
<p id="n1029" class="stm mis"><a href="#n1029">1029</a></p>
<p id="n1030" class="stm mis"><a href="#n1030">1030</a></p>
<p id="n1031" class="stm mis"><a href="#n1031">1031</a></p>
<p id="n1032" class="stm mis"><a href="#n1032">1032</a></p>
<p id="n1033" class="pln"><a href="#n1033">1033</a></p>
<p id="n1034" class="stm mis"><a href="#n1034">1034</a></p>
<p id="n1035" class="pln"><a href="#n1035">1035</a></p>
<p id="n1036" class="stm mis"><a href="#n1036">1036</a></p>
<p id="n1037" class="stm mis"><a href="#n1037">1037</a></p>
<p id="n1038" class="stm mis"><a href="#n1038">1038</a></p>
<p id="n1039" class="stm mis"><a href="#n1039">1039</a></p>
<p id="n1040" class="stm mis"><a href="#n1040">1040</a></p>
<p id="n1041" class="stm mis"><a href="#n1041">1041</a></p>
<p id="n1042" class="stm mis"><a href="#n1042">1042</a></p>
<p id="n1043" class="stm mis"><a href="#n1043">1043</a></p>
<p id="n1044" class="stm mis"><a href="#n1044">1044</a></p>
<p id="n1045" class="pln"><a href="#n1045">1045</a></p>
<p id="n1046" class="stm mis"><a href="#n1046">1046</a></p>
<p id="n1047" class="stm mis"><a href="#n1047">1047</a></p>
<p id="n1048" class="pln"><a href="#n1048">1048</a></p>
<p id="n1049" class="stm mis"><a href="#n1049">1049</a></p>
<p id="n1050" class="pln"><a href="#n1050">1050</a></p>
<p id="n1051" class="pln"><a href="#n1051">1051</a></p>
<p id="n1052" class="pln"><a href="#n1052">1052</a></p>
<p id="n1053" class="pln"><a href="#n1053">1053</a></p>
<p id="n1054" class="stm mis"><a href="#n1054">1054</a></p>
<p id="n1055" class="stm mis"><a href="#n1055">1055</a></p>
<p id="n1056" class="stm mis"><a href="#n1056">1056</a></p>
<p id="n1057" class="stm mis"><a href="#n1057">1057</a></p>
<p id="n1058" class="stm mis"><a href="#n1058">1058</a></p>
<p id="n1059" class="stm mis"><a href="#n1059">1059</a></p>
<p id="n1060" class="pln"><a href="#n1060">1060</a></p>
<p id="n1061" class="stm mis"><a href="#n1061">1061</a></p>
<p id="n1062" class="stm mis"><a href="#n1062">1062</a></p>
<p id="n1063" class="stm mis"><a href="#n1063">1063</a></p>
<p id="n1064" class="stm mis"><a href="#n1064">1064</a></p>
<p id="n1065" class="pln"><a href="#n1065">1065</a></p>
<p id="n1066" class="pln"><a href="#n1066">1066</a></p>
<p id="n1067" class="stm mis"><a href="#n1067">1067</a></p>
<p id="n1068" class="stm mis"><a href="#n1068">1068</a></p>
<p id="n1069" class="pln"><a href="#n1069">1069</a></p>
<p id="n1070" class="pln"><a href="#n1070">1070</a></p>
<p id="n1071" class="stm mis"><a href="#n1071">1071</a></p>
<p id="n1072" class="pln"><a href="#n1072">1072</a></p>
<p id="n1073" class="pln"><a href="#n1073">1073</a></p>
<p id="n1074" class="stm mis"><a href="#n1074">1074</a></p>
<p id="n1075" class="stm mis"><a href="#n1075">1075</a></p>
<p id="n1076" class="stm mis"><a href="#n1076">1076</a></p>
<p id="n1077" class="pln"><a href="#n1077">1077</a></p>
<p id="n1078" class="pln"><a href="#n1078">1078</a></p>
<p id="n1079" class="pln"><a href="#n1079">1079</a></p>
<p id="n1080" class="stm mis"><a href="#n1080">1080</a></p>
<p id="n1081" class="stm mis"><a href="#n1081">1081</a></p>
<p id="n1082" class="stm mis"><a href="#n1082">1082</a></p>
<p id="n1083" class="stm mis"><a href="#n1083">1083</a></p>
<p id="n1084" class="stm mis"><a href="#n1084">1084</a></p>
<p id="n1085" class="stm mis"><a href="#n1085">1085</a></p>
<p id="n1086" class="pln"><a href="#n1086">1086</a></p>
<p id="n1087" class="stm mis"><a href="#n1087">1087</a></p>
<p id="n1088" class="stm mis"><a href="#n1088">1088</a></p>
<p id="n1089" class="pln"><a href="#n1089">1089</a></p>
<p id="n1090" class="stm mis"><a href="#n1090">1090</a></p>
<p id="n1091" class="stm mis"><a href="#n1091">1091</a></p>
<p id="n1092" class="stm mis"><a href="#n1092">1092</a></p>
<p id="n1093" class="stm mis"><a href="#n1093">1093</a></p>
<p id="n1094" class="pln"><a href="#n1094">1094</a></p>
<p id="n1095" class="stm mis"><a href="#n1095">1095</a></p>
<p id="n1096" class="pln"><a href="#n1096">1096</a></p>
<p id="n1097" class="stm mis"><a href="#n1097">1097</a></p>
<p id="n1098" class="stm mis"><a href="#n1098">1098</a></p>
<p id="n1099" class="stm mis"><a href="#n1099">1099</a></p>
<p id="n1100" class="stm mis"><a href="#n1100">1100</a></p>
<p id="n1101" class="stm mis"><a href="#n1101">1101</a></p>
<p id="n1102" class="stm mis"><a href="#n1102">1102</a></p>
<p id="n1103" class="stm mis"><a href="#n1103">1103</a></p>
<p id="n1104" class="stm mis"><a href="#n1104">1104</a></p>
<p id="n1105" class="stm mis"><a href="#n1105">1105</a></p>
<p id="n1106" class="pln"><a href="#n1106">1106</a></p>
<p id="n1107" class="stm mis"><a href="#n1107">1107</a></p>
<p id="n1108" class="stm mis"><a href="#n1108">1108</a></p>
<p id="n1109" class="pln"><a href="#n1109">1109</a></p>
<p id="n1110" class="stm mis"><a href="#n1110">1110</a></p>
<p id="n1111" class="stm mis"><a href="#n1111">1111</a></p>
<p id="n1112" class="pln"><a href="#n1112">1112</a></p>
<p id="n1113" class="stm mis"><a href="#n1113">1113</a></p>
<p id="n1114" class="pln"><a href="#n1114">1114</a></p>
<p id="n1115" class="stm mis"><a href="#n1115">1115</a></p>
<p id="n1116" class="stm mis"><a href="#n1116">1116</a></p>
<p id="n1117" class="pln"><a href="#n1117">1117</a></p>
<p id="n1118" class="pln"><a href="#n1118">1118</a></p>
<p id="n1119" class="pln"><a href="#n1119">1119</a></p>
<p id="n1120" class="pln"><a href="#n1120">1120</a></p>
<p id="n1121" class="stm mis"><a href="#n1121">1121</a></p>
<p id="n1122" class="stm mis"><a href="#n1122">1122</a></p>
<p id="n1123" class="stm mis"><a href="#n1123">1123</a></p>
<p id="n1124" class="pln"><a href="#n1124">1124</a></p>
<p id="n1125" class="pln"><a href="#n1125">1125</a></p>
<p id="n1126" class="stm mis"><a href="#n1126">1126</a></p>
<p id="n1127" class="stm mis"><a href="#n1127">1127</a></p>
<p id="n1128" class="pln"><a href="#n1128">1128</a></p>
<p id="n1129" class="pln"><a href="#n1129">1129</a></p>
<p id="n1130" class="pln"><a href="#n1130">1130</a></p>
<p id="n1131" class="stm mis"><a href="#n1131">1131</a></p>
<p id="n1132" class="pln"><a href="#n1132">1132</a></p>
<p id="n1133" class="pln"><a href="#n1133">1133</a></p>
<p id="n1134" class="pln"><a href="#n1134">1134</a></p>
<p id="n1135" class="pln"><a href="#n1135">1135</a></p>
<p id="n1136" class="pln"><a href="#n1136">1136</a></p>
<p id="n1137" class="pln"><a href="#n1137">1137</a></p>
<p id="n1138" class="pln"><a href="#n1138">1138</a></p>
<p id="n1139" class="pln"><a href="#n1139">1139</a></p>
<p id="n1140" class="pln"><a href="#n1140">1140</a></p>
<p id="n1141" class="stm mis"><a href="#n1141">1141</a></p>
<p id="n1142" class="stm mis"><a href="#n1142">1142</a></p>
<p id="n1143" class="stm mis"><a href="#n1143">1143</a></p>
<p id="n1144" class="pln"><a href="#n1144">1144</a></p>
<p id="n1145" class="pln"><a href="#n1145">1145</a></p>
<p id="n1146" class="stm mis"><a href="#n1146">1146</a></p>
<p id="n1147" class="stm mis"><a href="#n1147">1147</a></p>
<p id="n1148" class="stm mis"><a href="#n1148">1148</a></p>
<p id="n1149" class="stm mis"><a href="#n1149">1149</a></p>
<p id="n1150" class="pln"><a href="#n1150">1150</a></p>
<p id="n1151" class="pln"><a href="#n1151">1151</a></p>
<p id="n1152" class="pln"><a href="#n1152">1152</a></p>
<p id="n1153" class="stm mis"><a href="#n1153">1153</a></p>
<p id="n1154" class="pln"><a href="#n1154">1154</a></p>
<p id="n1155" class="pln"><a href="#n1155">1155</a></p>
<p id="n1156" class="pln"><a href="#n1156">1156</a></p>
<p id="n1157" class="pln"><a href="#n1157">1157</a></p>
<p id="n1158" class="pln"><a href="#n1158">1158</a></p>
<p id="n1159" class="pln"><a href="#n1159">1159</a></p>
<p id="n1160" class="pln"><a href="#n1160">1160</a></p>
<p id="n1161" class="pln"><a href="#n1161">1161</a></p>
<p id="n1162" class="pln"><a href="#n1162">1162</a></p>
<p id="n1163" class="pln"><a href="#n1163">1163</a></p>
<p id="n1164" class="pln"><a href="#n1164">1164</a></p>
<p id="n1165" class="pln"><a href="#n1165">1165</a></p>
<p id="n1166" class="pln"><a href="#n1166">1166</a></p>
<p id="n1167" class="pln"><a href="#n1167">1167</a></p>
<p id="n1168" class="pln"><a href="#n1168">1168</a></p>
<p id="n1169" class="stm mis"><a href="#n1169">1169</a></p>
<p id="n1170" class="pln"><a href="#n1170">1170</a></p>
<p id="n1171" class="stm mis"><a href="#n1171">1171</a></p>
<p id="n1172" class="pln"><a href="#n1172">1172</a></p>
<p id="n1173" class="pln"><a href="#n1173">1173</a></p>
<p id="n1174" class="pln"><a href="#n1174">1174</a></p>
<p id="n1175" class="pln"><a href="#n1175">1175</a></p>
<p id="n1176" class="pln"><a href="#n1176">1176</a></p>
<p id="n1177" class="pln"><a href="#n1177">1177</a></p>
<p id="n1178" class="pln"><a href="#n1178">1178</a></p>
<p id="n1179" class="stm mis"><a href="#n1179">1179</a></p>
<p id="n1180" class="pln"><a href="#n1180">1180</a></p>
<p id="n1181" class="pln"><a href="#n1181">1181</a></p>
<p id="n1182" class="stm mis"><a href="#n1182">1182</a></p>
<p id="n1183" class="stm mis"><a href="#n1183">1183</a></p>
<p id="n1184" class="pln"><a href="#n1184">1184</a></p>
<p id="n1185" class="stm mis"><a href="#n1185">1185</a></p>
<p id="n1186" class="pln"><a href="#n1186">1186</a></p>
<p id="n1187" class="pln"><a href="#n1187">1187</a></p>
<p id="n1188" class="stm mis"><a href="#n1188">1188</a></p>
<p id="n1189" class="stm mis"><a href="#n1189">1189</a></p>
<p id="n1190" class="stm mis"><a href="#n1190">1190</a></p>
<p id="n1191" class="pln"><a href="#n1191">1191</a></p>
<p id="n1192" class="stm mis"><a href="#n1192">1192</a></p>
<p id="n1193" class="pln"><a href="#n1193">1193</a></p>
<p id="n1194" class="stm mis"><a href="#n1194">1194</a></p>
<p id="n1195" class="stm mis"><a href="#n1195">1195</a></p>
                
            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com">#!/usr/bin/env python</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="stm mis"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">print_function</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="com"># Author: Steve Ludtke 06/10/2013 (sludtke@bcm.edu)</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="com"># Copyright (c) 2013- Baylor College of Medicine</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="com"># This software is issued under a joint BSD/GNU license. You may use the</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="pln"><span class="com"># source code in this file under either license. However, note that the</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="com"># complete EMAN2 and SPARX software packages have some GPL dependencies,</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="com"># so you are responsible for compliance with the licenses of these packages</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="com"># if you opt to use BSD licensing. The warranty disclaimer below holds</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="com"># in either instance.</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="com"># This complete copyright notice must be included in any revised version of the</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="com"># source code. Additional authorship citations may be added, but existing</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln"><span class="com"># author citations must be preserved.</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln"><span class="com"># This program is free software; you can redistribute it and/or modify</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="pln"><span class="com"># it under the terms of the GNU General Public License as published by</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="pln"><span class="com"># the Free Software Foundation; either version 2 of the License, or</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="pln"><span class="com"># (at your option) any later version.</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="pln"><span class="com"># This program is distributed in the hope that it will be useful,</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="com"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="com"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="com"># GNU General Public License for more details.</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="com"># You should have received a copy of the GNU General Public License</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="com"># along with this program; if not, write to the Free Software</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="pln"><span class="com"># Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA&nbsp; 2111-1307 USA</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t35" class="stm mis"><span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">import</span> <span class="nam">matplotlib</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">matplotlib</span><span class="op">.</span><span class="nam">use</span><span class="op">(</span><span class="str">&quot;AGG&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">import</span> <span class="nam">matplotlib</span><span class="op">.</span><span class="nam">pyplot</span> <span class="key">as</span> <span class="nam">plt</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">pltcolors</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;k&quot;</span><span class="op">,</span><span class="str">&quot;b&quot;</span><span class="op">,</span><span class="str">&quot;g&quot;</span><span class="op">,</span><span class="str">&quot;r&quot;</span><span class="op">,</span><span class="str">&quot;m&quot;</span><span class="op">,</span><span class="str">&quot;c&quot;</span><span class="op">,</span><span class="str">&quot;darkblue&quot;</span><span class="op">,</span><span class="str">&quot;darkgreen&quot;</span><span class="op">,</span><span class="str">&quot;darkred&quot;</span><span class="op">,</span><span class="str">&quot;darkmagenta&quot;</span><span class="op">,</span><span class="str">&quot;darkcyan&quot;</span><span class="op">,</span><span class="str">&quot;0.5&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t40" class="stm mis"><span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t41" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Matplotlib not available, some output will not be generated&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t43" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t44" class="stm mis"><span class="key">from</span> <span class="nam">EMAN2</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="stm mis"><span class="key">from</span> <span class="nam">optparse</span> <span class="key">import</span> <span class="nam">OptionParser</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="stm mis"><span class="key">from</span> <span class="nam">math</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="stm mis"><span class="key">import</span> <span class="nam">os</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="stm mis"><span class="key">import</span> <span class="nam">sys</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="stm mis"><span class="key">import</span> <span class="nam">time</span><span class="strut">&nbsp;</span></p>
<p id="t50" class="stm mis"><span class="key">import</span> <span class="nam">traceback</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="stm mis"><span class="key">import</span> <span class="nam">numpy</span> <span class="key">as</span> <span class="nam">np</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t53" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln"><span class="com"># This is used to build the HTML status file. It&#39;s a global for convenience</span><span class="strut">&nbsp;</span></p>
<p id="t55" class="stm mis"><span class="nam">output_html</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t56" class="stm mis"><span class="nam">output_html_com</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="stm mis"><span class="nam">output_path</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t59" class="stm mis"><span class="key">def</span> <span class="nam">append_html</span><span class="op">(</span><span class="nam">msg</span><span class="op">,</span><span class="nam">com</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">global</span> <span class="nam">output_html</span><span class="op">,</span><span class="nam">output_html_com</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">com</span> <span class="op">:</span> <span class="nam">output_html_com</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t62" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">output_html</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">msg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t63" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">write_html</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t65" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t66" class="stm mis"><span class="key">def</span> <span class="nam">write_html</span><span class="op">(</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">global</span> <span class="nam">output_html</span><span class="op">,</span><span class="nam">output_html_com</span><span class="op">,</span><span class="nam">output_path</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">=</span><span class="nam">open</span><span class="op">(</span><span class="nam">output_path</span><span class="op">+</span><span class="str">&quot;/index.html&quot;</span><span class="op">,</span><span class="str">&quot;w&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t69" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;&lt;html&gt;&lt;head&gt;&lt;title&gt;EMAN2 Refinement Overview&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;\n&quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">output_html</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;&lt;h2&gt;Detailed command log&lt;/h2&gt;\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t72" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;\n&quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">output_html_com</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;&lt;br&gt;&lt;/br&gt;&lt;hr&gt;&lt;/hr&gt;Generated by {ver} {date}\n&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ver</span><span class="op">=</span><span class="nam">EMANVERSION</span><span class="op">,</span><span class="nam">date</span><span class="op">=</span><span class="nam">DATESTAMP</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t74" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t75" class="stm mis"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progname</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t77" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">usage</span> <span class="op">=</span> <span class="str">&quot;&quot;&quot;e2refine_easy.py [options]</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t79" class="pln"><span class="str">========================================================================</span><span class="strut">&nbsp;</span></p>
<p id="t80" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; This is the primary single particle refinement program in EMAN2.1+. It replaces earlier programs such as e2refine.py</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="pln"><span class="str">and e2refine_evenodd.py. Major features of this program:</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t83" class="pln"><span class="str"> * While a range of command-line options still exist. You should not normally specify more than a few basic requirements. The rest will be auto-selected for you.</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="pln"><span class="str"> * This program will split your data in half and automatically refine the halves independently to produce a gold standard resolution curve for every step in the refinement.</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="pln"><span class="str"> * An HTML report file will be generated as this program runs, telling you exactly what it decided to do and why, as well as giving information about runtime, etc while the job is still running.</span><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln"><span class="str"> * The gold standard FSC also permits us to automatically filter the structure at each refinement step. The resolution you specify is a target, NOT the filter resolution.</span><span class="strut">&nbsp;</span></p>
<p id="t87" class="pln"><span class="str"> * If --inputavg is specified to use a different stack for alignment and averaging, both stacks must have the same box size and sampling</span><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln"><span class="str"> * Many of the &#39;advanced&#39; options are hidden in the e2projectmanager.py GUI, because most users should not need to specify them.</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t90" class="pln"><span class="str">To run this program, you would normally specify only the following options:</span><span class="strut">&nbsp;</span></p>
<p id="t91" class="pln"><span class="str">&nbsp; --model=&lt;starting map to seed refinement&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="pln"><span class="str">&nbsp; --input=&lt;lst file referencing phase-flipped particles in HDF format used for alignment&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="pln"><span class="str">&nbsp; --inputavg=&lt;optional lst file with particles to be reconstructed, if not specified --input used&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="pln"><span class="str">&nbsp; OR</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="pln"><span class="str">&nbsp; --startfrom=&lt;path to existing refine_xx directory to continue from&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t97" class="pln"><span class="str">&nbsp; --targetres=&lt;in A&gt;&nbsp; &nbsp;&nbsp; Resolution to target in Angstroms in this refinement run. Do not be overoptimistic !</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Generally begin with something conservative like 25, then use --startfrom and reduce</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; to ~12, only after that try for high (3-8 A). Data permitting, of course. Low resolution</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; attempts will run MUCH faster due to more efficient parameters.</span><span class="strut">&nbsp;</span></p>
<p id="t101" class="pln"><span class="str">&nbsp; --speed=&lt;1-7&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Default=5. Larger values will run faster but slightly decrease measured resolution. 7 may</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; be useful for initial refinement runs. 5 is good for routine refinement. You may consider 1</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; when all other possibilities are exhausted and you are ready to push for a final published map.</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This option modifies several parameters, including the angular step, sep= and even the</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; specific alignment and similarity metric options. The resolution difference between 1 and 7 is</span><span class="strut">&nbsp;</span></p>
<p id="t106" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; generally no more than 10%%.</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="pln"><span class="str">&nbsp; --sym=&lt;symmetry&gt;&nbsp; &nbsp; &nbsp;&nbsp; Symmetry to enforce during refinement (Cn, Dn, icos, oct, cub).</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Default=c1 (no symmetry)</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="pln"><span class="str">&nbsp; --mass=&lt;in kDa&gt;&nbsp; &nbsp; &nbsp; &nbsp; Putative mass of object in kDa, but as desired volume varies with resolution</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; actual number may vary by as much a ~2x from the true value. The goal is to</span><span class="strut">&nbsp;</span></p>
<p id="t111" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; have a good isosurface in the final map with a threshold of 1.0.</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="pln"><span class="str">&nbsp; --parallel=&lt;par spec&gt;&nbsp; While not strictly required, without this option the refinement will run on a single CPU</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; and you will likely wait a very long time. To use more than one core on a single computer,</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; just say thread:N (eg - thread:4). For other options, like MPI, see:</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; http://blake.bcm.edu/emanwiki/EMAN2/Parallel for details.</span><span class="strut">&nbsp;</span></p>
<p id="t116" class="pln"><span class="str">&nbsp; --threads=&lt;ncpu&gt;&nbsp; &nbsp; &nbsp;&nbsp; For some algorithms, processing in parallel over the network (MPI) works poorly.</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Running on multiple processors on a single machine may still be worthwhile. If you specify this</span><span class="strut">&nbsp;</span></p>
<p id="t118" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; option, in specific cases it will replace your specified --parallel option. Specify</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the number of cores that can be used on a single machine.</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t121" class="pln"><span class="str">&nbsp; Optional:</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="pln"><span class="str">&nbsp; --tophat=&lt;local,global&gt;&nbsp; Some other packages (Relion) apply a tophat filter to the final map which helps exaggerate</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; the apperance of sidechains at near atomic resolution, but can also cause some artifacts.</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &#39;local&#39; will produce a similar effect in the final map (but probably should be limited to</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; subnanometer resolution.</span><span class="strut">&nbsp;</span></p>
<p id="t126" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &#39;global&#39; uses a local resolution computation to locally filter the map. This can actually</span><span class="strut">&nbsp;</span></p>
<p id="t127" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; lead to better resolution (in the good domains). While new, this may be a good idea to</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; use in pretty much all refinements.</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; To disable tophat, don&#39;t specify it, or specify &quot;none&quot;.</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="pln"><span class="str">&nbsp; --nogoldfinal&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Normally used in conjunction with tophat=local. During a refinement, the even/odd maps may</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; diverge slightly if there is any structural variability in the maps. This will disable </span><span class="strut">&nbsp;</span></p>
<p id="t132" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; gold-standard refinement mode in the final iteration to produce a more accurate filter.</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; This may cause the FSC curve to be somewhat exxagerated as well, though.</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="pln"><span class="str">&nbsp; --apix=&lt;A/pix&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; The value will normally come from the particle data if present (set to -1). You can </span><span class="strut">&nbsp;</span></p>
<p id="t135" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; override if necessary.</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="pln"><span class="str">&nbsp; --sep=&lt;classes/ptcl&gt;&nbsp; &nbsp;&nbsp; each particle will be put into N classes. Improves contrast at cost of rotational blur.</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="pln"><span class="str">&nbsp; --classkeep=&lt;frac&gt;&nbsp; &nbsp; &nbsp;&nbsp; fraction of particles to use in final average. Default 90%%. Should be &gt;50%%</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="pln"><span class="str">&nbsp; --m3dkeep=&lt;frac&gt;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; fraction of class-averages to use in 3-D map. Default=auto</span><span class="strut">&nbsp;</span></p>
<p id="t139" class="pln"><span class="str">&nbsp; --classautomask&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; applies an automask when aligning particles for improved alignment</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="pln"><span class="str">&nbsp; --m3dpostprocess&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &lt;name&gt;:&lt;parm&gt;=&lt;value&gt;:...&nbsp; An arbitrary processor</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (e2help.py processors -v2) to apply to the 3-D map after each</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; iteration. Default=none</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="pln"><span class="str">&nbsp; --path=&lt;path&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Normally the new directory will be named automatically. If you prefer your own convention</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; you can override, but it may cause minor GUI problems if you break the standard naming</span><span class="strut">&nbsp;</span></p>
<p id="t145" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; convention.</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t147" class="pln"><span class="str">Since many parameters are now selected automatically, if you are curious exactly what the differences are between any</span><span class="strut">&nbsp;</span></p>
<p id="t148" class="pln"><span class="str">two refinements, on Linux/Mac, you can run, for example, diff refine_01/0_refine_parms.json refine_02/0_refine_parms.json</span><span class="strut">&nbsp;</span></p>
<p id="t149" class="pln"><span class="str">to compare exactly what changed between the two runs.</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t151" class="pln"><span class="str">========================================================================</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="pln"><span class="str">&nbsp; There are numerous additional options based on the original e2refine.py command. These options are not available from</span><span class="strut">&nbsp;</span></p>
<p id="t153" class="pln"><span class="str">the graphical interface, as it is generally best to let e2refine_easy pick these values for you. Normally you should</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="pln"><span class="str">not need to specify any of the following other than the ones already listed above:</span><span class="strut">&nbsp;</span></p>
<p id="t155" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln"><span class="str">&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span> <span class="op">=</span> <span class="nam">EMArgumentParser</span><span class="op">(</span><span class="nam">usage</span><span class="op">=</span><span class="nam">usage</span><span class="op">,</span><span class="nam">version</span><span class="op">=</span><span class="nam">EMANVERSION</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t159" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#options associated with e2refine.py</span><span class="strut">&nbsp;</span></p>
<p id="t160" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_header(name=&quot;multirefineheader&quot;, help=&#39;Options below this label are specific to e2refinemulti&#39;, title=&quot;### e2refinemulti options ###&quot;, row=1, col=0, rowspan=1, colspan=3, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_header(name=&quot;multimodelheader&quot;, help=&#39;Options below this label are specific to e2refinemulti Model&#39;, title=&quot;### e2refinemulti model options ###&quot;, row=4, col=0, rowspan=1, colspan=3, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--input&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;input&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Image stack containing phase-flipped particles used for alignment&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMSetsTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--inputavg&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;inputavg&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Optional file containing alternate version of the particles to use for reconstruction after alignment&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMSetsTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--model&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;model&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The map to use as a starting point for refinement&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMModelsTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t165" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;orblock&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&#39;Just a visual separation&#39;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;- OR -&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">5</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--startfrom&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Path to an existing refine_xx directory to continue refining from. Alternative to --input and --model.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;filebox&#39;</span><span class="op">,</span> <span class="nam">filecheck</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">browser</span><span class="op">=</span><span class="str">&#39;EMModelsTable(withmodal=True,multiselect=False)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">7</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--targetres&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">25.0</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Target resolution in A of this refinement run. Usually works best in at least two steps (low/medium resolution, then final resolution) when starting with a poor starting model. Usually 3-4 iterations is sufficient.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--speed&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">5</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;(1-7) Balances speed vs precision. Larger values sacrifice a bit of potential resolution for significant speed increases. Set to 1 when really pushing resolution. Set to 7 for initial refinements. default=5&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">16</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t169" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;required&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&#39;Just a visual separation&#39;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;Required:&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">9</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--sym&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;sym&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;c1&quot;</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Specify symmetry - choices are: c&lt;n&gt;, d&lt;n&gt;, tet, oct, icos.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;strbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--breaksym&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;If selected, reconstruction will be asymmetric with sym= specifying a known pseudosymmetry, not an imposed symmetry.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">11</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[False]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--tophat&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;&#39;local&#39; or &#39;global&#39;. Instead of imposing a final Wiener filter, use a tophat filter (global similar to Relion). local determines local resolution and filters. danger of feature exaggeration&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;strbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">11</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[&#39;None&#39;]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--nogoldfinal&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;If selected, the final iteration will turn off gold-standard behavior and both halves will be refined from the same model. Normally used with --tophat=local.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--treeclassify&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Classify using a binary tree.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dold&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Use the traditional e2make3d program instead of the new e2make3dpar program&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">11</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--iter&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;iter&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">6</span><span class="op">,</span> <span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;The total number of refinement iterations to perform. Default=auto&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">10</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--mass&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The ~mass of the particle in kilodaltons, used to run normalize.bymass. Due to resolution effects, not always the true mass.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">12</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[&#39;self.pm().getMass()&#39;]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_header</span><span class="op">(</span><span class="nam">name</span><span class="op">=</span><span class="str">&quot;optional&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&#39;Just a visual separation&#39;</span><span class="op">,</span> <span class="nam">title</span><span class="op">=</span><span class="str">&quot;Optional:&quot;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">14</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t179" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--bispec&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Will use bispectra for orientation determination (EXPERIMENTAL).&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--apix&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The angstrom per pixel of the input particles. Normally set to 0, which will read the value from the header of the input file&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">16</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[0]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--sep&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The number of classes each particle can contribute towards (normally 1). Increasing will improve SNR, but produce rotational blurring.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classkeep&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The fraction of particles to keep in each class, based on the similarity score. (default=0.9 -&gt; 90%%)&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0.9</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classautomask&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;This will apply an automask to the class-average during iterative alignment for better accuracy. The final class averages are unmasked.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">20</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t184" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--prethreshold&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Applies a threshold to the volume just before generating projections. A sort of aggressive solvent flattening for the reference.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">20</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--eulerrefine&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Refines Euler angles of class-averages before reconstruction&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t186" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dkeep&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The fraction of slices to keep in e2make3d.py. Default=0.8 -&gt; 80%%&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0.8</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;floatbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">18</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dpostprocess&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=none. An arbitrary post-processor to run after all other automatic processing. Maps are autofiltered, so a low-pass filter should not normally be used here.&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;comboparambox&#39;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&#39;re_filter_list(dump_processors_list(),&quot;filter.lowpass|filter.highpass|mask&quot;)&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">26</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">3</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--parallel&quot;</span><span class="op">,</span><span class="str">&quot;-P&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Run in parallel, specify type:&lt;option&gt;=&lt;value&gt;:&lt;option&gt;=&lt;value&gt;. See http://blake.bcm.edu/emanwiki/EMAN2/Parallel&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;strbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">30</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[thread:4]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--threads&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">1</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Number of threads to run in parallel on a single computer when multi-computer parallelism isn&#39;t useful&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">30</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[4]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t190" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--path&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;The name of a directory where results are placed. Default = create new refine_xx&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--verbose&quot;</span><span class="op">,</span> <span class="str">&quot;-v&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;verbose&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;verbose level [0-9], higner number means higher level of verboseness&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_argument(&quot;--usefilt&quot;, dest=&quot;usefilt&quot;, type=str,default=None, help=&quot;Specify a particle data file that has been low pass or Wiener filtered. Has a one to one correspondence with your particle data. If specified will be used in projection matching routines, and elsewhere.&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t193" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t194" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2project3d.py</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;projectheader&quot;, help=&#39;Options below this label are specific to e2project&#39;, title=&quot;### e2project options ###&quot;, row=12, col=0, rowspan=1, colspan=3)</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--automaskexpand&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=boxsize/20. Specify number of voxels to expand mask before soft edge. Use this if low density peripheral features are cut off by the mask.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;intbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">12</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[-1]&quot;</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t197" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--automask3d&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Specify as a processor, eg - mask.auto3d:threshold=1.1:radius=30:nshells=5:nshellsgauss=5.&quot;</span><span class="op">,</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t198" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--automask3d2&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=none. If specified, this mask will be multiplied by the result of the first mask, eg - using mask.soft to mask out the center of a virus.&quot;</span><span class="op">,</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--projector&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;projector&quot;</span><span class="op">,</span> <span class="nam">default</span> <span class="op">=</span> <span class="str">&quot;standard&quot;</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Default=standard. Projector to use with parameters.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--orientgen&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Default=auto. Orientation generator for projections, eg - eman:delta=5.0:inc_mirror=0:perturb=1&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t201" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t202" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2simmx.py</span><span class="strut">&nbsp;</span></p>
<p id="t203" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;simmxheader&quot;, help=&#39;Options below this label are specific to e2simmx&#39;, title=&quot;### e2simmx options ###&quot;, row=15, col=0, rowspan=1, colspan=3)</span><span class="strut">&nbsp;</span></p>
<p id="t204" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simalign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name of an &#39;aligner&#39; to use prior to comparing the images&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;rotate_translate_tree&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simaligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Name of the aligner along with its construction arguments&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simralign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name and parameters of the second stage aligner which refines the results of the first alignment&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;auto&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simraligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name and parameters of the comparitor used by the second stage aligner.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simcmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name of a &#39;cmp&#39; to be used in comparing the aligned images&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t209" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--simmask&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. A file containing a single 0/1 image to apply as a mask before comparison but after alignment&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--shrink&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;shrink&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Optionally shrink the input particles by an integer amount prior to computing similarity scores. For speed purposes. 0 -&gt; no shrinking&quot;</span><span class="op">,</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t211" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--shrinks1&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;shrinks1&quot;</span><span class="op">,</span> <span class="nam">type</span> <span class="op">=</span> <span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The level of shrinking to apply in the first stage of the two-stage classification process. Default=0 (autoselect)&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--prefilt&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Filter each reference (c) to match the power spectrum of each particle (r) before alignment and comparison. Applies both to classification and class-averaging.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t213" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--cmpdiff&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Used only in binary tree classification. Use a mask that focus on the difference of two children.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--treeincomplete&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Used only in binary tree classification. Incompleteness of the tree on each level.Default=0&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t215" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t216" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2classify.py</span><span class="strut">&nbsp;</span></p>
<p id="t217" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t218" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># options associated with e2classaverage.py</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;caheader&quot;, help=&#39;Options below this label are specific to e2classaverage&#39;, title=&quot;### e2classaverage options ###&quot;, row=22, col=0, rowspan=1, colspan=3, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classkeepsig&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Change the keep (\&#39;--keep\&#39;) criterion from fraction-based to sigma-based.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classiter&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The number of iterations to perform.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classalign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;rotate_translate_tree&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. If doing more than one iteration, this is the name and parameters of the &#39;aligner&#39; used to align particles to the previous class average.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t223" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classaligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. This is the name and parameters of the comparitor used by the fist stage aligner.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t224" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classralign&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The second stage aligner which refines the results of the first alignment in class averaging.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;auto&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t225" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classraligncmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The comparitor used by the second stage aligner in class averageing.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classaverager&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The averager used to generate the class averages. Default is auto.&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t227" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classcmp&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The name and parameters of the comparitor used to generate similarity scores, when class averaging.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t228" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classnormproc&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&quot;normalize.edgemean&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Normalization applied during class averaging&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--classrefsf&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Use the setsfref option in class averaging. This matches the filtration of the class-averages to the projections for easier comparison. Disabled when ampcorrect=flatten is used.&quot;</span><span class="op">,</span><span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;boolbox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">20</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[False]&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t230" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#options associated with e2make3d.py</span><span class="strut">&nbsp;</span></p>
<p id="t232" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_header(name=&quot;make3dheader&quot;, help=&#39;Options below this label are specific to e2make3d&#39;, title=&quot;### e2make3d options ###&quot;, row=32, col=0, rowspan=1, colspan=3)</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--pad&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;pad&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. To reduce Fourier artifacts, the model is typically padded by ~25 percent - only applies to Fourier reconstruction&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--recon&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;recon&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;fourier&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Reconstructor to use see e2help.py reconstructors -v&quot;</span><span class="op">,</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t235" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dkeepsig&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. The standard deviation alternative to the --m3dkeep argument&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; parser.add_argument(&quot;--m3dsetsf&quot;, type=str,dest=&quot;m3dsetsf&quot;, default=None, help=&quot;Default=auto. Name of a file containing a structure factor to apply after refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--m3dpreprocess&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Normalization processor applied before 3D reconstruction&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t238" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t239" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--ampcorrect&quot;</span><span class="op">,</span><span class="nam">choices</span><span class="op">=</span><span class="op">[</span><span class="str">&#39;auto&#39;</span><span class="op">,</span><span class="str">&#39;strucfac&#39;</span><span class="op">,</span><span class="str">&#39;flatten&#39;</span><span class="op">,</span><span class="str">&#39;none&#39;</span><span class="op">]</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="str">&#39;auto&#39;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Will perform amplitude correction via the specified method.&nbsp; &#39;flatten&#39; requires a target resolution better than 8 angstroms (experimental). &#39;none&#39; will disable amplitude correction (experimental).&quot;</span><span class="op">,</span> <span class="nam">guitype</span><span class="op">=</span><span class="str">&#39;combobox&#39;</span><span class="op">,</span> <span class="nam">row</span><span class="op">=</span><span class="num">28</span><span class="op">,</span> <span class="nam">col</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">rowspan</span><span class="op">=</span><span class="num">1</span><span class="op">,</span> <span class="nam">colspan</span><span class="op">=</span><span class="num">2</span><span class="op">,</span> <span class="nam">mode</span><span class="op">=</span><span class="str">&quot;refinement[&#39;auto&#39;]&quot;</span><span class="op">,</span> <span class="nam">choicelist</span><span class="op">=</span><span class="str">&quot;(&#39;strucfac&#39;,&#39;flatten&#39;,&#39;none&#39;,&#39;auto&#39;)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t240" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t241" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--classweight&quot;,choices=[&#39;sqrt&#39;,&#39;count&#39;,&#39;no_wt&#39;],default=&#39;count&#39;,help=&quot;Alter the weight of each class in the reconstruction (experimental).&quot;, guitype=&#39;combobox&#39;, row=24, col=0, rowspan=1, colspan=2, mode=&quot;refinement[&#39;count&#39;]&quot;, choicelist=&quot;(&#39;sqrt&#39;,&#39;count&#39;,&#39;no_wt&#39;)&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t242" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#parser.add_argument(&quot;--sqrtnorm&quot;,action=&quot;store_true&quot;,default=False, dest=&quot;sqrtnorm&quot;, help=&quot;If set, the sqrt of the number of particles in each class will be used to weight the direct fourier inversion.&quot;,guitype=&#39;boolbox&#39;, row=24, col=0, rowspan=1, colspan=1, mode=&quot;refinement&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t243" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t244" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#lowmem!</span><span class="strut">&nbsp;</span></p>
<p id="t245" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--lowmem&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">True</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=auto. Make limited use of memory when possible - useful on lower end machines&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t246" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_argument</span><span class="op">(</span><span class="str">&quot;--ppid&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Set the PID of the parent process, used for cross platform PPID&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t248" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="nam">args</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">parse_args</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t249" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t250" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">&lt;=</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t251" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">!=</span><span class="nam">None</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">[</span><span class="op">:</span><span class="num">6</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;thread&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t252" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">[</span><span class="num">7</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t253" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Note: automatically setting --threads:{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t254" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;WARNING: specifying --threads=&lt;N&gt; (where N is the number of cores to use on a single processor) is strongly recommended, even if already specifying --parallel&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t255" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t256" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">!=</span><span class="nam">None</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">!=</span><span class="nam">None</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">!=</span><span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t257" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR : You may specify --input and --model&nbsp; OR&nbsp; --startfrom, not both&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t258" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t260" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">==</span><span class="nam">None</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">==</span><span class="nam">None</span><span class="op">)</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t261" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR : You must specify --input and --model&nbsp; OR&nbsp; --startfrom\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">print_help</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t264" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t265" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dpreprocess</span><span class="op">==</span><span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t266" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dold</span> <span class="op">:</span> <span class="nam">m3dpreprocess</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t267" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">m3dpreprocess</span><span class="op">=</span><span class="str">&quot;--preprocess normalize.edgemean&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t268" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t269" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dpreprocess</span><span class="op">=</span><span class="str">&quot;--preprocess &quot;</span><span class="op">+</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dpreprocess</span><span class="strut">&nbsp;</span></p>
<p id="t270" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t271" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">==</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t272" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fls</span><span class="op">=</span><span class="op">[</span><span class="nam">int</span><span class="op">(</span><span class="nam">i</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="str">&quot;.&quot;</span><span class="op">)</span> <span class="key">if</span> <span class="nam">i</span><span class="op">[</span><span class="op">:</span><span class="num">7</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;refine_&quot;</span> <span class="key">and</span> <span class="nam">len</span><span class="op">(</span><span class="nam">i</span><span class="op">)</span><span class="op">==</span><span class="num">9</span> <span class="key">and</span> <span class="nam">str</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="nam">i</span><span class="op">[</span><span class="op">-</span><span class="num">2</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t273" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">fls</span><span class="op">)</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span> <span class="nam">fls</span><span class="op">=</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t274" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">path</span> <span class="op">=</span> <span class="str">&quot;refine_{:02d}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">max</span><span class="op">(</span><span class="nam">fls</span><span class="op">)</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t275" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">global</span> <span class="nam">output_path</span><span class="strut">&nbsp;</span></p>
<p id="t276" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">output_path</span><span class="op">=</span><span class="str">&quot;{}/report&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">os</span><span class="op">.</span><span class="nam">makedirs</span><span class="op">(</span><span class="nam">output_path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t278" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t279" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t280" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># make sure the box sizes match</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xsize3d</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xsize</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t284" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img1</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img3</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t286" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix1</span><span class="op">=</span><span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t287" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t288" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix1</span><span class="op">=</span><span class="nam">img1</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix3</span><span class="op">=</span><span class="nam">img3</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t291" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix3</span><span class="op">=</span><span class="nam">apix1</span><span class="strut">&nbsp;</span></p>
<p id="t292" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t293" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span> <span class="nam">xsize3d</span> <span class="op">!=</span> <span class="nam">xsize</span> <span class="key">or</span> <span class="nam">apix3</span><span class="op">==</span><span class="num">0</span> <span class="key">or</span> <span class="nam">fabs</span><span class="op">(</span><span class="nam">fabs</span><span class="op">(</span><span class="nam">apix1</span><span class="op">/</span><span class="nam">apix3</span><span class="op">)</span><span class="op">-</span><span class="num">1.0</span><span class="op">)</span><span class="op">&gt;</span><span class="num">.001</span> <span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t294" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;WARNING: the dimensions of the particles (%d @ %1.4f A/pix) do not match the dimensions of the starting model (%d @ %1.4f A/pix). I will attempt to adjust the model appropriately.&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">apix1</span><span class="op">,</span><span class="nam">xsize3d</span><span class="op">,</span><span class="nam">apix3</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t295" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t296" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">scale</span><span class="op">=</span><span class="nam">img3</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="op">/</span><span class="nam">img1</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t297" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Reference is {box3} x {box3} x {box3} at {apix3:1.2f} A/pix, particles are {box2} x {box2} at {apix2:1.2f} A/pix. Scaling by {scale:1.3f}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">box3</span><span class="op">=</span><span class="nam">img3</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">box2</span><span class="op">=</span><span class="nam">img1</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">apix3</span><span class="op">=</span><span class="nam">img3</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">apix2</span><span class="op">=</span><span class="nam">img1</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">scale</span><span class="op">=</span><span class="nam">scale</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t298" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t299" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;A/pix unknown, assuming scale same as relative box size&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t300" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">scale</span><span class="op">=</span><span class="nam">float</span><span class="op">(</span><span class="nam">xsize</span><span class="op">)</span><span class="op">/</span><span class="nam">xsize3d</span><span class="strut">&nbsp;</span></p>
<p id="t301" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">scale</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2proc3d.py %s %s/scaled_model.hdf --clip=%d,%d,%d --scale=%1.5f&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">scale</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t302" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2proc3d.py %s %s/scaled_model.hdf --scale=%1.5f --clip=%d,%d,%d&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">scale</span><span class="op">,</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">xsize</span><span class="op">,</span><span class="nam">xsize</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t303" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t304" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t305" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">=</span><span class="str">&quot;%s/scaled_model.hdf&quot;</span><span class="op">%</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="strut">&nbsp;</span></p>
<p id="t306" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t307" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&gt;</span><span class="num">7</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&lt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t308" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: --speed must be between 1 and 7. Lower numbers will make refinements take longer, but produce slightly better measured resolutions. The default value of 5 is a good balance for typical refinements. When\</span><span class="strut">&nbsp;</span></p>
<p id="t309" class="pln"><span class="str">satisfied with the results with speed=5 you may consider reducing this number as you try to push for optimal resolution.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t310" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t311" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">=</span> <span class="num">0.0</span><span class="strut">&nbsp;</span></p>
<p id="t312" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">total_procs</span> <span class="op">=</span> <span class="num">5</span><span class="op">*</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="strut">&nbsp;</span></p>
<p id="t313" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t314" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; if options.automask3d: automask_parms = parsemodopt(options.automask3d) # this is just so we only ever have to do it</span><span class="strut">&nbsp;</span></p>
<p id="t315" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t316" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t317" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t318" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">olddb</span> <span class="op">=</span> <span class="nam">js_open_dict</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">+</span><span class="str">&quot;/0_refine_parms.json&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t319" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">=</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;apix&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t320" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">apix</span><span class="op">&lt;=</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t321" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;last_even&quot;</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t322" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t323" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t324" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&lt;</span><span class="nam">apix</span><span class="op">*</span><span class="num">2</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t325" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;ERROR: Target resolution is smaller than 2*A/pix value. This is impossible.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t326" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t327" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t328" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">logid</span><span class="op">=</span><span class="nam">E2init</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">ppid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t329" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t330" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">###################################</span><span class="strut">&nbsp;</span></p>
<p id="t331" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### This is where we fill in all of the undefined options, and analyse the data</span><span class="strut">&nbsp;</span></p>
<p id="t332" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">###################################</span><span class="strut">&nbsp;</span></p>
<p id="t333" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;h1&gt;e2refine_easy.py report&lt;/h1&gt;\n&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t334" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t335" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;If you are curious to see a list of the exact refinement parameters</span><span class="strut">&nbsp;</span></p>
<p id="t336" class="pln"><span class="str">used, browse to the 0_refine_parms.json file in the refinement directory. You can use &#39;Info&#39; in the file browser or just read the file directly</span><span class="strut">&nbsp;</span></p>
<p id="t337" class="pln"><span class="str">(.json files are plain text)&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t338" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;h3&gt;Explantion of Refinement Parameters&lt;/h3&gt;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t339" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t340" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Prepare initial models</span><span class="strut">&nbsp;</span></p>
<p id="t341" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">!=</span><span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t342" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t343" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">olddb</span> <span class="op">=</span> <span class="nam">js_open_dict</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">+</span><span class="str">&quot;/0_refine_parms.json&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t344" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {oldeven} {path}/threed_00_even.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">oldeven</span><span class="op">=</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;last_even&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t345" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {oldodd} {path}/threed_00_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span>&nbsp; <span class="nam">oldodd</span> <span class="op">=</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;last_odd&quot;</span><span class="op">]</span> <span class="op">,</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t346" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">=</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;input&quot;</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="nam">str</span><span class="op">(</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;input&quot;</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t347" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Using {oldeven} {oldodd} as starting models without additional randomizing. Input particles are from {infile}&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">oldeven</span><span class="op">=</span><span class="nam">olddb</span><span class="op">[</span><span class="str">&quot;last_even&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">oldodd</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;last_odd&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">infile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t348" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t349" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t350" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error: Cannot find necessary files in &quot;</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">startfrom</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t351" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t352" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t353" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t354" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">20</span> <span class="op">:</span> <span class="nam">randomres</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">*</span><span class="num">1.2</span><span class="strut">&nbsp;</span></p>
<p id="t355" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">12</span> <span class="op">:</span> <span class="nam">randomres</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">*</span><span class="num">1.5</span><span class="strut">&nbsp;</span></p>
<p id="t356" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">randomres</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">*</span><span class="num">2.0</span><span class="strut">&nbsp;</span></p>
<p id="t357" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t358" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {model} {path}/threed_00_even.hdf --process=filter.lowpass.randomphase:cutoff_freq={freq} --apix={apix}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">model</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">freq</span><span class="op">=</span><span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">randomres</span><span class="op">)</span><span class="op">,</span><span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t359" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2proc3d.py {model} {path}/threed_00_odd.hdf --process=filter.lowpass.randomphase:cutoff_freq={freq} --apix={apix}&quot;</span> <span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">model</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">freq</span><span class="op">=</span><span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">randomres</span><span class="op">)</span><span class="op">,</span><span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t360" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Randomizing the Fourier phases of &lt;i&gt;{model}&lt;/i&gt; at resolutions higher than {res:1.1f} &amp;Aring;. If the final achieved resolution is not at least ~{resb:1.1f} &amp;Aring;, then the</span><span class="strut">&nbsp;</span></p>
<p id="t361" class="pln"><span class="str">gold standard resolution assessment is not valid, and you need to re-refine, starting with a lower resolution target.&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t362" class="pln"><span class="str">&lt;p&gt;Input particles are from &lt;i&gt;{infile}&lt;/i&gt;&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">model</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">model</span><span class="op">,</span><span class="nam">infile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="nam">res</span><span class="op">=</span><span class="nam">randomres</span><span class="op">,</span><span class="nam">resb</span><span class="op">=</span><span class="nam">randomres</span><span class="op">*</span><span class="num">0.9</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t363" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># input gets modified below, we need to do this first</span><span class="strut">&nbsp;</span></p>
<p id="t364" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">bispec</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t365" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t366" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print &quot;eosplit &quot;,options.input.split(&quot;__ctf_flip&quot;)[0]+&quot;__ctf_flip_bispec.lst&quot;,&quot;\n\n&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t367" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">bsinput</span><span class="op">=</span><span class="nam">image_eosplit</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;__ctf_flip&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">+</span><span class="str">&quot;__ctf_flip_bispec.lst&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t368" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t369" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t370" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">bsinput</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">.</span><span class="nam">rsplit</span><span class="op">(</span><span class="str">&quot;.&quot;</span><span class="op">,</span><span class="num">1</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">+</span><span class="str">&quot;_bispec.hdf&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t371" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="nam">bsinput</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t372" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">com</span><span class="op">=</span><span class="str">&quot;e2proc2dpar.py {} {} --process filter.highpass.gauss:cutoff_freq=0.01 --process normalize.edgemean --process math.bispectrum.slice:size={}:fp={} --threads {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">,</span><span class="nam">bsinput</span><span class="op">,</span><span class="nam">bispec_invar_parm</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">bispec_invar_parm</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t373" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">com</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t374" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">bsinput</span><span class="op">=</span><span class="nam">image_eosplit</span><span class="op">(</span><span class="nam">bsinput</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t375" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># even/odd split of input data as .lst file</span><span class="strut">&nbsp;</span></p>
<p id="t376" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">=</span><span class="nam">image_eosplit</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t377" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">inputavg</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">inputavg</span><span class="op">=</span><span class="nam">image_eosplit</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">inputavg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t378" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t379" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t380" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error: Unable to prepare input files&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t381" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t382" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t383" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">repim</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="num">0</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># read a representative image to get some basic info</span><span class="strut">&nbsp;</span></p>
<p id="t384" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">repim</span><span class="op">.</span><span class="nam">has_attr</span><span class="op">(</span><span class="str">&quot;ctf&quot;</span><span class="op">)</span> <span class="op">:</span> <span class="nam">hasctf</span><span class="op">=</span><span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t385" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">hasctf</span><span class="op">=</span><span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t386" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span><span class="op">=</span><span class="nam">repim</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t387" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t388" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Fill in optional parameters</span><span class="strut">&nbsp;</span></p>
<p id="t389" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t390" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">hasctf</span> <span class="key">and</span> <span class="nam">apix</span><span class="op">&lt;</span><span class="num">6.5</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t391" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">exists</span><span class="op">(</span><span class="str">&quot;strucfac.txt&quot;</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t392" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; append_html(&quot;&lt;p&gt;Using the standard 3-stage filter on the reconstruction: &#39;filter.lowpass.autob&#39; which flattens the overall falloff of the structure factor in the 4-15 A range, \</span><span class="strut">&nbsp;</span></p>
<p id="t393" class="pln"><span class="com"># &#39;setsf strucfac.fromdata.txt&#39; which will force the low resolution structure factor to match the profile determined from the data, and filter.wiener.byfsc which performs a low-pass Wiener \</span><span class="strut">&nbsp;</span></p>
<p id="t394" class="pln"><span class="com"># filter based on the computed FSC curve between even/odd maps. Combined, this process produces properly resolution-limited maps with very accurate structure factors. The only real free \</span><span class="strut">&nbsp;</span></p>
<p id="t395" class="pln"><span class="com"># parameter is the amplitude contrast setting when determining the structure factor.&lt;/p&gt;&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t396" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; postprocess=&quot;--postprocess filter.lowpass.autob&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t397" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; m3dsetsf=&quot;--setsf strucfac.fromdata.txt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t398" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Several different methods can be used for final amplitude correction in cryoEM. The most accurate of these is to take the final\</span><span class="strut">&nbsp;</span></p>
<p id="t399" class="pln"><span class="str"> structure and filter it so its 1-D power spectrum matches a known 1-D power spectrum from X-ray solution scattering or other source. This &#39;ideally filtered&#39;\</span><span class="strut">&nbsp;</span></p>
<p id="t400" class="pln"><span class="str"> structure is then low-pass filtered based on the same FSC curve used to measure resolution between the independent even/odd models used in the Gold Standard\</span><span class="strut">&nbsp;</span></p>
<p id="t401" class="pln"><span class="str"> resolution criterion. This is the normal method EMAN2 will use for final corrections. Other choices are possible as well, however. EMAN2 generates an\</span><span class="strut">&nbsp;</span></p>
<p id="t402" class="pln"><span class="str"> experimental structure factor directly from your data as part of the CTF fitting procedure. The low resolution portion is drawn directly from your data\</span><span class="strut">&nbsp;</span></p>
<p id="t403" class="pln"><span class="str"> and the high resolution portion (generally past 14-18 A) is an empirical structure factor for proteins in general with a mix of alpha and beta components.\</span><span class="strut">&nbsp;</span></p>
<p id="t404" class="pln"><span class="str"> This works quite well for most proteins, however is not completely appropriate for hybrid molecules with nucleotides (like ribosomes), but will generally\</span><span class="strut">&nbsp;</span></p>
<p id="t405" class="pln"><span class="str"> still produce reasonable structures. Note that this is just a standard linear filter, which is not really changing the 3-D structure at all, it&#39;s really\</span><span class="strut">&nbsp;</span></p>
<p id="t406" class="pln"><span class="str"> just changing how that structure is portrayed.&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t407" class="pln"><span class="str"> &lt;p&gt;The structure factor produced when CTF fitting is stored in &lt;i&gt;strucfac.txt&lt;/i&gt; in the project directory. If you replace this file with a structure factor from</span><span class="strut">&nbsp;</span></p>
<p id="t408" class="pln"><span class="str"> some other source, it will be used to process all subsequent particles.&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t409" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t410" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;--setsf strucfac.txt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t411" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t412" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;No data-based structure factor was found in the project. Computing one during CTF correction is highly recommended. Falling back to two-stage filtration: \</span><span class="strut">&nbsp;</span></p>
<p id="t413" class="pln"><span class="str">&#39;filter.lowpass.autob&#39; which flattens the overall falloff of the structure factor in the 4-15 A range, \</span><span class="strut">&nbsp;</span></p>
<p id="t414" class="pln"><span class="str">and filter.wiener.byfsc which performs a low-pass Wiener filter based on the computed FSC curve between even/odd maps. \</span><span class="strut">&nbsp;</span></p>
<p id="t415" class="pln"><span class="str">While this filtration can work reasonably well, you may find that it over-exagerates low-resolution terms over multiple iterations. \</span><span class="strut">&nbsp;</span></p>
<p id="t416" class="pln"><span class="str">To avoid this, compute a structure factor.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t417" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;--m3dpostprocess filter.lowpass.autob&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t418" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t419" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">apix</span><span class="op">&gt;=</span><span class="num">6.5</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t420" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;A/pix value &gt;6.5. With such a large A/pix some of the post-processing sharpening filters need to be disabled, so you are effectively\</span><span class="strut">&nbsp;</span></p>
<p id="t421" class="pln"><span class="str"> getting an unfiltered output map other than the automatic CTF correction.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t422" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t423" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t424" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t425" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;No CTF information found in the input data. Note that EMAN2 cannot perform optimal reconstructions using phase-flipped particles from other \</span><span class="strut">&nbsp;</span></p>
<p id="t426" class="pln"><span class="str">software. Part of EMAN2&#39;s CTF correction process is measuring the SSNR of the particle data, an estimate of the low resolution structure factor and other parameters \</span><span class="strut">&nbsp;</span></p>
<p id="t427" class="pln"><span class="str">which are used to provide more accurate orientations, filters, etc. during processing. Since CTF information isn&#39;t present, we are limited to a basic refinement. \</span><span class="strut">&nbsp;</span></p>
<p id="t428" class="pln"><span class="str">output maps will be low-pass filtered based on resolution, but note that there will be no B-factor correction, so this will result in over-filtration of the final \</span><span class="strut">&nbsp;</span></p>
<p id="t429" class="pln"><span class="str">maps.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t430" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">postprocess</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t431" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dsetsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t432" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t433" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">tophat</span><span class="op">==</span><span class="str">&quot;global&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t434" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;You are using the --tophat=global option, which modifies the final filter applied to 3-D maps. The default behavior is to apply a final Wiener filter \</span><span class="strut">&nbsp;</span></p>
<p id="t435" class="pln"><span class="str">based on the FSC curve used to compute the resolution. This Wiener filter gives a map which in theory reduces noise and filters the map to get as close as possible to \</span><span class="strut">&nbsp;</span></p>
<p id="t436" class="pln"><span class="str">what you should be able to see at the specified resolution. However, this means that some features, such as sidechains and the pitch of alpha-helices may be somewhat \</span><span class="strut">&nbsp;</span></p>
<p id="t437" class="pln"><span class="str">smoothed out. The alternative is a &#39;tophat&#39; or &#39;sharp&#39; filter imposed at the cutoff (0.143) FSC value, and is what Relion imposes on its final maps. This produces \</span><span class="strut">&nbsp;</span></p>
<p id="t438" class="pln"><span class="str">maps which look prettier, with more apparent side-chains at high resolution, but runs the risk that some of these features may be artifacts of the sharp filter.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t439" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tophat</span><span class="op">=</span><span class="str">&quot;--tophat=global&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t440" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">tophat</span><span class="op">==</span><span class="str">&quot;local&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t441" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;You are using the --tophat=local option, which modifies the final filter applied to 3-D maps. The default behavior is to apply a final Wiener filter \</span><span class="strut">&nbsp;</span></p>
<p id="t442" class="pln"><span class="str">based on the FSC curve evenly across the map. This Wiener filter gives a map which in theory reduces noise and filters the map to get as close as possible to \</span><span class="strut">&nbsp;</span></p>
<p id="t443" class="pln"><span class="str">what you should be able to see at the specified resolution. However, this means that some features, such as sidechains and the pitch of alpha-helices may be somewhat \</span><span class="strut">&nbsp;</span></p>
<p id="t444" class="pln"><span class="str">smoothed out. This option will compute a local resolution map, by computing local FSCs in different regions of the map. This local resolution map is then applied as a set \</span><span class="strut">&nbsp;</span></p>
<p id="t445" class="pln"><span class="str">of local tophat filters across the map. If some regions of the map have better resolution than others, these regions will preserve more detail, and vice-versa. This may \</span><span class="strut">&nbsp;</span></p>
<p id="t446" class="pln"><span class="str">produce some local artifacts, but generally seems to work quite well.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t447" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tophat</span><span class="op">=</span><span class="str">&quot;--tophat=local&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t448" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t449" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;You are not using the --tophat option, meaning a final Wiener filter \</span><span class="strut">&nbsp;</span></p>
<p id="t450" class="pln"><span class="str">based on the FSC curve used to compute the resolution is applied to the reconstruction. This Wiener filter gives a map which in theory reduces noise and filters the map to get as close as possible to \</span><span class="strut">&nbsp;</span></p>
<p id="t451" class="pln"><span class="str">what you should be able to see at the specified resolution. However, this means that some features, such as sidechains and the pitch of alpha-helices may be somewhat \</span><span class="strut">&nbsp;</span></p>
<p id="t452" class="pln"><span class="str">smoothed out. The alternative is a &#39;tophat&#39; or &#39;sharp&#39; filter imposed at the cutoff (0.143) FSC value, and is what Relion imposes on its final maps. This produces \</span><span class="strut">&nbsp;</span></p>
<p id="t453" class="pln"><span class="str">maps which look prettier, with more apparent side-chains at high resolution, but runs the risk that some of these features may be artifacts of the sharp filter.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t454" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t455" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tophat</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t456" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t457" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">sym</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="str">&quot;c1&quot;</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">15</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t458" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Since you are not imposing symmetry, and your target resolution is low, there is a risk that the even and odd maps produced during refinement \</span><span class="strut">&nbsp;</span></p>
<p id="t459" class="pln"><span class="str">may become significantly misaligned (more than a few degrees). Small misalignments are automatically corrected after each refinement iteration, but larger misalignments \</span><span class="strut">&nbsp;</span></p>
<p id="t460" class="pln"><span class="str">are not. Given this risk, you may wish to check the even and odd maps after your refinement to insure that they are oriented identically. If they aren&#39;t, you may consider \</span><span class="strut">&nbsp;</span></p>
<p id="t461" class="pln"><span class="str">running another round of e2refine_easy, using either the even or the odd map (rather than the averaged map) as a starting model, and reducing (smaller number, better \</span><span class="strut">&nbsp;</span></p>
<p id="t462" class="pln"><span class="str">resolution) --targetres by ~25%. Hopefully this will eliminate the misalignment, and give a correct averaged map.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t463" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t464" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">&lt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t465" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">=</span><span class="nam">max</span><span class="op">(</span><span class="num">1</span><span class="op">,</span><span class="num">6</span><span class="op">-</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t466" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Based on your selected --speed, I am setting --sep {sep}. This puts each particle into its {sep} best orientations. If the angular sampling is finer than required \</span><span class="strut">&nbsp;</span></p>
<p id="t467" class="pln"><span class="str">to achieve the specified resolution, then a certain amount of rotational &#39;smearing&#39; of each particle will help improve SNR in the resulting map without the &#39;smearing&#39; degrading \</span><span class="strut">&nbsp;</span></p>
<p id="t468" class="pln"><span class="str">the actual map quality. This can achieve maximum liklihood-like effects without the substantial compuations this can entail. If you are concerned by this, or have many more particles than \</span><span class="strut">&nbsp;</span></p>
<p id="t469" class="pln"><span class="str">are really required to achieve the targeted resolution, you may consider manually specifiying --sep 1, which will override this automatic behavior.&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">sep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t470" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t471" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># in bispectrum mode, we make classes for the full sphere</span><span class="strut">&nbsp;</span></p>
<p id="t472" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">bispec</span><span class="op">:</span> <span class="nam">incmir</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t473" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">incmir</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t474" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t475" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t476" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># target resolution worse than 1/2 Nyquist</span><span class="strut">&nbsp;</span></p>
<p id="t477" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="nam">apix</span><span class="op">*</span><span class="num">4</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t478" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">effbox</span><span class="op">=</span><span class="nam">nx</span><span class="op">*</span><span class="nam">apix</span><span class="op">*</span><span class="num">2</span><span class="op">/</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="strut">&nbsp;</span></p>
<p id="t479" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; astep=89.999/ceil(90.0/sqrt(4300/effbox))&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; # This rounds to the best angular step divisible by 90 degrees. Old way without speed</span><span class="strut">&nbsp;</span></p>
<p id="t480" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">89.99</span><span class="op">/</span><span class="nam">ceil</span><span class="op">(</span><span class="num">90.0</span><span class="op">*</span><span class="num">9.0</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">+</span><span class="num">3.0</span><span class="op">)</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">4300</span><span class="op">/</span><span class="nam">effbox</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This rounds to the best angular step divisible by 90 degrees</span><span class="strut">&nbsp;</span></p>
<p id="t481" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="str">&quot;eman:delta={:1.5f}:inc_mirror={}:perturb=0&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">,</span><span class="nam">incmir</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t482" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t483" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">12.0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t484" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classiter</span><span class="op">=</span><span class="num">3</span><span class="strut">&nbsp;</span></p>
<p id="t485" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is below 1/2 Nyquist, and you requested a resolution of &lt;12 A, so we will initially set --classiter to 3. This will help \</span><span class="strut">&nbsp;</span></p>
<p id="t486" class="pln"><span class="str">low resolution refinements converge more rapidly. If you run more than 2 iterations and the map seems to have converged fairly well, this will be decreased.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t487" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">8.0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t488" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classiter</span><span class="op">=</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t489" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is below 1/2 Nyquist, and you requested a resolution of &lt;8 A, so we will initially set --classiter to 2. This balances \</span><span class="strut">&nbsp;</span></p>
<p id="t490" class="pln"><span class="str">rapid convergence with the subnanometer resolution goal. If you run more than 2 iterations and the map seems to have converged fairly well, this will be decreased.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t491" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t492" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t493" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is below 1/2 Nyquist, and you requested a high resolution, so we will initially set --classiter to 1. This balances \</span><span class="strut">&nbsp;</span></p>
<p id="t494" class="pln"><span class="str">rapid convergence with the resolution goal. If you run more than 2 iterations and the map seems to have converged fairly well, this will be decreased.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t495" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t496" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Automatically selecting a good angular spacing for the refinement adjusted for your selected --speed. The resolution you are requesting ({}) is quite conservative given the \</span><span class="strut">&nbsp;</span></p>
<p id="t497" class="pln"><span class="str">sampling ({}) of your data. If this is simply an initial refinement designed to get the overall shape of the structure correct, this is fine. If this is your final resolution \</span><span class="strut">&nbsp;</span></p>
<p id="t498" class="pln"><span class="str">target, you may wish to consider downsampling the data and importing into a new project, as too much oversampling is both &lt;i&gt;extremely&lt;/i&gt; inefficient, and in some cases will \</span><span class="strut">&nbsp;</span></p>
<p id="t499" class="pln"><span class="str">even lead to worse structures. Based on your requested resolution and box-size, I will use an angular sampling of {:1.2f} deg. For details, please see \</span><span class="strut">&nbsp;</span></p>
<p id="t500" class="pln"><span class="str">&lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">,</span><span class="nam">apix</span><span class="op">,</span><span class="nam">astep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t501" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t502" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># target resolution between 1/2 and 3/4 Nyquist</span><span class="strut">&nbsp;</span></p>
<p id="t503" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="nam">apix</span><span class="op">*</span><span class="num">8.0</span><span class="op">/</span><span class="num">3.0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t504" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">89.99</span><span class="op">/</span><span class="nam">ceil</span><span class="op">(</span><span class="num">90.0</span><span class="op">*</span><span class="num">9.0</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">+</span><span class="num">3.0</span><span class="op">)</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">4300</span><span class="op">/</span><span class="nam">nx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This rounds to the best angular step divisible by 90 degrees</span><span class="strut">&nbsp;</span></p>
<p id="t505" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="str">&quot;eman:delta={:1.5f}:inc_mirror={}:perturb=0&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">,</span><span class="nam">incmir</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t506" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Based on your requested resolution and box-size, modified by --speed,&nbsp; I will use an angular sampling of {:1.2f} deg. For details, please see \</span><span class="strut">&nbsp;</span></p>
<p id="t507" class="pln"><span class="str">&lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t508" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t509" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t510" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is between 1/2 and 3/4 Nyquist, so we will set --classiter to 1. Leaving this above 0 \</span><span class="strut">&nbsp;</span></p>
<p id="t511" class="pln"><span class="str">will help avoid noise bias in early rounds, but it may be reduced to zero if convergence seems to have been achieved.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t512" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t513" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># target resolution is beyond 3/4 Nyquist</span><span class="strut">&nbsp;</span></p>
<p id="t514" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t515" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t516" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t517" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Your desired resolution is beyond 3/4 Nyquist. Regardless, we will set --classiter to 1 initially. Leaving this above 0 \</span><span class="strut">&nbsp;</span></p>
<p id="t518" class="pln"><span class="str">will help avoid noise bias, but it may be reduced to zero if convergence seems to have been achieved.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t519" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">89.99</span><span class="op">/</span><span class="nam">ceil</span><span class="op">(</span><span class="num">90.0</span><span class="op">*</span><span class="num">9.0</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">+</span><span class="num">3.0</span><span class="op">)</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">4300</span><span class="op">/</span><span class="nam">nx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This rounds to the best angular step divisible by 90 degrees</span><span class="strut">&nbsp;</span></p>
<p id="t520" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="str">&quot;eman:delta={:1.5f}:inc_mirror={}:perturb=0&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">,</span><span class="nam">incmir</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t521" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;The resolution you are requesting is beyond 2/3 Nyquist. This is normally not recommended, as it represents insufficient sampling to give a good representation of your \</span><span class="strut">&nbsp;</span></p>
<p id="t522" class="pln"><span class="str">reconstructed map, and resolution can be difficult to accurately assess. The reconstruction will proceed, but generally speaking your A/pix should be less than 1/3 the targeted resolution. \</span><span class="strut">&nbsp;</span></p>
<p id="t523" class="pln"><span class="str">Based on your requested resolution and box-size, modified by --speed, I will use an angular sampling of {:1.2f} deg. For details, please see \</span><span class="strut">&nbsp;</span></p>
<p id="t524" class="pln"><span class="str">&lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">astep</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t525" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t526" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Using your specified orientation generator with angular step. You may consider reading this page: &lt;a href=http://blake.bcm.edu/emanwiki/EMAN2/AngStep&gt;http://blake.bcm.edu/emanwiki/EMAN2/AngStep&lt;/a&gt;&lt;/p&gt;&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t527" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t528" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="nam">float</span><span class="op">(</span><span class="nam">parsemodopt</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="str">&quot;delta&quot;</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t529" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">astep</span><span class="op">*</span><span class="nam">floor</span><span class="op">(</span><span class="num">90.0</span><span class="op">/</span><span class="nam">astep</span><span class="op">)</span><span class="op">&lt;</span><span class="num">89.9</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t530" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;WARNING: your specified angular step would not quite reach the equator when generating angles. For higher symmetries (icos or oct) this may not be a problem, but for lower symmetries, it is \</span><span class="strut">&nbsp;</span></p>
<p id="t531" class="pln"><span class="str">important to use an angular step which is 90/integer.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t532" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t533" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Could not extract an angular step from your orientation generator. This means I won&#39;t be able to use it for optimal rotational averaging during reconstruction&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t534" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t535" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="op">:</span> <span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t536" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">breaksym</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">+</span><span class="str">&quot;:breaksym=1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t537" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t538" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t539" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">==</span><span class="str">&quot;auto&quot;</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&lt;</span><span class="num">7</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t540" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;=</span><span class="num">11.0</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&gt;</span><span class="num">5</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t541" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t542" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t543" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t544" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t545" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># previously, the default minres/maxres was 500,10. In testing showed that 50,5 produced noticably improved results on IP3R</span><span class="strut">&nbsp;</span></p>
<p id="t546" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># changing the default to match targetres</span><span class="strut">&nbsp;</span></p>
<p id="t547" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t548" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">=</span><span class="str">&quot;frc:zeromask=1:snrweight=1:minres=80:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t549" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t550" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;--ralign {} --raligncmp {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t551" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">==</span><span class="num">7</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="nam">None</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="str">&quot;none&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t552" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simralign</span><span class="op">=</span><span class="str">&quot; &quot;</span><span class="strut">&nbsp;</span></p>
<p id="t553" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">simralign</span><span class="op">=</span><span class="str">&quot;--ralign {} --raligncmp {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">simraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t554" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t555" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t556" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">18.0</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">hasctf</span><span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">=</span><span class="str">&quot;frc:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t557" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">11.0</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; <span class="com"># no zeromask to avoid top/side errors at lower resolutions</span><span class="strut">&nbsp;</span></p>
<p id="t558" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">max</span><span class="op">(</span><span class="num">7.0</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t559" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t560" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrink</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span> <span class="nam">shrink</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t561" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">shrink</span><span class="op">=</span><span class="str">&quot;--shrink {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">shrink</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t562" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">shrinks1</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t563" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">nx</span><span class="op">&gt;=</span><span class="num">256</span> <span class="key">and</span> <span class="op">(</span><span class="nam">nx</span><span class="op">/</span><span class="num">4</span><span class="op">)</span><span class="op">%</span><span class="num">2</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;--shrinks1 4&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t564" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">nx</span><span class="op">&gt;=</span><span class="num">96</span> <span class="key">and</span> <span class="op">(</span><span class="nam">nx</span><span class="op">/</span><span class="num">2</span><span class="op">)</span><span class="op">%</span><span class="num">2</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;--shrinks1 2&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t565" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t566" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">shrinks1</span><span class="op">=</span><span class="str">&quot;--shrinks1 {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">shrinks1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t567" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t568" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t569" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t570" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t571" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">==</span><span class="str">&quot;auto&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t572" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&gt;</span><span class="num">15</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">hasctf</span> <span class="key">or</span> <span class="nam">options</span><span class="op">.</span><span class="nam">speed</span><span class="op">&gt;</span><span class="num">5</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t573" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t574" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t575" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t576" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;refine&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t577" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1:zeromask=1:minres=80:maxres={}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t578" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;--ralign {ralign} --raligncmp {raligncmp}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ralign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">,</span><span class="nam">raligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t579" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="nam">None</span> <span class="key">or</span>&nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">==</span><span class="str">&quot;none&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t580" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classralign</span><span class="op">=</span><span class="str">&quot; &quot;</span><span class="strut">&nbsp;</span></p>
<p id="t581" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classralign</span><span class="op">=</span><span class="str">&quot;--ralign {ralign} --raligncmp {raligncmp}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ralign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classralign</span><span class="op">,</span><span class="nam">raligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classraligncmp</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t582" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t583" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t584" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if hasctf and options.targetres&lt;15 : options.classaverager=&quot;ctfw.auto&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t585" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">hasctf</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&lt;</span><span class="num">15</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">=</span><span class="str">&quot;ctf.weight&quot;</span>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># changed default on 10/23/14</span><span class="strut">&nbsp;</span></p>
<p id="t586" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">=</span><span class="str">&quot;mean&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t587" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t588" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t589" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">hasctf</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">=</span><span class="str">&quot;frc:snrweight=1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t590" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">=</span><span class="str">&quot;ccc&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t591" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t592" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">&lt;</span><span class="nam">nx</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t593" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">=</span><span class="nam">good_size</span><span class="op">(</span><span class="nam">nx</span><span class="op">*</span><span class="num">1.3</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t594" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">&gt;</span><span class="num">1024</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t595" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Warning: padding for Fourier reconstruction is now {}, meaning quite a lot of memory will \</span><span class="strut">&nbsp;</span></p>
<p id="t596" class="pln"><span class="str">be required for reconstructions, and they may be very slow. Padding in Fourier space is largely performed to avoid high-radius \</span><span class="strut">&nbsp;</span></p>
<p id="t597" class="pln"><span class="str">Fourier artifacts, and a gradual radial density falloff. If you feel this value is too large, you can manually specify a value \</span><span class="strut">&nbsp;</span></p>
<p id="t598" class="pln"><span class="str">with the --pad option.&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t599" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t600" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">&lt;</span><span class="nam">nx</span><span class="op">*</span><span class="num">1.3</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t601" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Warning: the --pad value you specified is less than 1.3x the box size. We normlly recommend using a --pad \</span><span class="strut">&nbsp;</span></p>
<p id="t602" class="pln"><span class="str">value at least 1.3x the box size to avoid Fourier artifacts in the reconstruction, particularly at high radius. If you already \</span><span class="strut">&nbsp;</span></p>
<p id="t603" class="pln"><span class="str">have a box which is large compared to the particle, then a smaller value may be fine. Also, if your particle is very large and there \</span><span class="strut">&nbsp;</span></p>
<p id="t604" class="pln"><span class="str">are memory concerns, using a smaller pad option may be the only reasonable alternative, though some artifacts may occur.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t605" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t606" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">##################################</span><span class="strut">&nbsp;</span></p>
<p id="t607" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### prepare for the run</span><span class="strut">&nbsp;</span></p>
<p id="t608" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">##################################</span><span class="strut">&nbsp;</span></p>
<p id="t609" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Convert some of the command-line options to more conventient strings for command generation</span><span class="strut">&nbsp;</span></p>
<p id="t610" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="nam">verbose</span><span class="op">=</span><span class="str">&quot;--verbose {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t611" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">verbose</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t612" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t613" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">&lt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t614" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;WARNING: threads set to an invalid value. Changing to 1, but you should really provide a reasonable number.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t615" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t616" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t617" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">parallel</span><span class="op">=</span><span class="str">&quot;--parallel {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t618" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">&gt;</span><span class="num">1</span><span class="op">:</span> <span class="nam">parallel</span><span class="op">=</span><span class="str">&quot;--parallel thread:{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t619" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">parallel</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t620" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t621" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">prefilt</span> <span class="op">:</span> <span class="nam">prefilt</span><span class="op">=</span><span class="str">&quot;--prefilt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t622" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">prefilt</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t623" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t624" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">cmpdiff</span> <span class="op">:</span> <span class="nam">cmpdiff</span><span class="op">=</span><span class="str">&quot;--cmpdiff&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t625" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">cmpdiff</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t626" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t627" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">simmask</span><span class="op">!=</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t628" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">makesimmask</span><span class="op">=</span><span class="nam">False</span><span class="strut">&nbsp;</span></p>
<p id="t629" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simmask</span><span class="op">=</span><span class="str">&quot;--mask {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">simmask</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t630" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;{simmask} was specified, so I will not automatically create a mask for each iteration.&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t631" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t632" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">makesimmask</span><span class="op">=</span><span class="nam">True</span><span class="strut">&nbsp;</span></p>
<p id="t633" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">simmask</span><span class="op">=</span><span class="str">&quot;--mask {path}/simmask.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t634" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;As particles get translated during alignment, the total amount of noise present in the aligned particle can change\</span><span class="strut">&nbsp;</span></p>
<p id="t635" class="pln"><span class="str"> significantly. While this isn&#39;t a very large effect for similarity metrics like fsc, it can cause a bias in the reconstruction. Similarly\</span><span class="strut">&nbsp;</span></p>
<p id="t636" class="pln"><span class="str"> if we use a different mask derived for each projection to combat this problem (as with the zeromask=1 option in some comparators, then each\</span><span class="strut">&nbsp;</span></p>
<p id="t637" class="pln"><span class="str"> projection masks out a different fraction of the image causing some orientations to be preferred. To combat both effects, I will compute a\</span><span class="strut">&nbsp;</span></p>
<p id="t638" class="pln"><span class="str"> single aggregate mask from all of the projections in each iteration, and use it as &lt;i&gt;{simmask}&lt;/i&gt;. The mask is autogenerated and overwritten\</span><span class="strut">&nbsp;</span></p>
<p id="t639" class="pln"><span class="str"> after each iteration. The only way to completely disable this behavior\</span><span class="strut">&nbsp;</span></p>
<p id="t640" class="pln"><span class="str"> is to specify --simmask yourself with a file containing all 1.0 pixels.&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t641" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t642" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classrefsf</span> <span class="op">:</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="str">&quot;--setsfref&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t643" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t644" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t645" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">inputavg</span><span class="op">!=</span><span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t646" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cainput</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;--input {} --usefilt {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">inputavg</span><span class="op">[</span><span class="nam">ii</span><span class="op">]</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="nam">ii</span><span class="op">]</span><span class="op">)</span> <span class="key">for</span> <span class="nam">ii</span> <span class="key">in</span> <span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t647" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t648" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cainput</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;--input {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="nam">ii</span><span class="op">]</span><span class="op">)</span> <span class="key">for</span> <span class="nam">ii</span> <span class="key">in</span> <span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t649" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t650" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t651" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classautomask</span> <span class="op">:</span> <span class="nam">classautomask</span><span class="op">=</span><span class="str">&quot;--automask&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t652" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classautomask</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t653" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t654" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classkeepsig</span> <span class="op">:</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="str">&quot;--keepsig&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t655" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t656" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t657" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if options.classralign!=None : classralign=&quot;--ralign {} --raligncmp {}&quot;.format(options.classralign,options.classraligncmp)</span><span class="strut">&nbsp;</span></p>
<p id="t658" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#else: classralign=&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t659" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t660" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeepsig</span> <span class="op">:</span> <span class="nam">m3dkeepsig</span><span class="op">=</span><span class="str">&quot;--keepsig&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t661" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">m3dkeepsig</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t662" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t663" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">automask3d</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">amask3d</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t664" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">amask3d</span><span class="op">=</span><span class="str">&quot;--automask3d &quot;</span><span class="op">+</span><span class="nam">options</span><span class="op">.</span><span class="nam">automask3d</span><span class="strut">&nbsp;</span></p>
<p id="t665" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t666" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">automask3d2</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">amask3d2</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t667" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">amask3d2</span><span class="op">=</span><span class="str">&quot;--automask3d2 &quot;</span><span class="op">+</span><span class="nam">options</span><span class="op">.</span><span class="nam">automask3d2</span><span class="strut">&nbsp;</span></p>
<p id="t668" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t669" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t670" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dpostprocess</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span> <span class="nam">m3dpostproc</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t671" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">m3dpostproc</span><span class="op">=</span><span class="str">&quot;--m3dpostprocess &quot;</span><span class="op">+</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dpostprocess</span><span class="strut">&nbsp;</span></p>
<p id="t672" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t673" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">prethreshold</span> <span class="op">:</span> <span class="nam">prethreshold</span><span class="op">=</span><span class="str">&quot;--prethreshold&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t674" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">prethreshold</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t675" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t676" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># store the input arguments forever in the refinement directory</span><span class="strut">&nbsp;</span></p>
<p id="t677" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span> <span class="op">=</span> <span class="nam">js_open_dict</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">+</span><span class="str">&quot;/0_refine_parms.json&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t678" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="nam">vars</span><span class="op">(</span><span class="nam">options</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t679" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">[</span><span class="str">&quot;commandline&quot;</span><span class="op">]</span><span class="op">=</span><span class="str">&quot; &quot;</span><span class="op">.</span><span class="nam">join</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t680" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">[</span><span class="str">&quot;timestamp&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">str</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t681" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">[</span><span class="str">&quot;astep&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">astep</span><span class="strut">&nbsp;</span></p>
<p id="t682" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">[</span><span class="str">&quot;apix&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t683" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t684" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;NOTE: you can check the progress of the refinement at any time by opening this URL in your web-browser:&nbsp; file://{}/index.html&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">abspath</span><span class="op">(</span><span class="nam">output_path</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t685" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t686" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;h3&gt;Analysis of Refinement Results&lt;/h3&gt;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t687" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t688" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;h4&gt;Convergence Analysis&lt;/h4&gt; &lt;p&gt;The plot below shows the FSC computed between iterations for both even and</span><span class="strut">&nbsp;</span></p>
<p id="t689" class="pln"><span class="str">odd particle subsets. It is not a measure of resolution, but is a measure of how much the individual even/odd maps are changing</span><span class="strut">&nbsp;</span></p>
<p id="t690" class="pln"><span class="str">from one iteration to the next. In a perfect world, this plot would eventually be 1.0 indicating no change from one iteration</span><span class="strut">&nbsp;</span></p>
<p id="t691" class="pln"><span class="str">to the next after the refinement converges. In reality we normally expect only a pseudoconvergence, where the curves approach a</span><span class="strut">&nbsp;</span></p>
<p id="t692" class="pln"><span class="str">final shape but do not actually become 1.0. This plot is automatically updated after each iteration.&lt;/p&gt;&lt;br&gt;&lt;a href=converge.pdf&gt;&lt;img src=converge.png&gt;&lt;/a&gt;&lt;br&gt;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t693" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t694" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;h4&gt;Gold Standard Resolution&lt;/h4&gt; &lt;p&gt;e2refine_easy computes a true gold-standard resolution as part of its stanard</span><span class="strut">&nbsp;</span></p>
<p id="t695" class="pln"><span class="str">processing. This curve is also used as a basis for filtering the maps. Resolution can be gagued as the point at which this curve falls</span><span class="strut">&nbsp;</span></p>
<p id="t696" class="pln"><span class="str">below a value of 0.143. Note that when computing FSCs in other situations, for example, when comparing the final map produced with</span><span class="strut">&nbsp;</span></p>
<p id="t697" class="pln"><span class="str">all of the particle data to a higher resolution crystal structure, the more stringent 0.5 (actually 0.4) criterion must be used. Don&#39;t</span><span class="strut">&nbsp;</span></p>
<p id="t698" class="pln"><span class="str">overinterpret these plots. The FSC plots themselves contain some noise, so there is some uncertainty in any resolution value.&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t699" class="pln"><span class="str">&lt;p&gt;Also note that these curves are highly dependent on the mask used prior to FSC computation. See the next plot for more information</span><span class="strut">&nbsp;</span></p>
<p id="t700" class="pln"><span class="str">on this. This iteration comparison plot uses a relatively tight mask designed to be somewhat comparable to that used in Relion (though Relion is still more aggressive in masking).&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t701" class="pln"><span class="str">&lt;p&gt;These resolution curves should start at ~1 at low resolution, fall smoothly to ~0, then remain at roughly zero. The vertical range</span><span class="strut">&nbsp;</span></p>
<p id="t702" class="pln"><span class="str">of an FSC plot is -1 to 1. Some negative oscillations after reaching zero are normal. If the FSC curve falls towards zero, but then</span><span class="strut">&nbsp;</span></p>
<p id="t703" class="pln"><span class="str">rises again at high resolution this is an indication of an artifact, and the resolution values may not be trustworthy. Possible sources</span><span class="strut">&nbsp;</span></p>
<p id="t704" class="pln"><span class="str">include, but are not limited to: mask too tight, box size too small, reconstruction artifacts, ...&nbsp; If you observe an &quot;unhealthy&quot; FSC</span><span class="strut">&nbsp;</span></p>
<p id="t705" class="pln"><span class="str">curve here, please check the next plot, and see if the curve with a looser mask appears &quot;healthier&quot;.&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t706" class="pln"><span class="str">&lt;br&gt;&lt;a href=resolution.pdf&gt;&lt;img src=resolution.png&gt;&lt;/a&gt;&lt;br&gt;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t707" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t708" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;h4&gt;Mask Comparison&lt;/h4&gt; &lt;p&gt;As mentioned in the previous section, masking can have a significant impact on cited</span><span class="strut">&nbsp;</span></p>
<p id="t709" class="pln"><span class="str">resolution. For a while users who followed Relion&#39;s suggested procedure would find resolution values slightly better than those</span><span class="strut">&nbsp;</span></p>
<p id="t710" class="pln"><span class="str">produced by EMAN. This was due to Relion&#39;s use of a very tight mask, often extending into the core of the structure.&nbsp; EMAN2.1 now</span><span class="strut">&nbsp;</span></p>
<p id="t711" class="pln"><span class="str">generates 3 FSC curves automatically: 1) completely unmasked, 2) a loose, &quot;conservative&quot; mask and 3) a tighter mask which should be</span><span class="strut">&nbsp;</span></p>
<p id="t712" class="pln"><span class="str">somewhat similar to Relion 1.3 using its suggested parameters (though EMAN is still slightly more conservative). The plot below</span><span class="strut">&nbsp;</span></p>
<p id="t713" class="pln"><span class="str">compares these three FSC curves for the last completed iteration. The relevant mask files are also stored in the refinement folder as</span><span class="strut">&nbsp;</span></p>
<p id="t714" class="pln"><span class="str">mask.hdf and mask_tight.hdf. Note: if visualizing 3-D masks, it is generally a good idea to display as 2-D slices (single image view in</span><span class="strut">&nbsp;</span></p>
<p id="t715" class="pln"><span class="str">browser) rather than using isosurfaces, so any internal features of the mask can be readily observed.&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t716" class="pln"><span class="str">&lt;p&gt;If you see an &#39;unheathly&#39; looking unmasked curve (rising at high resolution, etc.), particularly if the masked curves look healthy, this can</span><span class="strut">&nbsp;</span></p>
<p id="t717" class="pln"><span class="str">indicate that your box-size is too small, and you are getting Fourier artifacts at the edge. It could also indicate some other problem, so if</span><span class="strut">&nbsp;</span></p>
<p id="t718" class="pln"><span class="str">re-extracting your boxed particles with a somewhat larger box doesn&#39;t fix the problem, please contact us, and we will help you to debug the problem.&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t719" class="pln"><span class="str">&lt;p&gt;If your goal is to compare EMAN2.1 results to Relion, the only way to reliably accomplish this is to extract the unmasked even and odd</span><span class="strut">&nbsp;</span></p>
<p id="t720" class="pln"><span class="str">gold-standard maps from both EMAN and RELION, mask them with exactly the same mask, then compute the FSC. For visual comparison of the final</span><span class="strut">&nbsp;</span></p>
<p id="t721" class="pln"><span class="str">gold-standard maps from both packages, you must insure that they are both identically filtered. This can be done easily by matching the 1-D</span><span class="strut">&nbsp;</span></p>
<p id="t722" class="pln"><span class="str">power spectrum of one of the maps to the other. For example &lt;i&gt;e2proc3d.py map_eman.hdf map_eman_cmp.hdf --process filter.matchto:to=map_relion.mrc&lt;/i&gt;&lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t723" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t724" class="pln"><span class="str">&lt;br&gt;&lt;a href=resolution_masks.pdf&gt;&lt;img src=resolution_masks.png&gt;&lt;/a&gt;&lt;br&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t725" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t726" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xticklocs</span><span class="op">=</span><span class="op">[</span><span class="nam">i</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="op">(</span><span class="num">.01</span><span class="op">,</span><span class="num">.05</span><span class="op">,</span><span class="num">.0833</span><span class="op">,</span><span class="num">.125</span><span class="op">,</span><span class="num">.1667</span><span class="op">,</span><span class="num">.2</span><span class="op">,</span><span class="num">.25</span><span class="op">,</span><span class="num">.3333</span><span class="op">,</span><span class="num">.4</span><span class="op">,</span><span class="num">.5</span><span class="op">)</span> <span class="key">if</span> <span class="nam">i</span><span class="op">&lt;</span><span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="num">2.0</span><span class="op">*</span><span class="nam">apix</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t727" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xticklbl</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;1/100&quot;</span><span class="op">,</span><span class="str">&quot;1/20&quot;</span><span class="op">,</span><span class="str">&quot;1/12&quot;</span><span class="op">,</span><span class="str">&quot;1/8&quot;</span><span class="op">,</span><span class="str">&quot;1/6&quot;</span><span class="op">,</span><span class="str">&quot;1/5&quot;</span><span class="op">,</span><span class="str">&quot;1/4&quot;</span><span class="op">,</span><span class="str">&quot;1/3&quot;</span><span class="op">,</span><span class="str">&quot;1/2.5&quot;</span><span class="op">,</span><span class="str">&quot;1/2&quot;</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="nam">len</span><span class="op">(</span><span class="nam">xticklocs</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t728" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yticklocs</span><span class="op">=</span><span class="op">(</span><span class="num">0.0</span><span class="op">,</span><span class="num">.125</span><span class="op">,</span><span class="num">.143</span><span class="op">,</span><span class="num">.25</span><span class="op">,</span><span class="num">.375</span><span class="op">,</span><span class="num">.5</span><span class="op">,</span><span class="num">.625</span><span class="op">,</span><span class="num">.75</span><span class="op">,</span><span class="num">.875</span><span class="op">,</span><span class="num">1.0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t729" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yticklbl</span><span class="op">=</span><span class="op">(</span><span class="str">&quot;0&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;0.143&quot;</span><span class="op">,</span><span class="str">&quot;0.25&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;0.5&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;0.75&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;1.0&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t730" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yticklocs2</span><span class="op">=</span><span class="op">(</span><span class="num">0.0</span><span class="op">,</span><span class="num">.125</span><span class="op">,</span><span class="num">.25</span><span class="op">,</span><span class="num">.375</span><span class="op">,</span><span class="num">.5</span><span class="op">,</span><span class="num">.625</span><span class="op">,</span><span class="num">.75</span><span class="op">,</span><span class="num">.875</span><span class="op">,</span><span class="num">1.0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t731" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yticklbl2</span><span class="op">=</span><span class="op">(</span><span class="str">&quot;0&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;0.25&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;0.5&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;0.75&quot;</span><span class="op">,</span><span class="str">&quot; &quot;</span><span class="op">,</span><span class="str">&quot;1.0&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t732" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t733" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">initclassiter</span><span class="op">=</span><span class="nam">classiter</span><span class="strut">&nbsp;</span></p>
<p id="t734" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="nam">classiter</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="strut">&nbsp;</span></p>
<p id="t735" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Actual refinement loop ###</span><span class="strut">&nbsp;</span></p>
<p id="t736" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">it</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">1</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">+</span><span class="num">1</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t737" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;h4&gt;Beginning iteration {} at {}&lt;/h4&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">,</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t738" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t739" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># adjustments to classiter</span><span class="strut">&nbsp;</span></p>
<p id="t740" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">classiter</span><span class="op">&lt;</span><span class="num">0</span> <span class="key">and</span> <span class="nam">classiter</span><span class="op">==</span><span class="nam">initclassiter</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t741" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">&gt;</span><span class="num">3</span> <span class="key">and</span> <span class="nam">it</span><span class="op">==</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">-</span><span class="num">2</span><span class="op">)</span> <span class="key">or</span> <span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">&gt;</span><span class="num">2</span> <span class="key">and</span> <span class="nam">it</span><span class="op">==</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">-</span><span class="num">1</span><span class="op">)</span> <span class="key">or</span> <span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span><span class="op">==</span><span class="num">2</span> <span class="key">and</span> <span class="nam">it</span><span class="op">==</span><span class="num">2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t742" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">initclassiter</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="nam">classiter</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t743" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">initclassiter</span><span class="op">==</span><span class="num">1</span> <span class="op">:</span> <span class="nam">classiter</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t744" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;*** Changing classiter from {} to {} ***&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">initclassiter</span><span class="op">,</span><span class="nam">classiter</span><span class="op">)</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t745" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t746" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### nogoldfinal</span><span class="strut">&nbsp;</span></p>
<p id="t747" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># averages even and odd maps together to disable gold-standard in last iteration</span><span class="strut">&nbsp;</span></p>
<p id="t748" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">nogoldfinal</span> <span class="key">and</span> <span class="nam">it</span><span class="op">==</span><span class="nam">options</span><span class="op">.</span><span class="nam">iter</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t749" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl1</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/threed_{itrm1:02d}_even.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t750" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl2</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/threed_{itrm1:02d}_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t751" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl1</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">mdl2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t752" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl1</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{path}/threed_{itrm1:02d}_even.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t753" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl1</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{path}/threed_{itrm1:02d}_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t754" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl1</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t755" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mdl2</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t756" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t757" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### 3-D Projections</span><span class="strut">&nbsp;</span></p>
<p id="t758" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Note that projections are generated on a single node only as specified by --threads</span><span class="strut">&nbsp;</span></p>
<p id="t759" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Generating 2-D projections of even/odd 3-D maps&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t760" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2project3d.py {path}/threed_{itrm1:02d}_even.hdf&nbsp; --outfile {path}/projections_{itr:02d}_even.hdf -f --projector {projector} --orientgen {orient} --sym {sym} {prethr} --parallel thread:{threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t761" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">projector</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">projector</span><span class="op">,</span><span class="nam">orient</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">,</span><span class="nam">sym</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sym</span><span class="op">,</span><span class="nam">prethr</span><span class="op">=</span><span class="nam">prethreshold</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t762" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t763" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2project3d.py&nbsp; {path}/threed_{itrm1:02d}_odd.hdf --outfile {path}/projections_{itr:02d}_odd.hdf -f --projector {projector} --orientgen {orient} --sym {sym} {prethr} --parallel thread:{threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t764" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">projector</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">projector</span><span class="op">,</span><span class="nam">orient</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">orientgen</span><span class="op">,</span><span class="nam">sym</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sym</span><span class="op">,</span><span class="nam">prethr</span><span class="op">=</span><span class="nam">prethreshold</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t765" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t766" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t767" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t768" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t769" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### We may need to make our own similarity mask file for more accurate particle classification</span><span class="strut">&nbsp;</span></p>
<p id="t770" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">makesimmask</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t771" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">av</span><span class="op">=</span><span class="nam">Averagers</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="str">&quot;minmax&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;max&quot;</span><span class="op">:</span><span class="num">1</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t772" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nprj</span><span class="op">=</span><span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="str">&quot;{path}/projections_{itr:02d}_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t773" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Mask from {} projections&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">nprj</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t774" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">nprj</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t775" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">a</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/projections_{itr:02d}_even.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t776" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">av</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span><span class="nam">a</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t777" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">a</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="str">&quot;{path}/projections_{itr:02d}_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t778" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">av</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span><span class="nam">a</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t779" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">msk</span><span class="op">=</span><span class="nam">av</span><span class="op">.</span><span class="nam">finish</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t780" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; msk.process_inplace(&quot;threshold.binary&quot;,{&quot;value&quot;:msk[&quot;sigma&quot;]/50.0})</span><span class="strut">&nbsp;</span></p>
<p id="t781" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">msk</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;threshold.notzero&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t782" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">msk</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="str">&quot;{path}/simmask.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t783" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t784" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">treeclassify</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t785" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Classify using a binary tree</span><span class="strut">&nbsp;</span></p>
<p id="t786" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Classify each particle using a binary tree generated from the projections&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t787" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classifytree.py {path}/projections_{itr:02d}_even.hdf {inputfile} --output={path}/classmx_{itr:02d}_even.hdf&nbsp; --nodes {path}/nodes_{itr:02d}_even.hdf --cmp {simcmp} --align {simalign} --aligncmp {simaligncmp} {simralign} {cmpdiff} --incomplete {incomplete} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">cmpdiff</span><span class="op">=</span><span class="nam">cmpdiff</span><span class="op">,</span><span class="nam">incomplete</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">treeincomplete</span><span class="op">,</span> <span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t788" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t789" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t790" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t791" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classifytree.py {path}/projections_{itr:02d}_odd.hdf {inputfile} --output={path}/classmx_{itr:02d}_odd.hdf&nbsp; --nodes {path}/nodes_{itr:02d}_odd.hdf --cmp {simcmp} --align {simalign} --aligncmp {simaligncmp} {simralign} {cmpdiff} --incomplete {incomplete} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">cmpdiff</span><span class="op">=</span><span class="nam">cmpdiff</span><span class="op">,</span><span class="nam">incomplete</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">treeincomplete</span><span class="op">,</span><span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t792" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t793" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t794" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t795" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">options</span><span class="op">.</span><span class="nam">bispec</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t796" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### FIXME - hard-coded rotate_translate aligner here due to odd irreproducible memory related crashes with rotate_translate_tree:flip=0&nbsp;&nbsp; 8/22/17</span><span class="strut">&nbsp;</span></p>
<p id="t797" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Computing similarity of each particle to the set of projections using bispectra. This avoids alignment, and permits classification in a single step.&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t798" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classesbyref.py {path}/projections_{itr:02d}_even.hdf {inputfile} --classmx {path}/classmx_{itr:02d}_even.hdf --classinfo {path}/classinfo_{itr:02d}_even.json --classes {path}/classes_{itr:02}_even.hdf --averager {averager} --cmp {simcmp} --align rotate_translate_tree --aligncmp {simaligncmp} {simralign} {verbose} --sep {sep} --threads {threads}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t799" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">sep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">,</span><span class="nam">averager</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t800" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t801" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t802" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t803" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classesbyref.py {path}/projections_{itr:02d}_odd.hdf {inputfile} --classmx {path}/classmx_{itr:02d}_odd.hdf --classinfo {path}/classinfo_{itr:02d}_odd.json --classes {path}/classes_{itr:02}_odd.hdf --averager {averager} --cmp {simcmp} --align rotate_translate_tree --aligncmp {simaligncmp} {simralign} {verbose} --sep {sep} --threads {threads}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t804" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="nam">sep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">,</span><span class="nam">averager</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t805" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t806" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t807" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t808" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t809" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t810" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t811" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Simmx</span><span class="strut">&nbsp;</span></p>
<p id="t812" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#FIXME - Need to combine simmx with classification !!!</span><span class="strut">&nbsp;</span></p>
<p id="t813" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t814" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Computing similarity of each particle to the set of projections using a hierarchical scheme. This will be the basis for classification.&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t815" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2simmx2stage.py {path}/projections_{itr:02d}_even.hdf {inputfile} {path}/simmx_{itr:02d}_even.hdf {path}/proj_simmx_{itr:02d}_even.hdf {path}/proj_stg1_{itr:02d}_even.hdf {path}/simmx_stg1_{itr:02d}_even.hdf --saveali --cmp {simcmp} \</span><span class="strut">&nbsp;</span></p>
<p id="t816" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --align {simalign} --aligncmp {simaligncmp} {simralign} {shrinks1} {shrink} {prefilt} {simmask} {verbose} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t817" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t818" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrinks1</span><span class="op">=</span><span class="nam">shrinks1</span><span class="op">,</span><span class="nam">shrink</span><span class="op">=</span><span class="nam">shrink</span><span class="op">,</span><span class="nam">prefilt</span><span class="op">=</span><span class="nam">prefilt</span><span class="op">,</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span><span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t819" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t820" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2simmx2stage.py {path}/projections_{itr:02d}_odd.hdf {inputfile} {path}/simmx_{itr:02d}_odd.hdf {path}/proj_simmx_{itr:02d}_odd.hdf {path}/proj_stg1_{itr:02d}_odd.hdf {path}/simmx_stg1_{itr:02d}_odd.hdf --saveali --cmp {simcmp} \</span><span class="strut">&nbsp;</span></p>
<p id="t821" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --align {simalign} --aligncmp {simaligncmp} {simralign} {shrinks1} {shrink} {prefilt} {simmask} {verbose} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t822" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">inputfile</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">input</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">simcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simcmp</span><span class="op">,</span><span class="nam">simalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simalign</span><span class="op">,</span><span class="nam">simaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">simaligncmp</span><span class="op">,</span><span class="nam">simralign</span><span class="op">=</span><span class="nam">simralign</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t823" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrinks1</span><span class="op">=</span><span class="nam">shrinks1</span><span class="op">,</span><span class="nam">shrink</span><span class="op">=</span><span class="nam">shrink</span><span class="op">,</span><span class="nam">prefilt</span><span class="op">=</span><span class="nam">prefilt</span><span class="op">,</span><span class="nam">simmask</span><span class="op">=</span><span class="nam">simmask</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span><span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t824" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t825" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t826" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t827" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t828" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Classify</span><span class="strut">&nbsp;</span></p>
<p id="t829" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Based on the similarity values, put each particle in to 1 or more classes (depending on --sep)&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t830" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classify.py {path}/simmx_{itr:02d}_even.hdf {path}/classmx_{itr:02d}_even.hdf -f --sep {sep} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t831" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">sep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t832" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t833" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span> <span class="op">=</span> <span class="str">&quot;e2classify.py {path}/simmx_{itr:02d}_odd.hdf {path}/classmx_{itr:02d}_odd.hdf -f --sep {sep} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t834" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">sep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sep</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t835" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t836" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t837" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t838" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t839" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Class-averaging</span><span class="strut">&nbsp;</span></p>
<p id="t840" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t841" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># we need to decide on a postprocessing amplitude correction scheme here, because it may impact class-averaging</span><span class="strut">&nbsp;</span></p>
<p id="t842" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">ampcorrect</span><span class="op">==</span><span class="str">&quot;auto&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t843" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t844" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># In the first iteration if targetres is 7 or better, we give it the benefit of the doubt and use flatten (changed 5/11/16)</span><span class="strut">&nbsp;</span></p>
<p id="t845" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">&lt;=</span><span class="num">7</span> <span class="key">and</span> <span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">&lt;</span><span class="num">9.0</span> <span class="op">:</span> <span class="nam">ampcorrect</span><span class="op">=</span><span class="str">&quot;flatten&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t846" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">ampcorrect</span><span class="op">=</span><span class="str">&quot;strucfac&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t847" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t848" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ampcorrect</span><span class="op">=</span><span class="str">&quot;strucfac&quot;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># first iteration</span><span class="strut">&nbsp;</span></p>
<p id="t849" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Auto amplitude correction using mode:{} in this iteration&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">ampcorrect</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t850" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="nam">ampcorrect</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">ampcorrect</span><span class="strut">&nbsp;</span></p>
<p id="t851" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t852" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">ampcorrect</span><span class="op">!=</span><span class="str">&quot;strucfac&quot;</span> <span class="key">and</span> <span class="nam">classrefsf</span><span class="op">!=</span><span class="str">&quot;&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t853" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classrefsf</span><span class="op">=</span><span class="str">&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t854" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Warning: Not using structure factor amplitude correction, so disabling classrefsf option&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t855" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Warning: classrefsf option requires &#39;strucfac&#39; amplitude correction. Since this is not being used either by intent or due to the high resolution of the map, &#39;classrefsf&#39; has been disabled.&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t856" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t857" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">options</span><span class="op">.</span><span class="nam">bispec</span> <span class="key">or</span> <span class="nam">classiter</span><span class="op">!=</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t858" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Iteratively align and average all of the particles within each class, discarding the worst fraction&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t859" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2classaverage.py {inputfile} --classmx {path}/classmx_{itr:02d}_even.hdf --decayedge --storebad --output {path}/classes_{itr:02d}_even.hdf --ref {path}/projections_{itr:02d}_even.hdf --iter {classiter} \</span><span class="strut">&nbsp;</span></p>
<p id="t860" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; -f --resultmx {path}/cls_result_{itr:02d}_even.hdf --normproc {normproc} --averager {averager} {classrefsf} {classautomask} --keep {classkeep} {classkeepsig} --cmp {classcmp} \</span><span class="strut">&nbsp;</span></p>
<p id="t861" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --align {classalign} --aligncmp {classaligncmp} {classralign} {prefilt} {verbose} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t862" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">inputfile</span><span class="op">=</span><span class="nam">cainput</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span> <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">classiter</span><span class="op">=</span><span class="nam">classiter</span><span class="op">,</span> <span class="nam">normproc</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classnormproc</span><span class="op">,</span> <span class="nam">averager</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">,</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="nam">classrefsf</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t863" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classautomask</span><span class="op">=</span><span class="nam">classautomask</span><span class="op">,</span><span class="nam">classkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classkeep</span><span class="op">,</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="nam">classkeepsig</span><span class="op">,</span> <span class="nam">classcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">,</span> <span class="nam">classalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classalign</span><span class="op">,</span> <span class="nam">classaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t864" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classralign</span><span class="op">=</span><span class="nam">classralign</span><span class="op">,</span> <span class="nam">prefilt</span><span class="op">=</span><span class="nam">prefilt</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span> <span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t865" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t866" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2classaverage.py {inputfile} --classmx {path}/classmx_{itr:02d}_odd.hdf --decayedge --storebad --output {path}/classes_{itr:02d}_odd.hdf --ref {path}/projections_{itr:02d}_odd.hdf --iter {classiter} \</span><span class="strut">&nbsp;</span></p>
<p id="t867" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; -f --resultmx {path}/cls_result_{itr:02d}_odd.hdf --normproc {normproc} --averager {averager} {classrefsf} {classautomask} --keep {classkeep} {classkeepsig} --cmp {classcmp} \</span><span class="strut">&nbsp;</span></p>
<p id="t868" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; --align {classalign} --aligncmp {classaligncmp} {classralign} {prefilt} {verbose} {parallel}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t869" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">inputfile</span><span class="op">=</span><span class="nam">cainput</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">classiter</span><span class="op">=</span><span class="nam">classiter</span><span class="op">,</span> <span class="nam">normproc</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classnormproc</span><span class="op">,</span> <span class="nam">averager</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaverager</span><span class="op">,</span> <span class="nam">classrefsf</span><span class="op">=</span><span class="nam">classrefsf</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t870" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classautomask</span><span class="op">=</span><span class="nam">classautomask</span><span class="op">,</span><span class="nam">classkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classkeep</span><span class="op">,</span> <span class="nam">classkeepsig</span><span class="op">=</span><span class="nam">classkeepsig</span><span class="op">,</span> <span class="nam">classcmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classcmp</span><span class="op">,</span> <span class="nam">classalign</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classalign</span><span class="op">,</span> <span class="nam">classaligncmp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">classaligncmp</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t871" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">classralign</span><span class="op">=</span><span class="nam">classralign</span><span class="op">,</span> <span class="nam">prefilt</span><span class="op">=</span><span class="nam">prefilt</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">,</span> <span class="nam">parallel</span><span class="op">=</span><span class="nam">parallel</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t872" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t873" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t874" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t875" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t876" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Refine Euler angles of class-averages</span><span class="strut">&nbsp;</span></p>
<p id="t877" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">eulerrefine</span> <span class="key">and</span> <span class="nam">it</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t878" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2euler_refine.py --input {path}/classes_{itr:02d}_even.hdf --ref_volume {path}/threed_{itrm1:02d}_even.hdf --threads {threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t879" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t880" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t881" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t882" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2euler_refine.py --input {path}/classes_{itr:02d}_odd.hdf --ref_volume {path}/threed_{itrm1:02d}_odd.hdf --threads {threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t883" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span><span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t884" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t885" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t886" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### 3-D Reconstruction</span><span class="strut">&nbsp;</span></p>
<p id="t887" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># FIXME - --lowmem removed due to some tricky bug in e2make3d</span><span class="strut">&nbsp;</span></p>
<p id="t888" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">breaksym</span> <span class="op">:</span> <span class="nam">m3dsym</span><span class="op">=</span><span class="str">&quot;c1&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t889" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">m3dsym</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">sym</span><span class="strut">&nbsp;</span></p>
<p id="t890" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;* Using the known orientations, reconstruct the even/odd 3-D maps from the even/odd 2-D class-averages.&lt;/p&gt;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t891" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t892" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dold</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t893" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2make3dpar.py --input {path}/classes_{itr:02d}_even.hdf --sym {sym} --output {path}/threed_{itr:02d}_even.hdf {preprocess} \</span><span class="strut">&nbsp;</span></p>
<p id="t894" class="pln"><span class="str"> --keep {m3dkeep} {keepsig} --apix {apix} --pad {m3dpad} --iterative --threads {threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t895" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">m3dsym</span><span class="op">,</span> <span class="nam">recon</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">recon</span><span class="op">,</span> <span class="nam">preprocess</span><span class="op">=</span><span class="nam">m3dpreprocess</span><span class="op">,</span>&nbsp; <span class="nam">m3dkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeep</span><span class="op">,</span> <span class="nam">keepsig</span><span class="op">=</span><span class="nam">m3dkeepsig</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t896" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dpad</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">,</span><span class="nam">fillangle</span><span class="op">=</span><span class="nam">astep</span> <span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t897" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">it</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="nam">cmd</span><span class="op">=</span><span class="nam">cmd</span><span class="op">+</span><span class="str">&quot; --itermask {path}/mask.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t898" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t899" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2make3d.py --input {path}/classes_{itr:02d}_even.hdf --iter 2 -f --sym {sym} --output {path}/threed_{itr:02d}_even.hdf --recon {recon} {preprocess} \</span><span class="strut">&nbsp;</span></p>
<p id="t900" class="pln"><span class="str"> --keep={m3dkeep} {keepsig} --apix={apix} --pad={m3dpad} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t901" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">m3dsym</span><span class="op">,</span> <span class="nam">recon</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">recon</span><span class="op">,</span> <span class="nam">preprocess</span><span class="op">=</span><span class="nam">m3dpreprocess</span><span class="op">,</span>&nbsp; <span class="nam">m3dkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeep</span><span class="op">,</span> <span class="nam">keepsig</span><span class="op">=</span><span class="nam">m3dkeepsig</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t902" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dpad</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">,</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t903" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t904" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if options.classweight == &quot;count&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t905" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; pass # this is the default.</span><span class="strut">&nbsp;</span></p>
<p id="t906" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#elif options.classweight == &quot;sqrt&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t907" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; cmd += &quot; --sqrtnorm&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t908" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#elif options.classwright == &quot;no_wt&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t909" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; cmd += &quot; --no_wt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t910" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t911" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t912" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t913" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">options</span><span class="op">.</span><span class="nam">m3dold</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t914" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2make3dpar.py --input {path}/classes_{itr:02d}_odd.hdf --sym {sym} --output {path}/threed_{itr:02d}_odd.hdf {preprocess} \</span><span class="strut">&nbsp;</span></p>
<p id="t915" class="pln"><span class="str"> --keep {m3dkeep} {keepsig} --apix {apix} --pad {m3dpad} --iterative --threads {threads} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t916" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">m3dsym</span><span class="op">,</span> <span class="nam">recon</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">recon</span><span class="op">,</span> <span class="nam">preprocess</span><span class="op">=</span><span class="nam">m3dpreprocess</span><span class="op">,</span> <span class="nam">m3dkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeep</span><span class="op">,</span> <span class="nam">keepsig</span><span class="op">=</span><span class="nam">m3dkeepsig</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t917" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dpad</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">,</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">,</span> <span class="nam">fillangle</span><span class="op">=</span><span class="nam">astep</span> <span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t918" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">it</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="nam">cmd</span><span class="op">=</span><span class="nam">cmd</span><span class="op">+</span><span class="str">&quot; --itermask {path}/mask.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t919" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t920" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2make3d.py --input {path}/classes_{itr:02d}_odd.hdf --iter 2 -f --sym {sym} --output {path}/threed_{itr:02d}_odd.hdf --recon {recon} {preprocess} \</span><span class="strut">&nbsp;</span></p>
<p id="t921" class="pln"><span class="str"> --keep={m3dkeep} {keepsig} --apix={apix} --pad={m3dpad} {verbose}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="strut">&nbsp;</span></p>
<p id="t922" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">m3dsym</span><span class="op">,</span> <span class="nam">recon</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">recon</span><span class="op">,</span> <span class="nam">preprocess</span><span class="op">=</span><span class="nam">m3dpreprocess</span><span class="op">,</span> <span class="nam">m3dkeep</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">m3dkeep</span><span class="op">,</span> <span class="nam">keepsig</span><span class="op">=</span><span class="nam">m3dkeepsig</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t923" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">m3dpad</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">pad</span><span class="op">,</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">apix</span><span class="op">,</span> <span class="nam">verbose</span><span class="op">=</span><span class="nam">verbose</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t924" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t925" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if options.classweight == &quot;count&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t926" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; pass # this is the default.</span><span class="strut">&nbsp;</span></p>
<p id="t927" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#elif options.classweight == &quot;sqrt&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t928" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; cmd += &quot; --sqrtnorm&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t929" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#elif options.classwright == &quot;no_wt&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t930" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; cmd += &quot; --no_wt&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t931" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t932" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t933" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progress</span> <span class="op">+=</span> <span class="num">1.0</span><span class="strut">&nbsp;</span></p>
<p id="t934" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t935" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### postprocessing</span><span class="strut">&nbsp;</span></p>
<p id="t936" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;* Finally, determine the resolution, filter and mask the even/odd maps, and then produce the final 3-D map for this iteration.</span><span class="strut">&nbsp;</span></p>
<p id="t937" class="pln"><span class="str">Note that the next iteration is seeded with the individual even/odd maps, not the final average.&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t938" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">evenfile</span><span class="op">=</span><span class="str">&quot;{path}/threed_{itr:02d}_even.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t939" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">oddfile</span><span class="op">=</span><span class="str">&quot;{path}/threed_{itr:02d}_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t940" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">combfile</span><span class="op">=</span><span class="str">&quot;{path}/threed_{itr:02d}.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t941" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="str">&quot;e2refine_postprocess.py --even {path}/threed_{it:02d}_even.hdf --odd {path}/threed_{it:02d}_odd.hdf --output {path}/threed_{it:02d}.hdf --automaskexpand {amaskxp} \</span><span class="strut">&nbsp;</span></p>
<p id="t942" class="pln"><span class="str">--align --mass {mass} --iter {it} {amask3d} {amask3d2} {m3dpostproc} {setsf} {tophat} --sym {sym} --restarget {restarget} --underfilter --ampcorrect {ampcorrect} --threads {threads}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="xx">\</span><span class="strut">&nbsp;</span></p>
<p id="t943" class="pln"><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span> <span class="nam">it</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span> <span class="nam">mass</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">mass</span><span class="op">,</span> <span class="nam">amask3d</span><span class="op">=</span><span class="nam">amask3d</span><span class="op">,</span> <span class="nam">sym</span><span class="op">=</span><span class="nam">m3dsym</span><span class="op">,</span> <span class="nam">amask3d2</span><span class="op">=</span><span class="nam">amask3d2</span><span class="op">,</span> <span class="nam">m3dpostproc</span><span class="op">=</span><span class="nam">m3dpostproc</span><span class="op">,</span> <span class="nam">setsf</span><span class="op">=</span><span class="nam">m3dsetsf</span><span class="op">,</span> <span class="nam">restarget</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">,</span> <span class="nam">amaskxp</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">automaskexpand</span><span class="op">,</span><span class="xx">\</span><span class="strut">&nbsp;</span></p>
<p id="t944" class="pln"><span class="nam">ampcorrect</span><span class="op">=</span><span class="nam">ampcorrect</span><span class="op">,</span><span class="nam">tophat</span><span class="op">=</span><span class="nam">tophat</span><span class="op">,</span><span class="nam">threads</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">threads</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t945" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t946" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">db</span><span class="op">.</span><span class="nam">update</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;last_map&quot;</span><span class="op">:</span><span class="nam">combfile</span><span class="op">,</span><span class="str">&quot;last_even&quot;</span><span class="op">:</span><span class="nam">evenfile</span><span class="op">,</span><span class="str">&quot;last_odd&quot;</span><span class="op">:</span><span class="nam">oddfile</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t947" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t948" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">##################################################################</span><span class="strut">&nbsp;</span></p>
<p id="t949" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Generating FSC plots and other output for the report files ###</span><span class="strut">&nbsp;</span></p>
<p id="t950" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t951" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Convergenece plot</span><span class="strut">&nbsp;</span></p>
<p id="t952" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">it</span><span class="op">&gt;</span><span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t953" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2proc3d.py {path}/threed_{itr:02d}_even.hdf {path}/converge_even_{itrm1:02d}_{itr:02d}.txt --calcfsc {path}/threed_{itrm1:02d}_even.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t954" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t955" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cmd</span><span class="op">=</span><span class="str">&quot;e2proc3d.py {path}/threed_{itr:02d}_odd.hdf {path}/converge_odd_{itrm1:02d}_{itr:02d}.txt --calcfsc {path}/threed_{itrm1:02d}_odd.hdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">itr</span><span class="op">=</span><span class="nam">it</span><span class="op">,</span><span class="nam">itrm1</span><span class="op">=</span><span class="nam">it</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t956" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">run</span><span class="op">(</span><span class="nam">cmd</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t957" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t958" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t959" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">title</span><span class="op">(</span><span class="str">&quot;Convergence plot (not resolution)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t960" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">xlabel</span><span class="op">(</span><span class="str">r&quot;Spatial Frequency (1/$\AA$)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t961" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">ylabel</span><span class="op">(</span><span class="str">&quot;FSC&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t962" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cnvrg</span><span class="op">=</span><span class="op">[</span><span class="nam">i</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span> <span class="key">if</span> <span class="str">&quot;converge_&quot;</span> <span class="key">in</span> <span class="nam">i</span> <span class="key">and</span> <span class="nam">i</span><span class="op">[</span><span class="op">-</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;.txt&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t963" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">cnvrg</span><span class="op">.</span><span class="nam">sort</span><span class="op">(</span><span class="nam">reverse</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t964" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nummx</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">cnvrg</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;_&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t965" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">maxx</span><span class="op">=</span><span class="num">0.01</span><span class="strut">&nbsp;</span></p>
<p id="t966" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">c</span> <span class="key">in</span> <span class="nam">cnvrg</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t967" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">num</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">c</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;_&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t968" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">loadtxt</span><span class="op">(</span><span class="str">&quot;{}/{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">c</span><span class="op">)</span><span class="op">)</span><span class="op">.</span><span class="nam">transpose</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t969" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">c</span><span class="op">[</span><span class="num">9</span><span class="op">:</span><span class="num">13</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;even&quot;</span> <span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">label</span><span class="op">=</span><span class="nam">c</span><span class="op">[</span><span class="num">14</span><span class="op">:</span><span class="op">-</span><span class="num">4</span><span class="op">]</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="nam">pltcolors</span><span class="op">[</span><span class="op">(</span><span class="nam">nummx</span><span class="op">-</span><span class="nam">num</span><span class="op">)</span><span class="op">%</span><span class="num">12</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t970" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="nam">pltcolors</span><span class="op">[</span><span class="op">(</span><span class="nam">nummx</span><span class="op">-</span><span class="nam">num</span><span class="op">)</span><span class="op">%</span><span class="num">12</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t971" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">maxx</span><span class="op">=</span><span class="nam">max</span><span class="op">(</span><span class="nam">maxx</span><span class="op">,</span><span class="nam">max</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t972" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="num">0.0</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">&quot;k&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t973" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axis</span><span class="op">(</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">maxx</span><span class="op">,</span><span class="op">-</span><span class="num">.06</span><span class="op">,</span><span class="num">1.02</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t974" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">legend</span><span class="op">(</span><span class="nam">loc</span><span class="op">=</span><span class="str">&quot;upper right&quot;</span><span class="op">,</span><span class="nam">fontsize</span><span class="op">=</span><span class="str">&quot;x-small&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t975" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#plt.minorticks_on()</span><span class="strut">&nbsp;</span></p>
<p id="t976" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">xticks</span><span class="op">(</span><span class="nam">xticklocs</span><span class="op">,</span><span class="nam">xticklbl</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t977" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">yticks</span><span class="op">(</span><span class="nam">yticklocs2</span><span class="op">,</span><span class="nam">yticklbl2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t978" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">savefig</span><span class="op">(</span><span class="str">&quot;{}/report/converge.png&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t979" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">savefig</span><span class="op">(</span><span class="str">&quot;{}/report/converge.pdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t980" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t981" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">clf</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t982" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t983" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t984" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t985" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Error generating convergence plot in report. Please look at fsc* files in the refine_xx folder&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t986" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t987" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">######################</span><span class="strut">&nbsp;</span></p>
<p id="t988" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Resolution plot</span><span class="strut">&nbsp;</span></p>
<p id="t989" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### broken up into multiple try/except blocks because we need some of the info, even if plotting fails</span><span class="strut">&nbsp;</span></p>
<p id="t990" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t991" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">title</span><span class="op">(</span><span class="str">&quot;Gold Standard Resolution (tight mask)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t992" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">xlabel</span><span class="op">(</span><span class="str">r&quot;Spatial Frequency (1/$\AA$)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t993" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">ylabel</span><span class="op">(</span><span class="str">&quot;FSC&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t994" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t995" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t996" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t997" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fscs</span><span class="op">=</span><span class="op">[</span><span class="nam">i</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">os</span><span class="op">.</span><span class="nam">listdir</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span> <span class="key">if</span> <span class="str">&quot;fsc_maskedtight&quot;</span> <span class="key">in</span> <span class="nam">i</span> <span class="key">and</span> <span class="nam">i</span><span class="op">[</span><span class="op">-</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;.txt&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t998" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fscs</span><span class="op">.</span><span class="nam">sort</span><span class="op">(</span><span class="nam">reverse</span><span class="op">=</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t999" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nummx</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">fscs</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;_&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1000" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">maxx</span><span class="op">=</span><span class="num">0.01</span><span class="strut">&nbsp;</span></p>
<p id="t1001" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1002" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># iterate over fsc curves</span><span class="strut">&nbsp;</span></p>
<p id="t1003" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">fi</span><span class="op">,</span><span class="nam">f</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">fscs</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1004" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">num</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">f</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;_&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1005" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1006" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># read the fsc curve</span><span class="strut">&nbsp;</span></p>
<p id="t1007" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">loadtxt</span><span class="op">(</span><span class="str">&quot;{}/{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">f</span><span class="op">)</span><span class="op">)</span><span class="op">.</span><span class="nam">transpose</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1008" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1009" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># plot the curve</span><span class="strut">&nbsp;</span></p>
<p id="t1010" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">label</span><span class="op">=</span><span class="nam">f</span><span class="op">[</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="nam">pltcolors</span><span class="op">[</span><span class="op">(</span><span class="nam">nummx</span><span class="op">-</span><span class="nam">num</span><span class="op">)</span><span class="op">%</span><span class="num">12</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1011" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1012" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">maxx</span><span class="op">=</span><span class="nam">max</span><span class="op">(</span><span class="nam">maxx</span><span class="op">,</span><span class="nam">max</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1013" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1014" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># find the resolution from the first curve (the highest numbered one)</span><span class="strut">&nbsp;</span></p>
<p id="t1015" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">f</span><span class="op">==</span><span class="nam">fscs</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1016" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">lastnum</span><span class="op">=</span><span class="nam">num</span><span class="strut">&nbsp;</span></p>
<p id="t1017" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># find the 0.143 crossing</span><span class="strut">&nbsp;</span></p>
<p id="t1018" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">si</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">2</span><span class="op">,</span><span class="nam">len</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="num">2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1019" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">&gt;</span><span class="num">0.143</span> <span class="key">and</span> <span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">&lt;=</span><span class="num">0.143</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1020" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">frac</span><span class="op">=</span><span class="op">(</span><span class="num">0.143</span><span class="op">-</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># 1.0 if 0.143 at si-1, 0.0 if .143 at si</span><span class="strut">&nbsp;</span></p>
<p id="t1021" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">lastres</span><span class="op">=</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="num">1.0</span><span class="op">-</span><span class="nam">frac</span><span class="op">)</span><span class="op">+</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="nam">frac</span><span class="strut">&nbsp;</span></p>
<p id="t1022" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1023" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">annotate</span><span class="op">(</span><span class="str">r&quot;{:1.1f} $\AA$&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">)</span><span class="op">,</span><span class="nam">xy</span><span class="op">=</span><span class="op">(</span><span class="nam">lastres</span><span class="op">,</span><span class="num">0.143</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t1024" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xytext</span><span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="nam">lastres</span><span class="op">*</span><span class="num">4</span><span class="op">+</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="num">5.0</span><span class="op">,</span><span class="num">0.2</span><span class="op">+</span><span class="num">0.05</span><span class="op">*</span><span class="nam">fi</span><span class="op">)</span><span class="op">,</span><span class="nam">arrowprops</span><span class="op">=</span><span class="op">{</span><span class="str">&quot;width&quot;</span><span class="op">:</span><span class="num">1</span><span class="op">,</span><span class="str">&quot;frac&quot;</span><span class="op">:</span><span class="num">.1</span><span class="op">,</span><span class="str">&quot;headwidth&quot;</span><span class="op">:</span><span class="num">7</span><span class="op">,</span><span class="str">&quot;shrink&quot;</span><span class="op">:</span><span class="num">.05</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1025" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1026" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t1027" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">lastres</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t1028" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1029" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1030" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="num">0.0</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">&quot;k&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1031" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="num">0.143</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">&quot;#306030&quot;</span><span class="op">,</span><span class="nam">linestyle</span><span class="op">=</span><span class="str">&quot;:&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1032" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axis</span><span class="op">(</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">maxx</span><span class="op">,</span><span class="op">-</span><span class="num">.02</span><span class="op">,</span><span class="num">1.02</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1033" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plt.legend(loc=&quot;lower left&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t1034" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">legend</span><span class="op">(</span><span class="nam">loc</span><span class="op">=</span><span class="str">&quot;upper right&quot;</span><span class="op">,</span><span class="nam">fontsize</span><span class="op">=</span><span class="str">&quot;x-small&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1035" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plt.minorticks_on()</span><span class="strut">&nbsp;</span></p>
<p id="t1036" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">xticks</span><span class="op">(</span><span class="nam">xticklocs</span><span class="op">,</span><span class="nam">xticklbl</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1037" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">yticks</span><span class="op">(</span><span class="nam">yticklocs</span><span class="op">,</span><span class="nam">yticklbl</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1038" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">savefig</span><span class="op">(</span><span class="str">&quot;{}/report/resolution.png&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1039" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">savefig</span><span class="op">(</span><span class="str">&quot;{}/report/resolution.pdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1040" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1041" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">clf</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1042" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1043" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1044" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Error generating resolution plot in report. Please look at fsc* files in the refine_xx folder&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1045" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1046" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">lastres</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1047" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;No valid resolution found for iteration {}.&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1048" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1049" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Iteration {}: Resolution = {:1.1f} &amp;Aring; (gold standard refinement with tight mask, FSC @0.143)&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1050" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1051" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">######################</span><span class="strut">&nbsp;</span></p>
<p id="t1052" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### Resolution plot 2</span><span class="strut">&nbsp;</span></p>
<p id="t1053" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">### broken up into multiple try/except blocks because we need some of the info, even if plotting fails</span><span class="strut">&nbsp;</span></p>
<p id="t1054" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1055" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">title</span><span class="op">(</span><span class="str">&quot;Gold Standard Resolution (mask comparison)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1056" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">xlabel</span><span class="op">(</span><span class="str">r&quot;Spatial Frequency (1/$\AA$)&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1057" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">ylabel</span><span class="op">(</span><span class="str">&quot;FSC&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1058" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1059" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1060" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1061" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fscs</span><span class="op">=</span><span class="op">[</span><span class="str">&quot;fsc_maskedtight_{:02d}.txt&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">lastnum</span><span class="op">)</span><span class="op">,</span><span class="str">&quot;fsc_masked_{:02d}.txt&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">lastnum</span><span class="op">)</span><span class="op">,</span><span class="str">&quot;fsc_unmasked_{:02d}.txt&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">lastnum</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t1062" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nummx</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">fscs</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;_&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1063" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">maxx</span><span class="op">=</span><span class="num">0.01</span><span class="strut">&nbsp;</span></p>
<p id="t1064" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">lastres</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t1065" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1066" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># iterate over fsc curves</span><span class="strut">&nbsp;</span></p>
<p id="t1067" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span><span class="op">,</span><span class="nam">f</span> <span class="key">in</span> <span class="nam">enumerate</span><span class="op">(</span><span class="nam">fscs</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1068" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">num</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">f</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;_&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">[</span><span class="op">:</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1069" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1070" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># read the fsc curve</span><span class="strut">&nbsp;</span></p>
<p id="t1071" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span><span class="op">=</span><span class="nam">np</span><span class="op">.</span><span class="nam">loadtxt</span><span class="op">(</span><span class="str">&quot;{}/{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">f</span><span class="op">)</span><span class="op">)</span><span class="op">.</span><span class="nam">transpose</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1072" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1073" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># plot the curve</span><span class="strut">&nbsp;</span></p>
<p id="t1074" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">plot</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">label</span><span class="op">=</span><span class="nam">f</span><span class="op">[</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="nam">pltcolors</span><span class="op">[</span><span class="nam">i</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1075" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1076" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">maxx</span><span class="op">=</span><span class="nam">max</span><span class="op">(</span><span class="nam">maxx</span><span class="op">,</span><span class="nam">max</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1077" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1078" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># find the resolutions</span><span class="strut">&nbsp;</span></p>
<p id="t1079" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># find the 0.143 crossing</span><span class="strut">&nbsp;</span></p>
<p id="t1080" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">si</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">2</span><span class="op">,</span><span class="nam">len</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">-</span><span class="num">2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1081" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">&gt;</span><span class="num">0.143</span> <span class="key">and</span> <span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">&lt;=</span><span class="num">0.143</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1082" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">frac</span><span class="op">=</span><span class="op">(</span><span class="num">0.143</span><span class="op">-</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">d</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># 1.0 if 0.143 at si-1, 0.0 if .143 at si</span><span class="strut">&nbsp;</span></p>
<p id="t1083" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">lastres</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="num">1.0</span><span class="op">-</span><span class="nam">frac</span><span class="op">)</span><span class="op">+</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="nam">si</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="nam">frac</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1084" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1085" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">annotate</span><span class="op">(</span><span class="str">r&quot;{:1.1f} $\AA$&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="nam">xy</span><span class="op">=</span><span class="op">(</span><span class="nam">lastres</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="num">0.143</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t1086" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xytext</span><span class="op">=</span><span class="op">(</span><span class="op">(</span><span class="nam">lastres</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="num">4</span><span class="op">+</span><span class="nam">d</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="num">5.0</span><span class="op">,</span><span class="num">0.2</span><span class="op">+</span><span class="num">0.05</span><span class="op">*</span><span class="nam">i</span><span class="op">)</span><span class="op">,</span><span class="nam">arrowprops</span><span class="op">=</span><span class="op">{</span><span class="str">&quot;width&quot;</span><span class="op">:</span><span class="num">1</span><span class="op">,</span><span class="str">&quot;frac&quot;</span><span class="op">:</span><span class="num">.1</span><span class="op">,</span><span class="str">&quot;headwidth&quot;</span><span class="op">:</span><span class="num">7</span><span class="op">,</span><span class="str">&quot;shrink&quot;</span><span class="op">:</span><span class="num">.05</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1087" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1088" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">break</span><span class="strut">&nbsp;</span></p>
<p id="t1089" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1090" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1091" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="num">0.0</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">&quot;k&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1092" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axhline</span><span class="op">(</span><span class="num">0.143</span><span class="op">,</span><span class="nam">color</span><span class="op">=</span><span class="str">&quot;#306030&quot;</span><span class="op">,</span><span class="nam">linestyle</span><span class="op">=</span><span class="str">&quot;:&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1093" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">axis</span><span class="op">(</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">maxx</span><span class="op">,</span><span class="op">-</span><span class="num">.02</span><span class="op">,</span><span class="num">1.02</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1094" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plt.legend(loc=&quot;lower left&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t1095" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">legend</span><span class="op">(</span><span class="nam">loc</span><span class="op">=</span><span class="str">&quot;upper right&quot;</span><span class="op">,</span><span class="nam">fontsize</span><span class="op">=</span><span class="str">&quot;x-small&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1096" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plt.minorticks_on()</span><span class="strut">&nbsp;</span></p>
<p id="t1097" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">xticks</span><span class="op">(</span><span class="nam">xticklocs</span><span class="op">,</span><span class="nam">xticklbl</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1098" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">yticks</span><span class="op">(</span><span class="nam">yticklocs</span><span class="op">,</span><span class="nam">yticklbl</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1099" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">savefig</span><span class="op">(</span><span class="str">&quot;{}/report/resolution_masks.png&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1100" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">plt</span><span class="op">.</span><span class="nam">savefig</span><span class="op">(</span><span class="str">&quot;{}/report/resolution_masks.pdf&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1101" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t1102" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">plt</span><span class="op">.</span><span class="nam">clf</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1103" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1104" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1105" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Error generating resolution plot in report. Please look at fsc* files in the refine_xx folder&lt;/p&gt;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1106" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1107" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">lastres</span><span class="op">)</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1108" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;No valid resolution found for iteration {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1109" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1110" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span> <span class="op">:</span><span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Iteration {}: Resolution with different masks = {:1.1f}, {:1.1f}, {:1.1f} &amp;Aring;&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1111" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span> <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;Iteration {}: Didn&#39;t find resolutions for all 3 curves&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1112" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1113" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2progress</span><span class="op">(</span><span class="nam">logid</span><span class="op">,</span><span class="nam">progress</span><span class="op">/</span><span class="nam">total_procs</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1114" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1115" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">lastres</span><span class="op">)</span><span class="op">==</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1116" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;I was unable to determine a resolution for your final iteration. This should not normally happen, and generally indicates a problem. </span><span class="strut">&nbsp;</span></p>
<p id="t1117" class="pln"><span class="str">One exception is when working with heavily downsampled data, the data may be of sufficient quality to achieve resolutions beyond Nyquist. If the resolution curve</span><span class="strut">&nbsp;</span></p>
<p id="t1118" class="pln"><span class="str">falls smoothly to the edge of the plot, this may be what is happening, and you should try continuing the processing with finer A/pix sampling.</span><span class="strut">&nbsp;</span></p>
<p id="t1119" class="pln"><span class="str">Consider consulting the EMAN2 mailing list if you cannot figure out what&#39;s going wrong&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1120" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1121" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1122" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">&gt;</span><span class="nam">randomres</span><span class="op">*</span><span class="num">.9</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1123" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Unfortunately your final determined resolution of {:1.1f} &amp;Aring; is not sufficiently better than the</span><span class="strut">&nbsp;</span></p>
<p id="t1124" class="pln"><span class="str">phase randomization resolution of {:1.1f} &amp;Aring; for the &#39;gold standard&#39; resolution method to be valid. Please do not trust this result.</span><span class="strut">&nbsp;</span></p>
<p id="t1125" class="pln"><span class="str">You must rerun the refinement with a more conservative initial target resolution (suggest ~{:1.1f}).&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">randomres</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="num">0.9</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1126" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">&lt;</span><span class="nam">options</span><span class="op">.</span><span class="nam">targetres</span><span class="op">*</span><span class="num">.9</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1127" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Your final determined resolution of {:1.1f} &amp;Aring; is higher resolution than your specified target resolution by more than 10%.</span><span class="strut">&nbsp;</span></p>
<p id="t1128" class="pln"><span class="str">This may cause the FSC curves to have an unusual shape, giving invalid numbers. It also means your reconstruction may be rotationally undersampled. Suggest running</span><span class="strut">&nbsp;</span></p>
<p id="t1129" class="pln"><span class="str">another refinement with a target resolution slightly higher than {:1.1f} &amp;Aring; to ensure your results are valid&lt;/p&gt;&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1130" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1131" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Congratulations, your refinement is complete, and you have a gold standard resolution of {:1.1f} &amp;Aring;.</span><span class="strut">&nbsp;</span></p>
<p id="t1132" class="pln"><span class="str">Note that there is always some variability in these determined values based on masking of the map. If the map is masked too tightly,</span><span class="strut">&nbsp;</span></p>
<p id="t1133" class="pln"><span class="str">the FSC curve will not remain near zero at high resolution and will rise again. If you see an FSC curve that falls to zero then rises again,</span><span class="strut">&nbsp;</span></p>
<p id="t1134" class="pln"><span class="str">it is an indication that something may have gone wrong with the masking. In general, EMAN2.1 is very conservative in its masking to try and</span><span class="strut">&nbsp;</span></p>
<p id="t1135" class="pln"><span class="str">avoid these problems. This means that the resolution may be as much as 10% better with somewhat tighter masking, without getting into</span><span class="strut">&nbsp;</span></p>
<p id="t1136" class="pln"><span class="str">artifact territory. &lt;/p&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1137" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1138" class="pln"><span class="str">&lt;p&gt;If you wish to continue this refinement to further improve resolution, the most efficient approach is to use the --startfrom refine_XX option</span><span class="strut">&nbsp;</span></p>
<p id="t1139" class="pln"><span class="str">rather than specifying --input and --model. When you use --startfrom, it will not re-randomize the phases. Since you have already achieved</span><span class="strut">&nbsp;</span></p>
<p id="t1140" class="pln"><span class="str">sufficient resolution to validate the gold-standard approach, continuing to extend this resolution is valid, and more efficient.&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1141" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1142" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1143" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt;Congratulations, your refinement is complete, and you have a gold standard resolution of {:1.1f} &amp;Aring (or {:1.1f} &amp;Aring with a more conservative mask);.</span><span class="strut">&nbsp;</span></p>
<p id="t1144" class="pln"><span class="str">Since this refinement continued from an existing refinement (or something funny happened), it is impossible to tell if the gold-standard criteria have been met, but</span><span class="strut">&nbsp;</span></p>
<p id="t1145" class="pln"><span class="str">if they were met in the refinement this run continued, then your resolution should still be valid.&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="num">1.0</span><span class="op">/</span><span class="nam">lastres</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1146" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1147" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Note: the above traceback is just a warning for debugging purposes, and can be ignored&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1148" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1149" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;p&gt; Congratulations, your refinement is complete, but there was some difficulty in assessing the resolution. This could just mean that your data was </span><span class="strut">&nbsp;</span></p>
<p id="t1150" class="pln"><span class="str">sampling-limited (meaning a smaller A/pix value would have been required to achieve data-limited resolution. If you cannot figure out what is going on, suggest asking for help</span><span class="strut">&nbsp;</span></p>
<p id="t1151" class="pln"><span class="str">on the &lt;a href=https://groups.google.com/forum/#!forum/eman2&gt;Google Group&lt;/a&gt;.&quot;&quot;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1152" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1153" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&quot;&quot;&lt;h2&gt;Explore your results&lt;/h2&gt;&lt;p&gt;Here are some useful output files to look at:&lt;/p&gt;&lt;ul&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1154" class="pln"><span class="str">&lt;li&gt;Your final 3-D map from this run is {path}/threed_{iter:02d}.hdf&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1155" class="pln"><span class="str">&lt;li&gt;It may be useful to compare {path}/classes_{iter:02d}.hdf to {path}/projections_{iter:02d}.hdf. The images in these</span><span class="strut">&nbsp;</span></p>
<p id="t1156" class="pln"><span class="str">two files should match extremely well, other than more noise being present in the class-averages.&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1157" class="pln"><span class="str">&lt;li&gt;Run &lt;i&gt;e2eulerxplor.py&lt;/i&gt; to look at the distribution of particle orientations and interactively compare projections to</span><span class="strut">&nbsp;</span></p>
<p id="t1158" class="pln"><span class="str">class-averages. Click on a specific peak to see the projection and corresponding filtered class-average for any specific orientation.&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1159" class="pln"><span class="str">&lt;li&gt;If you wish to make a single stack where you can look at all projections/averages side-by-side:</span><span class="strut">&nbsp;</span></p>
<p id="t1160" class="pln"><span class="str">&lt;br&gt;&lt;i&gt;e2proc2d.py {path}/classes_{iter:02d}_even.hdf clsvsproj.hdf --interlv {path}/projections_{iter:02d}_odd.hdf&lt;/i&gt;&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1161" class="pln"><span class="str">&lt;li&gt;It may also be worthwhile to compare {path}/threed_{iter:02d}_even.hdf to {path}/threed_{iter:02d}_odd.hdf to observe</span><span class="strut">&nbsp;</span></p>
<p id="t1162" class="pln"><span class="str">the differences responsible for the assessed resolution.&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1163" class="pln"><span class="str">&lt;li&gt;The individual FSC curves are in 2-column text files called fsc_*.txt. Both masked and unmasked FSCs are computed&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1164" class="pln"><span class="str">&lt;li&gt;The reconstruction produced after each iteration (threed_??.hdf) is masked and filtered as part of the reconstruction process.</span><span class="strut">&nbsp;</span></p>
<p id="t1165" class="pln"><span class="str">For the final completed iteration, the unmasked even and odd volumes are also retained: threed_even|odd_unmasked.hdf&lt;/li&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t1166" class="pln"><span class="str">&lt;/ul&gt;&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">iter</span><span class="op">=</span><span class="nam">it</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1167" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1168" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1169" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2end</span><span class="op">(</span><span class="nam">logid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1170" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1171" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t1172" class="pln"><span class="str">***********************************************************{stars}</span><span class="strut">&nbsp;</span></p>
<p id="t1173" class="pln"><span class="str">* REFINEMENT COMPLETE - Please look at {path}/report/index.html *</span><span class="strut">&nbsp;</span></p>
<p id="t1174" class="pln"><span class="str">***********************************************************{stars}</span><span class="strut">&nbsp;</span></p>
<p id="t1175" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1176" class="pln"><span class="str">&quot;&quot;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">path</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">,</span><span class="nam">stars</span><span class="op">=</span><span class="str">&quot;*&quot;</span><span class="op">*</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">path</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1177" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1178" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1179" class="stm mis"><span class="key">def</span> <span class="nam">run</span><span class="op">(</span><span class="nam">command</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1180" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="str">&quot;Mostly here for debugging, allows you to control how commands are executed (os.system is normal)&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t1181" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1182" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;{}: {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="nam">command</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1183" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_html</span><span class="op">(</span><span class="str">&quot;&lt;p&gt;{}: {}&lt;/p&gt;&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">ctime</span><span class="op">(</span><span class="nam">time</span><span class="op">.</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">,</span><span class="nam">command</span><span class="op">)</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1184" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1185" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ret</span><span class="op">=</span><span class="nam">launch_childprocess</span><span class="op">(</span><span class="nam">command</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1186" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1187" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># We put the exit here since this is what we&#39;d do in every case anyway. Saves replication of error detection code above.</span><span class="strut">&nbsp;</span></p>
<p id="t1188" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">ret</span> <span class="op">!=</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1189" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error running: &quot;</span><span class="op">,</span><span class="nam">command</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1190" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t1191" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1192" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t1193" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t1194" class="stm mis"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">&quot;__main__&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t1195" class="stm mis">&nbsp; &nbsp; <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
                
            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.org">coverage.py v4.0.3</a>,
            created at 2018-07-02 05:34
        </p>
    </div>
</div>

</body>
</html>
