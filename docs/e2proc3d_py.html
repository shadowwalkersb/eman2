


<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
    <title>Coverage for e2proc3d.py: 0%</title>
    <link rel="stylesheet" href="style.css" type="text/css">
    
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="jquery.hotkeys.js"></script>
    <script type="text/javascript" src="jquery.isonscreen.js"></script>
    <script type="text/javascript" src="coverage_html.js"></script>
    <script type="text/javascript">
        jQuery(document).ready(coverage.pyfile_ready);
    </script>
</head>
<body class="pyfile">

<div id="header">
    <div class="content">
        <h1>Coverage for <b>e2proc3d.py</b> :
            <span class="pc_cov">0%</span>
        </h1>

        <img id="keyboard_icon" src="keybd_closed.png" alt="Show keyboard shortcuts" />

        <h2 class="stats">
            549 statements &nbsp;
            <span class="run hide_run shortkey_r button_toggle_run">0 run</span>
            <span class="mis shortkey_m button_toggle_mis">549 missing</span>
            <span class="exc shortkey_x button_toggle_exc">0 excluded</span>

            
                <span class="par run hide_run shortkey_p button_toggle_par">0 partial</span>
            
        </h2>
    </div>
</div>

<div class="help_panel">
    <img id="panel_icon" src="keybd_open.png" alt="Hide keyboard shortcuts" />
<p class="legend">Hot-keys on this page</p>
    <div>
<p class="keyhelp">
        <span class="key">r</span>
        <span class="key">m</span>
        <span class="key">x</span>
        <span class="key">p</span> &nbsp; toggle line displays
    </p>
<p class="keyhelp">
        <span class="key">j</span>
        <span class="key">k</span> &nbsp; next/prev highlighted chunk
    </p>
<p class="keyhelp">
        <span class="key">0</span> &nbsp; (zero) top of page
    </p>
<p class="keyhelp">
        <span class="key">1</span> &nbsp; (one) first highlighted chunk
    </p>
    </div>
</div>

<div id="source">
    <table>
        <tr>
            <td class="linenos">
<p id="n1" class="pln"><a href="#n1">1</a></p>
<p id="n2" class="pln"><a href="#n2">2</a></p>
<p id="n3" class="pln"><a href="#n3">3</a></p>
<p id="n4" class="pln"><a href="#n4">4</a></p>
<p id="n5" class="pln"><a href="#n5">5</a></p>
<p id="n6" class="pln"><a href="#n6">6</a></p>
<p id="n7" class="pln"><a href="#n7">7</a></p>
<p id="n8" class="pln"><a href="#n8">8</a></p>
<p id="n9" class="pln"><a href="#n9">9</a></p>
<p id="n10" class="pln"><a href="#n10">10</a></p>
<p id="n11" class="pln"><a href="#n11">11</a></p>
<p id="n12" class="pln"><a href="#n12">12</a></p>
<p id="n13" class="pln"><a href="#n13">13</a></p>
<p id="n14" class="pln"><a href="#n14">14</a></p>
<p id="n15" class="pln"><a href="#n15">15</a></p>
<p id="n16" class="pln"><a href="#n16">16</a></p>
<p id="n17" class="pln"><a href="#n17">17</a></p>
<p id="n18" class="pln"><a href="#n18">18</a></p>
<p id="n19" class="pln"><a href="#n19">19</a></p>
<p id="n20" class="pln"><a href="#n20">20</a></p>
<p id="n21" class="pln"><a href="#n21">21</a></p>
<p id="n22" class="pln"><a href="#n22">22</a></p>
<p id="n23" class="pln"><a href="#n23">23</a></p>
<p id="n24" class="pln"><a href="#n24">24</a></p>
<p id="n25" class="pln"><a href="#n25">25</a></p>
<p id="n26" class="pln"><a href="#n26">26</a></p>
<p id="n27" class="pln"><a href="#n27">27</a></p>
<p id="n28" class="pln"><a href="#n28">28</a></p>
<p id="n29" class="pln"><a href="#n29">29</a></p>
<p id="n30" class="pln"><a href="#n30">30</a></p>
<p id="n31" class="pln"><a href="#n31">31</a></p>
<p id="n32" class="pln"><a href="#n32">32</a></p>
<p id="n33" class="pln"><a href="#n33">33</a></p>
<p id="n34" class="pln"><a href="#n34">34</a></p>
<p id="n35" class="pln"><a href="#n35">35</a></p>
<p id="n36" class="pln"><a href="#n36">36</a></p>
<p id="n37" class="stm mis"><a href="#n37">37</a></p>
<p id="n38" class="stm mis"><a href="#n38">38</a></p>
<p id="n39" class="stm mis"><a href="#n39">39</a></p>
<p id="n40" class="stm mis"><a href="#n40">40</a></p>
<p id="n41" class="stm mis"><a href="#n41">41</a></p>
<p id="n42" class="stm mis"><a href="#n42">42</a></p>
<p id="n43" class="stm mis"><a href="#n43">43</a></p>
<p id="n44" class="stm mis"><a href="#n44">44</a></p>
<p id="n45" class="stm mis"><a href="#n45">45</a></p>
<p id="n46" class="stm mis"><a href="#n46">46</a></p>
<p id="n47" class="stm mis"><a href="#n47">47</a></p>
<p id="n48" class="stm mis"><a href="#n48">48</a></p>
<p id="n49" class="pln"><a href="#n49">49</a></p>
<p id="n50" class="stm mis"><a href="#n50">50</a></p>
<p id="n51" class="stm mis"><a href="#n51">51</a></p>
<p id="n52" class="pln"><a href="#n52">52</a></p>
<p id="n53" class="pln"><a href="#n53">53</a></p>
<p id="n54" class="pln"><a href="#n54">54</a></p>
<p id="n55" class="pln"><a href="#n55">55</a></p>
<p id="n56" class="stm mis"><a href="#n56">56</a></p>
<p id="n57" class="stm mis"><a href="#n57">57</a></p>
<p id="n58" class="stm mis"><a href="#n58">58</a></p>
<p id="n59" class="stm mis"><a href="#n59">59</a></p>
<p id="n60" class="stm mis"><a href="#n60">60</a></p>
<p id="n61" class="stm mis"><a href="#n61">61</a></p>
<p id="n62" class="pln"><a href="#n62">62</a></p>
<p id="n63" class="stm mis"><a href="#n63">63</a></p>
<p id="n64" class="stm mis"><a href="#n64">64</a></p>
<p id="n65" class="stm mis"><a href="#n65">65</a></p>
<p id="n66" class="pln"><a href="#n66">66</a></p>
<p id="n67" class="pln"><a href="#n67">67</a></p>
<p id="n68" class="pln"><a href="#n68">68</a></p>
<p id="n69" class="pln"><a href="#n69">69</a></p>
<p id="n70" class="pln"><a href="#n70">70</a></p>
<p id="n71" class="pln"><a href="#n71">71</a></p>
<p id="n72" class="pln"><a href="#n72">72</a></p>
<p id="n73" class="pln"><a href="#n73">73</a></p>
<p id="n74" class="pln"><a href="#n74">74</a></p>
<p id="n75" class="pln"><a href="#n75">75</a></p>
<p id="n76" class="pln"><a href="#n76">76</a></p>
<p id="n77" class="pln"><a href="#n77">77</a></p>
<p id="n78" class="pln"><a href="#n78">78</a></p>
<p id="n79" class="pln"><a href="#n79">79</a></p>
<p id="n80" class="pln"><a href="#n80">80</a></p>
<p id="n81" class="pln"><a href="#n81">81</a></p>
<p id="n82" class="pln"><a href="#n82">82</a></p>
<p id="n83" class="pln"><a href="#n83">83</a></p>
<p id="n84" class="pln"><a href="#n84">84</a></p>
<p id="n85" class="pln"><a href="#n85">85</a></p>
<p id="n86" class="pln"><a href="#n86">86</a></p>
<p id="n87" class="pln"><a href="#n87">87</a></p>
<p id="n88" class="pln"><a href="#n88">88</a></p>
<p id="n89" class="stm mis"><a href="#n89">89</a></p>
<p id="n90" class="pln"><a href="#n90">90</a></p>
<p id="n91" class="stm mis"><a href="#n91">91</a></p>
<p id="n92" class="stm mis"><a href="#n92">92</a></p>
<p id="n93" class="stm mis"><a href="#n93">93</a></p>
<p id="n94" class="stm mis"><a href="#n94">94</a></p>
<p id="n95" class="stm mis"><a href="#n95">95</a></p>
<p id="n96" class="stm mis"><a href="#n96">96</a></p>
<p id="n97" class="stm mis"><a href="#n97">97</a></p>
<p id="n98" class="stm mis"><a href="#n98">98</a></p>
<p id="n99" class="stm mis"><a href="#n99">99</a></p>
<p id="n100" class="pln"><a href="#n100">100</a></p>
<p id="n101" class="stm mis"><a href="#n101">101</a></p>
<p id="n102" class="stm mis"><a href="#n102">102</a></p>
<p id="n103" class="stm mis"><a href="#n103">103</a></p>
<p id="n104" class="stm mis"><a href="#n104">104</a></p>
<p id="n105" class="pln"><a href="#n105">105</a></p>
<p id="n106" class="stm mis"><a href="#n106">106</a></p>
<p id="n107" class="stm mis"><a href="#n107">107</a></p>
<p id="n108" class="stm mis"><a href="#n108">108</a></p>
<p id="n109" class="stm mis"><a href="#n109">109</a></p>
<p id="n110" class="pln"><a href="#n110">110</a></p>
<p id="n111" class="stm mis"><a href="#n111">111</a></p>
<p id="n112" class="stm mis"><a href="#n112">112</a></p>
<p id="n113" class="stm mis"><a href="#n113">113</a></p>
<p id="n114" class="stm mis"><a href="#n114">114</a></p>
<p id="n115" class="pln"><a href="#n115">115</a></p>
<p id="n116" class="stm mis"><a href="#n116">116</a></p>
<p id="n117" class="pln"><a href="#n117">117</a></p>
<p id="n118" class="stm mis"><a href="#n118">118</a></p>
<p id="n119" class="stm mis"><a href="#n119">119</a></p>
<p id="n120" class="stm mis"><a href="#n120">120</a></p>
<p id="n121" class="stm mis"><a href="#n121">121</a></p>
<p id="n122" class="stm mis"><a href="#n122">122</a></p>
<p id="n123" class="stm mis"><a href="#n123">123</a></p>
<p id="n124" class="stm mis"><a href="#n124">124</a></p>
<p id="n125" class="stm mis"><a href="#n125">125</a></p>
<p id="n126" class="pln"><a href="#n126">126</a></p>
<p id="n127" class="stm mis"><a href="#n127">127</a></p>
<p id="n128" class="stm mis"><a href="#n128">128</a></p>
<p id="n129" class="stm mis"><a href="#n129">129</a></p>
<p id="n130" class="stm mis"><a href="#n130">130</a></p>
<p id="n131" class="pln"><a href="#n131">131</a></p>
<p id="n132" class="stm mis"><a href="#n132">132</a></p>
<p id="n133" class="stm mis"><a href="#n133">133</a></p>
<p id="n134" class="pln"><a href="#n134">134</a></p>
<p id="n135" class="stm mis"><a href="#n135">135</a></p>
<p id="n136" class="stm mis"><a href="#n136">136</a></p>
<p id="n137" class="stm mis"><a href="#n137">137</a></p>
<p id="n138" class="pln"><a href="#n138">138</a></p>
<p id="n139" class="stm mis"><a href="#n139">139</a></p>
<p id="n140" class="stm mis"><a href="#n140">140</a></p>
<p id="n141" class="stm mis"><a href="#n141">141</a></p>
<p id="n142" class="stm mis"><a href="#n142">142</a></p>
<p id="n143" class="stm mis"><a href="#n143">143</a></p>
<p id="n144" class="pln"><a href="#n144">144</a></p>
<p id="n145" class="stm mis"><a href="#n145">145</a></p>
<p id="n146" class="stm mis"><a href="#n146">146</a></p>
<p id="n147" class="stm mis"><a href="#n147">147</a></p>
<p id="n148" class="pln"><a href="#n148">148</a></p>
<p id="n149" class="stm mis"><a href="#n149">149</a></p>
<p id="n150" class="pln"><a href="#n150">150</a></p>
<p id="n151" class="stm mis"><a href="#n151">151</a></p>
<p id="n152" class="pln"><a href="#n152">152</a></p>
<p id="n153" class="stm mis"><a href="#n153">153</a></p>
<p id="n154" class="pln"><a href="#n154">154</a></p>
<p id="n155" class="stm mis"><a href="#n155">155</a></p>
<p id="n156" class="pln"><a href="#n156">156</a></p>
<p id="n157" class="stm mis"><a href="#n157">157</a></p>
<p id="n158" class="pln"><a href="#n158">158</a></p>
<p id="n159" class="pln"><a href="#n159">159</a></p>
<p id="n160" class="stm mis"><a href="#n160">160</a></p>
<p id="n161" class="stm mis"><a href="#n161">161</a></p>
<p id="n162" class="stm mis"><a href="#n162">162</a></p>
<p id="n163" class="stm mis"><a href="#n163">163</a></p>
<p id="n164" class="pln"><a href="#n164">164</a></p>
<p id="n165" class="stm mis"><a href="#n165">165</a></p>
<p id="n166" class="stm mis"><a href="#n166">166</a></p>
<p id="n167" class="stm mis"><a href="#n167">167</a></p>
<p id="n168" class="pln"><a href="#n168">168</a></p>
<p id="n169" class="stm mis"><a href="#n169">169</a></p>
<p id="n170" class="stm mis"><a href="#n170">170</a></p>
<p id="n171" class="stm mis"><a href="#n171">171</a></p>
<p id="n172" class="stm mis"><a href="#n172">172</a></p>
<p id="n173" class="stm mis"><a href="#n173">173</a></p>
<p id="n174" class="stm mis"><a href="#n174">174</a></p>
<p id="n175" class="pln"><a href="#n175">175</a></p>
<p id="n176" class="stm mis"><a href="#n176">176</a></p>
<p id="n177" class="stm mis"><a href="#n177">177</a></p>
<p id="n178" class="stm mis"><a href="#n178">178</a></p>
<p id="n179" class="pln"><a href="#n179">179</a></p>
<p id="n180" class="stm mis"><a href="#n180">180</a></p>
<p id="n181" class="stm mis"><a href="#n181">181</a></p>
<p id="n182" class="stm mis"><a href="#n182">182</a></p>
<p id="n183" class="pln"><a href="#n183">183</a></p>
<p id="n184" class="stm mis"><a href="#n184">184</a></p>
<p id="n185" class="pln"><a href="#n185">185</a></p>
<p id="n186" class="stm mis"><a href="#n186">186</a></p>
<p id="n187" class="stm mis"><a href="#n187">187</a></p>
<p id="n188" class="stm mis"><a href="#n188">188</a></p>
<p id="n189" class="pln"><a href="#n189">189</a></p>
<p id="n190" class="pln"><a href="#n190">190</a></p>
<p id="n191" class="pln"><a href="#n191">191</a></p>
<p id="n192" class="stm mis"><a href="#n192">192</a></p>
<p id="n193" class="stm mis"><a href="#n193">193</a></p>
<p id="n194" class="stm mis"><a href="#n194">194</a></p>
<p id="n195" class="stm mis"><a href="#n195">195</a></p>
<p id="n196" class="stm mis"><a href="#n196">196</a></p>
<p id="n197" class="pln"><a href="#n197">197</a></p>
<p id="n198" class="stm mis"><a href="#n198">198</a></p>
<p id="n199" class="stm mis"><a href="#n199">199</a></p>
<p id="n200" class="stm mis"><a href="#n200">200</a></p>
<p id="n201" class="stm mis"><a href="#n201">201</a></p>
<p id="n202" class="stm mis"><a href="#n202">202</a></p>
<p id="n203" class="pln"><a href="#n203">203</a></p>
<p id="n204" class="stm mis"><a href="#n204">204</a></p>
<p id="n205" class="stm mis"><a href="#n205">205</a></p>
<p id="n206" class="stm mis"><a href="#n206">206</a></p>
<p id="n207" class="stm mis"><a href="#n207">207</a></p>
<p id="n208" class="stm mis"><a href="#n208">208</a></p>
<p id="n209" class="stm mis"><a href="#n209">209</a></p>
<p id="n210" class="stm mis"><a href="#n210">210</a></p>
<p id="n211" class="stm mis"><a href="#n211">211</a></p>
<p id="n212" class="stm mis"><a href="#n212">212</a></p>
<p id="n213" class="stm mis"><a href="#n213">213</a></p>
<p id="n214" class="stm mis"><a href="#n214">214</a></p>
<p id="n215" class="stm mis"><a href="#n215">215</a></p>
<p id="n216" class="pln"><a href="#n216">216</a></p>
<p id="n217" class="pln"><a href="#n217">217</a></p>
<p id="n218" class="pln"><a href="#n218">218</a></p>
<p id="n219" class="stm mis"><a href="#n219">219</a></p>
<p id="n220" class="stm mis"><a href="#n220">220</a></p>
<p id="n221" class="stm mis"><a href="#n221">221</a></p>
<p id="n222" class="pln"><a href="#n222">222</a></p>
<p id="n223" class="stm mis"><a href="#n223">223</a></p>
<p id="n224" class="stm mis"><a href="#n224">224</a></p>
<p id="n225" class="stm mis"><a href="#n225">225</a></p>
<p id="n226" class="pln"><a href="#n226">226</a></p>
<p id="n227" class="stm mis"><a href="#n227">227</a></p>
<p id="n228" class="stm mis"><a href="#n228">228</a></p>
<p id="n229" class="stm mis"><a href="#n229">229</a></p>
<p id="n230" class="stm mis"><a href="#n230">230</a></p>
<p id="n231" class="pln"><a href="#n231">231</a></p>
<p id="n232" class="stm mis"><a href="#n232">232</a></p>
<p id="n233" class="stm mis"><a href="#n233">233</a></p>
<p id="n234" class="pln"><a href="#n234">234</a></p>
<p id="n235" class="stm mis"><a href="#n235">235</a></p>
<p id="n236" class="stm mis"><a href="#n236">236</a></p>
<p id="n237" class="pln"><a href="#n237">237</a></p>
<p id="n238" class="stm mis"><a href="#n238">238</a></p>
<p id="n239" class="stm mis"><a href="#n239">239</a></p>
<p id="n240" class="stm mis"><a href="#n240">240</a></p>
<p id="n241" class="pln"><a href="#n241">241</a></p>
<p id="n242" class="stm mis"><a href="#n242">242</a></p>
<p id="n243" class="stm mis"><a href="#n243">243</a></p>
<p id="n244" class="pln"><a href="#n244">244</a></p>
<p id="n245" class="pln"><a href="#n245">245</a></p>
<p id="n246" class="stm mis"><a href="#n246">246</a></p>
<p id="n247" class="pln"><a href="#n247">247</a></p>
<p id="n248" class="stm mis"><a href="#n248">248</a></p>
<p id="n249" class="stm mis"><a href="#n249">249</a></p>
<p id="n250" class="stm mis"><a href="#n250">250</a></p>
<p id="n251" class="pln"><a href="#n251">251</a></p>
<p id="n252" class="pln"><a href="#n252">252</a></p>
<p id="n253" class="stm mis"><a href="#n253">253</a></p>
<p id="n254" class="stm mis"><a href="#n254">254</a></p>
<p id="n255" class="stm mis"><a href="#n255">255</a></p>
<p id="n256" class="pln"><a href="#n256">256</a></p>
<p id="n257" class="pln"><a href="#n257">257</a></p>
<p id="n258" class="pln"><a href="#n258">258</a></p>
<p id="n259" class="pln"><a href="#n259">259</a></p>
<p id="n260" class="stm mis"><a href="#n260">260</a></p>
<p id="n261" class="stm mis"><a href="#n261">261</a></p>
<p id="n262" class="stm mis"><a href="#n262">262</a></p>
<p id="n263" class="pln"><a href="#n263">263</a></p>
<p id="n264" class="pln"><a href="#n264">264</a></p>
<p id="n265" class="stm mis"><a href="#n265">265</a></p>
<p id="n266" class="stm mis"><a href="#n266">266</a></p>
<p id="n267" class="stm mis"><a href="#n267">267</a></p>
<p id="n268" class="pln"><a href="#n268">268</a></p>
<p id="n269" class="stm mis"><a href="#n269">269</a></p>
<p id="n270" class="stm mis"><a href="#n270">270</a></p>
<p id="n271" class="pln"><a href="#n271">271</a></p>
<p id="n272" class="pln"><a href="#n272">272</a></p>
<p id="n273" class="stm mis"><a href="#n273">273</a></p>
<p id="n274" class="stm mis"><a href="#n274">274</a></p>
<p id="n275" class="stm mis"><a href="#n275">275</a></p>
<p id="n276" class="stm mis"><a href="#n276">276</a></p>
<p id="n277" class="stm mis"><a href="#n277">277</a></p>
<p id="n278" class="pln"><a href="#n278">278</a></p>
<p id="n279" class="stm mis"><a href="#n279">279</a></p>
<p id="n280" class="stm mis"><a href="#n280">280</a></p>
<p id="n281" class="stm mis"><a href="#n281">281</a></p>
<p id="n282" class="stm mis"><a href="#n282">282</a></p>
<p id="n283" class="pln"><a href="#n283">283</a></p>
<p id="n284" class="stm mis"><a href="#n284">284</a></p>
<p id="n285" class="stm mis"><a href="#n285">285</a></p>
<p id="n286" class="pln"><a href="#n286">286</a></p>
<p id="n287" class="pln"><a href="#n287">287</a></p>
<p id="n288" class="stm mis"><a href="#n288">288</a></p>
<p id="n289" class="stm mis"><a href="#n289">289</a></p>
<p id="n290" class="stm mis"><a href="#n290">290</a></p>
<p id="n291" class="stm mis"><a href="#n291">291</a></p>
<p id="n292" class="stm mis"><a href="#n292">292</a></p>
<p id="n293" class="stm mis"><a href="#n293">293</a></p>
<p id="n294" class="stm mis"><a href="#n294">294</a></p>
<p id="n295" class="pln"><a href="#n295">295</a></p>
<p id="n296" class="stm mis"><a href="#n296">296</a></p>
<p id="n297" class="stm mis"><a href="#n297">297</a></p>
<p id="n298" class="stm mis"><a href="#n298">298</a></p>
<p id="n299" class="stm mis"><a href="#n299">299</a></p>
<p id="n300" class="stm mis"><a href="#n300">300</a></p>
<p id="n301" class="stm mis"><a href="#n301">301</a></p>
<p id="n302" class="pln"><a href="#n302">302</a></p>
<p id="n303" class="stm mis"><a href="#n303">303</a></p>
<p id="n304" class="pln"><a href="#n304">304</a></p>
<p id="n305" class="pln"><a href="#n305">305</a></p>
<p id="n306" class="stm mis"><a href="#n306">306</a></p>
<p id="n307" class="stm mis"><a href="#n307">307</a></p>
<p id="n308" class="stm mis"><a href="#n308">308</a></p>
<p id="n309" class="stm mis"><a href="#n309">309</a></p>
<p id="n310" class="pln"><a href="#n310">310</a></p>
<p id="n311" class="stm mis"><a href="#n311">311</a></p>
<p id="n312" class="stm mis"><a href="#n312">312</a></p>
<p id="n313" class="stm mis"><a href="#n313">313</a></p>
<p id="n314" class="stm mis"><a href="#n314">314</a></p>
<p id="n315" class="stm mis"><a href="#n315">315</a></p>
<p id="n316" class="pln"><a href="#n316">316</a></p>
<p id="n317" class="stm mis"><a href="#n317">317</a></p>
<p id="n318" class="stm mis"><a href="#n318">318</a></p>
<p id="n319" class="stm mis"><a href="#n319">319</a></p>
<p id="n320" class="stm mis"><a href="#n320">320</a></p>
<p id="n321" class="pln"><a href="#n321">321</a></p>
<p id="n322" class="stm mis"><a href="#n322">322</a></p>
<p id="n323" class="stm mis"><a href="#n323">323</a></p>
<p id="n324" class="pln"><a href="#n324">324</a></p>
<p id="n325" class="stm mis"><a href="#n325">325</a></p>
<p id="n326" class="stm mis"><a href="#n326">326</a></p>
<p id="n327" class="stm mis"><a href="#n327">327</a></p>
<p id="n328" class="pln"><a href="#n328">328</a></p>
<p id="n329" class="stm mis"><a href="#n329">329</a></p>
<p id="n330" class="stm mis"><a href="#n330">330</a></p>
<p id="n331" class="stm mis"><a href="#n331">331</a></p>
<p id="n332" class="pln"><a href="#n332">332</a></p>
<p id="n333" class="stm mis"><a href="#n333">333</a></p>
<p id="n334" class="stm mis"><a href="#n334">334</a></p>
<p id="n335" class="stm mis"><a href="#n335">335</a></p>
<p id="n336" class="stm mis"><a href="#n336">336</a></p>
<p id="n337" class="stm mis"><a href="#n337">337</a></p>
<p id="n338" class="pln"><a href="#n338">338</a></p>
<p id="n339" class="pln"><a href="#n339">339</a></p>
<p id="n340" class="pln"><a href="#n340">340</a></p>
<p id="n341" class="pln"><a href="#n341">341</a></p>
<p id="n342" class="stm mis"><a href="#n342">342</a></p>
<p id="n343" class="pln"><a href="#n343">343</a></p>
<p id="n344" class="pln"><a href="#n344">344</a></p>
<p id="n345" class="pln"><a href="#n345">345</a></p>
<p id="n346" class="stm mis"><a href="#n346">346</a></p>
<p id="n347" class="pln"><a href="#n347">347</a></p>
<p id="n348" class="stm mis"><a href="#n348">348</a></p>
<p id="n349" class="stm mis"><a href="#n349">349</a></p>
<p id="n350" class="stm mis"><a href="#n350">350</a></p>
<p id="n351" class="pln"><a href="#n351">351</a></p>
<p id="n352" class="stm mis"><a href="#n352">352</a></p>
<p id="n353" class="stm mis"><a href="#n353">353</a></p>
<p id="n354" class="stm mis"><a href="#n354">354</a></p>
<p id="n355" class="pln"><a href="#n355">355</a></p>
<p id="n356" class="stm mis"><a href="#n356">356</a></p>
<p id="n357" class="stm mis"><a href="#n357">357</a></p>
<p id="n358" class="stm mis"><a href="#n358">358</a></p>
<p id="n359" class="pln"><a href="#n359">359</a></p>
<p id="n360" class="stm mis"><a href="#n360">360</a></p>
<p id="n361" class="stm mis"><a href="#n361">361</a></p>
<p id="n362" class="stm mis"><a href="#n362">362</a></p>
<p id="n363" class="pln"><a href="#n363">363</a></p>
<p id="n364" class="pln"><a href="#n364">364</a></p>
<p id="n365" class="pln"><a href="#n365">365</a></p>
<p id="n366" class="stm mis"><a href="#n366">366</a></p>
<p id="n367" class="stm mis"><a href="#n367">367</a></p>
<p id="n368" class="stm mis"><a href="#n368">368</a></p>
<p id="n369" class="pln"><a href="#n369">369</a></p>
<p id="n370" class="stm mis"><a href="#n370">370</a></p>
<p id="n371" class="stm mis"><a href="#n371">371</a></p>
<p id="n372" class="pln"><a href="#n372">372</a></p>
<p id="n373" class="stm mis"><a href="#n373">373</a></p>
<p id="n374" class="stm mis"><a href="#n374">374</a></p>
<p id="n375" class="pln"><a href="#n375">375</a></p>
<p id="n376" class="pln"><a href="#n376">376</a></p>
<p id="n377" class="stm mis"><a href="#n377">377</a></p>
<p id="n378" class="pln"><a href="#n378">378</a></p>
<p id="n379" class="pln"><a href="#n379">379</a></p>
<p id="n380" class="stm mis"><a href="#n380">380</a></p>
<p id="n381" class="pln"><a href="#n381">381</a></p>
<p id="n382" class="stm mis"><a href="#n382">382</a></p>
<p id="n383" class="pln"><a href="#n383">383</a></p>
<p id="n384" class="stm mis"><a href="#n384">384</a></p>
<p id="n385" class="stm mis"><a href="#n385">385</a></p>
<p id="n386" class="pln"><a href="#n386">386</a></p>
<p id="n387" class="pln"><a href="#n387">387</a></p>
<p id="n388" class="stm mis"><a href="#n388">388</a></p>
<p id="n389" class="stm mis"><a href="#n389">389</a></p>
<p id="n390" class="stm mis"><a href="#n390">390</a></p>
<p id="n391" class="stm mis"><a href="#n391">391</a></p>
<p id="n392" class="pln"><a href="#n392">392</a></p>
<p id="n393" class="stm mis"><a href="#n393">393</a></p>
<p id="n394" class="stm mis"><a href="#n394">394</a></p>
<p id="n395" class="pln"><a href="#n395">395</a></p>
<p id="n396" class="stm mis"><a href="#n396">396</a></p>
<p id="n397" class="stm mis"><a href="#n397">397</a></p>
<p id="n398" class="stm mis"><a href="#n398">398</a></p>
<p id="n399" class="stm mis"><a href="#n399">399</a></p>
<p id="n400" class="pln"><a href="#n400">400</a></p>
<p id="n401" class="stm mis"><a href="#n401">401</a></p>
<p id="n402" class="stm mis"><a href="#n402">402</a></p>
<p id="n403" class="pln"><a href="#n403">403</a></p>
<p id="n404" class="stm mis"><a href="#n404">404</a></p>
<p id="n405" class="pln"><a href="#n405">405</a></p>
<p id="n406" class="stm mis"><a href="#n406">406</a></p>
<p id="n407" class="stm mis"><a href="#n407">407</a></p>
<p id="n408" class="stm mis"><a href="#n408">408</a></p>
<p id="n409" class="stm mis"><a href="#n409">409</a></p>
<p id="n410" class="pln"><a href="#n410">410</a></p>
<p id="n411" class="stm mis"><a href="#n411">411</a></p>
<p id="n412" class="stm mis"><a href="#n412">412</a></p>
<p id="n413" class="stm mis"><a href="#n413">413</a></p>
<p id="n414" class="stm mis"><a href="#n414">414</a></p>
<p id="n415" class="stm mis"><a href="#n415">415</a></p>
<p id="n416" class="stm mis"><a href="#n416">416</a></p>
<p id="n417" class="stm mis"><a href="#n417">417</a></p>
<p id="n418" class="stm mis"><a href="#n418">418</a></p>
<p id="n419" class="stm mis"><a href="#n419">419</a></p>
<p id="n420" class="stm mis"><a href="#n420">420</a></p>
<p id="n421" class="pln"><a href="#n421">421</a></p>
<p id="n422" class="stm mis"><a href="#n422">422</a></p>
<p id="n423" class="stm mis"><a href="#n423">423</a></p>
<p id="n424" class="stm mis"><a href="#n424">424</a></p>
<p id="n425" class="stm mis"><a href="#n425">425</a></p>
<p id="n426" class="stm mis"><a href="#n426">426</a></p>
<p id="n427" class="pln"><a href="#n427">427</a></p>
<p id="n428" class="stm mis"><a href="#n428">428</a></p>
<p id="n429" class="stm mis"><a href="#n429">429</a></p>
<p id="n430" class="stm mis"><a href="#n430">430</a></p>
<p id="n431" class="stm mis"><a href="#n431">431</a></p>
<p id="n432" class="stm mis"><a href="#n432">432</a></p>
<p id="n433" class="pln"><a href="#n433">433</a></p>
<p id="n434" class="pln"><a href="#n434">434</a></p>
<p id="n435" class="pln"><a href="#n435">435</a></p>
<p id="n436" class="pln"><a href="#n436">436</a></p>
<p id="n437" class="pln"><a href="#n437">437</a></p>
<p id="n438" class="pln"><a href="#n438">438</a></p>
<p id="n439" class="pln"><a href="#n439">439</a></p>
<p id="n440" class="pln"><a href="#n440">440</a></p>
<p id="n441" class="pln"><a href="#n441">441</a></p>
<p id="n442" class="pln"><a href="#n442">442</a></p>
<p id="n443" class="pln"><a href="#n443">443</a></p>
<p id="n444" class="pln"><a href="#n444">444</a></p>
<p id="n445" class="pln"><a href="#n445">445</a></p>
<p id="n446" class="pln"><a href="#n446">446</a></p>
<p id="n447" class="stm mis"><a href="#n447">447</a></p>
<p id="n448" class="stm mis"><a href="#n448">448</a></p>
<p id="n449" class="stm mis"><a href="#n449">449</a></p>
<p id="n450" class="stm mis"><a href="#n450">450</a></p>
<p id="n451" class="stm mis"><a href="#n451">451</a></p>
<p id="n452" class="stm mis"><a href="#n452">452</a></p>
<p id="n453" class="stm mis"><a href="#n453">453</a></p>
<p id="n454" class="stm mis"><a href="#n454">454</a></p>
<p id="n455" class="stm mis"><a href="#n455">455</a></p>
<p id="n456" class="pln"><a href="#n456">456</a></p>
<p id="n457" class="stm mis"><a href="#n457">457</a></p>
<p id="n458" class="stm mis"><a href="#n458">458</a></p>
<p id="n459" class="stm mis"><a href="#n459">459</a></p>
<p id="n460" class="stm mis"><a href="#n460">460</a></p>
<p id="n461" class="stm mis"><a href="#n461">461</a></p>
<p id="n462" class="pln"><a href="#n462">462</a></p>
<p id="n463" class="pln"><a href="#n463">463</a></p>
<p id="n464" class="stm mis"><a href="#n464">464</a></p>
<p id="n465" class="stm mis"><a href="#n465">465</a></p>
<p id="n466" class="stm mis"><a href="#n466">466</a></p>
<p id="n467" class="stm mis"><a href="#n467">467</a></p>
<p id="n468" class="stm mis"><a href="#n468">468</a></p>
<p id="n469" class="stm mis"><a href="#n469">469</a></p>
<p id="n470" class="stm mis"><a href="#n470">470</a></p>
<p id="n471" class="pln"><a href="#n471">471</a></p>
<p id="n472" class="stm mis"><a href="#n472">472</a></p>
<p id="n473" class="pln"><a href="#n473">473</a></p>
<p id="n474" class="stm mis"><a href="#n474">474</a></p>
<p id="n475" class="stm mis"><a href="#n475">475</a></p>
<p id="n476" class="stm mis"><a href="#n476">476</a></p>
<p id="n477" class="stm mis"><a href="#n477">477</a></p>
<p id="n478" class="stm mis"><a href="#n478">478</a></p>
<p id="n479" class="pln"><a href="#n479">479</a></p>
<p id="n480" class="stm mis"><a href="#n480">480</a></p>
<p id="n481" class="pln"><a href="#n481">481</a></p>
<p id="n482" class="stm mis"><a href="#n482">482</a></p>
<p id="n483" class="stm mis"><a href="#n483">483</a></p>
<p id="n484" class="stm mis"><a href="#n484">484</a></p>
<p id="n485" class="stm mis"><a href="#n485">485</a></p>
<p id="n486" class="pln"><a href="#n486">486</a></p>
<p id="n487" class="stm mis"><a href="#n487">487</a></p>
<p id="n488" class="stm mis"><a href="#n488">488</a></p>
<p id="n489" class="pln"><a href="#n489">489</a></p>
<p id="n490" class="stm mis"><a href="#n490">490</a></p>
<p id="n491" class="stm mis"><a href="#n491">491</a></p>
<p id="n492" class="pln"><a href="#n492">492</a></p>
<p id="n493" class="pln"><a href="#n493">493</a></p>
<p id="n494" class="stm mis"><a href="#n494">494</a></p>
<p id="n495" class="stm mis"><a href="#n495">495</a></p>
<p id="n496" class="stm mis"><a href="#n496">496</a></p>
<p id="n497" class="stm mis"><a href="#n497">497</a></p>
<p id="n498" class="stm mis"><a href="#n498">498</a></p>
<p id="n499" class="pln"><a href="#n499">499</a></p>
<p id="n500" class="stm mis"><a href="#n500">500</a></p>
<p id="n501" class="stm mis"><a href="#n501">501</a></p>
<p id="n502" class="stm mis"><a href="#n502">502</a></p>
<p id="n503" class="stm mis"><a href="#n503">503</a></p>
<p id="n504" class="pln"><a href="#n504">504</a></p>
<p id="n505" class="pln"><a href="#n505">505</a></p>
<p id="n506" class="stm mis"><a href="#n506">506</a></p>
<p id="n507" class="stm mis"><a href="#n507">507</a></p>
<p id="n508" class="pln"><a href="#n508">508</a></p>
<p id="n509" class="pln"><a href="#n509">509</a></p>
<p id="n510" class="stm mis"><a href="#n510">510</a></p>
<p id="n511" class="stm mis"><a href="#n511">511</a></p>
<p id="n512" class="stm mis"><a href="#n512">512</a></p>
<p id="n513" class="stm mis"><a href="#n513">513</a></p>
<p id="n514" class="stm mis"><a href="#n514">514</a></p>
<p id="n515" class="pln"><a href="#n515">515</a></p>
<p id="n516" class="stm mis"><a href="#n516">516</a></p>
<p id="n517" class="stm mis"><a href="#n517">517</a></p>
<p id="n518" class="stm mis"><a href="#n518">518</a></p>
<p id="n519" class="pln"><a href="#n519">519</a></p>
<p id="n520" class="stm mis"><a href="#n520">520</a></p>
<p id="n521" class="stm mis"><a href="#n521">521</a></p>
<p id="n522" class="stm mis"><a href="#n522">522</a></p>
<p id="n523" class="stm mis"><a href="#n523">523</a></p>
<p id="n524" class="stm mis"><a href="#n524">524</a></p>
<p id="n525" class="stm mis"><a href="#n525">525</a></p>
<p id="n526" class="stm mis"><a href="#n526">526</a></p>
<p id="n527" class="stm mis"><a href="#n527">527</a></p>
<p id="n528" class="pln"><a href="#n528">528</a></p>
<p id="n529" class="stm mis"><a href="#n529">529</a></p>
<p id="n530" class="stm mis"><a href="#n530">530</a></p>
<p id="n531" class="stm mis"><a href="#n531">531</a></p>
<p id="n532" class="stm mis"><a href="#n532">532</a></p>
<p id="n533" class="stm mis"><a href="#n533">533</a></p>
<p id="n534" class="stm mis"><a href="#n534">534</a></p>
<p id="n535" class="stm mis"><a href="#n535">535</a></p>
<p id="n536" class="pln"><a href="#n536">536</a></p>
<p id="n537" class="stm mis"><a href="#n537">537</a></p>
<p id="n538" class="stm mis"><a href="#n538">538</a></p>
<p id="n539" class="stm mis"><a href="#n539">539</a></p>
<p id="n540" class="stm mis"><a href="#n540">540</a></p>
<p id="n541" class="stm mis"><a href="#n541">541</a></p>
<p id="n542" class="stm mis"><a href="#n542">542</a></p>
<p id="n543" class="stm mis"><a href="#n543">543</a></p>
<p id="n544" class="pln"><a href="#n544">544</a></p>
<p id="n545" class="stm mis"><a href="#n545">545</a></p>
<p id="n546" class="stm mis"><a href="#n546">546</a></p>
<p id="n547" class="pln"><a href="#n547">547</a></p>
<p id="n548" class="stm mis"><a href="#n548">548</a></p>
<p id="n549" class="stm mis"><a href="#n549">549</a></p>
<p id="n550" class="stm mis"><a href="#n550">550</a></p>
<p id="n551" class="stm mis"><a href="#n551">551</a></p>
<p id="n552" class="pln"><a href="#n552">552</a></p>
<p id="n553" class="stm mis"><a href="#n553">553</a></p>
<p id="n554" class="stm mis"><a href="#n554">554</a></p>
<p id="n555" class="stm mis"><a href="#n555">555</a></p>
<p id="n556" class="stm mis"><a href="#n556">556</a></p>
<p id="n557" class="pln"><a href="#n557">557</a></p>
<p id="n558" class="pln"><a href="#n558">558</a></p>
<p id="n559" class="stm mis"><a href="#n559">559</a></p>
<p id="n560" class="stm mis"><a href="#n560">560</a></p>
<p id="n561" class="stm mis"><a href="#n561">561</a></p>
<p id="n562" class="stm mis"><a href="#n562">562</a></p>
<p id="n563" class="stm mis"><a href="#n563">563</a></p>
<p id="n564" class="stm mis"><a href="#n564">564</a></p>
<p id="n565" class="pln"><a href="#n565">565</a></p>
<p id="n566" class="pln"><a href="#n566">566</a></p>
<p id="n567" class="stm mis"><a href="#n567">567</a></p>
<p id="n568" class="stm mis"><a href="#n568">568</a></p>
<p id="n569" class="stm mis"><a href="#n569">569</a></p>
<p id="n570" class="stm mis"><a href="#n570">570</a></p>
<p id="n571" class="stm mis"><a href="#n571">571</a></p>
<p id="n572" class="stm mis"><a href="#n572">572</a></p>
<p id="n573" class="stm mis"><a href="#n573">573</a></p>
<p id="n574" class="pln"><a href="#n574">574</a></p>
<p id="n575" class="pln"><a href="#n575">575</a></p>
<p id="n576" class="stm mis"><a href="#n576">576</a></p>
<p id="n577" class="stm mis"><a href="#n577">577</a></p>
<p id="n578" class="stm mis"><a href="#n578">578</a></p>
<p id="n579" class="pln"><a href="#n579">579</a></p>
<p id="n580" class="stm mis"><a href="#n580">580</a></p>
<p id="n581" class="stm mis"><a href="#n581">581</a></p>
<p id="n582" class="pln"><a href="#n582">582</a></p>
<p id="n583" class="stm mis"><a href="#n583">583</a></p>
<p id="n584" class="stm mis"><a href="#n584">584</a></p>
<p id="n585" class="stm mis"><a href="#n585">585</a></p>
<p id="n586" class="stm mis"><a href="#n586">586</a></p>
<p id="n587" class="stm mis"><a href="#n587">587</a></p>
<p id="n588" class="pln"><a href="#n588">588</a></p>
<p id="n589" class="stm mis"><a href="#n589">589</a></p>
<p id="n590" class="stm mis"><a href="#n590">590</a></p>
<p id="n591" class="stm mis"><a href="#n591">591</a></p>
<p id="n592" class="stm mis"><a href="#n592">592</a></p>
<p id="n593" class="stm mis"><a href="#n593">593</a></p>
<p id="n594" class="pln"><a href="#n594">594</a></p>
<p id="n595" class="pln"><a href="#n595">595</a></p>
<p id="n596" class="pln"><a href="#n596">596</a></p>
<p id="n597" class="pln"><a href="#n597">597</a></p>
<p id="n598" class="pln"><a href="#n598">598</a></p>
<p id="n599" class="pln"><a href="#n599">599</a></p>
<p id="n600" class="pln"><a href="#n600">600</a></p>
<p id="n601" class="stm mis"><a href="#n601">601</a></p>
<p id="n602" class="stm mis"><a href="#n602">602</a></p>
<p id="n603" class="pln"><a href="#n603">603</a></p>
<p id="n604" class="stm mis"><a href="#n604">604</a></p>
<p id="n605" class="stm mis"><a href="#n605">605</a></p>
<p id="n606" class="stm mis"><a href="#n606">606</a></p>
<p id="n607" class="pln"><a href="#n607">607</a></p>
<p id="n608" class="stm mis"><a href="#n608">608</a></p>
<p id="n609" class="stm mis"><a href="#n609">609</a></p>
<p id="n610" class="stm mis"><a href="#n610">610</a></p>
<p id="n611" class="stm mis"><a href="#n611">611</a></p>
<p id="n612" class="pln"><a href="#n612">612</a></p>
<p id="n613" class="pln"><a href="#n613">613</a></p>
<p id="n614" class="stm mis"><a href="#n614">614</a></p>
<p id="n615" class="stm mis"><a href="#n615">615</a></p>
<p id="n616" class="stm mis"><a href="#n616">616</a></p>
<p id="n617" class="stm mis"><a href="#n617">617</a></p>
<p id="n618" class="stm mis"><a href="#n618">618</a></p>
<p id="n619" class="pln"><a href="#n619">619</a></p>
<p id="n620" class="stm mis"><a href="#n620">620</a></p>
<p id="n621" class="stm mis"><a href="#n621">621</a></p>
<p id="n622" class="pln"><a href="#n622">622</a></p>
<p id="n623" class="stm mis"><a href="#n623">623</a></p>
<p id="n624" class="pln"><a href="#n624">624</a></p>
<p id="n625" class="pln"><a href="#n625">625</a></p>
<p id="n626" class="pln"><a href="#n626">626</a></p>
<p id="n627" class="pln"><a href="#n627">627</a></p>
<p id="n628" class="stm mis"><a href="#n628">628</a></p>
<p id="n629" class="stm mis"><a href="#n629">629</a></p>
<p id="n630" class="pln"><a href="#n630">630</a></p>
<p id="n631" class="stm mis"><a href="#n631">631</a></p>
<p id="n632" class="stm mis"><a href="#n632">632</a></p>
<p id="n633" class="stm mis"><a href="#n633">633</a></p>
<p id="n634" class="stm mis"><a href="#n634">634</a></p>
<p id="n635" class="stm mis"><a href="#n635">635</a></p>
<p id="n636" class="stm mis"><a href="#n636">636</a></p>
<p id="n637" class="stm mis"><a href="#n637">637</a></p>
<p id="n638" class="stm mis"><a href="#n638">638</a></p>
<p id="n639" class="stm mis"><a href="#n639">639</a></p>
<p id="n640" class="stm mis"><a href="#n640">640</a></p>
<p id="n641" class="stm mis"><a href="#n641">641</a></p>
<p id="n642" class="stm mis"><a href="#n642">642</a></p>
<p id="n643" class="stm mis"><a href="#n643">643</a></p>
<p id="n644" class="stm mis"><a href="#n644">644</a></p>
<p id="n645" class="stm mis"><a href="#n645">645</a></p>
<p id="n646" class="stm mis"><a href="#n646">646</a></p>
<p id="n647" class="stm mis"><a href="#n647">647</a></p>
<p id="n648" class="stm mis"><a href="#n648">648</a></p>
<p id="n649" class="pln"><a href="#n649">649</a></p>
<p id="n650" class="stm mis"><a href="#n650">650</a></p>
<p id="n651" class="stm mis"><a href="#n651">651</a></p>
<p id="n652" class="pln"><a href="#n652">652</a></p>
<p id="n653" class="stm mis"><a href="#n653">653</a></p>
<p id="n654" class="stm mis"><a href="#n654">654</a></p>
<p id="n655" class="stm mis"><a href="#n655">655</a></p>
<p id="n656" class="stm mis"><a href="#n656">656</a></p>
<p id="n657" class="pln"><a href="#n657">657</a></p>
<p id="n658" class="stm mis"><a href="#n658">658</a></p>
<p id="n659" class="stm mis"><a href="#n659">659</a></p>
<p id="n660" class="stm mis"><a href="#n660">660</a></p>
<p id="n661" class="pln"><a href="#n661">661</a></p>
<p id="n662" class="stm mis"><a href="#n662">662</a></p>
<p id="n663" class="stm mis"><a href="#n663">663</a></p>
<p id="n664" class="stm mis"><a href="#n664">664</a></p>
<p id="n665" class="stm mis"><a href="#n665">665</a></p>
<p id="n666" class="stm mis"><a href="#n666">666</a></p>
<p id="n667" class="stm mis"><a href="#n667">667</a></p>
<p id="n668" class="stm mis"><a href="#n668">668</a></p>
<p id="n669" class="pln"><a href="#n669">669</a></p>
<p id="n670" class="pln"><a href="#n670">670</a></p>
<p id="n671" class="stm mis"><a href="#n671">671</a></p>
<p id="n672" class="stm mis"><a href="#n672">672</a></p>
<p id="n673" class="stm mis"><a href="#n673">673</a></p>
<p id="n674" class="stm mis"><a href="#n674">674</a></p>
<p id="n675" class="stm mis"><a href="#n675">675</a></p>
<p id="n676" class="pln"><a href="#n676">676</a></p>
<p id="n677" class="stm mis"><a href="#n677">677</a></p>
<p id="n678" class="stm mis"><a href="#n678">678</a></p>
<p id="n679" class="stm mis"><a href="#n679">679</a></p>
<p id="n680" class="stm mis"><a href="#n680">680</a></p>
<p id="n681" class="stm mis"><a href="#n681">681</a></p>
<p id="n682" class="pln"><a href="#n682">682</a></p>
<p id="n683" class="stm mis"><a href="#n683">683</a></p>
<p id="n684" class="stm mis"><a href="#n684">684</a></p>
<p id="n685" class="stm mis"><a href="#n685">685</a></p>
<p id="n686" class="stm mis"><a href="#n686">686</a></p>
<p id="n687" class="stm mis"><a href="#n687">687</a></p>
<p id="n688" class="stm mis"><a href="#n688">688</a></p>
<p id="n689" class="stm mis"><a href="#n689">689</a></p>
<p id="n690" class="stm mis"><a href="#n690">690</a></p>
<p id="n691" class="pln"><a href="#n691">691</a></p>
<p id="n692" class="stm mis"><a href="#n692">692</a></p>
<p id="n693" class="stm mis"><a href="#n693">693</a></p>
<p id="n694" class="stm mis"><a href="#n694">694</a></p>
<p id="n695" class="stm mis"><a href="#n695">695</a></p>
<p id="n696" class="stm mis"><a href="#n696">696</a></p>
<p id="n697" class="stm mis"><a href="#n697">697</a></p>
<p id="n698" class="stm mis"><a href="#n698">698</a></p>
<p id="n699" class="stm mis"><a href="#n699">699</a></p>
<p id="n700" class="pln"><a href="#n700">700</a></p>
<p id="n701" class="stm mis"><a href="#n701">701</a></p>
<p id="n702" class="stm mis"><a href="#n702">702</a></p>
<p id="n703" class="stm mis"><a href="#n703">703</a></p>
<p id="n704" class="stm mis"><a href="#n704">704</a></p>
<p id="n705" class="stm mis"><a href="#n705">705</a></p>
<p id="n706" class="stm mis"><a href="#n706">706</a></p>
<p id="n707" class="stm mis"><a href="#n707">707</a></p>
<p id="n708" class="stm mis"><a href="#n708">708</a></p>
<p id="n709" class="pln"><a href="#n709">709</a></p>
<p id="n710" class="stm mis"><a href="#n710">710</a></p>
<p id="n711" class="stm mis"><a href="#n711">711</a></p>
<p id="n712" class="stm mis"><a href="#n712">712</a></p>
<p id="n713" class="pln"><a href="#n713">713</a></p>
<p id="n714" class="stm mis"><a href="#n714">714</a></p>
<p id="n715" class="stm mis"><a href="#n715">715</a></p>
<p id="n716" class="pln"><a href="#n716">716</a></p>
<p id="n717" class="stm mis"><a href="#n717">717</a></p>
<p id="n718" class="stm mis"><a href="#n718">718</a></p>
<p id="n719" class="stm mis"><a href="#n719">719</a></p>
<p id="n720" class="stm mis"><a href="#n720">720</a></p>
<p id="n721" class="pln"><a href="#n721">721</a></p>
<p id="n722" class="stm mis"><a href="#n722">722</a></p>
<p id="n723" class="stm mis"><a href="#n723">723</a></p>
<p id="n724" class="pln"><a href="#n724">724</a></p>
<p id="n725" class="stm mis"><a href="#n725">725</a></p>
<p id="n726" class="stm mis"><a href="#n726">726</a></p>
<p id="n727" class="stm mis"><a href="#n727">727</a></p>
<p id="n728" class="pln"><a href="#n728">728</a></p>
<p id="n729" class="stm mis"><a href="#n729">729</a></p>
<p id="n730" class="stm mis"><a href="#n730">730</a></p>
<p id="n731" class="stm mis"><a href="#n731">731</a></p>
<p id="n732" class="pln"><a href="#n732">732</a></p>
<p id="n733" class="pln"><a href="#n733">733</a></p>
<p id="n734" class="stm mis"><a href="#n734">734</a></p>
<p id="n735" class="stm mis"><a href="#n735">735</a></p>
<p id="n736" class="pln"><a href="#n736">736</a></p>
<p id="n737" class="stm mis"><a href="#n737">737</a></p>
<p id="n738" class="stm mis"><a href="#n738">738</a></p>
<p id="n739" class="stm mis"><a href="#n739">739</a></p>
<p id="n740" class="pln"><a href="#n740">740</a></p>
<p id="n741" class="stm mis"><a href="#n741">741</a></p>
<p id="n742" class="stm mis"><a href="#n742">742</a></p>
<p id="n743" class="stm mis"><a href="#n743">743</a></p>
<p id="n744" class="pln"><a href="#n744">744</a></p>
<p id="n745" class="stm mis"><a href="#n745">745</a></p>
<p id="n746" class="stm mis"><a href="#n746">746</a></p>
<p id="n747" class="pln"><a href="#n747">747</a></p>
<p id="n748" class="stm mis"><a href="#n748">748</a></p>
<p id="n749" class="stm mis"><a href="#n749">749</a></p>
<p id="n750" class="pln"><a href="#n750">750</a></p>
<p id="n751" class="stm mis"><a href="#n751">751</a></p>
<p id="n752" class="pln"><a href="#n752">752</a></p>
<p id="n753" class="stm mis"><a href="#n753">753</a></p>
<p id="n754" class="stm mis"><a href="#n754">754</a></p>
<p id="n755" class="stm mis"><a href="#n755">755</a></p>
<p id="n756" class="pln"><a href="#n756">756</a></p>
<p id="n757" class="stm mis"><a href="#n757">757</a></p>
<p id="n758" class="pln"><a href="#n758">758</a></p>
<p id="n759" class="pln"><a href="#n759">759</a></p>
<p id="n760" class="pln"><a href="#n760">760</a></p>
<p id="n761" class="stm mis"><a href="#n761">761</a></p>
<p id="n762" class="pln"><a href="#n762">762</a></p>
<p id="n763" class="stm mis"><a href="#n763">763</a></p>
<p id="n764" class="stm mis"><a href="#n764">764</a></p>
<p id="n765" class="stm mis"><a href="#n765">765</a></p>
<p id="n766" class="stm mis"><a href="#n766">766</a></p>
<p id="n767" class="stm mis"><a href="#n767">767</a></p>
<p id="n768" class="stm mis"><a href="#n768">768</a></p>
<p id="n769" class="pln"><a href="#n769">769</a></p>
<p id="n770" class="stm mis"><a href="#n770">770</a></p>
<p id="n771" class="stm mis"><a href="#n771">771</a></p>
<p id="n772" class="stm mis"><a href="#n772">772</a></p>
<p id="n773" class="pln"><a href="#n773">773</a></p>
<p id="n774" class="stm mis"><a href="#n774">774</a></p>
<p id="n775" class="pln"><a href="#n775">775</a></p>
<p id="n776" class="stm mis"><a href="#n776">776</a></p>
<p id="n777" class="pln"><a href="#n777">777</a></p>
<p id="n778" class="stm mis"><a href="#n778">778</a></p>
<p id="n779" class="pln"><a href="#n779">779</a></p>
<p id="n780" class="stm mis"><a href="#n780">780</a></p>
<p id="n781" class="stm mis"><a href="#n781">781</a></p>
<p id="n782" class="stm mis"><a href="#n782">782</a></p>
<p id="n783" class="pln"><a href="#n783">783</a></p>
<p id="n784" class="stm mis"><a href="#n784">784</a></p>
<p id="n785" class="stm mis"><a href="#n785">785</a></p>
<p id="n786" class="stm mis"><a href="#n786">786</a></p>
<p id="n787" class="pln"><a href="#n787">787</a></p>
<p id="n788" class="stm mis"><a href="#n788">788</a></p>
<p id="n789" class="stm mis"><a href="#n789">789</a></p>
<p id="n790" class="stm mis"><a href="#n790">790</a></p>
<p id="n791" class="stm mis"><a href="#n791">791</a></p>
<p id="n792" class="stm mis"><a href="#n792">792</a></p>
<p id="n793" class="stm mis"><a href="#n793">793</a></p>
<p id="n794" class="stm mis"><a href="#n794">794</a></p>
<p id="n795" class="stm mis"><a href="#n795">795</a></p>
<p id="n796" class="stm mis"><a href="#n796">796</a></p>
<p id="n797" class="stm mis"><a href="#n797">797</a></p>
<p id="n798" class="stm mis"><a href="#n798">798</a></p>
<p id="n799" class="stm mis"><a href="#n799">799</a></p>
<p id="n800" class="stm mis"><a href="#n800">800</a></p>
<p id="n801" class="stm mis"><a href="#n801">801</a></p>
<p id="n802" class="pln"><a href="#n802">802</a></p>
<p id="n803" class="stm mis"><a href="#n803">803</a></p>
<p id="n804" class="stm mis"><a href="#n804">804</a></p>
<p id="n805" class="pln"><a href="#n805">805</a></p>
<p id="n806" class="stm mis"><a href="#n806">806</a></p>
<p id="n807" class="stm mis"><a href="#n807">807</a></p>
<p id="n808" class="pln"><a href="#n808">808</a></p>
<p id="n809" class="stm mis"><a href="#n809">809</a></p>
<p id="n810" class="stm mis"><a href="#n810">810</a></p>
<p id="n811" class="pln"><a href="#n811">811</a></p>
<p id="n812" class="stm mis"><a href="#n812">812</a></p>
<p id="n813" class="stm mis"><a href="#n813">813</a></p>
<p id="n814" class="stm mis"><a href="#n814">814</a></p>
<p id="n815" class="pln"><a href="#n815">815</a></p>
<p id="n816" class="pln"><a href="#n816">816</a></p>
<p id="n817" class="stm mis"><a href="#n817">817</a></p>
<p id="n818" class="stm mis"><a href="#n818">818</a></p>
                
            </td>
            <td class="text">
<p id="t1" class="pln"><span class="com">#!/usr/bin/env python</span><span class="strut">&nbsp;</span></p>
<p id="t2" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t3" class="pln"><span class="com"># Author: Steven Ludtke, 04/10/2003 (sludtke@bcm.edu)</span><span class="strut">&nbsp;</span></p>
<p id="t4" class="pln"><span class="com"># Copyright (c) 2000-2006 Baylor College of Medicine</span><span class="strut">&nbsp;</span></p>
<p id="t5" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t6" class="pln"><span class="com"># This software is issued under a joint BSD/GNU license. You may use the</span><span class="strut">&nbsp;</span></p>
<p id="t7" class="pln"><span class="com"># source code in this file under either license. However, note that the</span><span class="strut">&nbsp;</span></p>
<p id="t8" class="pln"><span class="com"># complete EMAN2 and SPARX software packages have some GPL dependencies,</span><span class="strut">&nbsp;</span></p>
<p id="t9" class="pln"><span class="com"># so you are responsible for compliance with the licenses of these packages</span><span class="strut">&nbsp;</span></p>
<p id="t10" class="pln"><span class="com"># if you opt to use BSD licensing. The warranty disclaimer below holds</span><span class="strut">&nbsp;</span></p>
<p id="t11" class="pln"><span class="com"># in either instance.</span><span class="strut">&nbsp;</span></p>
<p id="t12" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t13" class="pln"><span class="com"># This complete copyright notice must be included in any revised version of the</span><span class="strut">&nbsp;</span></p>
<p id="t14" class="pln"><span class="com"># source code. Additional authorship citations may be added, but existing</span><span class="strut">&nbsp;</span></p>
<p id="t15" class="pln"><span class="com"># author citations must be preserved.</span><span class="strut">&nbsp;</span></p>
<p id="t16" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t17" class="pln"><span class="com"># This program is free software; you can redistribute it and/or modify</span><span class="strut">&nbsp;</span></p>
<p id="t18" class="pln"><span class="com"># it under the terms of the GNU General Public License as published by</span><span class="strut">&nbsp;</span></p>
<p id="t19" class="pln"><span class="com"># the Free Software Foundation; either version 2 of the License, or</span><span class="strut">&nbsp;</span></p>
<p id="t20" class="pln"><span class="com"># (at your option) any later version.</span><span class="strut">&nbsp;</span></p>
<p id="t21" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t22" class="pln"><span class="com"># This program is distributed in the hope that it will be useful,</span><span class="strut">&nbsp;</span></p>
<p id="t23" class="pln"><span class="com"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="strut">&nbsp;</span></p>
<p id="t24" class="pln"><span class="com"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span><span class="strut">&nbsp;</span></p>
<p id="t25" class="pln"><span class="com"># GNU General Public License for more details.</span><span class="strut">&nbsp;</span></p>
<p id="t26" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t27" class="pln"><span class="com"># You should have received a copy of the GNU General Public License</span><span class="strut">&nbsp;</span></p>
<p id="t28" class="pln"><span class="com"># along with this program; if not, write to the Free Software</span><span class="strut">&nbsp;</span></p>
<p id="t29" class="pln"><span class="com"># Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA&nbsp; 2111-1307 USA</span><span class="strut">&nbsp;</span></p>
<p id="t30" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t31" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t32" class="pln"><span class="com"># $Id$</span><span class="strut">&nbsp;</span></p>
<p id="t33" class="pln"><span class="com"># todo: verify the processors who have the same names in proc3d</span><span class="strut">&nbsp;</span></p>
<p id="t34" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and proc2d have the same implementation</span><span class="strut">&nbsp;</span></p>
<p id="t35" class="pln"><span class="com">#</span><span class="strut">&nbsp;</span></p>
<p id="t36" class="pln"><span class="com"># todo: lp, hp, tlp vs apix</span><span class="strut">&nbsp;</span></p>
<p id="t37" class="stm mis"><span class="key">from</span> <span class="nam">__future__</span> <span class="key">import</span> <span class="nam">print_function</span><span class="strut">&nbsp;</span></p>
<p id="t38" class="stm mis"><span class="key">from</span> <span class="nam">EMAN2</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t39" class="stm mis"><span class="key">from</span> <span class="nam">optparse</span> <span class="key">import</span> <span class="nam">OptionParser</span><span class="strut">&nbsp;</span></p>
<p id="t40" class="stm mis"><span class="key">import</span> <span class="nam">sys</span><span class="strut">&nbsp;</span></p>
<p id="t41" class="stm mis"><span class="key">from</span> <span class="nam">math</span> <span class="key">import</span> <span class="op">*</span><span class="strut">&nbsp;</span></p>
<p id="t42" class="stm mis"><span class="key">import</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="strut">&nbsp;</span></p>
<p id="t43" class="stm mis"><span class="key">import</span> <span class="nam">pyemtbx</span><span class="op">.</span><span class="nam">options</span><span class="strut">&nbsp;</span></p>
<p id="t44" class="stm mis"><span class="key">from</span> <span class="nam">pyemtbx</span><span class="op">.</span><span class="nam">options</span> <span class="key">import</span> <span class="nam">intvararg_callback</span><span class="strut">&nbsp;</span></p>
<p id="t45" class="stm mis"><span class="key">from</span> <span class="nam">pyemtbx</span><span class="op">.</span><span class="nam">options</span> <span class="key">import</span> <span class="nam">floatvararg_callback</span><span class="strut">&nbsp;</span></p>
<p id="t46" class="stm mis"><span class="key">from</span> <span class="nam">time</span> <span class="key">import</span> <span class="nam">time</span><span class="strut">&nbsp;</span></p>
<p id="t47" class="stm mis"><span class="key">from</span> <span class="nam">numpy</span> <span class="key">import</span> <span class="nam">arange</span><span class="strut">&nbsp;</span></p>
<p id="t48" class="stm mis"><span class="key">import</span> <span class="nam">traceback</span><span class="strut">&nbsp;</span></p>
<p id="t49" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t50" class="stm mis"><span class="key">def</span> <span class="nam">print_iminfo</span><span class="op">(</span><span class="nam">data</span><span class="op">,</span> <span class="nam">label</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t51" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;%s image : %dx%dx%d Mean=%1.3g Sigma=%1.3g Min=%1.3g Max=%1.3g&quot;</span> <span class="op">%</span> <span class="xx">\</span><span class="strut">&nbsp;</span></p>
<p id="t52" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">label</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_xsize</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_ysize</span><span class="op">(</span><span class="op">)</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_zsize</span><span class="op">(</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t53" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">get_attr</span><span class="op">(</span><span class="str">&quot;mean&quot;</span><span class="op">)</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_attr</span><span class="op">(</span><span class="str">&quot;sigma&quot;</span><span class="op">)</span><span class="op">,</span><span class="strut">&nbsp;</span></p>
<p id="t54" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">get_attr</span><span class="op">(</span><span class="str">&quot;minimum&quot;</span><span class="op">)</span><span class="op">,</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_attr</span><span class="op">(</span><span class="str">&quot;maximum&quot;</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t55" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t56" class="stm mis"><span class="key">def</span> <span class="nam">calcsf</span><span class="op">(</span><span class="nam">data</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t57" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dataf</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">do_fft</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t58" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">curve</span> <span class="op">=</span> <span class="nam">dataf</span><span class="op">.</span><span class="nam">calc_radial_dist</span><span class="op">(</span><span class="nam">ny</span><span class="op">/</span><span class="num">2</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t59" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">curve</span><span class="op">=</span><span class="op">[</span><span class="nam">i</span><span class="op">/</span><span class="op">(</span><span class="nam">dataf</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">*</span><span class="nam">dataf</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="op">*</span><span class="nam">dataf</span><span class="op">[</span><span class="str">&quot;nz&quot;</span><span class="op">]</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">curve</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t60" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">Util</span><span class="op">.</span><span class="nam">save_data</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">apix</span><span class="op">*</span><span class="nam">ny</span><span class="op">)</span><span class="op">,</span> <span class="nam">curve</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">calcsf</span><span class="op">)</span><span class="op">;</span><span class="strut">&nbsp;</span></p>
<p id="t61" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t62" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t63" class="stm mis"><span class="key">def</span> <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t64" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">progname</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">basename</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t65" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">usage</span> <span class="op">=</span> <span class="nam">progname</span> <span class="op">+</span> <span class="str">&quot;&quot;&quot; [options] &lt;inputfile&gt; &lt;outputfile&gt;</span><span class="strut">&nbsp;</span></p>
<p id="t66" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Generic 3-D image processing and file format conversion program.</span><span class="strut">&nbsp;</span></p>
<p id="t67" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; All EMAN2 recognized file formats accepted (see Wiki for list).</span><span class="strut">&nbsp;</span></p>
<p id="t68" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t69" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; To create a new image, rather than reading from a file, specify &#39;:&lt;nx&gt;:&lt;ny&gt;:&lt;nz&gt;:&lt;value&gt;&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t70" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; as an input filename.</span><span class="strut">&nbsp;</span></p>
<p id="t71" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t72" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Examples:</span><span class="strut">&nbsp;</span></p>
<p id="t73" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t74" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Convert MRC format to HDF format:</span><span class="strut">&nbsp;</span></p>
<p id="t75" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; e2proc3d.py test.mrc test.hdf</span><span class="strut">&nbsp;</span></p>
<p id="t76" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t77" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Apply a 10 A low-pass filter to a volume and write output to a new file:</span><span class="strut">&nbsp;</span></p>
<p id="t78" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; e2proc3d.py threed.hdf threed.filt.hdf --process=filter.lowpass.gauss:cutoff_freq=0.1</span><span class="strut">&nbsp;</span></p>
<p id="t79" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t80" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Extract a reconstruction from a refinement directory as an HDF file usable with Chimera:</span><span class="strut">&nbsp;</span></p>
<p id="t81" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; e2proc3d.py bdb:refine_02#threed_filt_04 map_02_04.hdf</span><span class="strut">&nbsp;</span></p>
<p id="t82" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t83" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; Create a new 64x64x64 volume, initialize it as 1, then apply a hard spherical mask to 0:</span><span class="strut">&nbsp;</span></p>
<p id="t84" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; e2proc3d.py :64:64:64:1 myvol.hdf --process mask.sharp:outer_radius=25</span><span class="strut">&nbsp;</span></p>
<p id="t85" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t86" class="pln"><span class="str">&nbsp; &nbsp; &nbsp; &nbsp; &#39;e2help.py processors -v 2&#39; for a detailed list of available procesors</span><span class="strut">&nbsp;</span></p>
<p id="t87" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t88" class="pln"><span class="str">&quot;&quot;&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t89" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span> <span class="op">=</span> <span class="nam">OptionParser</span><span class="op">(</span><span class="nam">usage</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t90" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t91" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--add&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;f&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;float&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Adds a constant &#39;f&#39; to the densities&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t92" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--addfile&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Adds the volume to another volume of identical size&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t93" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--align&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;aligner_name:param1=value1:param2=value2&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Align input map to reference specified with --alignref. As with processors, a sequence of aligners is permitted&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t94" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--alignctod&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span> <span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Rotates a map already aligned for C symmetry so the best 2-fold is positioned for specified D symmetry. Does not impose specified symmetry.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t95" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--alignref&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;filename&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Alignment reference volume. May only be specified once.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t96" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--apix&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;float&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Default=None (not used). A/pixel for S scaling. Also sets/resets the apix of an image to this value.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t97" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--append&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Append output image, i.e., do not write inplace.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t98" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--average&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Computes the average of a stack of 3D volumes&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t99" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--averager&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;mean&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Averager used for --average and --sym options&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t100" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t101" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--calcfsc&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;with input&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Calculate a FSC curve between two models. Output is a txt file. This option is the name of the second volume.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t102" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--calcsf&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;outputfile&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Calculate a radial structure factor. Must specify apix.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t103" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--calcradial&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Calculate the radial density by shell. Output file becomes a text file. 0 - mean amp, 2 - min, 3 - max, 4 - sigma&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t104" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--clip&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;x[,y,z[,xc,yc,zc]]&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&#39;string&#39;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;callback&quot;</span><span class="op">,</span> <span class="nam">callback</span><span class="op">=</span><span class="nam">intvararg_callback</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Make the output have this size by padding/clipping. 1, 3 or 6 arguments. &quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t105" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t106" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--fftclip&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;x, y, z&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;callback&quot;</span><span class="op">,</span> <span class="nam">callback</span><span class="op">=</span><span class="nam">floatvararg_callback</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Make the output have this size, rescaling by padding FFT.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t107" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--filtertable&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Applies a 2 column (S,amp) file as a filter in Fourier space, assumed 0 outside the defined range.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t108" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--first&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;the first image in the input to process [0 - n-1])&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t109" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--fouriershrink&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">float</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Reduce an image size by an arbitrary scaling factor by clipping in Fourier space. eg - 2 will reduce image size to 1/2.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t110" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t111" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--icos2to5&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Rotate an icosahedral map from 2-fold on Z (MRC standard) to 5-fold on Z (EMAN standard)&nbsp; orientation&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t112" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--icos5fhalfmap&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The input is the icos 5f top half map generated by the &#39;tophalf&#39; option&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t113" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--icos5to2&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Rotate an icosahedral map from 5-fold on Z (EMAN standard) to 2-fold on Z (MRC standard) orientation&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t114" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--inputto1&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;All voxels in the input file are set to 1 after reading. This can be used with mask.* processors to produce a mask file of the correct size.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t115" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t116" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--last&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;the last image in the input to process&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t117" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t118" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--matchto&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Match filtration of input volume to this specified volume.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t119" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--medianshrink&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Downsamples the volume by a factor of n by computing the local median&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t120" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--meanshrink&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Downsamples the volume by a factor of n by computing the local average&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t121" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--meanshrinkbig&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Downsamples the volume by a factor of n without reading the entire volume into RAM. The output file (after shrinking) must fit into RAM. If specified, this must be the ONLY option on the command line. Any other options will be ignored. Output data type will match input data type. Works only on single image files, not stack files.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t122" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--mrc16bit&quot;</span><span class="op">,</span>&nbsp; <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;(deprecated, use --outmode instead) output as 16 bit MRC file&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t123" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--mrc8bit&quot;</span><span class="op">,</span>&nbsp; <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;(deprecated, use --outmode instead) output as 8 bit MRC file&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t124" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--mult&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;f&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;float&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Scales the densities by a fixed number in the output&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t125" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--multfile&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Multiplies the volume by another volume of identical size. This can be used to apply masks, etc.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t126" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t127" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--origin&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;x, y, z&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;callback&quot;</span><span class="op">,</span> <span class="nam">callback</span><span class="op">=</span><span class="nam">floatvararg_callback</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Set the coordinates for the pixel (0,0,0) for Chimera. THIS HAS NO IMPACT ON IMAGE PROCESSING !&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t128" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--outmode&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="str">&quot;float&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;All EMAN2 programs write images with 4-byte floating point values when possible by default. This allows specifying an alternate format when supported (int8, int16, int32, uint8, uint16, uint32). Values are rescaled to fill MIN-MAX range.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t129" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--outnorescale&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;If specified, floating point values will not be rescaled when writing data as integers. Values outside of range are truncated.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t130" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--outtype&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;image-type&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Set output image format, mrc, imagic, hdf, etc&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t131" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t132" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--ppid&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">int</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Set the PID of the parent process, used for cross platform PPID&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="op">-</span><span class="num">2</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t133" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--process&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;processor_name:param1=value1:param2=value2&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;apply a processor named &#39;processorname&#39; with all its parameters/values.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t134" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t135" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--resetxf&quot;</span><span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Reset an existing transform matrix to the identity matrix&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t136" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--ralignzphi&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span> <span class="op">,</span><span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Refine Z alignment within +-10 pixels&nbsp; and phi +-15 degrees (for C symmetries), specify name of alignment reference here not with --alignref&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t137" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--rot&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;az,alt,phi or convention:par=val:...&quot;</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Rotate map. Specify az,alt,phi or convention:par=val:par=val:...&nbsp; eg - mrc:psi=22:theta=15:omega=7&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t138" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t139" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--scale&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;float&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Rescales the data in the image by &#39;n&#39;, opposite behavior of &#39;shrink&#39; above. Scaling is done by interpolation in real-space. Box size unchanged. See &#39;--clip&#39;&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t140" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--setsf&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;inputfile&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Set the radial structure factor. Must specify apix.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t141" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--step&quot;</span><span class="op">,</span><span class="nam">type</span><span class="op">=</span><span class="nam">str</span><span class="op">,</span><span class="nam">default</span><span class="op">=</span><span class="nam">None</span><span class="op">,</span><span class="nam">help</span><span class="op">=</span><span class="str">&quot;Specify &lt;init&gt;,&lt;step&gt;. Processes only a subset of the input data. For example, 0,2 would process only the even numbered particles&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t142" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--swap&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Swap the byte order&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t143" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--sym&quot;</span><span class="op">,</span> <span class="nam">dest</span> <span class="op">=</span> <span class="str">&quot;sym&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span> <span class="op">=</span> <span class="str">&quot;Symmetry to impose - choices are: c&lt;n&gt;, d&lt;n&gt;, h&lt;n&gt;, tet, oct, icos&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t144" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t145" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--tomoprep&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Produces a special HDF file designed for rapid interactive tomography annotation. This option should be used alone.&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t146" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--tophalf&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;The output only keeps the top half map&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t147" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--trans&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;dx,dy,dz&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;string&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;append&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Translate map by dx,dy,dz &quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t148" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t149" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--unstacking&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store_true&quot;</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;Process a stack of 3D images, then output a a series of numbered single image files&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="nam">False</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t150" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t151" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parser</span><span class="op">.</span><span class="nam">add_option</span><span class="op">(</span><span class="str">&quot;--verbose&quot;</span><span class="op">,</span> <span class="str">&quot;-v&quot;</span><span class="op">,</span> <span class="nam">dest</span><span class="op">=</span><span class="str">&quot;verbose&quot;</span><span class="op">,</span> <span class="nam">action</span><span class="op">=</span><span class="str">&quot;store&quot;</span><span class="op">,</span> <span class="nam">metavar</span><span class="op">=</span><span class="str">&quot;n&quot;</span><span class="op">,</span> <span class="nam">type</span><span class="op">=</span><span class="str">&quot;int&quot;</span><span class="op">,</span> <span class="nam">default</span><span class="op">=</span><span class="num">0</span><span class="op">,</span> <span class="nam">help</span><span class="op">=</span><span class="str">&quot;verbose level [0-9], higner number means higher level of verboseness&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t152" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t153" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">append_options</span> <span class="op">=</span> <span class="op">[</span><span class="str">&quot;clip&quot;</span><span class="op">,</span> <span class="str">&quot;fftclip&quot;</span><span class="op">,</span> <span class="str">&quot;process&quot;</span><span class="op">,</span> <span class="str">&quot;filter&quot;</span><span class="op">,</span> <span class="str">&quot;filtertable&quot;</span><span class="op">,</span>&nbsp; <span class="str">&quot;meanshrink&quot;</span><span class="op">,</span> <span class="str">&quot;medianshrink&quot;</span><span class="op">,</span> <span class="str">&quot;fouriershrink&quot;</span><span class="op">,</span> <span class="str">&quot;scale&quot;</span><span class="op">,</span> <span class="str">&quot;sym&quot;</span><span class="op">,</span> <span class="str">&quot;multfile&quot;</span><span class="op">,</span> <span class="str">&quot;addfile&quot;</span><span class="op">,</span> <span class="str">&quot;trans&quot;</span><span class="op">,</span> <span class="str">&quot;rot&quot;</span><span class="op">,</span> <span class="str">&quot;align&quot;</span><span class="op">,</span><span class="str">&quot;ralignzphi&quot;</span><span class="op">,</span><span class="str">&quot;alignctod&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t154" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t155" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">optionlist</span> <span class="op">=</span> <span class="nam">pyemtbx</span><span class="op">.</span><span class="nam">options</span><span class="op">.</span><span class="nam">get_optionlist</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t156" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t157" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">options</span><span class="op">,</span> <span class="nam">args</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parser</span><span class="op">.</span><span class="nam">parse_args</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t158" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t159" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t160" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">args</span><span class="op">)</span> <span class="op">!=</span> <span class="num">2</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t161" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;usage: &quot;</span> <span class="op">+</span> <span class="nam">usage</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t162" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Please run &#39;&quot;</span> <span class="op">+</span> <span class="nam">progname</span> <span class="op">+</span> <span class="str">&quot; -h&#39; for detailed options&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t163" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t164" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t165" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">step</span> <span class="key">and</span> <span class="nam">options</span><span class="op">.</span><span class="nam">first</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t166" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&#39;Invalid options. You used --first and --step. The --step option contains both a step size and the first image to step from. Please use only the --step option rather than --step and --first&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t167" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t168" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t169" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">mrc16bit</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t170" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Deprecated option mrc16bit, please use outmode=int16&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t171" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">=</span><span class="str">&quot;int16&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t172" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">mrc8bit</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t173" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Deprecated option mrc8bit, please use outmode=int8&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t174" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">=</span><span class="str">&quot;int8&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t175" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t176" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">file_mode_map</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t177" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Invalid output mode, please specify one of :\n&quot;</span><span class="op">,</span><span class="nam">str</span><span class="op">(</span><span class="nam">file_mode_map</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">.</span><span class="nam">translate</span><span class="op">(</span><span class="nam">None</span><span class="op">,</span><span class="str">&#39;&quot;[]&#39;</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t178" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t179" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t180" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">infile</span> <span class="op">=</span> <span class="nam">args</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t181" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">outfile</span> <span class="op">=</span> <span class="nam">args</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t182" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">is_new_file</span> <span class="op">=</span> <span class="key">not</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">isfile</span><span class="op">(</span><span class="nam">outfile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t183" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t184" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out_ext</span> <span class="op">=</span> <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">splitext</span><span class="op">(</span><span class="nam">outfile</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t185" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t186" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">out_ext</span> <span class="op">==</span> <span class="str">&quot;.lst&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t187" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Output file extension may not be .lst: &quot;</span> <span class="op">+</span> <span class="nam">outfile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t188" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t189" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t190" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This is a specilalized option which doesn&#39;t play nice with ANY other options in the command</span><span class="strut">&nbsp;</span></p>
<p id="t191" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># it will do piecewise shrinking of a map which is too large for RAM</span><span class="strut">&nbsp;</span></p>
<p id="t192" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">meanshrinkbig</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t193" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Dedicated large-map shrinking mode. No other operations will be performed.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t194" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">hdr</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t195" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrink</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">meanshrinkbig</span><span class="strut">&nbsp;</span></p>
<p id="t196" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">shrink</span><span class="op">&gt;</span><span class="num">10</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;Shrinking by &gt;10x is not recommended&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t197" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t198" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span><span class="op">,</span><span class="nam">ny</span><span class="op">,</span><span class="nam">nz</span><span class="op">=</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nz&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t199" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nnx</span><span class="op">=</span><span class="nam">nx</span><span class="op">/</span><span class="nam">shrink</span><span class="strut">&nbsp;</span></p>
<p id="t200" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nny</span><span class="op">=</span><span class="nam">ny</span><span class="op">/</span><span class="nam">shrink</span><span class="strut">&nbsp;</span></p>
<p id="t201" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nnz</span><span class="op">=</span><span class="nam">nz</span><span class="op">/</span><span class="nam">shrink</span><span class="strut">&nbsp;</span></p>
<p id="t202" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;%d x %d x %d --&gt; %d x %d x %d&nbsp; &nbsp; %1.1f GB of RAM required&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">nx</span><span class="op">,</span><span class="nam">ny</span><span class="op">,</span><span class="nam">nz</span><span class="op">,</span><span class="nam">nnx</span><span class="op">,</span><span class="nam">nny</span><span class="op">,</span><span class="nam">nnz</span><span class="op">,</span><span class="op">(</span><span class="nam">nnx</span><span class="op">*</span><span class="nam">nny</span><span class="op">*</span><span class="nam">nnz</span><span class="op">*</span><span class="num">4</span><span class="op">+</span><span class="nam">shrink</span><span class="op">*</span><span class="num">4</span><span class="op">*</span><span class="nam">ny</span><span class="op">*</span><span class="nam">shrink</span><span class="op">*</span><span class="num">4</span><span class="op">)</span><span class="op">/</span><span class="num">1.0e9</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t203" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t204" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">nnx</span><span class="op">,</span><span class="nam">nny</span><span class="op">,</span><span class="nam">nnz</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t205" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">to_zero</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t206" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ltime</span><span class="op">=</span><span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t207" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">nz</span><span class="op">,</span><span class="nam">shrink</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t208" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="nam">ltime</span><span class="op">&gt;</span><span class="num">0.5</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t209" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;&nbsp; %d/%d\r&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">z</span><span class="op">,</span><span class="nam">nz</span><span class="op">)</span><span class="op">,</span> <span class="nam">end</span><span class="op">=</span><span class="str">&#39; &#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t210" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">stdout</span><span class="op">.</span><span class="nam">flush</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t211" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ltime</span><span class="op">=</span><span class="nam">time</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t212" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">y</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">ny</span><span class="op">,</span><span class="num">4</span><span class="op">*</span><span class="nam">shrink</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t213" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">Region</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">y</span><span class="op">,</span><span class="nam">z</span><span class="op">,</span><span class="nam">nx</span><span class="op">,</span><span class="num">4</span><span class="op">*</span><span class="nam">shrink</span><span class="op">,</span><span class="nam">shrink</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t214" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;math.meanshrink&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;n&quot;</span><span class="op">:</span><span class="nam">shrink</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t215" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">insert_clip</span><span class="op">(</span><span class="nam">tmp</span><span class="op">,</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">y</span><span class="op">/</span><span class="nam">shrink</span><span class="op">,</span><span class="nam">z</span><span class="op">/</span><span class="nam">shrink</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t216" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t217" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#try: stype=tmp[&quot;datatype&quot;]</span><span class="strut">&nbsp;</span></p>
<p id="t218" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#except: stype=EM_FLOAT</span><span class="strut">&nbsp;</span></p>
<p id="t219" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">stype</span><span class="op">=</span><span class="nam">EM_FLOAT</span><span class="strut">&nbsp;</span></p>
<p id="t220" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;&nbsp; %d/%d&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">nz</span><span class="op">,</span><span class="nam">nz</span><span class="op">)</span><span class="op">,</span> <span class="nam">end</span><span class="op">=</span><span class="str">&#39; &#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t221" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;\nWriting in data mode &quot;</span><span class="op">,</span><span class="nam">file_mode_imap</span><span class="op">[</span><span class="nam">int</span><span class="op">(</span><span class="nam">stype</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t222" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t223" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">stype</span><span class="op">!=</span><span class="nam">EM_FLOAT</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t224" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">[</span><span class="str">&quot;render_min&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">file_mode_range</span><span class="op">[</span><span class="nam">stype</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t225" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">[</span><span class="str">&quot;render_max&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">file_mode_range</span><span class="op">[</span><span class="nam">stype</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t226" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t227" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">out</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">IMAGE_UNKNOWN</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">None</span><span class="op">,</span><span class="nam">EMUtil</span><span class="op">.</span><span class="nam">EMDataType</span><span class="op">(</span><span class="nam">stype</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t228" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t229" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Failed to write in file mode matching input, reverting to floating point output&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t230" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t231" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t232" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Complete !&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t233" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t234" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t235" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">tomoprep</span><span class="op">&gt;</span><span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t236" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Tomography processing preparation mode. No other processing will be performed.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t237" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t238" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">outfile</span><span class="op">[</span><span class="op">-</span><span class="num">4</span><span class="op">:</span><span class="op">]</span><span class="op">!=</span><span class="str">&quot;.hdf&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t239" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Preprocessed tomograms can only be in HDF format&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t240" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t241" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t242" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">hdr</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t243" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span><span class="op">,</span><span class="nam">ny</span><span class="op">,</span><span class="nam">nz</span><span class="op">=</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">hdr</span><span class="op">[</span><span class="str">&quot;nz&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t244" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t245" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># If this is a &quot;y-short&quot; tomogram convert it to z-short</span><span class="strut">&nbsp;</span></p>
<p id="t246" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">min</span><span class="op">(</span><span class="nam">nx</span><span class="op">,</span><span class="nam">ny</span><span class="op">,</span><span class="nam">nz</span><span class="op">)</span><span class="op">==</span><span class="nam">ny</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t247" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Create an empty file of the correct size</span><span class="strut">&nbsp;</span></p>
<p id="t248" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t249" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">.</span><span class="nam">set_size</span><span class="op">(</span><span class="nam">nx</span><span class="op">,</span><span class="nam">nz</span><span class="op">,</span><span class="nam">ny</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t250" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">IMAGE_UNKNOWN</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">None</span><span class="op">,</span><span class="nam">EM_UCHAR</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t251" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t252" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Write the output volume slice by slice</span><span class="strut">&nbsp;</span></p>
<p id="t253" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">ny</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t254" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">slice</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">Region</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="nam">z</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">nx</span><span class="op">,</span><span class="num">1</span><span class="op">,</span><span class="nam">nz</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t255" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">slice</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">IMAGE_UNKNOWN</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">Region</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">ny</span><span class="op">-</span><span class="nam">z</span><span class="op">-</span><span class="num">1</span><span class="op">,</span><span class="nam">nx</span><span class="op">,</span><span class="nam">nz</span><span class="op">,</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="nam">EM_UCHAR</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t256" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t257" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Write</span><span class="strut">&nbsp;</span></p>
<p id="t258" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t259" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Create an empty file of the correct size</span><span class="strut">&nbsp;</span></p>
<p id="t260" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t261" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">.</span><span class="nam">set_size</span><span class="op">(</span><span class="nam">nx</span><span class="op">,</span><span class="nam">ny</span><span class="op">,</span><span class="nam">nz</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t262" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tmp</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">IMAGE_UNKNOWN</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">None</span><span class="op">,</span><span class="nam">EM_UCHAR</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t263" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t264" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># write the output volume slice by slice</span><span class="strut">&nbsp;</span></p>
<p id="t265" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">ny</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t266" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">slice</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">Region</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">z</span><span class="op">,</span><span class="nam">nx</span><span class="op">,</span><span class="nam">nz</span><span class="op">,</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t267" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">slice</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">IMAGE_UNKNOWN</span><span class="op">,</span><span class="nam">False</span><span class="op">,</span><span class="nam">Region</span><span class="op">(</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">z</span><span class="op">,</span><span class="nam">nx</span><span class="op">,</span><span class="nam">nz</span><span class="op">,</span><span class="num">1</span><span class="op">)</span><span class="op">,</span><span class="nam">EM_UCHAR</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t268" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t269" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Complete !&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t270" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t271" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t272" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t273" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n0</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">first</span><span class="strut">&nbsp;</span></p>
<p id="t274" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n1</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">last</span><span class="strut">&nbsp;</span></p>
<p id="t275" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">infile</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;:&quot;</span> <span class="op">:</span> <span class="nam">nimg</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t276" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">nimg</span> <span class="op">=</span> <span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="nam">infile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t277" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">n1</span> <span class="op">&gt;</span> <span class="nam">nimg</span> <span class="key">or</span> <span class="nam">n1</span><span class="op">&lt;</span><span class="num">0</span><span class="op">:</span> <span class="nam">n1</span><span class="op">=</span><span class="nam">nimg</span><span class="op">-</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t278" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t279" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">step</span> <span class="op">!=</span> <span class="nam">None</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t280" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n0</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">step</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;,&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t281" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n2</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">step</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;,&quot;</span><span class="op">)</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t282" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">n2</span><span class="op">=</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t283" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t284" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">alignref</span> <span class="op">:</span> <span class="nam">alignref</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">alignref</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t285" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span> <span class="nam">alignref</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t286" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t287" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t288" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">calcradial</span><span class="op">&gt;=</span><span class="num">0</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t289" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Computing radial real-space distribution. All other options ignored!&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t290" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">curves</span><span class="op">=</span><span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t291" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n0</span><span class="op">,</span><span class="nam">n1</span><span class="op">+</span><span class="num">1</span><span class="op">,</span><span class="nam">n2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t292" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t293" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">c</span><span class="op">=</span><span class="nam">img</span><span class="op">.</span><span class="nam">calc_radial_dist</span><span class="op">(</span><span class="nam">img</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">/</span><span class="num">2</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="num">1</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">calcradial</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t294" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">curves</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">c</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t295" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t296" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">=</span><span class="nam">open</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="str">&quot;w&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t297" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;# {} mode {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">calcradial</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t298" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">l</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">curves</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t299" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;\n{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">l</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t300" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">c</span> <span class="key">in</span> <span class="nam">curves</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t301" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">out</span><span class="op">.</span><span class="nam">write</span><span class="op">(</span><span class="str">&quot;\t{}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">c</span><span class="op">[</span><span class="nam">l</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t302" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t303" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t304" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t305" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t306" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">average</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t307" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Averaging particles from %d to %d stepping by %d. All other options ignored !&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">n0</span><span class="op">,</span><span class="nam">n1</span><span class="op">,</span><span class="nam">n2</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t308" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg_dict</span><span class="op">=</span><span class="nam">parsemodopt</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">averager</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t309" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgr</span> <span class="op">=</span> <span class="nam">Averagers</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">avg_dict</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">avg_dict</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t310" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t311" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">n0</span><span class="op">,</span><span class="nam">n1</span><span class="op">+</span><span class="num">1</span><span class="op">,</span><span class="nam">n2</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t312" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avgr</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span> <span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t313" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t314" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Added ptcl %d / %d&quot;</span> <span class="op">%</span><span class="op">(</span> <span class="nam">i</span><span class="op">+</span><span class="num">1</span><span class="op">,</span> <span class="op">(</span><span class="nam">n1</span><span class="op">-</span><span class="nam">n0</span><span class="op">)</span><span class="op">/</span><span class="nam">n2</span> <span class="op">+</span> <span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t315" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">=</span><span class="nam">avgr</span><span class="op">.</span><span class="nam">finish</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t316" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t317" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t318" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">[</span><span class="str">&quot;ptcl_repr&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">sum</span><span class="op">(</span><span class="op">[</span><span class="nam">i</span><span class="op">[</span><span class="str">&quot;ptcl_repr&quot;</span><span class="op">]</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">ptcls</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t319" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t320" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t321" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t322" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t323" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t324" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t325" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span> <span class="op">=</span> <span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t326" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">append_option</span> <span class="key">in</span> <span class="nam">append_options</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t327" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">append_option</span><span class="op">]</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t328" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t329" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span><span class="op">(</span><span class="nam">n0</span> <span class="op">&lt;</span> <span class="num">0</span> <span class="key">or</span> <span class="nam">n0</span> <span class="op">&gt;</span> <span class="nam">nimg</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t330" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Your first index is out of range, changed to zero&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t331" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n0</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t332" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t333" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span><span class="op">(</span><span class="nam">n1</span> <span class="op">==</span> <span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t334" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n1</span> <span class="op">=</span> <span class="nam">nimg</span><span class="op">-</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t335" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span><span class="op">(</span><span class="nam">n1</span> <span class="op">&gt;</span> <span class="nam">nimg</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t336" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Your last index is out of range, changed to %d&quot;</span> <span class="op">%</span> <span class="op">(</span><span class="nam">nimg</span><span class="op">-</span><span class="num">1</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t337" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">n1</span> <span class="op">=</span> <span class="nam">nimg</span><span class="op">-</span><span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t338" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t339" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Steve:&nbsp; why are all of the images being read at once !?!?. This is nuts</span><span class="strut">&nbsp;</span></p>
<p id="t340" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># modified so for multiple volumes, returns header-only</span><span class="strut">&nbsp;</span></p>
<p id="t341" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t342" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">datlst</span> <span class="op">=</span> <span class="nam">parse_infile</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span> <span class="nam">n0</span><span class="op">,</span> <span class="nam">n1</span><span class="op">,</span> <span class="nam">n2</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t343" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t344" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#datlst = parse_infile(infile, indxs)</span><span class="strut">&nbsp;</span></p>
<p id="t345" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t346" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">logid</span><span class="op">=</span><span class="nam">E2init</span><span class="op">(</span><span class="nam">sys</span><span class="op">.</span><span class="nam">argv</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">ppid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t347" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t348" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">x</span> <span class="op">=</span> <span class="nam">datlst</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">get_xsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t349" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">y</span> <span class="op">=</span> <span class="nam">datlst</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">get_ysize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t350" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">z</span> <span class="op">=</span> <span class="nam">datlst</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">get_zsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t351" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t352" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xc</span> <span class="op">=</span> <span class="nam">x</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t353" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yc</span> <span class="op">=</span> <span class="nam">y</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t354" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zc</span> <span class="op">=</span> <span class="nam">z</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t355" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t356" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span> <span class="op">=</span> <span class="nam">x</span><span class="strut">&nbsp;</span></p>
<p id="t357" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span> <span class="op">=</span> <span class="nam">y</span><span class="strut">&nbsp;</span></p>
<p id="t358" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nz</span> <span class="op">=</span> <span class="nam">z</span><span class="strut">&nbsp;</span></p>
<p id="t359" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t360" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">origin_x</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t361" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">origin_y</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t362" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">origin_z</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t363" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t364" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print_iminfo(datlst[0], &quot;Original&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t365" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t366" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span> <span class="op">=</span> <span class="nam">datlst</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="str">&quot;apix_x&quot;</span><span class="op">]</span>&nbsp; &nbsp; &nbsp; <span class="com"># default to apix_x from file</span><span class="strut">&nbsp;</span></p>
<p id="t367" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t368" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t369" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t370" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="str">&quot;outtype&quot;</span> <span class="key">in</span> <span class="nam">optionlist</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t371" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">optionlist</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="str">&quot;outtype&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t372" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t373" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t374" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;%d images, processing %d-%d (step %d)......&quot;</span><span class="op">%</span><span class="op">(</span><span class="nam">nimg</span><span class="op">,</span> <span class="nam">n0</span><span class="op">,</span> <span class="nam">n1</span><span class="op">,</span><span class="nam">n2</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t375" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t376" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># processors that only work out of place</span><span class="strut">&nbsp;</span></p>
<p id="t377" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">oopprocs</span><span class="op">=</span><span class="op">{</span><span class="str">&quot;misc.directional_sum&quot;</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t378" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t379" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print &#39;start.....&#39;</span><span class="strut">&nbsp;</span></p>
<p id="t380" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img_index</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t381" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print &quot;datalst is&quot;, datlst</span><span class="strut">&nbsp;</span></p>
<p id="t382" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">data</span> <span class="key">in</span> <span class="nam">datlst</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t383" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># if this is a list of images, we have header-only, and need to read the actual volume</span><span class="strut">&nbsp;</span></p>
<p id="t384" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">datlst</span><span class="op">)</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t385" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;source_path&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;source_n&quot;</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t386" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print &quot;Read image data from file %s for index %d&quot; %(data[&quot;source_path&quot;],data[&quot;source_n&quot;])</span><span class="strut">&nbsp;</span></p>
<p id="t387" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t388" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">apix</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t389" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">set_attr</span><span class="op">(</span><span class="str">&#39;apix_x&#39;</span><span class="op">,</span> <span class="nam">apix</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t390" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">set_attr</span><span class="op">(</span><span class="str">&#39;apix_y&#39;</span><span class="op">,</span> <span class="nam">apix</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t391" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">set_attr</span><span class="op">(</span><span class="str">&#39;apix_z&#39;</span><span class="op">,</span> <span class="nam">apix</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t392" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t393" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">inputto1</span> <span class="op">:</span> <span class="nam">data</span><span class="op">.</span><span class="nam">to_one</span><span class="op">(</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># replace all voxel values with 1.0</span><span class="strut">&nbsp;</span></p>
<p id="t394" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">resetxf</span> <span class="op">:</span> <span class="nam">data</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">Transform</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t395" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t396" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">option1</span> <span class="key">in</span> <span class="nam">optionlist</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t397" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;origin&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t398" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">origin</span><span class="op">)</span><span class="op">==</span><span class="num">3</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t399" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">originx</span><span class="op">,</span> <span class="nam">originy</span><span class="op">,</span> <span class="nam">originz</span><span class="op">)</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">origin</span><span class="strut">&nbsp;</span></p>
<p id="t400" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t401" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&#39;&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t402" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t403" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t404" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">set_xyz_origin</span><span class="op">(</span><span class="nam">originx</span><span class="op">,</span> <span class="nam">originy</span><span class="op">,</span> <span class="nam">originz</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t405" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t406" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;matchto&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t407" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mt</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">matchto</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t408" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;filter.matchto&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;to&quot;</span><span class="op">:</span><span class="nam">mt</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t409" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mt</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t410" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t411" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;calcfsc&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t412" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">datafsc</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">calcfsc</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t413" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fsc</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">calc_fourier_shell_correlation</span><span class="op">(</span><span class="nam">datafsc</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t414" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">third</span> <span class="op">=</span> <span class="nam">len</span><span class="op">(</span><span class="nam">fsc</span><span class="op">)</span><span class="op">/</span><span class="num">3</span><span class="strut">&nbsp;</span></p>
<p id="t415" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xaxis</span> <span class="op">=</span> <span class="nam">fsc</span><span class="op">[</span><span class="num">0</span><span class="op">:</span><span class="nam">third</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t416" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fsc</span> <span class="op">=</span> <span class="nam">fsc</span><span class="op">[</span><span class="nam">third</span><span class="op">:</span><span class="num">2</span><span class="op">*</span><span class="nam">third</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t417" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">saxis</span> <span class="op">=</span> <span class="op">[</span><span class="nam">x</span><span class="op">/</span><span class="nam">apix</span> <span class="key">for</span> <span class="nam">x</span> <span class="key">in</span> <span class="nam">xaxis</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t418" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">Util</span><span class="op">.</span><span class="nam">save_data</span><span class="op">(</span><span class="nam">saxis</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">saxis</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">saxis</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">fsc</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">args</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t419" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;Exiting after FSC calculation&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t420" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t421" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t422" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;calcsf&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t423" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dataf</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">do_fft</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t424" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">curve</span> <span class="op">=</span> <span class="nam">dataf</span><span class="op">.</span><span class="nam">calc_radial_dist</span><span class="op">(</span><span class="nam">ny</span><span class="op">/</span><span class="num">2</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t425" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">curve</span><span class="op">=</span><span class="op">[</span><span class="nam">i</span><span class="op">/</span><span class="op">(</span><span class="nam">dataf</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">*</span><span class="nam">dataf</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="op">*</span><span class="nam">dataf</span><span class="op">[</span><span class="str">&quot;nz&quot;</span><span class="op">]</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">curve</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t426" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">Util</span><span class="op">.</span><span class="nam">save_data</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">1.0</span><span class="op">/</span><span class="op">(</span><span class="nam">apix</span><span class="op">*</span><span class="nam">ny</span><span class="op">)</span><span class="op">,</span> <span class="nam">curve</span><span class="op">,</span> <span class="nam">options</span><span class="op">.</span><span class="nam">calcsf</span><span class="op">)</span><span class="op">;</span><span class="strut">&nbsp;</span></p>
<p id="t427" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t428" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;setsf&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t429" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;setsf -&gt; &quot;</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">setsf</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t430" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sf</span><span class="op">=</span><span class="nam">XYData</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t431" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sf</span><span class="op">.</span><span class="nam">read_file</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">setsf</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t432" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;filter.setstrucfac&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;apix&quot;</span><span class="op">:</span><span class="nam">apix</span><span class="op">,</span><span class="str">&quot;strucfac&quot;</span><span class="op">:</span><span class="nam">sf</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t433" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#dataf = data.do_fft()</span><span class="strut">&nbsp;</span></p>
<p id="t434" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#curve = dataf.calc_radial_dist(ny, 0, 0.5,True)</span><span class="strut">&nbsp;</span></p>
<p id="t435" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#filt=[]</span><span class="strut">&nbsp;</span></p>
<p id="t436" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#norm=data[&quot;nx&quot;]*data[&quot;ny&quot;]*data[&quot;nz&quot;]</span><span class="strut">&nbsp;</span></p>
<p id="t437" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#for i,j in enumerate(curve):</span><span class="strut">&nbsp;</span></p>
<p id="t438" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#if j==0 : filt.append(0.0)</span><span class="strut">&nbsp;</span></p>
<p id="t439" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#else :</span><span class="strut">&nbsp;</span></p>
<p id="t440" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#filt.append(sqrt(norm*sf.get_yatx(i/(apix*2.0*dataf[&quot;ny&quot;]))/j))</span><span class="strut">&nbsp;</span></p>
<p id="t441" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print i,sqrt(norm*sf.get_yatx(i/(apix*2.0*dataf[&quot;ny&quot;]))/j)</span><span class="strut">&nbsp;</span></p>
<p id="t442" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#dataf.apply_radial_func(0,0.5/len(filt),filt)</span><span class="strut">&nbsp;</span></p>
<p id="t443" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#data=dataf.do_ift()</span><span class="strut">&nbsp;</span></p>
<p id="t444" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t445" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#curve2 = dataf.calc_radial_dist(ny, 0, 0.5,True)</span><span class="strut">&nbsp;</span></p>
<p id="t446" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; plot((curve,curve2))</span><span class="strut">&nbsp;</span></p>
<p id="t447" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;filtertable&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t448" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">tf</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">filtertable</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t449" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;Apply filter -&gt; &quot;</span><span class="op">,</span><span class="nam">tf</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t450" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xy</span> <span class="op">=</span> <span class="nam">XYData</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t451" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xy</span><span class="op">.</span><span class="nam">read_file</span><span class="op">(</span><span class="nam">tf</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t452" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t453" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">filt</span><span class="op">=</span><span class="op">[</span><span class="nam">xy</span><span class="op">.</span><span class="nam">get_yatx_smooth</span><span class="op">(</span><span class="nam">i</span><span class="op">/</span><span class="op">(</span><span class="nam">apix</span><span class="op">*</span><span class="nam">ny</span><span class="op">)</span><span class="op">,</span><span class="num">1</span><span class="op">)</span> <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">int</span><span class="op">(</span><span class="nam">ceil</span><span class="op">(</span><span class="nam">ny</span><span class="op">*</span><span class="nam">sqrt</span><span class="op">(</span><span class="num">3.0</span><span class="op">)</span><span class="op">/</span><span class="num">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t454" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="nam">filt</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t455" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;filter.radialtable&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;table&quot;</span><span class="op">:</span><span class="nam">filt</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t456" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t457" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;process&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t458" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fi</span> <span class="op">=</span> <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t459" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;process -&gt; &quot;</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">process</span><span class="op">[</span><span class="nam">fi</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t460" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">filtername</span><span class="op">,</span> <span class="nam">param_dict</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parsemodopt</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">process</span><span class="op">[</span><span class="nam">fi</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t461" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">param_dict</span> <span class="op">:</span> <span class="nam">param_dict</span><span class="op">=</span><span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t462" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t463" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#Parse the options to convert the image file name to EMData object(for both plain image file and bdb file)</span><span class="strut">&nbsp;</span></p>
<p id="t464" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">key</span> <span class="key">in</span> <span class="nam">param_dict</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t465" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">str</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">&#39;bdb:&#39;</span><span class="op">)</span><span class="op">!=</span><span class="op">-</span><span class="num">1</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">str</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t466" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t467" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span>&nbsp; <span class="nam">os</span><span class="op">.</span><span class="nam">path</span><span class="op">.</span><span class="nam">is_file</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t468" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t469" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t470" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t471" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t472" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">filtername</span> <span class="key">in</span> <span class="nam">oopprocs</span> <span class="op">:</span> <span class="nam">data</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="nam">filtername</span><span class="op">,</span><span class="nam">param_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t473" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t474" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span> <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="nam">filtername</span><span class="op">,</span> <span class="nam">param_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t475" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t476" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">traceback</span><span class="op">.</span><span class="nam">print_exc</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t477" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error running processor: &quot;</span><span class="op">,</span><span class="nam">filtername</span><span class="op">,</span><span class="nam">param_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t478" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t479" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t480" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;ralignzphi&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t481" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; print &quot;ralignzphi &quot;,options.ralignzphi[index_d[option1]]</span><span class="strut">&nbsp;</span></p>
<p id="t482" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zalignref</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">ralignzphi</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t483" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dang</span><span class="op">=</span><span class="num">80.0</span><span class="op">/</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="op">;</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># 1 pixel at ~3/4 radius</span><span class="strut">&nbsp;</span></p>
<p id="t484" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dzmax</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="op">/</span><span class="num">20</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># max +-z shift</span><span class="strut">&nbsp;</span></p>
<p id="t485" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="op">(</span><span class="num">1000</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="num">0</span><span class="op">,</span><span class="nam">data</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t486" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t487" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dsd</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;math.meanshrink&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;n&quot;</span><span class="op">:</span><span class="num">2</span><span class="op">}</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># downsampled data</span><span class="strut">&nbsp;</span></p>
<p id="t488" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dsd</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;filter.lowpass.gauss&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;cutoff_abs&quot;</span><span class="op">:</span><span class="num">0.25</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t489" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t490" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dsr</span><span class="op">=</span><span class="nam">zalignref</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;math.meanshrink&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;n&quot;</span><span class="op">:</span><span class="num">2</span><span class="op">}</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># downsampled reference</span><span class="strut">&nbsp;</span></p>
<p id="t491" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dsr</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;filter.lowpass.gauss&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;cutoff_abs&quot;</span><span class="op">:</span><span class="num">0.25</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t492" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t493" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># coarse search on downsampled/filtered data</span><span class="strut">&nbsp;</span></p>
<p id="t494" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">it</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="num">3</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t495" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="nam">dzmax</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">+</span><span class="nam">dzmax</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t496" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zimg</span><span class="op">=</span><span class="nam">dsd</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;tz&quot;</span><span class="op">:</span><span class="nam">z</span><span class="op">,</span><span class="str">&quot;phi&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t497" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="nam">min</span><span class="op">(</span><span class="nam">best</span><span class="op">,</span><span class="op">(</span><span class="nam">dsr</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="op">,</span><span class="nam">z</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t498" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="op">:</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t499" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t500" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">phi</span> <span class="key">in</span> <span class="nam">arange</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">-</span><span class="num">20.0</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">+</span><span class="num">20.0</span><span class="op">,</span><span class="nam">dang</span><span class="op">*</span><span class="num">2.0</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t501" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zimg</span><span class="op">=</span><span class="nam">dsd</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;tz&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="str">&quot;phi&quot;</span><span class="op">:</span><span class="nam">phi</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t502" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="nam">min</span><span class="op">(</span><span class="nam">best</span><span class="op">,</span><span class="op">(</span><span class="nam">dsr</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="nam">phi</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t503" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="op">:</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t504" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t505" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># Fix best() for full sampling</span><span class="strut">&nbsp;</span></p>
<p id="t506" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zimg</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;tz&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="num">2</span><span class="op">,</span><span class="str">&quot;phi&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t507" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="op">(</span><span class="num">1000.0</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">*</span><span class="num">2</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t508" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t509" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># now we do a fine search only in the neighborhood on the original data</span><span class="strut">&nbsp;</span></p>
<p id="t510" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">z</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">-</span><span class="num">3</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">+</span><span class="num">4</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t511" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">phi</span> <span class="key">in</span> <span class="nam">arange</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">-</span><span class="nam">dang</span><span class="op">*</span><span class="num">3.0</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">+</span><span class="nam">dang</span><span class="op">*</span><span class="num">3.5</span><span class="op">,</span><span class="nam">dang</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t512" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zimg</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;tz&quot;</span><span class="op">:</span><span class="nam">z</span><span class="op">,</span><span class="str">&quot;phi&quot;</span><span class="op">:</span><span class="nam">phi</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t513" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="nam">min</span><span class="op">(</span><span class="nam">best</span><span class="op">,</span><span class="op">(</span><span class="nam">zalignref</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="op">,</span><span class="nam">z</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">,</span><span class="nam">zimg</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t514" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="nam">best</span><span class="op">[</span><span class="op">:</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t515" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t516" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">=</span><span class="nam">best</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t517" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;tz&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="str">&quot;phi&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t518" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;Alignment: tz = &quot;</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">,</span><span class="str">&quot;&nbsp; dphi=&quot;</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t519" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t520" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;alignctod&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t521" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">alignctod</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">.</span><span class="nam">lower</span><span class="op">(</span><span class="op">)</span><span class="op">!=</span><span class="str">&quot;d&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t522" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error: please specify D symmetry as alignctod&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t523" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t524" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nsym</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">alignctod</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">:</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t525" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">angrange</span><span class="op">=</span><span class="num">360.0</span><span class="op">/</span><span class="nam">nsym</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># probably more than necessary, but we&#39;ll do it anyway...</span><span class="strut">&nbsp;</span></p>
<p id="t526" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">astep</span><span class="op">=</span><span class="num">360.0</span><span class="op">/</span><span class="nam">pi</span><span class="op">*</span><span class="nam">atan</span><span class="op">(</span><span class="num">2.0</span><span class="op">/</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t527" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nstep</span><span class="op">=</span><span class="nam">int</span><span class="op">(</span><span class="nam">angrange</span><span class="op">/</span><span class="nam">astep</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t528" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t529" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="op">(</span><span class="num">1e23</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t530" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">azi</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">nstep</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t531" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">az</span><span class="op">=</span><span class="nam">azi</span><span class="op">*</span><span class="nam">astep</span><span class="strut">&nbsp;</span></p>
<p id="t532" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">datad</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;alt&quot;</span><span class="op">:</span><span class="num">180.0</span><span class="op">,</span><span class="str">&quot;az&quot;</span><span class="op">:</span><span class="nam">az</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># rotate 180, then about z</span><span class="strut">&nbsp;</span></p>
<p id="t533" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">c</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">datad</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t534" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="nam">min</span><span class="op">(</span><span class="nam">best</span><span class="op">,</span><span class="op">(</span><span class="nam">c</span><span class="op">,</span><span class="nam">az</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t535" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="nam">azi</span><span class="op">,</span><span class="nam">az</span><span class="op">,</span><span class="nam">c</span><span class="op">,</span><span class="nam">best</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t536" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t537" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">bcen</span><span class="op">=</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t538" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">azi</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="op">-</span><span class="num">4</span><span class="op">,</span><span class="num">5</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t539" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">az</span><span class="op">=</span><span class="nam">bcen</span><span class="op">+</span><span class="nam">azi</span><span class="op">*</span><span class="nam">astep</span><span class="op">/</span><span class="num">4.0</span><span class="strut">&nbsp;</span></p>
<p id="t540" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">datad</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">process</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;alt&quot;</span><span class="op">:</span><span class="num">180.0</span><span class="op">,</span><span class="str">&quot;az&quot;</span><span class="op">:</span><span class="nam">az</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># rotate 180, then about z</span><span class="strut">&nbsp;</span></p>
<p id="t541" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">c</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">cmp</span><span class="op">(</span><span class="str">&quot;ccc&quot;</span><span class="op">,</span><span class="nam">datad</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t542" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">best</span><span class="op">=</span><span class="nam">min</span><span class="op">(</span><span class="nam">best</span><span class="op">,</span><span class="op">(</span><span class="nam">c</span><span class="op">,</span><span class="nam">az</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t543" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="nam">azi</span><span class="op">,</span><span class="nam">az</span><span class="op">,</span><span class="nam">c</span><span class="op">,</span><span class="nam">best</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t544" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t545" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;alignctod, rotate:&quot;</span><span class="op">,</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">/</span><span class="num">2.0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t546" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">Transform</span><span class="op">(</span><span class="op">{</span><span class="str">&quot;type&quot;</span><span class="op">:</span><span class="str">&quot;eman&quot;</span><span class="op">,</span><span class="str">&quot;az&quot;</span><span class="op">:</span><span class="nam">best</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">/</span><span class="num">2.0</span><span class="op">}</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="com"># 1/2 the angle to get it on the 2-fold</span><span class="strut">&nbsp;</span></p>
<p id="t547" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t548" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;align&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t549" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">alignref</span><span class="op">==</span><span class="nam">None</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t550" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error, no alignment reference specified with --alignref&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t551" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t552" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t553" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fi</span> <span class="op">=</span> <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t554" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">1</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;align -&gt; &quot;</span><span class="op">,</span><span class="nam">options</span><span class="op">.</span><span class="nam">align</span><span class="op">[</span><span class="nam">fi</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t555" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">alignername</span><span class="op">,</span> <span class="nam">param_dict</span><span class="op">)</span> <span class="op">=</span> <span class="nam">parsemodopt</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">align</span><span class="op">[</span><span class="nam">fi</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t556" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">param_dict</span> <span class="op">:</span> <span class="nam">param_dict</span><span class="op">=</span><span class="op">{</span><span class="op">}</span><span class="strut">&nbsp;</span></p>
<p id="t557" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t558" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#Parse the options to convert the image file name to EMData object(for both plain image file and bdb file)</span><span class="strut">&nbsp;</span></p>
<p id="t559" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">key</span> <span class="key">in</span> <span class="nam">param_dict</span><span class="op">.</span><span class="nam">keys</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t560" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">str</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span><span class="op">.</span><span class="nam">find</span><span class="op">(</span><span class="str">&#39;bdb:&#39;</span><span class="op">)</span><span class="op">!=</span><span class="op">-</span><span class="num">1</span> <span class="key">or</span> <span class="key">not</span> <span class="nam">str</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span><span class="op">.</span><span class="nam">isdigit</span><span class="op">(</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t561" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t562" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">param_dict</span><span class="op">[</span><span class="nam">key</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t563" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t564" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">pass</span><span class="strut">&nbsp;</span></p>
<p id="t565" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t566" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># For &#39;refine&#39; aligners, we normally want to provide a starting alignment, presumably from the previous aligner. If we can&#39;t find one with start with identity matrix</span><span class="strut">&nbsp;</span></p>
<p id="t567" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="str">&quot;refine&quot;</span> <span class="key">in</span> <span class="nam">alignername</span> <span class="key">and</span> <span class="str">&quot;xform.align3d&quot;</span> <span class="key">not</span> <span class="key">in</span> <span class="nam">param_dict</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t568" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">try</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t569" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">param_dict</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t570" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="nam">alignername</span><span class="op">,</span><span class="str">&quot; using xform.align3d from image&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t571" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">except</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t572" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">param_dict</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">Transform</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t573" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="nam">alignername</span><span class="op">,</span><span class="str">&quot; didn&#39;t find a starting transform, using identity matrix.&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t574" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t575" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># actual alignment</span><span class="strut">&nbsp;</span></p>
<p id="t576" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">align</span><span class="op">(</span><span class="nam">alignername</span><span class="op">,</span><span class="nam">alignref</span><span class="op">,</span> <span class="nam">param_dict</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t577" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">verbose</span><span class="op">&gt;</span><span class="num">0</span> <span class="op">:</span> <span class="key">print</span><span class="op">(</span><span class="str">&quot;Final alignment:&quot;</span><span class="op">,</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;xform.align3d&quot;</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t578" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t579" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t580" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;mult&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t581" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">mult</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">mult</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t582" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t583" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;addfile&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t584" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">af</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">addfile</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t585" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">af</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t586" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">af</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t587" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t588" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t589" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;multfile&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t590" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mf</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">multfile</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t591" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">mult</span><span class="op">(</span><span class="nam">mf</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t592" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">mf</span><span class="op">=</span><span class="nam">None</span><span class="strut">&nbsp;</span></p>
<p id="t593" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t594" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t595" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif option1 == &quot;tomoshrink&quot;:</span><span class="strut">&nbsp;</span></p>
<p id="t596" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; from e2spt_boxer import ShrunkenTomogram</span><span class="strut">&nbsp;</span></p>
<p id="t597" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; st = ShrunkenTomogram(args[0])</span><span class="strut">&nbsp;</span></p>
<p id="t598" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; st.set_cache_to_db(False)</span><span class="strut">&nbsp;</span></p>
<p id="t599" class="pln"><span class="com">#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp = st.get_image()</span><span class="strut">&nbsp;</span></p>
<p id="t600" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t601" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;add&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t602" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">add</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">add</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t603" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t604" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;icos5to2&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t605" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xf</span><span class="op">=</span><span class="nam">Transform</span><span class="op">.</span><span class="nam">icos_5_to_2</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t606" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">xf</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t607" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t608" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;icos2to5&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t609" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xf</span><span class="op">=</span><span class="nam">Transform</span><span class="op">.</span><span class="nam">icos_5_to_2</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t610" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xf</span><span class="op">.</span><span class="nam">invert</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t611" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;xform&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;transform&quot;</span><span class="op">:</span><span class="nam">xf</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t612" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t613" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t614" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;trans&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t615" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fi</span> <span class="op">=</span> <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t616" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">dx</span><span class="op">,</span><span class="nam">dy</span><span class="op">,</span><span class="nam">dz</span><span class="op">=</span><span class="nam">options</span><span class="op">.</span><span class="nam">trans</span><span class="op">[</span><span class="nam">fi</span><span class="op">]</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;,&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t617" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">translate</span><span class="op">(</span><span class="nam">float</span><span class="op">(</span><span class="nam">dx</span><span class="op">)</span><span class="op">,</span><span class="nam">float</span><span class="op">(</span><span class="nam">dy</span><span class="op">)</span><span class="op">,</span><span class="nam">float</span><span class="op">(</span><span class="nam">dz</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t618" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t619" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t620" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;rot&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t621" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fi</span> <span class="op">=</span> <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t622" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#try:</span><span class="strut">&nbsp;</span></p>
<p id="t623" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xform</span><span class="op">=</span><span class="nam">parse_transform</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">rot</span><span class="op">[</span><span class="nam">fi</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t624" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#except:</span><span class="strut">&nbsp;</span></p>
<p id="t625" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; print &quot;Invalid rotation specified: &quot;,options.rot[fi]</span><span class="strut">&nbsp;</span></p>
<p id="t626" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#&nbsp; &nbsp; &nbsp;&nbsp; print &quot;Please see e2help.py transform&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t627" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t628" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">transform</span><span class="op">(</span><span class="nam">xform</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t629" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t630" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t631" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;clip&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t632" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">x</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;nx&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t633" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">y</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;ny&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t634" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">z</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;nz&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t635" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">clip</span><span class="op">)</span> <span class="op">==</span> <span class="num">6</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t636" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">nx</span><span class="op">,</span> <span class="nam">ny</span><span class="op">,</span> <span class="nam">nz</span><span class="op">,</span> <span class="nam">xc</span><span class="op">,</span> <span class="nam">yc</span><span class="op">,</span> <span class="nam">zc</span><span class="op">)</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">clip</span><span class="strut">&nbsp;</span></p>
<p id="t637" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">clip</span><span class="op">)</span> <span class="op">==</span> <span class="num">3</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t638" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">nx</span><span class="op">,</span> <span class="nam">ny</span><span class="op">,</span> <span class="nam">nz</span><span class="op">)</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">clip</span><span class="strut">&nbsp;</span></p>
<p id="t639" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xc</span> <span class="op">=</span> <span class="nam">x</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t640" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yc</span> <span class="op">=</span> <span class="nam">y</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t641" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zc</span> <span class="op">=</span> <span class="nam">z</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t642" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">clip</span><span class="op">)</span> <span class="op">==</span><span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t643" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">clip</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t644" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span><span class="op">=</span><span class="nam">nx</span><span class="strut">&nbsp;</span></p>
<p id="t645" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nz</span><span class="op">=</span><span class="nam">nx</span><span class="strut">&nbsp;</span></p>
<p id="t646" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xc</span> <span class="op">=</span> <span class="nam">x</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t647" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yc</span> <span class="op">=</span> <span class="nam">y</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t648" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zc</span> <span class="op">=</span> <span class="nam">z</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t649" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t650" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&#39;clip option takes 1, 3 or 6 arguments. --clip=x[,y,z[,xc,yc,zc]]&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t651" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t652" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t653" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="op">(</span><span class="nam">xc</span><span class="op">&gt;=</span><span class="num">0</span> <span class="key">and</span> <span class="nam">yc</span><span class="op">&gt;=</span><span class="num">0</span> <span class="key">and</span> <span class="nam">zc</span><span class="op">&gt;=</span><span class="num">0</span> <span class="key">and</span> <span class="nam">xc</span><span class="op">&lt;</span><span class="nam">x</span> <span class="key">and</span> <span class="nam">yc</span><span class="op">&lt;</span><span class="nam">y</span> <span class="key">and</span> <span class="nam">zc</span><span class="op">&lt;</span><span class="nam">z</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t654" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xc</span> <span class="op">=</span> <span class="nam">x</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t655" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">yc</span> <span class="op">=</span> <span class="nam">y</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t656" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">zc</span> <span class="op">=</span> <span class="nam">z</span><span class="op">/</span><span class="num">2</span><span class="strut">&nbsp;</span></p>
<p id="t657" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t658" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">x</span> <span class="op">!=</span> <span class="nam">nx</span> <span class="key">or</span> <span class="nam">y</span> <span class="op">!=</span> <span class="nam">ny</span> <span class="key">or</span> <span class="nam">z</span> <span class="op">!=</span> <span class="nam">nz</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t659" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">clip_inplace</span><span class="op">(</span><span class="nam">Region</span><span class="op">(</span><span class="nam">xc</span><span class="op">-</span><span class="nam">nx</span><span class="op">/</span><span class="num">2</span><span class="op">,</span> <span class="nam">yc</span><span class="op">-</span><span class="nam">ny</span><span class="op">/</span><span class="num">2</span><span class="op">,</span> <span class="nam">zc</span><span class="op">-</span><span class="nam">nz</span><span class="op">/</span><span class="num">2</span><span class="op">,</span> <span class="nam">nx</span><span class="op">,</span> <span class="nam">ny</span><span class="op">,</span> <span class="nam">nz</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t660" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t661" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t662" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;sym&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t663" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sym</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">sym</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t664" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xf</span> <span class="op">=</span> <span class="nam">Transform</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t665" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">xf</span><span class="op">.</span><span class="nam">to_identity</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t666" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nsym</span><span class="op">=</span><span class="nam">xf</span><span class="op">.</span><span class="nam">get_nsym</span><span class="op">(</span><span class="nam">sym</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t667" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">avg_dict</span><span class="op">=</span><span class="nam">parsemodopt</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">averager</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t668" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">symavgr</span> <span class="op">=</span> <span class="nam">Averagers</span><span class="op">.</span><span class="nam">get</span><span class="op">(</span><span class="nam">avg_dict</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">,</span><span class="nam">avg_dict</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t669" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t670" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t671" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="nam">nsym</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t672" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ref</span><span class="op">=</span><span class="nam">data</span><span class="op">.</span><span class="nam">copy</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t673" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ref</span><span class="op">.</span><span class="nam">transform</span><span class="op">(</span><span class="nam">xf</span><span class="op">.</span><span class="nam">get_sym</span><span class="op">(</span><span class="nam">sym</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t674" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">symavgr</span><span class="op">.</span><span class="nam">add_image</span><span class="op">(</span><span class="nam">ref</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t675" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">=</span><span class="nam">symavgr</span><span class="op">.</span><span class="nam">finish</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t676" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t677" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;scale&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t678" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">scale_f</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">scale</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t679" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">scale_f</span> <span class="op">!=</span> <span class="num">1.0</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t680" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">scale</span><span class="op">(</span><span class="nam">scale_f</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t681" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t682" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t683" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;medianshrink&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t684" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrink_f</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">medianshrink</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t685" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">shrink_f</span> <span class="op">&gt;</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t686" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;math.medianshrink&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;n&quot;</span><span class="op">:</span><span class="nam">shrink_f</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t687" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_xsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t688" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_ysize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t689" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nz</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_zsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t690" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t691" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t692" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;meanshrink&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t693" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrink_f</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">meanshrink</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t694" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">shrink_f</span> <span class="op">&gt;</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t695" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;math.meanshrink&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;n&quot;</span><span class="op">:</span><span class="nam">shrink_f</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t696" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_xsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t697" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_ysize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t698" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nz</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_zsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t699" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t700" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t701" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;fouriershrink&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t702" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">shrink_f</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">fouriershrink</span><span class="op">[</span><span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t703" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">shrink_f</span> <span class="op">&gt;</span> <span class="num">1</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t704" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">process_inplace</span><span class="op">(</span><span class="str">&quot;math.fft.resample&quot;</span><span class="op">,</span><span class="op">{</span><span class="str">&quot;n&quot;</span><span class="op">:</span><span class="nam">shrink_f</span><span class="op">}</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t705" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nx</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_xsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t706" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ny</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_ysize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t707" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nz</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_zsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t708" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t709" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t710" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;fftclip&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t711" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">fftclip</span><span class="op">)</span><span class="op">==</span><span class="num">3</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t712" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="op">(</span><span class="nam">fnx</span><span class="op">,</span> <span class="nam">fny</span><span class="op">,</span> <span class="nam">fnz</span><span class="op">)</span> <span class="op">=</span> <span class="nam">options</span><span class="op">.</span><span class="nam">fftclip</span><span class="strut">&nbsp;</span></p>
<p id="t713" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t714" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&#39;fftclip option takes either 3 arguments. --fftclip=x,y,z&#39;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t715" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span><span class="strut">&nbsp;</span></p>
<p id="t716" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t717" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">fft</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">do_fft</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t718" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">padfft</span> <span class="op">=</span> <span class="nam">fft</span><span class="op">.</span><span class="nam">get_clip</span><span class="op">(</span><span class="nam">Region</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">fnx</span><span class="op">+</span><span class="num">2</span><span class="op">,</span> <span class="nam">fny</span><span class="op">,</span> <span class="nam">fnz</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t719" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span> <span class="op">=</span> <span class="nam">padfft</span><span class="op">.</span><span class="nam">do_ift</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t720" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">option1</span><span class="op">]</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t721" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t722" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;icos5fhalfmap&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t723" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;not implemented yet&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t724" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t725" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;tophalf&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t726" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">half</span> <span class="op">=</span> <span class="nam">data</span><span class="op">.</span><span class="nam">get_top_half</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t727" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span> <span class="op">=</span> <span class="nam">half</span><span class="strut">&nbsp;</span></p>
<p id="t728" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t729" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">elif</span> <span class="nam">option1</span> <span class="op">==</span> <span class="str">&quot;outtype&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t730" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">options</span><span class="op">.</span><span class="nam">outtype</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t731" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">options</span><span class="op">.</span><span class="nam">outtype</span> <span class="op">=</span> <span class="str">&quot;unknown&quot;</span><span class="strut">&nbsp;</span></p>
<p id="t732" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t733" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print_iminfo(data, &quot;Final&quot;)</span><span class="strut">&nbsp;</span></p>
<p id="t734" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">!=</span><span class="str">&quot;float&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t735" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">outnorescale</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t736" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com"># This sets the minimum and maximum values to the range for the specified type, which should result in no rescaling</span><span class="strut">&nbsp;</span></p>
<p id="t737" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">outmode</span><span class="op">=</span><span class="nam">file_mode_map</span><span class="op">[</span><span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t738" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">[</span><span class="str">&quot;render_min&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">file_mode_range</span><span class="op">[</span><span class="nam">outmode</span><span class="op">]</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t739" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">[</span><span class="str">&quot;render_max&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">file_mode_range</span><span class="op">[</span><span class="nam">outmode</span><span class="op">]</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t740" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t741" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">[</span><span class="str">&quot;render_min&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;minimum&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t742" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">[</span><span class="str">&quot;render_max&quot;</span><span class="op">]</span><span class="op">=</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;maximum&quot;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t743" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;rescale output to range {} - {}&quot;</span><span class="op">.</span><span class="nam">format</span><span class="op">(</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;render_min&quot;</span><span class="op">]</span><span class="op">,</span><span class="nam">data</span><span class="op">[</span><span class="str">&quot;render_max&quot;</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t744" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t745" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">unstacking</span><span class="op">:</span>&nbsp; <span class="com">#output a series numbered single image files</span><span class="strut">&nbsp;</span></p>
<p id="t746" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&#39;.&#39;</span><span class="op">)</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">+</span><span class="str">&#39;-&#39;</span><span class="op">+</span><span class="nam">str</span><span class="op">(</span><span class="nam">img_index</span><span class="op">+</span><span class="num">1</span><span class="op">)</span><span class="op">.</span><span class="nam">zfill</span><span class="op">(</span><span class="nam">len</span><span class="op">(</span><span class="nam">str</span><span class="op">(</span><span class="nam">nimg</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span> <span class="str">&#39;.&#39;</span> <span class="op">+</span> <span class="nam">outfile</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&#39;.&#39;</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="num">1</span><span class="op">]</span><span class="op">,</span> <span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="nam">EMUtil</span><span class="op">.</span><span class="nam">ImageType</span><span class="op">.</span><span class="nam">IMAGE_UNKNOWN</span><span class="op">,</span> <span class="nam">False</span><span class="op">,</span> <span class="nam">None</span><span class="op">,</span> <span class="nam">file_mode_map</span><span class="op">[</span><span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">]</span><span class="op">,</span> <span class="key">not</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">swap</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t747" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span>&nbsp;&nbsp; <span class="com">#output a single 2D image or a 2D stack</span><span class="strut">&nbsp;</span></p>
<p id="t748" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">options</span><span class="op">.</span><span class="nam">append</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t749" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span> <span class="op">-</span><span class="num">1</span><span class="op">,</span> <span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_ext_type</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">outtype</span><span class="op">)</span><span class="op">,</span> <span class="nam">False</span><span class="op">,</span> <span class="nam">None</span><span class="op">,</span> <span class="nam">file_mode_map</span><span class="op">[</span><span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">]</span><span class="op">,</span> <span class="key">not</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">swap</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t750" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t751" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">write_image</span><span class="op">(</span><span class="nam">outfile</span><span class="op">,</span> <span class="nam">img_index</span><span class="op">,</span> <span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_ext_type</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">outtype</span><span class="op">)</span><span class="op">,</span> <span class="nam">False</span><span class="op">,</span> <span class="nam">None</span><span class="op">,</span> <span class="nam">file_mode_map</span><span class="op">[</span><span class="nam">options</span><span class="op">.</span><span class="nam">outmode</span><span class="op">]</span><span class="op">,</span> <span class="key">not</span><span class="op">(</span><span class="nam">options</span><span class="op">.</span><span class="nam">swap</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t752" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t753" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">img_index</span> <span class="op">+=</span> <span class="num">1</span><span class="strut">&nbsp;</span></p>
<p id="t754" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">append_option</span> <span class="key">in</span> <span class="nam">append_options</span><span class="op">:</span>&nbsp; &nbsp; <span class="com">#clean up the multi-option counter for next image</span><span class="strut">&nbsp;</span></p>
<p id="t755" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">index_d</span><span class="op">[</span><span class="nam">append_option</span><span class="op">]</span> <span class="op">=</span> <span class="num">0</span><span class="strut">&nbsp;</span></p>
<p id="t756" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t757" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">E2end</span><span class="op">(</span><span class="nam">logid</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t758" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t759" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t760" class="pln"><span class="com">#parse_file() will read the input image file and return a list of EMData() object</span><span class="strut">&nbsp;</span></p>
<p id="t761" class="stm mis"><span class="key">def</span> <span class="nam">parse_infile</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span> <span class="nam">first</span><span class="op">,</span> <span class="nam">last</span><span class="op">,</span> <span class="nam">step</span><span class="op">,</span> <span class="nam">apix</span><span class="op">=</span><span class="nam">None</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t762" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#def parse_infile(infile, indxs):</span><span class="strut">&nbsp;</span></p>
<p id="t763" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">infile</span><span class="op">[</span><span class="num">0</span><span class="op">]</span><span class="op">==</span><span class="str">&quot;:&quot;</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t764" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">parm</span><span class="op">=</span><span class="nam">infile</span><span class="op">.</span><span class="nam">split</span><span class="op">(</span><span class="str">&quot;:&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t765" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parm</span><span class="op">)</span><span class="op">==</span><span class="num">4</span> <span class="op">:</span> <span class="nam">parm</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="num">0</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t766" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">len</span><span class="op">(</span><span class="nam">parm</span><span class="op">)</span><span class="op">!=</span><span class="num">5</span> <span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t767" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;Error: please specify &#39;:X:Y:Z:fillval&#39; to create a new volume&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t768" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">sys</span><span class="op">.</span><span class="nam">exit</span><span class="op">(</span><span class="num">1</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t769" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t770" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ret</span><span class="op">=</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">int</span><span class="op">(</span><span class="nam">parm</span><span class="op">[</span><span class="num">1</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="nam">int</span><span class="op">(</span><span class="nam">parm</span><span class="op">[</span><span class="num">2</span><span class="op">]</span><span class="op">)</span><span class="op">,</span><span class="nam">int</span><span class="op">(</span><span class="nam">parm</span><span class="op">[</span><span class="num">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t771" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">ret</span><span class="op">.</span><span class="nam">to_value</span><span class="op">(</span><span class="nam">float</span><span class="op">(</span><span class="nam">parm</span><span class="op">[</span><span class="num">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t772" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span> <span class="op">[</span><span class="nam">ret</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t773" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t774" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">nimg</span> <span class="op">=</span> <span class="nam">EMUtil</span><span class="op">.</span><span class="nam">get_image_count</span><span class="op">(</span><span class="nam">infile</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t775" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t776" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span><span class="nam">nimg</span> <span class="op">&gt;</span> <span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t777" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="com">#print &quot;it appears %s contains %d image&quot; % (infile, nimg)</span><span class="strut">&nbsp;</span></p>
<p id="t778" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">nimg</span><span class="op">-</span><span class="num">1</span><span class="op">)</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># we read the last image, since it should always exist</span><span class="strut">&nbsp;</span></p>
<p id="t779" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t780" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">x</span> <span class="op">=</span> <span class="nam">d</span><span class="op">.</span><span class="nam">get_xsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t781" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">y</span> <span class="op">=</span> <span class="nam">d</span><span class="op">.</span><span class="nam">get_ysize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t782" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">z</span> <span class="op">=</span> <span class="nam">d</span><span class="op">.</span><span class="nam">get_zsize</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t783" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t784" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apixdata</span> <span class="op">=</span> <span class="nam">d</span><span class="op">[</span><span class="str">&#39;apix_x&#39;</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t785" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">apix</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t786" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">apix</span> <span class="op">=</span> <span class="nam">apixdata</span><span class="strut">&nbsp;</span></p>
<p id="t787" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t788" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="op">(</span><span class="nam">z</span> <span class="op">==</span> <span class="num">1</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t789" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;the images are 2D - I will now make a 3D image out of the 2D images&quot;</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t790" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t791" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">return_data</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t792" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">return_data</span><span class="op">.</span><span class="nam">set_size</span><span class="op">(</span><span class="nam">x</span><span class="op">,</span> <span class="nam">y</span><span class="op">,</span> <span class="nam">nimg</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t793" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">range</span><span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="nam">nimg</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t794" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span><span class="op">.</span><span class="nam">read_image</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span> <span class="nam">i</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t795" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">return_data</span><span class="op">.</span><span class="nam">insert_clip</span><span class="op">(</span><span class="nam">d</span><span class="op">,</span> <span class="op">(</span><span class="num">0</span><span class="op">,</span> <span class="num">0</span><span class="op">,</span> <span class="nam">i</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t796" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="nam">apix</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t797" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">return_data</span><span class="op">[</span><span class="str">&#39;apix_x&#39;</span><span class="op">]</span><span class="op">=</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t798" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">return_data</span><span class="op">[</span><span class="str">&#39;apix_y&#39;</span><span class="op">]</span><span class="op">=</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t799" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">return_data</span><span class="op">[</span><span class="str">&#39;apix_z&#39;</span><span class="op">]</span><span class="op">=</span><span class="nam">apix</span><span class="strut">&nbsp;</span></p>
<p id="t800" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">return_data</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t801" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span> <span class="nam">data</span><span class="strut">&nbsp;</span></p>
<p id="t802" class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t803" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">print</span><span class="op">(</span><span class="str">&quot;the image is a 3D stack - I will process images from %d to %d&quot;</span> <span class="op">%</span> <span class="op">(</span><span class="nam">first</span><span class="op">,</span> <span class="nam">last</span><span class="op">)</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t804" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span> <span class="op">=</span> <span class="op">[</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t805" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t806" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">for</span> <span class="nam">i</span> <span class="key">in</span> <span class="nam">xrange</span><span class="op">(</span><span class="nam">first</span><span class="op">,</span> <span class="nam">last</span><span class="op">+</span><span class="num">1</span><span class="op">,</span> <span class="nam">step</span><span class="op">)</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t807" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">i</span><span class="op">,</span><span class="nam">True</span><span class="op">)</span>&nbsp; &nbsp; &nbsp;&nbsp; <span class="com"># header only</span><span class="strut">&nbsp;</span></p>
<p id="t808" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t809" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">if</span> <span class="key">not</span> <span class="nam">first</span> <span class="op">-</span> <span class="nam">last</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t810" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">d</span> <span class="op">=</span> <span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="nam">i</span><span class="op">)</span>&nbsp; &nbsp; <span class="com"># header only</span><span class="strut">&nbsp;</span></p>
<p id="t811" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t812" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">data</span><span class="op">.</span><span class="nam">append</span><span class="op">(</span><span class="nam">d</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
<p id="t813" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="key">return</span> <span class="nam">data</span><span class="strut">&nbsp;</span></p>
<p id="t814" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="key">else</span><span class="op">:</span> <span class="key">return</span> <span class="op">[</span><span class="nam">EMData</span><span class="op">(</span><span class="nam">infile</span><span class="op">,</span><span class="num">0</span><span class="op">)</span><span class="op">]</span><span class="strut">&nbsp;</span></p>
<p id="t815" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t816" class="pln"><span class="strut">&nbsp;</span></p>
<p id="t817" class="stm mis"><span class="key">if</span> <span class="nam">__name__</span> <span class="op">==</span> <span class="str">&quot;__main__&quot;</span><span class="op">:</span><span class="strut">&nbsp;</span></p>
<p id="t818" class="stm mis">&nbsp; &nbsp; &nbsp; &nbsp; <span class="nam">main</span><span class="op">(</span><span class="op">)</span><span class="strut">&nbsp;</span></p>
                
            </td>
        </tr>
    </table>
</div>

<div id="footer">
    <div class="content">
        <p>
            <a class="nav" href="index.html">&#xab; index</a> &nbsp; &nbsp; <a class="nav" href="https://coverage.readthedocs.org">coverage.py v4.0.3</a>,
            created at 2018-07-02 05:34
        </p>
    </div>
</div>

</body>
</html>
